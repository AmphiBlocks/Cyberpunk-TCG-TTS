{
  "SaveName": "Riftbound - LGS Table - riftboundgg support",
  "EpochTime": 1771216779,
  "Date": "2/15/2026 8:39:39 PM",
  "VersionNumber": "v14.1.8",
  "GameMode": "Riftbound : LGS Table",
  "GameType": "Game",
  "GameComplexity": "Medium Complexity",
  "PlayingTime": [
    30,
    90
  ],
  "PlayerCounts": [
    2,
    2
  ],
  "Tags": [
    "Card Games",
    "TCG",
    "Trading Card Game",
    "English",
    "League of Legends",
    "Riftbound",
    "Project K"
  ],
  "Gravity": 0.5,
  "PlayArea": 0.5,
  "Table": "Table_Custom",
  "TableURL": "https://steamusercontent-a.akamaihd.net/ugc/12774099564723684255/1D8963BAC472B1866D9DF5A8712FBB026FCBF442/",
  "Sky": "Sky_Forest",
  "Note": "",
  "TabStates": {
    "0": {
      "title": "Rules",
      "body": "",
      "color": "Grey",
      "visibleColor": {
        "r": 0.5,
        "g": 0.5,
        "b": 0.5
      },
      "id": 0
    },
    "1": {
      "title": "White",
      "body": "",
      "color": "White",
      "visibleColor": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "id": 1
    },
    "2": {
      "title": "Brown",
      "body": "",
      "color": "Brown",
      "visibleColor": {
        "r": 0.443,
        "g": 0.231,
        "b": 0.09
      },
      "id": 2
    },
    "3": {
      "title": "Red",
      "body": "",
      "color": "Red",
      "visibleColor": {
        "r": 0.856,
        "g": 0.1,
        "b": 0.094
      },
      "id": 3
    },
    "4": {
      "title": "Orange",
      "body": "",
      "color": "Orange",
      "visibleColor": {
        "r": 0.956,
        "g": 0.392,
        "b": 0.113
      },
      "id": 4
    },
    "5": {
      "title": "Yellow",
      "body": "",
      "color": "Yellow",
      "visibleColor": {
        "r": 0.905,
        "g": 0.898,
        "b": 0.172
      },
      "id": 5
    },
    "6": {
      "title": "Green",
      "body": "",
      "color": "Green",
      "visibleColor": {
        "r": 0.192,
        "g": 0.701,
        "b": 0.168
      },
      "id": 6
    },
    "7": {
      "title": "Blue",
      "body": "",
      "color": "Blue",
      "visibleColor": {
        "r": 0.118,
        "g": 0.53,
        "b": 1.0
      },
      "id": 7
    },
    "8": {
      "title": "Teal",
      "body": "",
      "color": "Teal",
      "visibleColor": {
        "r": 0.129,
        "g": 0.694,
        "b": 0.607
      },
      "id": 8
    },
    "9": {
      "title": "Purple",
      "body": "",
      "color": "Purple",
      "visibleColor": {
        "r": 0.627,
        "g": 0.125,
        "b": 0.941
      },
      "id": 9
    },
    "10": {
      "title": "Pink",
      "body": "",
      "color": "Pink",
      "visibleColor": {
        "r": 0.96,
        "g": 0.439,
        "b": 0.807
      },
      "id": 10
    },
    "11": {
      "title": "Black",
      "body": "",
      "color": "Black",
      "visibleColor": {
        "r": 0.25,
        "g": 0.25,
        "b": 0.25
      },
      "id": 11
    }
  },
  "MusicPlayer": {
    "RepeatSong": false,
    "PlaylistEntry": 0,
    "CurrentAudioTitle": "Burn It All Down Worlds 2021",
    "CurrentAudioURL": "https://steamusercontent-a.akamaihd.net/ugc/40076514767533224/B991BE8D698F078DF5D961922AF422B020F70360/",
    "AudioLibrary": []
  },
  "Grid": {
    "Type": 0,
    "Lines": false,
    "Color": {
      "r": 0.0,
      "g": 0.0,
      "b": 0.0
    },
    "Opacity": 0.75,
    "ThickLines": false,
    "Snapping": false,
    "Offset": false,
    "BothSnapping": false,
    "xSize": 2.0,
    "ySize": 2.0,
    "PosOffset": {
      "x": 0.0,
      "y": 1.0,
      "z": 0.0
    }
  },
  "Lighting": {
    "LightIntensity": 0.54,
    "LightColor": {
      "r": 1.0,
      "g": 0.9804,
      "b": 0.8902
    },
    "AmbientIntensity": 1.18800044,
    "AmbientType": 0,
    "AmbientSkyColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "AmbientEquatorColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "AmbientGroundColor": {
      "r": 0.5,
      "g": 0.5,
      "b": 0.5
    },
    "ReflectionIntensity": 1.0,
    "LutIndex": 0,
    "LutContribution": 1.0,
    "LutURL": ""
  },
  "Hands": {
    "Enable": true,
    "DisableUnused": false,
    "Hiding": 0
  },
  "ComponentTags": {
    "labels": [
      {
        "displayed": "Game Marker",
        "normalized": "game_marker"
      },
      {
        "displayed": "StatusToken",
        "normalized": "statustoken"
      }
    ]
  },
  "Turns": {
    "Enable": false,
    "Type": 0,
    "TurnOrder": [],
    "Reverse": false,
    "SkipEmpty": false,
    "DisableInteractions": false,
    "PassTurns": true,
    "TurnColor": ""
  },
  "CameraStates": [
    null,
    {
      "Position": {
        "x": 22.4021931,
        "y": -2.5,
        "z": -1.22805107
      },
      "Rotation": {
        "x": 46.67399,
        "y": 1.33290517,
        "z": 0.0
      },
      "Distance": 56.9530945,
      "Zoomed": false,
      "AbsolutePosition": {
        "x": 21.4931717,
        "y": 38.93118,
        "z": -40.2957649
      }
    },
    null,
    null,
    null,
    null,
    null,
    null,
    null,
    null
  ],
  "DecalPallet": [],
  "LuaScript": "-- Constants\r\nregular_card_scale = 1.42055011\r\nmini_card_scale = 1\r\ncard_back = \"https://steamusercontent-a.akamaihd.net/ugc/17688218182195221720/C0AEF1C3E0A5694D46C19B17437C2C07790FF943/\"\r\ncard_back_white = \"https://steamusercontent-a.akamaihd.net/ugc/11360156058649621400/9E42514E1839ADB4B820E74D40E4FCB60B480F02/\"\r\ncard_back_black = \"https://steamusercontent-a.akamaihd.net/ugc/10261669853776692125/9796B9F1E68254EFEAC0913340E02D083A076F62/\"\r\ncard_back_blue = \"https://steamusercontent-a.akamaihd.net/ugc/17688218182195221720/C0AEF1C3E0A5694D46C19B17437C2C07790FF943/\"\r\n\r\ndefault_card_back_map =\r\n{\r\n  battlefield = card_back_black,\r\n  rune = card_back_white,\r\n  main = card_back_blue,\r\n  default = card_back_blue,\r\n  legends = card_back_black,\r\n  champion = card_back_blue,\r\n}\r\n\r\ncard_scale_by_player = {\r\n  Red = regular_card_scale,\r\n  Blue = regular_card_scale,\r\n  Green = regular_card_scale,\r\n  Purple = regular_card_scale\r\n}\r\n\r\nui_decklist_state = {}\r\nui_sleeve_state = {\r\n  Red = {},\r\n  Blue = {},\r\n  Green = {},\r\n  Purple = {}\r\n}\r\nui_material_deck_sleeve_state = {}\r\nui_playmat_image_state = {}\r\n\r\nlocal enableAnalytics = true\r\nlocal analyticsSessionID = 0\r\nlocal version = \"0.50\"\nlocal playformat = \"OGN\" -- needs to be updated anytime temporary/spoiler card art is replaced with final card art. Suggest updating to new set name.\r\n\r\nlocal analyticsURL = \"https://script.google.com/macros/s/AKfycbwtUbAa8yvBJbQqA2WrVl8AyYFZo0WFX2eGhps7HRDFkdl761vmftYOsW3Jah0iIU2D_A/exec\"\r\n\r\n-- FNV-1a 32-bit hash\r\nfunction fnv1a_32(str)\r\n    local hash = 0x811c9dc5\r\n    for i = 1, #str do\r\n        hash = bit32.bxor(hash, string.byte(str, i))\r\n        hash = bit32.band(hash * 0x01000193, 0xFFFFFFFF)\r\n    end\r\n    return hash\r\nend\r\n\r\n-- Make a clean “reduced” slug: lowercase, dashes for spaces, strip punctuation (incl. '/').\r\nlocal function toReducedSlug(name)\r\n  local s = (name or \"\"):lower()\r\n  s = s:gsub(\"%s+\", \"-\")         -- spaces -> dash\r\n  s = s:gsub(\"[^%w%-]\", \"\")      -- strip everything that's not [a-z0-9-]\r\n  s = s:gsub(\"%-+\", \"-\")         -- collapse repeats\r\n  return s\r\nend\r\n\r\nfunction sendAnalytics(eventName, player, extra)\r\n  if version==\"dev\" then return end\r\n  local sid = player and player.steam_id or \"\"\r\n  -- anonymize the player's steam id\r\n  local anonID = sid ~= \"\" and fnv1a_32(\"cruxisfine\" .. sid) or 0\r\n  local payload = {\r\n    mod       = \"Cyberpunk : LGS Table\",\r\n    version   = version,\r\n    event     = eventName,\r\n    timestamp = os.time(),\r\n    session   = analyticsSessionID,\r\n    player    = anonID,\r\n    extra     = extra or {},\r\n  }\r\n  local body    = JSON.encode(payload)\r\n  local headers = { [\"Content-Type\"] = \"application/json\" }\r\n\r\n  WebRequest.custom(\r\n    analyticsURL,      -- url\r\n    \"POST\",            -- method\r\n    true,              -- download response body\r\n    body,              -- data to send\r\n    headers,           -- headers\r\n    function(req)      -- callback\r\n      if req.is_error or req.response_code >= 400 then\r\n        print(string.format(\r\n          \"Analytics ➜ ERROR %s: %s\",\r\n          tostring(req.response_code),\r\n          req.error or req.text\r\n        ))\r\n      end\r\n    end\r\n  )\r\nend\r\n\r\nlocal function sanitizePrivateData(data)\r\n  local out = {}\r\n\r\n  for k, v in pairs(data or {}) do\r\n    if k == \"card_id\" or k == \"unitcard\" or k == \"gearcard\" then\r\n      -- strip\r\n    else\r\n      out[k] = v\r\n    end\r\n  end\r\n\r\n  return out\r\nend\r\n\r\nlocal function getOrCreateNotebook(title, color)\r\n  local tabs = getNotebookTabs()\r\n\r\n  for _, t in ipairs(tabs) do\r\n    if t.title == title then\r\n      return t\r\n    end\r\n  end\r\n\r\n  local tab = {\r\n    title = title,\r\n    body  = \"Replay v1\",\r\n    color = color or \"Grey\"\r\n  }\r\n  addNotebookTab(tab)\r\n  return tab\r\nend\r\n\r\nlocal function appendToNotebook(title, line, color)\r\n  local tab = getOrCreateNotebook(title, \"Grey\")\r\n\r\n  if tab.body ~= \"\" then\r\n    tab.body = tab.body .. \"\\n\"\r\n  end\r\n  tab.body = tab.body .. line\r\n\r\n  editNotebookTab(tab)\r\nend\r\n\r\nReplayLog = {\r\n  seq = 0,\r\n  startTime = os.clock()\r\n}\r\n\r\nlocal function nowMs()\r\n  return math.floor((os.clock() - ReplayLog.startTime) * 1000)\r\nend\r\n\r\nlocal function encodeEvent(evt)\r\n  return JSON.encode(evt)\r\nend\r\n\r\nreplay_log_enabled = false\r\n\r\nfunction ReplayLog.log(eventType, playerColor, data, visibility)\r\n  if not replay_log_enabled then return end\r\n  ReplayLog.seq = ReplayLog.seq + 1\r\n\r\n  local evt = {\r\n    meta = {\r\n      t = nowMs(),\r\n      seq = ReplayLog.seq,\r\n      v = 1,\r\n    },\r\n    type = eventType,\r\n    player = playerColor,\r\n    visibility = visibility or \"public\",\r\n    data = data or {}\r\n  }\r\n\r\n  local encoded = encodeEvent(evt)\r\n\r\n  appendToNotebook(\"Game Log (Global)\", encoded, \"Grey\")\r\n\r\n  print(eventType)\r\n\r\n  local colors_to_iterate = isFourPlayerMode() and {\"Red\", \"Blue\", \"Green\", \"Purple\"} or {\"Red\", \"Blue\"}\r\n\r\n  for _, color in ipairs(colors_to_iterate) do\r\n    local title = \"Game Log (\" .. color .. \")\"\r\n\r\n    if evt.visibility == \"public\" then\r\n      appendToNotebook(title, encoded, color)\r\n\r\n    elseif color == playerColor then\r\n      appendToNotebook(title, encoded, color)\r\n\r\n    else\r\n      local sanitizedEvt = {\r\n        meta = evt.meta,\r\n        type = evt.type,\r\n        player = evt.player,\r\n        visibility = \"private_sanitized\",\r\n        data = sanitizePrivateData(evt.data)\r\n      }\r\n\r\n      appendToNotebook(title, encodeEvent(sanitizedEvt), color)\r\n    end\r\n  end\r\nend\r\n\r\nfunction onLoad()\r\n  analyticsSessionID = os.time()\r\n  sendAnalytics(\"load\", Player[\"White\"], nil)\r\n  print(\"Type 'spawn cardname' to spawn a card with that name.\")\r\n  print(\"Type 'tutor cardname' to grab that card out of your deck.\")\r\nend\r\n\r\nfunction toggleAnalytics(player,value,index)\r\n  enableAnalytics = not enableAnalytics\r\n  print(\"Analytics collected? - \" .. tostring(enableAnalytics))\r\nend\r\n\r\nfunction onPlayerConect(player_id)\r\n  player_id.promote()\r\nend\r\n\r\nfunction onPlayerDisconnect(player_id)\r\n  sendAnalytics(\"disconnect\", player_id, nil)\r\nend\r\n\r\n-- Snappoints\r\nlocal left_col0_x_off = 2.9\r\nlocal left_col_x_off = 2.21\r\nlocal left_col2_x_off = 1.62\r\nlocal right_col0_x_off = -left_col0_x_off\r\nlocal right_col_x_off = -left_col_x_off\r\nlocal right_col2_x_off = -left_col2_x_off\r\n\r\nlocal left_mid_col_x_off = 0.425\r\nlocal right_mid_col_x_off = -left_mid_col_x_off\r\n\r\nlocal top_row_z_off = -0.48\r\nlocal middle_row_z_off = 0.460\r\nlocal bottom_row_z_off = 1.22\r\n\r\nlocal banish_offset_x = 0.035\r\n\r\nlocal memory_row_z = 0.55\r\n\r\n\r\ndeck_position = {\r\n\r\n  main = {right_col_x_off, 0.5, top_row_z_off},\r\n  sideboard = {left_col0_x_off, 0.1, bottom_row_z_off},\r\n  battlefield = {right_col0_x_off, 0.1, bottom_row_z_off},\r\n  trash = {right_col_x_off, 0.5, middle_row_z_off},\r\n  rune = {left_col_x_off, 0.5, middle_row_z_off},\r\n  legends = {left_col2_x_off, 0.5, top_row_z_off},\r\n  champion = {left_col_x_off, 0.5, top_row_z_off},\r\n\r\n  spawn = {right_col0_x_off, 0, top_row_z_off},\r\n  extra = {left_col0_x_off, 0, top_row_z_off},\r\n\r\n-- ga vestigials\r\n\r\n  material = {left_col_x_off, 0.5, top_row_z_off},\r\n  banished = {right_col_x_off+banish_offset_x, 0.5, top_row_z_off},\r\n  token = {left_col0_x_off, 0, top_row_z_off},\r\n  generated = {left_col0_x_off, 0, top_row_z_off},\r\n  references = {left_col0_x_off, 0, top_row_z_off},\r\n\r\n  graveyard = {right_col_x_off, 0.5, middle_row_z_off},\r\n  mastery = {right_col0_x_off, 0, top_row_z_off}\r\n}\r\n\r\n\r\nfunction dice_colors()\r\n  local colors = {\r\n      Damage      = {r=0.9, g=0.0, b=0.0},\r\n      Prevention  = {r=0.1, g=0.3, b=0.8},\r\n      Buff        = {r=0.0, g=0.0, b=0.0},\r\n      Durability  = {r=0.3, g=0.3, b=0.3},\r\n      Level       = {r=0.6, g=0.1, b=0.6},\r\n      Preparation = {r=0.2, g=0.7, b=0.2},\r\n      Enlighten   = {r=0.7, g=0.4, b=0.1},\r\n      Quest       = {r=0.8, g=0.4, b=0.9},\r\n      Glimmer     = {r=0.5, g=0.4, b=0.9},\r\n      Age         = {r=0.6, g=0.6, b=0.2},\r\n      Lash        = {r=0.2, g=0.2, b=0.8},\r\n      Debuff      = {r=0.8, g=0.2, b=0.4},\r\n      Wither      = {r=0.0, g=0.8, b=0.8},\r\n      Aim         = {r=0.7, g=0.7, b=0.7},\r\n      Refinement  = {r=0.4, g=0.7, b=0.9},\r\n      Charge      = {r=0.8, g=0.6, b=0.9},\r\n      Tactic      = {r=0.6, g=0.7, b=0.8},\r\n      Music       = {r=0.6, g=0.3, b=0.5},\r\n  }\r\n  return colors\r\nend\r\n\r\nfunction dice_types()\r\n    local types = {}\r\n    for k, _ in pairs(dice_colors()) do\r\n        table.insert(types, k)\r\n    end\r\n    return types\r\nend\r\n\r\nfunction token_colors()\r\n  local colors = {\r\n      Distant       = {r=0.9, g=0.7, b=0.7},\r\n      Imbued        = {r=0.0, g=0.7, b=0.0},\r\n      Fostered      = {r=0.3, g=0.3, b=0.3},\r\n      Fracturized   = {r=0.3, g=0.75, b=0.8},\r\n      Suppressed    = {r=0.2, g=0.7, b=0.2},\r\n      Stealth       = {r=0.7, g=0.4, b=0.1},\r\n      Ephemeral     = {r=0.8, g=0.4, b=0.9},\r\n      Used_Up       = {r=0.5, g=0.4, b=0.9},\r\n      Omen          = {r=0.6, g=0.6, b=0.2},\r\n      Frenzy        = {r=0.2, g=0.2, b=0.8},\r\n      Distortion    = {r=0.8, g=0.2, b=0.4},\r\n      Dontwake      = {r=0.0, g=0.8, b=0.8},\r\n      Immortality   = {r=0.7, g=0.7, b=0.7},\r\n      True_Sight    = {r=0.4, g=0.7, b=0.9},\r\n      Spellshroud   = {r=0.8, g=0.6, b=0.9},\r\n      Brewed        = {r=0.6, g=0.7, b=0.8},\r\n      Woh           = {r=0.6, g=0.3, b=0.5},\r\n  }\r\n  return colors\r\nend\r\n\r\nQUICK_ACTION_BUTTONS = {\r\n  { label = \"Begin Turn\",       fn = \"Global/beginNewTurnProcedure\", },\r\n  { label = \"End Turn\",         fn = \"Global/endTurnProcedure\", },\r\n  { label = \"Peek 1\",           fn = \"Global/glimpseQuickAction\", },\r\n  { label = \"Reveal 1\",         fn = \"Global/revealQuickAction\", },\r\n  { label = \"Clear Mat\",        fn = \"Global/clearPlaymat\", },\r\n  { label = \"GG Go Next\",       fn = \"Global/resetToGameStart\", },\r\n}\r\n\r\nfunction token_types()\r\n    local types = {}\r\n    for k, _ in pairs(token_colors()) do\r\n        table.insert(types, k)\r\n    end\r\n    return types\r\nend\r\n\r\n\r\nfunction getSnapPosition (mat, position)\r\n  basic_position = deck_position[position]\r\n  scale = mat.getScale()\r\n  scaleFactor = scale.z / scale.x\r\n\r\n  return {basic_position[1] * scaleFactor, basic_position[2], basic_position[3]}\r\nend\r\n\r\ncard_rotations = {\r\n  up = {0,0,0},\r\n  right = {0,90,0},\r\n  down = {0,180,0},\r\n  left = {0,270,0}\r\n}\r\n\r\nfunction setMatSnapPoints(mat, scaleFactor)\r\n  local inverseScale = 1 / (scaleFactor or 1)\r\n  local snap_points = {\r\n    {\r\n      position = getSnapPosition(mat, \"legends\"),\r\n      rotation = card_rotations[\"up\"],\r\n      rotation_snap = true\r\n    },\r\n    {\r\n      position = getSnapPosition(mat, \"champion\"),\r\n      rotation = card_rotations[\"up\"],\r\n      rotation_snap = true\r\n    },\r\n    {\r\n      position = getSnapPosition(mat, \"main\"),\r\n      rotation = card_rotations[\"up\"],\r\n      rotation_snap = true\r\n    },\r\n    {\r\n      position = getSnapPosition(mat, \"rune\"),\r\n      rotation = card_rotations[\"up\"],\r\n      rotation_snap = true\r\n    },\r\n    {\r\n      position = getSnapPosition(mat, \"trash\"),\r\n      rotation = card_rotations[\"up\"],\r\n      rotation_snap = true\r\n    },\r\n    {\r\n      position = getSnapPosition(mat, \"battlefield\"),\r\n      rotation = card_rotations[\"left\"],\r\n      rotation_snap = true\r\n    },\r\n    {\r\n      position = getSnapPosition(mat, \"sideboard\"),\r\n      rotation = card_rotations[\"left\"],\r\n      rotation_snap = true\r\n    }\r\n  }\r\n\r\n  local memory_start = -0.975 * inverseScale\r\n  local memory_offset = 0.150 * inverseScale\r\n  local memory_count = 14\r\n\r\n  for memory_index = 0, memory_count - 1 do\r\n    local memory_snap_point = {\r\n      position = {\r\n        memory_start + (memory_index * memory_offset),\r\n        0,\r\n        memory_row_z\r\n      },\r\n      rotation = {0, 0, 0},\r\n      rotation_snap = true\r\n    }\r\n    --table.insert(snap_points, memory_snap_point)\r\n  end\r\n\r\n  mat.setSnapPoints(snap_points)\r\n  mat.interactable = false\r\nend\r\n\r\nfunction toggleOptionsLayout(player)\r\n  toggleVisibility(player, \"options_layout\")\r\n  toggleVisibility(player, \"menu_layout\")\r\nend\r\n\r\nfunction toggleQuickHelp(player)\r\n  toggleVisibility(player, \"quick_quick_actions_help\")\r\nend\r\n\r\nfunction toggleHelpersLayout(player)\r\n  toggleVisibility(player, \"helpers_layout\")\r\n  toggleVisibility(player, \"menu_layout\")\r\nend\r\n\r\nfunction toggleImportLayout(player)\r\n  toggleVisibility(player, \"import_layout\")\r\n  toggleVisibility(player, \"fullscreen_import_container\")\r\n\r\n  toggleVisibility(player, \"menu_layout\")\r\nend\r\n\r\nfunction shutImportLayout(player)\r\n  toggleVisibility(player, \"import_layout\", false)\r\n  toggleVisibility(player, \"fullscreen_import_container\", false)\r\n\r\n  toggleVisibility(player, \"menu_layout\", true)\r\nend\r\n\r\n\r\nfunction toggleMoreLayout(player)\r\n  toggleVisibility(player, \"import_sleeve_layout\")\r\nend\r\n\r\nfunction veryCool(player)\r\n  log(player.color .. \" was noticed by senpai. Very cool!\")\r\nend\r\n\r\nplaymats = {\r\n    Red    = \"35894d\",\r\n    Blue   = \"f0607e\",\r\n    Green  = \"53ddd0\",\r\n    Purple = \"a251c2\",\r\n}\r\n\r\nbags = {\r\n    Red    = \"7fd7f6\",\r\n    White   = \"421f2d\",\r\n    Purple   = \"9231d7\",\r\n    Blue  = \"5ddb44\",\r\n}\r\n\r\nscorecounters = {\r\n    Red    = \"96b1d6\",\r\n    Blue   = \"96b1d7\",\r\n    Green  = \"96b1d8\",\r\n    Purple = \"96b1d9\"\r\n}\r\n\r\ninitialquickactionpanels = {\r\n    Red    = \"3afac6\",\r\n    Blue   = \"e6da45\"\r\n}\r\n\r\nplayerhandzones = {\r\n    Red    = \"9e87d8\",\r\n    Blue   = \"32941e\",\r\n    Green = \"c6b5a0\",\r\n    Purple  = \"2c30da\"\r\n}\r\n\r\nplayerglimpsezones = {\r\n    Red    = \"7b7b42\",\r\n    Blue   = \"d45d18\",\r\n    Green = \"fab8ed\",\r\n    Purple  = \"6b7af4\"\r\n}\r\n\r\nplayerbattlefield1v1zonesWest = {\r\n  Red = \"b30ddd\",\r\n  Blue = \"edc262\"\r\n}\r\n\r\nplayerbattlefield1v1zonesEast = {\r\n  Red = \"b30dde\",\r\n  Blue = \"71d4a9\"\r\n}\r\n\r\nplayerbattlefieldFFAZonesWest = {\r\n  Red = \"ee409d\",\r\n  Blue = \"ee40dd\",\r\n  Green = \"ee40bd\",\r\n  Purple = \"ee40cd\"\r\n}\r\n\r\nplayerbattlefieldFFAZonesEast = {\r\n  Red = \"ee409b\",\r\n  Blue = \"ee40db\",\r\n  Green = \"ee40bb\",\r\n  Purple = \"ee40cb\"\r\n}\r\n\r\nplayerbattlefieldFFAZonesCenter = {\r\n  Red = \"ee409c\",\r\n  Blue = \"ee40dc\",\r\n  Green = \"ee40bc\",\r\n  Purple = \"ee40cc\"\r\n}\r\n\r\nplayerbases = {\r\n    Red    = \"e5fb87\",\r\n    Blue   = \"1236a0\",\r\n    Green  = \"5fd0e9\",\r\n    Purple = \"936992\"\r\n}\r\n\r\nplayerrunezones = {\r\n    Red    = \"70b7c0\",\r\n    Blue   = \"db3661\",\r\n    Green  = \"980a93\",\r\n    Purple = \"82dc50\"\r\n}\r\n\r\nplayermaterialdeckzones = {\r\n  Red    = \"f19275\",\r\n  Blue   = \"06c960\",\r\n  Green  = \"a5b274\",\r\n  Purple = \"2eb031\"\r\n}\r\n\r\nnotshuffledmarkers = {\r\n  Red = \"d80f44\",\r\n  Blue = \"b5216f\",\r\n  Green = \"6bfa05\",\r\n  Purple = \"52ab11\"\r\n}\r\n\r\nchooseonemarkers = {\r\n  Red = \"cdd84e\",\r\n  Blue = \"650908\",\r\n  Green = \"2bb427\",\r\n  Purple = \"7902f4\"\r\n}\r\n\r\nbattlefields1v1 = {\r\n  West = \"fa1d96\",\r\n  East = \"541d5c\",\r\n}\r\n\r\nbattlefieldsFFA = {\r\n  West = \"cb8139\",\r\n  Center = \"7772d5\",\r\n  East = \"4266ed\",\r\n}\r\n\r\nfunction glimpseQuickAction(player, value, index)\r\n  Global.call(\"glimpse1\", player.color)\r\nend\r\n\r\nfunction glimpse1(playerColor)\r\n\r\n  local deck = findPlayerDeckByName(playerColor, \"main\")\r\n  if not deck then return end\r\n\r\n  -- 1) Take the top card (index=0) off the deck,\r\n  --    dropping it just above the deck so it spawns in view\r\n  local spawnPos = deck.getPosition() + Vector(0, 2, 0)\r\n  local card = deck.takeObject({\r\n    index    = 0,\r\n    position = spawnPos,\r\n    smooth   = false\r\n  })\r\n\r\n  if card then\r\n    Wait.condition(function()\r\n      -- send it to the player’s hand (hand #2 here),\r\n      -- then register it with the Encoder\r\n      card.deal(1, playerColor, 2)\r\n      Encoder.call(\"APIencodeObject\", { obj = card })\r\n      Encoder.call(\"APIobjEnableProp\", { obj = card, propID = \"πGlimpse\" })\r\n\r\n    end, function()\r\n      return not card.spawning\r\n    end)\r\n  end\r\nend\r\n\r\nlocal revealCards = {}\r\n\r\n\r\nfunction removeRevealCardPhysics(card)\r\n  if revealCards[card.guid] and revealZoneArrivedCards[card.guid] then\r\n    card.use_gravity = true\r\n    revealCards[card.guid] = nil\r\n    revealZoneArrivedCards[card.guid] = nil\r\n  end\r\nend\r\n\r\nfunction revealQuickAction(player, value, index)\r\n  reveal1(player.color)\r\nend\r\n\r\nfunction reveal1(playerColor)\r\n\r\n  local deck = findPlayerDeckByName(playerColor, \"main\")\r\n  if not deck then return end\r\n\r\n  local mat = getPlaymat(playerColor)\r\n\r\n  -- 1) Take the top card (index=0) off the deck,\r\n  --    dropping it just above the deck so it spawns in view\r\n  local spawnPos = deck.getPosition() + Vector(0, 2, 0)\r\n  local card = deck.takeObject({\r\n    index    = 0,\r\n    position = spawnPos,\r\n    rotation = mat.getRotation(),\r\n    smooth   = false\r\n  })\r\n\r\n  if card then\r\n    Wait.condition(function()\r\n      card.use_gravity = false\r\n      card.drag_selectable = true\r\n\r\n      revealCards[card.guid] = os.time()\r\n      repositionRevealLine()\r\n    end, function()\r\n      return not card.spawning\r\n    end)\r\n  end\r\nend\r\n\r\n\r\nrevealZoneArrivedCards = {}\r\n\r\nfunction repositionRevealLine()\r\n    local REVEAL_ZONE_GUID = \"fad044\"\r\n    local REVEAL_ZONE_WIDTH_X = 16\r\n    local REVEAL_FLOAT_Y_OFFSET = 0.1\r\n    local REVEAL_FLOAT_Z_OFFSET = -0.9\r\n    local CARD_WIDTH_X = 2.5    -- world units, tune once\r\n\r\n    local zone = getObjectFromGUID(REVEAL_ZONE_GUID)\r\n    if not zone then return end\r\n\r\n    -- count cards\r\n    local timeSortedRevealCards = {}\r\n\r\n    local count = 0\r\n    for guid, timestamp in pairs(revealCards) do\r\n        table.insert(timeSortedRevealCards, {\r\n            guid = guid,\r\n            time = timestamp\r\n        })\r\n        count = count + 1\r\n    end\r\n    if count == 0 then return end\r\n\r\n    table.sort(timeSortedRevealCards, function(a, b)\r\n        return a.time < b.time\r\n    end)\r\n\r\n    local center = zone.getPosition()\r\n    local idealSpacing = CARD_WIDTH_X\r\n    local maxAllowedSpacing = REVEAL_ZONE_WIDTH_X / math.max(count - 1, 1)\r\n    local spacing = math.min(idealSpacing, maxAllowedSpacing)\r\n    local usedWidth = spacing * math.max(count - 1, 0)\r\n    local startX = center.x - (usedWidth / 2)\r\n\r\n\r\n    for i, entry in ipairs(timeSortedRevealCards) do\r\n        local card = getObjectFromGUID(entry.guid)\r\n        card.use_gravity = false\r\n        card.drag_selectable = true\r\n\r\n        card.setPositionSmooth({\r\n            startX + i * spacing,\r\n            center.y + REVEAL_FLOAT_Y_OFFSET*i,\r\n            center.z - REVEAL_FLOAT_Z_OFFSET\r\n        }, false, true)\r\n\r\n        Wait.condition( function()\r\n          revealZoneArrivedCards[card.guid] = card\r\n        end, function() return not card.isSmoothMoving() end\r\n\r\n        )\r\n    end\r\nend\r\n\r\ndeckcounts = {\r\n  Red = {12, 60},\r\n  Blue = {12, 60},\r\n  Green = {12, 60},\r\n  Purple = {12, 60}\r\n}\r\n\r\nfunction showSitDownHelp(player, value, id)\r\n  broadcastToColor(\r\n    \"Before Importing you have to SIT DOWN. (Click your name in the top right, then click one of the empty player spots at the table)\\r\\n\",\r\n    player.color,\r\n    {1,1,0}\r\n  )\r\nend\r\n\r\nfunction isFourPlayerMode()\r\n    local redMat = getObjectFromGUID(playmats.Red)\r\n    if not redMat then return true end\r\n    local posX = redMat.getPosition().x\r\n    return posX < -10\r\nend\r\n\r\nfunction isStillSwitching()\r\n  local redMat = getObjectFromGUID(playmats.Red)\r\n  if not redMat then return true end\r\n  return redMat.isSmoothMoving()\r\nend\r\n\r\nfunction toggleBigMat(player, value, index)\r\n    local mat = getObjectFromGUID(playmats[player.color])\r\n    if not mat then return end\r\n\r\n    local handzone = getObjectFromGUID(playerhandzones[player.color])\r\n    if not handzone then return end\r\n\r\n    local currentScale = mat.getScale().x\r\n    local newScale = 22 - currentScale\r\n    mat.setScale({newScale, 1, newScale})\r\n\r\n    local pos = handzone.getPosition()\r\n    pos.z = (pos.z > 0) and 57-pos.z or -57-pos.z\r\n    handzone.setPosition(pos)\r\nend\r\n\r\nfunction togglePlayerCount()\r\n\r\n    if isStillSwitching() then\r\n      print (\"Wait for switching to finish first!\")\r\n      return\r\n    end\r\n\r\n\r\n    local moveDistance = -24\r\n    local moveDistanceLess = -15\r\n    local hideDistance = -196\r\n    local bagDistance = 13\r\n    shouldLock = false\r\n\r\n    if isFourPlayerMode() then\r\n      moveDistance = -moveDistance\r\n      moveDistanceLess = -moveDistanceLess\r\n      hideDistance = -hideDistance\r\n      bagDistance = -bagDistance\r\n      shouldLock = true\r\n    end\r\n\r\n    print(\"[INFO] Switching between 2p/4p mode\")\r\n\r\n    moveObjectX(playmats.Red,   moveDistance)\r\n    moveObjectX(playmats.Blue,  moveDistance)\r\n\r\n    moveObjectX(scorecounters.Red, moveDistanceLess)\r\n    moveObjectX(scorecounters.Blue, moveDistanceLess)\r\n\r\n    moveObjectX(initialquickactionpanels.Red,   moveDistance)\r\n    moveObjectX(initialquickactionpanels.Blue,  moveDistance)\r\n\r\n    moveObjectX(playerhandzones.Red,  moveDistance)\r\n    moveObjectX(playerhandzones.Blue, moveDistance)\r\n    moveObjectX(playerglimpsezones.Red,  moveDistance)\r\n    moveObjectX(playerglimpsezones.Blue, moveDistance)\r\n    moveObjectX(playerbases.Red,  moveDistance)\r\n    moveObjectX(playerbases.Blue, moveDistance)\r\n    moveObjectX(playerrunezones.Red,  moveDistance)\r\n    moveObjectX(playerrunezones.Blue, moveDistance)\r\n    moveObjectX(playermaterialdeckzones.Red,  moveDistance)\r\n    moveObjectX(playermaterialdeckzones.Blue, moveDistance)\r\n\r\n    moveObjectX(bags.Red, bagDistance)\r\n    moveObjectX(bags.Purple, bagDistance)\r\n    moveObjectX(bags.White, -bagDistance)\r\n    moveObjectX(bags.Blue, -bagDistance)\r\n\r\n    moveObjectX(battlefields1v1.West,   hideDistance)\r\n    moveObjectX(battlefields1v1.East,   hideDistance)\r\n\r\n    moveObjectX(playerbattlefield1v1zonesWest.Red,   hideDistance)\r\n    moveObjectX(playerbattlefield1v1zonesWest.Blue,   hideDistance)\r\n    moveObjectX(playerbattlefield1v1zonesEast.Red,   hideDistance)\r\n    moveObjectX(playerbattlefield1v1zonesEast.Blue,   hideDistance)\r\n\r\n    moveObjectX(battlefieldsFFA.West,   -hideDistance)\r\n    moveObjectX(battlefieldsFFA.Center,   -hideDistance)\r\n    moveObjectX(battlefieldsFFA.East,   -hideDistance)\r\n\r\n    moveObjectX(playerbattlefieldFFAZonesWest.Red,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesWest.Blue,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesWest.Green,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesWest.Purple,   -hideDistance)\r\n\r\n    moveObjectX(playerbattlefieldFFAZonesEast.Red,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesEast.Blue,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesEast.Green,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesEast.Purple,   -hideDistance)\r\n\r\n    moveObjectX(playerbattlefieldFFAZonesCenter.Red,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesCenter.Blue,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesCenter.Green,   -hideDistance)\r\n    moveObjectX(playerbattlefieldFFAZonesCenter.Purple,   -hideDistance)\r\n\r\n    moveObjectX(playmats.Green, hideDistance)\r\n    moveObjectX(playmats.Purple, hideDistance)\r\n\r\n    safeMoveObjectX(scorecounters.Green, hideDistance)\r\n    safeMoveObjectX(scorecounters.Purple, hideDistance)\r\n\r\n    moveObjectX(playerhandzones.Green, hideDistance)\r\n    moveObjectX(playerhandzones.Purple, hideDistance)\r\n    moveObjectX(playerglimpsezones.Green, hideDistance)\r\n    moveObjectX(playerglimpsezones.Purple, hideDistance)\r\n    moveObjectX(playerbases.Green, hideDistance)\r\n    moveObjectX(playerbases.Purple, hideDistance)\r\n    moveObjectX(playerrunezones.Green, hideDistance)\r\n    moveObjectX(playerrunezones.Purple, hideDistance)\r\n    moveObjectX(playermaterialdeckzones.Green, hideDistance)\r\n    moveObjectX(playermaterialdeckzones.Purple, hideDistance)\r\nend\r\n\r\nfunction moveObjectX(guid, deltaX)\r\n    local obj = getObjectFromGUID(guid)\r\n    if not obj then return end\r\n\r\n    local pos = obj.getPosition()\r\n    pos.x = pos.x + deltaX\r\n    obj.setPositionSmooth(pos, false, false)\r\nend\r\n\r\nfunction safeMoveObjectX(guid, deltaX)\r\n    local obj = getObjectFromGUID(guid)\r\n    if not obj then return end\r\n\r\n    local pos = obj.getPosition()\r\n    pos.x = pos.x + deltaX\r\n    obj.setPosition(pos)\r\nend\r\n\r\n\r\nfunction moveObjectToX(guid, targetX)\r\n    local obj = getObjectFromGUID(guid)\r\n    if not obj then return end\r\n\r\n    local pos = obj.getPosition()\r\n    pos.x = targetX\r\n    obj.setPositionSmooth(pos)\r\nend\r\n\r\nfunction doneSideboarding(player, value, button_id)\r\nend\r\n\r\nfunction toggleVisibility(player, id, force)\r\n  visibility = Global.UI.getAttribute(id, \"visibility\")\r\n  visible = visibility:find(player.color) ~= nil\r\n  if (force==visible) then return end\r\n  if visible then\r\n    Global.UI.setAttribute(id, \"visibility\", visibility:gsub(\"|\" .. player.color, \"\"))\r\n  else\r\n    Global.UI.setAttribute(id, \"visibility\", visibility .. \"|\" .. player.color)\r\n  end\r\nend\r\n\r\nfunction setMainDeckSleeve(player, value)\r\n  ui_sleeve_state[player.steam_id] = ui_sleeve_state[player.steam_id] or {}\r\n  ui_sleeve_state[player.steam_id][\"main\"] = value\r\nend\r\n\r\n\r\nfunction setBattlefieldDeckSleeve(player, value)\r\n  ui_sleeve_state[player.steam_id] = ui_sleeve_state[player.steam_id] or {}\r\n  ui_sleeve_state[player.steam_id][\"battlefield\"] = value\r\nend\r\n\r\nfunction setRuneDeckSleeve(player, value)\r\n  ui_sleeve_state[player.steam_id] = ui_sleeve_state[player.steam_id] or {}\r\n  ui_sleeve_state[player.steam_id][\"rune\"] = value\r\nend\r\n\r\ntarget_playmat_width = 38.2\r\n\r\nfunction setPlaymatImage(player, imageUrl)\r\n    local player_color = player.color\r\n    local guid = playmats[player_color]\r\n    local originalObj = getObjectFromGUID(guid)\r\n    if not originalObj then\r\n        print(\"No playmat found for color: \" .. player_color)\r\n        return\r\n    end\r\n\r\n    if imageUrl==\"\" then\r\n      return\r\n    end\r\n\r\n    -- Update the image\r\n    local custom = originalObj.getCustomObject()\r\n    custom.image = imageUrl\r\n    originalObj.setCustomObject(custom)\r\n    originalObj.reload()\r\n\r\n    -- Wait a bit for reload, then re-fetch by GUID\r\n    Wait.time(function()\r\n\r\n            local obj = getObjectFromGUID(guid)\r\n            if not obj then\r\n                print(\"Waiting for object to reload...\")\r\n                return false  -- Try again\r\n            end\r\n\r\n            local bounds = obj.getBounds().size\r\n            local actualWidth = bounds.x\r\n            if actualWidth == 0 then\r\n                print(\"Bounds not ready yet...\")\r\n                return false  -- Try again\r\n            end\r\n\r\n            -- Rescale X to match target width\r\n            local currentScale = obj.getScale()\r\n            local scaleFactor = target_playmat_width / actualWidth\r\n            obj.setScale({\r\n                x = currentScale.x * scaleFactor,\r\n                y = currentScale.y,\r\n                z = currentScale.z\r\n            })\r\n\r\n            setMatSnapPoints(obj, scaleFactor)\r\n            return true  -- Done\r\n    end, 0.5)\r\nend\r\n\r\nfunction setDecklist(player, value)\r\n  ui_decklist_state[player.steam_id] = value\r\nend\r\n\r\n-- Decks/Cards\r\nfunction getSleeves(player)\r\n  if ui_sleeve_state[player.steam_id] then\r\n    return {\r\n      main = ui_sleeve_state[player.steam_id][\"main\"] or default_card_back_map[\"main\"],\r\n      legends = ui_sleeve_state[player.steam_id][\"battlefield\"] or default_card_back_map[\"battlefield\"],\r\n      champion = ui_sleeve_state[player.steam_id][\"main\"] or default_card_back_map[\"main\"],\r\n      rune = ui_sleeve_state[player.steam_id][\"rune\"] or default_card_back_map[\"rune\"],\r\n      battlefield = ui_sleeve_state[player.steam_id][\"battlefield\"] or default_card_back_map[\"battlefield\"],\r\n      default = ui_sleeve_state[player.steam_id][\"main\"] or default_card_back_map[\"main\"]\r\n    }\r\n  end\r\n  return default_card_back_map\r\nend\r\n\r\nfunction getCardScale(player)\r\n  return card_scale_by_player[player.steam_id] or regular_card_scale\r\nend\r\n\r\nfunction getDeckBag(name, deck, player)\r\n  local colorRGB = Color.fromString(player.color)\r\n  return {\r\n    Name = \"Infinite_Bag\",\r\n    Transform = {\r\n      scaleX = 1,\r\n      scaleY = 1,\r\n      scaleZ = 1,\r\n      rotX = 0,\r\n      rotY = 0,\r\n      rotZ = 0\r\n    },\r\n    ColorDiffuse = {\r\n      r = colorRGB.r,\r\n      g = colorRGB.g,\r\n      b = colorRGB.b\r\n    },\r\n    Nickname = name,\r\n    ContainedObjects = {deck}\r\n  }\r\nend\r\n\r\nglobal_offset = 0\r\n\r\nfunction getCustomCard(image, sleeve)\r\n  return {\r\n    FaceURL = image,\r\n    BackURL = sleeve,\r\n    NumWidth = 1,\r\n    NumHeight = 1,\r\n    BackIsHidden = true,\r\n    UniqueBack = false,\r\n    Type = 0\r\n  }\r\nend\r\n\r\nlocal function trimSpaces(str)\r\n    if str == nil then\r\n      return \"\"\r\n    end\r\n    return str:gsub(\"^%s+\", \"\"):gsub(\"%s+$\", \"\")\r\nend\r\n\r\nlocal function to_slug(s)\r\n  if not s or s == \"\" then return \"\" end\r\n  s = trimSpaces(s:lower())\r\n  s = s:gsub(\"%s+\", \"-\")\r\n  s = s:gsub(\"[',]\", \"\")\r\n  s = s:gsub(\"[^%w%-]+\", \"-\")\r\n  s = s:gsub(\"%-+\", \"-\")\r\n  s = s:gsub(\"^%-+\", \"\"):gsub(\"%-+$\", \"\")\r\n  return s\r\nend\r\n\r\nlocal function randomGUID()\r\n    local chars = '0123456789abcdef'\r\n    local res = {}\r\n    for i=1,6 do\r\n        local rand = math.random(#chars)\r\n        res[#res+1] = chars:sub(rand, rand)\r\n    end\r\n    return table.concat(res)\r\nend\r\n\r\nextraDecks = {\r\n    references = {},\r\n    token = {},\r\n    generated = {},\r\n    mastery = {}\r\n}\r\nshouldSpawnExtraDecks=false\r\n\r\nfunction spawnDeck(name, cards, player, as_bag)\n    if name == \"references\" or name == \"token\" or name == \"generated\" or name == \"mastery\" then\r\n        for _, card in ipairs(cards) do\r\n            table.insert(extraDecks[name], card)\r\n            shouldSpawnExtraDecks=true\r\n        end\r\n        return -- Delay spawning until all are gathered\r\n    end\r\n\r\n    if name == \"extra\" then\r\n        local combined = {}\r\n        for _, group in pairs(extraDecks) do\r\n            for _, card in ipairs(group) do\r\n                table.insert(combined, card)\r\n            end\r\n        end\r\n        cards = combined\r\n    end\r\n\r\n    local playmatGUID = playmats[player.color]\r\n    if(playmatGUID==nil) then\r\n      playmatGUID = playmats[\"Red\"]\r\n    end\r\n    local playmat = getObjectFromGUID(playmatGUID)\r\n    local rotation = playmat.getRotation()\r\n    local position = playmat.positionToWorld(getSnapPosition(playmat, name))\r\n    local bounds = playmat.getBounds()\r\n\r\n    local deck = getDeck(name, cards, player)\r\n    if as_bag or name == \"extra\" then\r\n        deck = getDeckBag(name, deck, player)\r\n    end\r\n\r\n    deck.Transform = deck.Transform or {}\r\n    deck.Transform.posX = position.x\r\n    deck.Transform.posY = playmat.getPosition().y + bounds.size.y + bounds.offset.y + 1\r\n    deck.Transform.posZ = position.z\r\n    deck.Transform.rotY = rotation.y\r\n    if (name==\"battlefield\") or (name==\"sideboard\") then\r\n      deck.Transform.rotY = deck.Transform.rotY + 270\r\n    end\r\n\r\n    local spawned = spawnObjectData({data = deck})\n    if spawned and player and player.color then\n      cacheDeckGuid(player.color, name, spawned)\n    end\n    return spawned\nend\n\r\nfunction tableContains(table, value)\r\n  for i = 1,#table do\r\n    if (table[i]:lower() == value) then\r\n      return true\r\n    end\r\n  end\r\n  return false\r\nend\r\n\r\nfunction DecodeDeckCodeToTables(code)\r\n  local mod = Cyberpunk_DeckCodes or Global.getVar(\"Cyberpunk_DeckCodes\")\r\n  local json = mod.call(\"decode_json\", { code = code })\r\n  return JSON.decode(json)\r\nend\r\n\r\n-- Pixelborn-style deck decode for TTS (base64 + '$' delimited card codes)\r\n\r\nlocal b64chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\r\n\r\nlocal function base64_decode(data)\r\n    data = (data or \"\"):gsub(\"%s+\", \"\")\r\n    local t = {}\r\n    local bit = bit32\r\n\r\n    local function val(c)\r\n        local i = b64chars:find(c, 1, true)\r\n        return i and (i - 1) or nil\r\n    end\r\n\r\n    local buffer = 0\r\n    local bits = 0\r\n\r\n    for i = 1, #data do\r\n        local c = data:sub(i, i)\r\n        if c ~= \"=\" then\r\n            local v = val(c)\r\n            if v == nil then\r\n                error(\"Invalid base64 character: \" .. tostring(c))\r\n            end\r\n\r\n            buffer = bit.lshift(buffer, 6) + v\r\n            bits = bits + 6\r\n\r\n            while bits >= 8 do\r\n                bits = bits - 8\r\n                local byte = bit.band(bit.rshift(buffer, bits), 0xFF)\r\n                t[#t + 1] = string.char(byte)\r\n            end\r\n        end\r\n    end\r\n\r\n    return table.concat(t)\r\nend\r\n\r\nlocal function split_dollar(s)\r\n    local out = {}\r\n    local start = 1\r\n    while true do\r\n        local p = s:find(\"%$\", start)\r\n        if not p then\r\n            out[#out + 1] = s:sub(start)\r\n            break\r\n        end\r\n        out[#out + 1] = s:sub(start, p - 1)\r\n        start = p + 1\r\n    end\r\n    return out\r\nend\r\n\r\nlocal function normalize_code(entry)\r\n    entry = (entry or \"\"):gsub(\"^%s+\", \"\"):gsub(\"%s+$\", \"\")\r\n    if entry == \"\" then return nil end\r\n\r\n    -- DotGG starred cards: SFD-236-STAR -> SFD-236s\r\n    entry = entry:gsub(\"%-STAR$\", \"s\")\r\n\r\n    -- Strip trailing numeric variant ONLY if there is another dash before it\r\n    -- SFD-241-1 -> SFD-241\r\n    -- OGN-274   -> unchanged\r\n    entry = entry:gsub(\"^(.-%-%d+)%-%d+$\", \"%1\")\r\n\r\n    return entry\r\nend\r\n\r\n\r\n\r\nlocal function count_entries(entries)\r\n    local counts = {}\r\n    local order = {}\r\n\r\n    for _, raw in ipairs(entries) do\r\n        local code = normalize_code(raw)\r\n        if code then\r\n            if not counts[code] then\r\n                counts[code] = 1\r\n                order[#order + 1] = code\r\n            else\r\n                counts[code] = counts[code] + 1\r\n            end\r\n        end\r\n    end\r\n\r\n    local deck = {}\r\n    for _, code in ipairs(order) do\r\n        deck[#deck + 1] = { cardCode = code, count = counts[code] }\r\n    end\r\n    return deck\r\nend\r\n\r\nfunction DecodePixelbornDeckToTable(code_b64)\r\n    local ok, result = pcall(function()\r\n        local decoded = base64_decode(code_b64)\r\n        if type(decoded) ~= \"string\" or decoded == \"\" then\r\n            error(\"Invalid base64 decode\")\r\n        end\r\n\r\n        local parts = split_dollar(decoded)\r\n        if type(parts) ~= \"table\" or #parts == 0 then\r\n            error(\"No card entries\")\r\n        end\r\n\r\n        local mainDeck = count_entries(parts)\r\n        if not mainDeck or #mainDeck == 0 then\r\n            error(\"No valid cards parsed\")\r\n        end\r\n\r\n        return mainDeck\r\n    end)\r\n\r\n    if not ok then\r\n        return nil\r\n    end\r\n\r\n    return result\r\nend\r\n\r\n-- Debuggable DotGG decoder.\r\n-- Returns: { { cardCode=..., count=... }, ... } on success, or nil on failure.\r\n-- Requires: JSON.decode, and your normalize_code(entry) function.\r\n\r\nfunction DecodeDotGGDeckToTable(deck_text, debug)\r\n    local ok, result = pcall(function()\r\n\r\n        if type(deck_text) ~= \"string\" or deck_text == \"\" then\r\n            error(\"Empty deck text\")\r\n        end\r\n\r\n        local decoded = JSON.decode(deck_text)\r\n\r\n        if type(decoded) ~= \"table\" then\r\n            error(\"Invalid JSON (not a table)\")\r\n        end\r\n\r\n        local boards = decoded.boards\r\n\r\n        if type(boards) ~= \"table\" then\r\n            error(\"No 'boards' field found\")\r\n        end\r\n        if type(boards[1]) ~= \"table\" then\r\n            error(\"No boards[1] table found\")\r\n        end\r\n\r\n        local mainBoard = boards[1]\r\n\r\n        -- Count how many entries are in the board, and show a sample\r\n        local n = 0\r\n        local sample = {}\r\n        for k,v in pairs(mainBoard) do\r\n            n = n + 1\r\n            if #sample < 10 then\r\n                sample[#sample+1] = tostring(k) .. \"=\" .. tostring(v)\r\n            end\r\n        end\r\n\r\n        local deck = {}\r\n        local bad = { missingCount = 0, badCount = 0, badCode = 0 }\r\n        local anyStar = false\r\n\r\n        for rawCode, rawCount in pairs(mainBoard) do\r\n            local codeBefore = tostring(rawCode)\r\n            local code = normalize_code(rawCode)\r\n\r\n            if codeBefore:find(\"%-STAR$\") then\r\n                anyStar = true\r\n            end\r\n\r\n            local count = tonumber(rawCount)\r\n\r\n            if not code then\r\n                bad.badCode = bad.badCode + 1\r\n            elseif not count then\r\n                bad.missingCount = bad.missingCount + 1\r\n            elseif count <= 0 then\r\n                bad.badCount = bad.badCount + 1\r\n            else\r\n                deck[#deck + 1] = { cardCode = code, count = count }\r\n            end\r\n        end\r\n        if #deck == 0 then\r\n            error(\"No valid cards parsed from boards[1]\")\r\n        end\r\n\r\n        return deck\r\n    end)\r\n\r\n    if not ok then\r\n        return nil\r\n    end\r\n\r\n    return result\r\nend\r\n\r\n\r\n\r\nfunction importResolvedDeckText(player, deck_text, source)\r\n    if not deck_text or deck_text == \"\" then\r\n        broadcastToColor(\"Failed to extract deck code from URL.\", player.color, {1,0,0})\r\n        return\r\n    end\r\n\r\n    local analyticdata = {}\r\n\r\n    if source then\r\n      analyticdata[\"source\"]=source\r\n    end\r\n\r\n    -- Cyberpunk deck code\r\n    local decoded = DecodeDeckCodeToTables(deck_text)\r\n    if decoded then\r\n        analyticdata[\"format\"] = \"Deck Code\"\r\n        sendAnalytics(\"importDeck\", player, analyticdata)\r\n        ReplayLog.log(\"IMPORT_DECK\", player.color,\r\n          { analyticdata = analyticdata, deck_text = deck_text },\r\n          \"private\")\r\n        spawnCyberpunkDecks(player, decoded.mainDeck, decoded.sideDeck, decoded.chosenChampion)\r\n        finalizeImport(player)\r\n        return\r\n    end\r\n\r\n    -- Pixelborn\r\n    local pixelled = DecodePixelbornDeckToTable(deck_text)\r\n    if pixelled then\r\n        analyticdata[\"format\"] = \"Pixelborn Code\"\r\n        sendAnalytics(\"importDeck\", player, analyticdata)\r\n        ReplayLog.log(\"IMPORT_DECK\", player.color,\r\n          { analyticdata = analyticdata, deck_text = deck_text },\r\n          \"private\")\r\n        spawnCyberpunkDecks(player, pixelled, nil)\r\n        finalizeImport(player)\r\n        return\r\n    end\r\n\r\n    local dotGGed = DecodeDotGGDeckToTable(deck_text)\r\n    if dotGGed then\r\n      analyticdata[\"format\"] = \"DotGG Code\"\r\n      sendAnalytics(\"importDeck\", player, analyticdata)\r\n      ReplayLog.log(\"IMPORT_DECK\", player.color,\r\n        { analyticdata = analyticdata, deck_text = deck_text },\r\n        \"private\")\r\n      spawnCyberpunkDecks(player, dotGGed, nil)\r\n      finalizeImport(player)\r\n      return\r\n    end\r\n\r\n    -- TTS ID fallback\r\n    local lib = Cyberpunk_CardLibrary or Global.getVar(\"Cyberpunk_CardLibrary\")\r\n    if not lib then\r\n        print(\"ERROR: Cyberpunk_CardLibrary not set on Global\")\r\n        return\r\n    end\r\n\r\n    local ok, ttsMap = pcall(lib.call, \"getTTSMap\")\r\n    if not ok or not ttsMap then\r\n        print(\"ERROR: Failed to get TTS map\")\r\n        return\r\n    end\r\n\r\n\r\n    local CardIDs = {}\r\n    local failed = {}\r\n\r\n    for id in deck_text:gmatch(\"%S+\") do\r\n        if ttsMap[id] then\r\n            table.insert(CardIDs, { cardCode = ttsMap[id], count = 1 })\r\n        else\r\n            table.insert(failed, id)\r\n        end\r\n    end\r\n\r\n    if #failed > 0 then\r\n        broadcastToColor(\r\n            \"If you are trying to use Overnumbered cards, use Piltover Archive's DECK CODE.Failed to load card IDs: \" .. table.concat(failed, \", \"),\r\n            player.color,\r\n            {1,0,0}\r\n        )\r\n    end\r\n\r\n    if #CardIDs == 0 then\r\n        broadcastToColor(\"No valid IDs!\", player.color, {1,0,0})\r\n        return\r\n    end\r\n\r\n    analyticdata[\"format\"] = \"TTS Code\"\r\n    sendAnalytics(\"importDeck\", player, analyticdata)\r\n    ReplayLog.log(\"IMPORT_DECK\", player.color,\r\n      { analyticdata = analyticdata, deck_text = deck_text },\r\n      \"private\")\r\n    spawnCyberpunkDecks(player, CardIDs, nil)\r\n    finalizeImport(player)\r\nend\r\n\r\n\r\nfunction fetchDeckCodeFromURL(site, url, pattern, callback)\r\n    WebRequest.get(url, function(req)\r\n        if req.is_error or not req.text then\r\n            print(\"[\" .. site .. \"] Web request failed:\", req.error)\r\n            callback(nil)\r\n            return\r\n        end\r\n\r\n        if not pattern or pattern == \"\" then\r\n            callback(req.text)\r\n            return\r\n        end\r\n\r\n        local result = req.text:match(pattern)\r\n        if not result then\r\n            print(\"[\" .. site .. \"] Pattern not found\")\r\n            callback(nil)\r\n            return\r\n        end\r\n\r\n        callback(result)\r\n    end)\r\nend\r\n\r\n\r\nfunction importCyberpunkDeckFromPlaymatRemote(params)\r\n  for color, mat in pairs(playmats) do\r\n    if mat == params.playmat.guid then\r\n\r\n      params.player.changeColor(color)\r\n      importCyberpunkDeck(Player[color], nil, nil, params.deck_text)\r\n    end\r\n  end\r\nend\r\n\r\nfunction importCyberpunkDeck(player, value, index, deck_text)\r\n    local deck_text = deck_text or trimSpaces(ui_decklist_state[player.steam_id] or \"\")\r\n    if deck_text == \"\" then\r\n        broadcastToColor(\"Paste Deck Code Or TTS Code!\", player.color, {1,0,0})\r\n        return\r\n    end\r\n\r\n    -- URL paths (async)\r\n    if deck_text:find(\"piltoverarchive.com\") then\r\n        fetchDeckCodeFromURL(\"piltover\", deck_text, 'href=\"[^\"]-/deckbuilder%?code=([^\"&]+)\"', function(resolved)\r\n            importResolvedDeckText(player, resolved, \"Piltover Archive\")\r\n        end)\r\n        return\r\n    end\r\n\r\n    if deck_text:find(\"riftmana.com\") then\r\n        fetchDeckCodeFromURL(\"riftmana\", deck_text, '<textarea[^>]*class=\"deckBuilderDeckCodeTextarea\"[^>]*>%s*([A-Z0-9]+)%s*</textarea>', function(resolved)\r\n            importResolvedDeckText(player, resolved, \"Riftmana\")\r\n        end)\r\n        return\r\n    end\r\n\r\n    if deck_text:find(\"cyberpunk.gg\") then\r\n        local slug = deck_text:match(\"cyberpunk%.gg/decks/([^/]+)/?\")\r\n        if not slug then return end\r\n        local api_url = \"https://api.dotgg.gg/cgfw/getdeck?game=cyberpunk&slug=\" .. slug .. \"&mode=boards\"\r\n        fetchDeckCodeFromURL(\"dotGG\", api_url, '', function(resolved)\r\n            importResolvedDeckText(player, resolved, \"DotGG\")\r\n        end)\r\n        return\r\n    end\r\n\r\n    -- Non-URL path (sync)\r\n    importResolvedDeckText(player, deck_text, \"Direct Paste\")\r\nend\r\n\r\nfunction finalizeImport(player)\n    writeResetSnapshotToPlaymat(player.color)\n    shutImportLayout(player)\n    local mat = getPlaymat(player.color)\n    mat.call(\"ImportFinished\", {})\nend\n\r\nfunction spawnCyberpunkDecks(player, mainCardIDs, sideCardIDs, chosenChampionID)\r\n    local playmat = getObjectFromGUID(playmats[player.color])\r\n    if not playmat then\r\n        broadcastToColor(\"Playmat not found!\", player.color, {1,0,0})\r\n        return\r\n    end\r\n\r\n    local mainCards = {}\r\n    local sideboardCards = {}\r\n    local championCards = {}  -- Max 1 card\r\n    local legends = {}\r\n    local runeCards = {}\r\n    local battlefieldCards = {}\r\n\r\n    local legendName = nil\r\n    local championSlotFilled = false\r\n\r\n    local standardDeckSize = 40\r\n\r\n    for i, cardEntry in ipairs(mainCardIDs) do\r\n      -- Capture legend name (first legend wins)\r\n      -- Cache data\r\n      local cardID = cardEntry.cardCode\r\n      local card = getCardData(cardID)\r\n      local data = parseGMNotes(card.gmNotes)\r\n      mainCardIDs[i][\"card\"] = card\r\n      mainCardIDs[i][\"data\"] = data\r\n      if data.type==\"legend\" and not legendName then\r\n        legendName = data.signature_key:lower()\r\n      end\r\n    end\r\n\r\n    local championKeys = championKeys or {}\r\n\r\n    for i, cardEntry in ipairs(mainCardIDs) do\r\n        local cardID = cardEntry.cardCode\r\n        local count = cardEntry.count\r\n        local card = cardEntry.card\r\n        local data = cardEntry.data\r\n\r\n        if card then\r\n          for i = 1, count do\r\n            local cardType = data.type and data.type:lower() or \"\"\r\n\r\n            if cardType == \"legend\" and #legends == 0 then\r\n              table.insert(legends, card)\r\n\r\n            elseif cardType == \"legend\" then\r\n              table.insert(mainCards, card)\r\n\r\n            elseif cardType == \"rune\" then\r\n              table.insert(runeCards, card)\r\n\r\n            elseif cardType == \"battlefield\" then\r\n              table.insert(battlefieldCards, card)\r\n\r\n            elseif (#mainCards + #championCards) >= standardDeckSize then\r\n              table.insert(sideboardCards, card)\r\n\r\n            elseif\r\n              legendName\r\n              and data.signature_key\r\n              and data.signature_key:lower() == legendName\r\n              and not championKeys[card.name]\r\n              and not (chosenChampionID and chosenChampionID~=cardID)\r\n              and (#mainCards + #championCards) < standardDeckSize\r\n            then\r\n              table.insert(championCards, card)\r\n              championKeys[card.name] = true\r\n            else\r\n              table.insert(mainCards, card)\r\n            end\r\n          end\r\n        end\r\n    end\r\n    if(sideCardIDs) then\r\n      for i, cardEntry in ipairs(sideCardIDs) do\r\n          local cardID = cardEntry.cardCode\r\n          local count = cardEntry.count\r\n          for i = 1, count do\r\n            local card = getCardData(cardID)\r\n            table.insert(sideboardCards, card)\r\n          end\r\n      end\r\n    end\r\n\r\n    local mainDeck = nil\r\n    if #mainCards > 0 then\r\n        local mainDeck = spawnDeck(\"main\", mainCards, player, false)\r\n        placeNotShuffledMarker(mainDeck, player)\r\n    end\r\n    if #runeCards > 0 then\r\n        local runeDeck = spawnDeck(\"rune\", runeCards, player, false)\r\n        runeDeck.randomize()\r\n    end\r\n    if #battlefieldCards > 0 then\r\n        spawnDeck(\"battlefield\", battlefieldCards, player, false)\r\n    end\r\n    if #sideboardCards > 0 then\r\n        spawnDeck(\"sideboard\", sideboardCards, player, false)\r\n    end\r\n    if #championCards > 0 then\r\n        local championDeck = spawnDeck(\"champion\", championCards, player, false)\r\n        if #championCards > 1 then\r\n            placeChooseOneMarker(championDeck, player)\r\n        end\r\n    end\r\n    if #legends > 0 then\r\n        spawnDeck(\"legends\", legends, player, false)\r\n    end\r\n\r\n    broadcastToColor(\r\n        \"Cyberpunk imported! Main:\"..#mainCards..\" Side:\"..#sideboardCards..\" Champ:\"..#championCards,\r\n        player.color, {0,0.8,0}\r\n    )\r\n\r\nend\r\n\r\n-- CARD LOOKUP: Use standalone library\r\nfunction getCardData(slug, quiet)\r\n    if not Cyberpunk_CardLibrary then\r\n        print(\"ERROR: Cyberpunk_CardLibrary not found!\")\r\n        return nil\r\n    end\r\n    local success, result = pcall(Cyberpunk_CardLibrary.call, \"getTTSParams\", { slug = slug })\r\n    if success and result then\r\n        return {\r\n            name = result.name or \"Unknown\",\r\n            description = result.description or \"\",\r\n            image = result.image or \"https://raw.githubusercontent.com/AmphiBlocks/Cyberpunk-TTS/main/cyberpunk_jpg/\".. slug ..\".jpg\",\r\n            gmNotes = result.gmNotes or \"[]\",\r\n            slug = slug\r\n        }\r\n    else\r\n        if not quiet then\r\n          print(\"Failed to get card: \" .. slug .. \" | Error: \" .. tostring(result))\r\n        end\r\n        return nil\r\n    end\r\nend\r\n\r\n-- Parse gmNotes JSON\r\nfunction parseGMNotes(gmNotes)\r\n    local success, data = pcall(JSON.decode, gmNotes)\r\n    return success and data or {}\r\nend\r\n\r\n-- Vector helper\r\nfunction vecSum(v1, v2)\r\n    return { x = v1.x + v2[1], y = v1.y + v2[2], z = v1.z + v2[3] }\r\nend\r\n\r\nfunction getDeck(name, cards, player)\r\n    global_offset = (global_offset % 30) + 1\r\n\r\n    local sleeve_mapping = getSleeves(player)\r\n\r\n    local sleeve = sleeve_mapping[name] or sleeve_mapping[\"default\"]\r\n    local card_scale = getCardScale(player)\r\n\r\n    local deckOffset = global_offset * 1000\r\n\r\n    local deck_ids       = {}\r\n    local custom_deck    = {}\r\n    local contained_objs = {}\r\n\r\n    local idx = 1\r\n    for _, card in ipairs(cards) do\r\n        local cardstomake = (card.quantity == 0 and 1) or (card.quantity or 1)\r\n\r\n        for i = 1, cardstomake do\r\n            local orientation = (card.orientation or \"\"):lower()\r\n            local frontSide, backSide = nil, nil\r\n            local hasOrientations = (type(card.orientations) == \"table\" and #card.orientations > 0)\r\n            local isMultiState = false\r\n\r\n            if hasOrientations then\r\n                isMultiState = true\r\n                local oppositeNeeded = (orientation == \"front\") and \"back\"\r\n                    or (orientation == \"back\") and \"front\"\r\n                    or nil\r\n\r\n                if oppositeNeeded then\r\n                    for b, alt in ipairs(card.orientations) do\r\n                        if (alt.orientation==nil) or (type(alt.orientation) == \"string\"\r\n                          and alt.orientation:lower() == oppositeNeeded) then\r\n                            backSide = alt\r\n                            break\r\n                        end\r\n                    end\r\n                end\r\n            end\r\n\r\n            local hasTypes = (type(card.types) == \"table\" and #(card.types) > 0)\r\n            if hasTypes then\r\n              if tableContains(card.types, \"regalia\") or tableContains(card.types, \"champion\") then\r\n                sleeve = material_sleeves\r\n              else\r\n                sleeve = main_sleeves\r\n              end\r\n            end\r\n\r\n            if orientation == \"front\" and backSide then\r\n                frontSide = card\r\n\r\n            elseif orientation == \"back\" and backSide then\r\n                -- the user put the back side in their deck so we'll just flip it for them\r\n                frontSide = backSide\r\n                backSide  = card\r\n            end\r\n\r\n            if isMultiState then\r\n                local frontKey    = (deckOffset + idx)\r\n                local backKey     = frontKey + 1\r\n                local frontBackKey= backKey + 1\r\n                local frontID     = frontKey * 100\r\n                local backID      = backKey * 100\r\n                local frontBackID = frontBackKey * 100\r\n\r\n                table.insert(deck_ids, frontID)\r\n\r\n\r\n                local frontURL = frontSide.image or card_back\r\n                local backURL  = backSide.image  or card_back\r\n\r\n                -- This section is to work around a bug in TTS\r\n                local altBackURL\r\n\r\n                if backURL:find(\"shoutatyourdecks.com/images/\") then\r\n                    altBackURL = backURL:gsub(\"https://[^/]+/images/\", \"https://api.gatcg.com/cards/images/\")\r\n                elseif backURL:find(\"api.gatcg.com/cards/images/\") then\r\n                    altBackURL = backURL:gsub(\"https://api.gatcg.com/cards/images/\", \"https://shoutatyourdecks.com/images/\")\r\n                else\r\n                    altBackURL = backURL\r\n                end\r\n\r\n                custom_deck[tostring(frontKey)] = {\r\n                    FaceURL      = frontURL .. \"?format=\"..playformat,\r\n                    BackURL      = sleeve,\r\n                    NumWidth     = 1,\r\n                    NumHeight    = 1,\r\n                    BackIsHidden = true,\r\n                    HideWhenFaceDown = true,\r\n                    UniqueBack   = false,\r\n                    Type         = 0\r\n                }\r\n                custom_deck[tostring(backKey)] = {\r\n                    FaceURL      = altBackURL,\r\n                    BackURL      = sleeve,\r\n                    NumWidth     = 1,\r\n                    NumHeight    = 1,\r\n                    BackIsHidden = true,\r\n                    HideWhenFaceDown = true,\r\n                    UniqueBack   = false,\r\n                    Type         = 0\r\n                }\r\n                custom_deck[tostring(frontBackKey)] = {\r\n                    FaceURL      = frontURL,\r\n                    BackURL      = backURL,\r\n                    NumWidth     = 1,\r\n                    NumHeight    = 1,\r\n                    BackIsHidden = false,\r\n                    HideWhenFaceDown = false,\r\n                    UniqueBack   = false,\r\n                    Type         = 0\r\n                }\r\n\r\n                table.insert(contained_objs, {\r\n                    GUID = randomGUID(),\r\n                    Name = \"CardCustom\",\r\n                    Transform = { scaleX = card_scale, scaleY = 1, scaleZ = card_scale },\r\n                    Nickname = frontSide.name or \"(NoName)\",\r\n                    CardID   = frontID,\r\n                    HideWhenFaceDown = true,\r\n                    CustomDeck = {\r\n                        [tostring(frontKey)] = custom_deck[tostring(frontKey)]\r\n                    },\r\n                    States = {\r\n                        [\"2\"] = {\r\n                            GUID = randomGUID(),\r\n                            Name = \"CardCustom\",\r\n                            Transform = { scaleX = card_scale, scaleY = 1, scaleZ = card_scale },\r\n                            Nickname = backSide.name or \"(NoName)\",\r\n                            CardID   = backID,\r\n                            HideWhenFaceDown = true,\r\n                            CustomDeck = {\r\n                                [tostring(backKey)] = custom_deck[tostring(backKey)]\r\n                            }\r\n                        },\r\n                        [\"3\"] = {\r\n                            GUID = randomGUID(),\r\n                            Name = \"CardCustom\",\r\n                            Transform = { scaleX = card_scale, scaleY = 1, scaleZ = card_scale },\r\n                            Nickname = frontSide.name .. \" / \" .. backSide.name or \"(NoName)\",\r\n                            CardID   = frontBackID,\r\n                            HideWhenFaceDown = false,\r\n                            CustomDeck = {\r\n                                [tostring(frontBackKey)] = custom_deck[tostring(frontBackKey)]\r\n                            }\r\n                        }\r\n                    }\r\n                })\r\n                idx = idx + 3\r\n            else\r\n                local singleKey = deckOffset + idx\r\n                local singleID  = singleKey * 100\r\n\r\n                table.insert(deck_ids, singleID)\r\n\r\n                local faceUrl = card.image or card_back\r\n\r\n                custom_deck[tostring(singleKey)] = {\r\n                    FaceURL      = faceUrl .. \"?format=\"..playformat,\r\n                    BackURL      = sleeve,\r\n                    NumWidth     = 1,\r\n                    NumHeight    = 1,\r\n                    BackIsHidden = true,\r\n                    HideWhenFaceDown = true,\r\n                    UniqueBack   = false,\r\n                    Type         = 0\r\n                }\r\n\r\n                table.insert(contained_objs, {\r\n                    GUID = randomGUID(),\r\n                    Name = \"CardCustom\",\r\n                    Description = card.description,\r\n                    GMNotes = card.gmNotes,\r\n                    Transform = { scaleX = card_scale, scaleY = 1, scaleZ = card_scale },\r\n                    Nickname = card.name,\r\n                    CardID   = singleID,\r\n                    HideWhenFaceDown = true,\r\n                    CustomDeck = {\r\n                        [tostring(singleKey)] = custom_deck[tostring(singleKey)]\r\n                    }\r\n                })\r\n                idx = idx + 1\r\n            end\r\n        end\r\n    end\r\n\r\n    if #contained_objs == 1 then\r\n        contained_objs[1].Transform.rotZ = 180\r\n        return contained_objs[1]\r\n    else\r\n        return {\r\n            GUID = randomGUID(),\r\n            Name = \"Deck\",\r\n            Transform = {\r\n                rotX = 360, rotY = 180, rotZ = 180,\r\n                scaleX = card_scale, scaleY = 1, scaleZ = card_scale\r\n            },\r\n            Nickname = name,\r\n            DeckIDs = deck_ids,\r\n            CustomDeck = custom_deck,\r\n            ContainedObjects = contained_objs\r\n        }\r\n    end\r\nend\r\n\r\nfunction placeNotShuffledMarker(obj, player)\r\n  if obj then\r\n    local markerGUID = notshuffledmarkers[player.color]\r\n    local marker = getObjectFromGUID(markerGUID)\r\n    if marker then\r\n      local playmatGUID = playmats[player.color]\r\n      local playmat = getObjectFromGUID(playmatGUID)\r\n\r\n      if playmat then\r\n        local rot = playmat.getRotation()\r\n        marker.setRotation(rot)\r\n        if(rot.y>90) then\r\n          marker.setPosition(obj.getPosition() + Vector(6, 0, 0))\r\n        else\r\n          marker.setPosition(obj.getPosition() + Vector(-6, 0, 0))\r\n        end\r\n      end\r\n\r\n      marker.setName(\"Not Shuffled Marker\")\r\n      marker.setVar(\"ownerColor\", player.color)\r\n    end\r\n  end\r\nend\r\n\r\nfunction placeChooseOneMarker(obj, player)\r\n  if obj then\r\n    local markerGUID = chooseonemarkers[player.color]\r\n    local marker = getObjectFromGUID(markerGUID)\r\n    if marker then\r\n      local playmatGUID = playmats[player.color]\r\n      local playmat = getObjectFromGUID(playmatGUID)\r\n\r\n      if playmat then\r\n        local rot = playmat.getRotation()\r\n        marker.setRotation(rot)\r\n        if(rot.y<90) then\r\n          marker.setPosition(obj.getPosition() + Vector(4, 0, 0))\r\n        else\r\n          marker.setPosition(obj.getPosition() + Vector(-4, 0, 0))\r\n        end\r\n      end\r\n\r\n      marker.setName(\"Choose One Marker\")\r\n      marker.setVar(\"ownerColor\", player.color)\r\n    end\r\n  end\r\nend\r\n\r\n\r\nfunction importDeck(player, value, index)\r\n    local deck_text = ui_decklist_state[player.steam_id]\r\n    deck_text = trimSpaces(deck_text)\r\n\r\n    if deck_text == \"\" then\r\n        broadcastToColor(\"No Decklist URL provided!\", player.color, {255,0,0})\r\n        return\r\n    end\r\n\r\n    if deck_text:match(\"^{\") then\n      local json = JSON.decode(deck_text)\n      if json then\n          if json.error == nil then\n              SpawnDeckFromJson(json, player, value, index)\n              writeResetSnapshotToPlaymat(player.color)\n              return\n          end\n      end\n    end\r\n\r\n    if importDeckFromURL(deck_text, player, value, index) then\r\n        return\r\n    end    -- deck_text:match(\"^https?://\")\r\n\r\n    broadcastToColor(\"Invalid deck input! Provide a valid JSON decklist or a URL.\", player.color, {255,0,0})\r\nend\r\n\r\nfunction importDeckFromURL(deck_url, player, value, index)\r\n\r\n  if deck_url ~= nil and deck_url:len() > 0 then\r\n    if deck_url:sub(1, 5) ~= \"https\" then\r\n      deck_url = \"https://\" .. deck_url\r\n    end\r\n\r\n    -- Silvie\r\n    if deck_url:find(\"silvie.org\") ~= nil or deck_url:find(\"silv.ie\") then\r\n        if deck_url:find(\"format=json\") == nil then\r\n            if deck_url:find(\"?\") == nil then\r\n              deck_url = deck_url .. \"?format=json\"\r\n            else\r\n              deck_url = deck_url .. \"&format=json\"\r\n            end\r\n        end\r\n        sendAnalytics(\"importDeck\", player, { site = \"silvie.org\" })\r\n    elseif deck_url:find(\"shoutatyourdecks.com\") ~= nil then\r\n        deck_url = deck_url:gsub(\"/decks/\", \"/api/\")\r\n        sendAnalytics(\"importDeck\", player, { site = \"shoutatyourdecks.com\" })\r\n    elseif deck_url:find(\"silvie.gg\") ~= nil then\r\n        deck_url = deck_url:gsub(\"silvie.gg/decklist%?deck=\", \"build.silvie.gg/deck/\")\r\n        deck_url = deck_url:gsub(\"silvie.gg/decklist/\", \"build.silvie.gg/deck/\")\r\n        sendAnalytics(\"importDeck\", player, { site = \"silvie.gg\" })\r\n    elseif deck_url:find(\"jsonblob.com\") ~= nil then\r\n        deck_url = deck_url:gsub(\"jsonblob.com/\", \"jsonblob.com/api/jsonBlob/\")\r\n        sendAnalytics(\"importDeck\", player, { site = \"jsonblob.com\" })\r\n    elseif deck_url:find(\"tcgarchitect.com\") ~= nil then\r\n        deck_url = deck_url:gsub(\"tcgarchitect.com/grand%-archive/decks/\", \"api.tcgarchitect.com/tts/grand-archive/deck/\")\r\n        deck_url = deck_url:gsub(\"tcgarchitect.com/grand%-archive/tournaments/decklists/\", \"api.tcgarchitect.com/tts/grand-archive/tournament-deck/\")\r\n        sendAnalytics(\"importDeck\", player, { site = \"tcgarchitect.com\" })\r\n    elseif deck_url:find(\"fractalofin.site\") ~= nil then\r\n        local event_id, player_id,suffix\r\n        local patterns = {\r\n            { pattern = \"/player/(%d+).html#deck_(%d+)\", swap = true, suffix=\"\"  }, -- player page\r\n            { pattern = \"#deck_(%d+)_(%d+)\",             swap = false, suffix=\"\" }, -- card/archetype page\r\n            { pattern = \"/%w+/(%d+).html#deck_(%d+)_topcut\",    swap = false, suffix=\"_topcut\" },  -- event page\r\n            { pattern = \"/%w+/(%d+).html#deck_(%d+)\",    swap = false, suffix=\"\" },  -- event page\r\n        }\r\n\r\n        for _, entry in ipairs(patterns) do\r\n            local first, second = deck_url:match(entry.pattern)\r\n            if first and second then\r\n                player_id = entry.swap and tonumber(first) or tonumber(second)\r\n                event_id = entry.swap and tonumber(second) or tonumber(first)\r\n                suffix = entry.suffix\r\n                break\r\n            end\r\n        end\r\n\r\n        if event_id and player_id then\r\n            deck_url = \"https://fractalofin.site/tts/event_\" .. event_id .. \"/\" .. player_id .. suffix .. \".json\"\r\n        else\r\n            broadcastToColor(\"Invalid Fractalofin URL format!\", player.color, {255,0,0})\r\n            return\r\n        end\r\n        sendAnalytics(\"importDeck\", player, { site = \"fractalofin.site\" })\r\n    else\r\n        broadcastToColor(\"Invalid Decklist URL!\", player.color, {255,0,0})\r\n        return false\r\n    end\r\n\r\n    WebRequest.get(deck_url, function(req)\r\n      if req.is_error then\r\n        log(req.error)\r\n      else\r\n        json = JSON.decode(req.text)\r\n        if json.error ~= nil then\r\n          log(json.error)\r\n          if json.error == \"silvie/bad-request\" then\r\n            broadcastToColor(\"Invalid Silvie.org Decklist!\", player.color, {255,0,0})\r\n          else\r\n            broadcastToColor(\"Unknown Error :(\", player.color, {255,0,0})\r\n          end\r\n          return false\r\n        else\r\n          -- Generate Cards\r\n          for deck, cards in pairs(json.cards) do\r\n            if #cards > 0 then\r\n              local obj = spawnDeck(deck, cards, player, index==\"import_deck_bag\")\r\n              -- temporarily disabled\r\n              placeNotShuffledMarker(obj, player)\r\n            end\r\n          end\r\n          if shouldSpawnExtraDecks then\r\n            spawnDeck(\"extra\", {}, player, true)\r\n          end\r\n          extraDecks = {\r\n              references = {},\r\n              token = {},\r\n              generated = {},\r\n              mastery = {}\r\n          }\r\n          shouldSpawnExtraDecks=false\r\n          local mainDeck = findPlayerDeckByName(player.color, \"main\")\n          deckcounts[player.color][2] = math.max(60, #mainDeck.getObjects())\n          writeResetSnapshotToPlaymat(player.color)\n          shutImportLayout(player)\n        end\n      end\n    end)\r\n    return true\r\n  end\r\nend\r\n\r\n\r\n\r\nfunction spawnDeckRemote(payload)\r\n    deck = SpawnDeckFromJson(payload.json, payload.player, 0, 0)\r\n    if (payload.locationOverride) then deck.setPosition(payload.locationOverride) end\r\n    if (payload.rotationOverride) then deck.setRotation(payload.rotationOverride) end\r\n    return deck\r\nend\r\n\r\nfunction SpawnDeckFromJson(json, player, value, index)\r\n  for deck, cards in pairs(json.cards) do\r\n    if #cards > 0 then\r\n      return spawnDeck(deck, cards, player, index==\"import_deck_bag\")\r\n    end\r\n  end\r\nend\r\n\r\n\r\ncameraPositions2P = {\r\n    Red    = { position = Vector(0, -2.5, -1), rotation = {x = 45, y = 0, z = 0} },\r\n    Blue   = { position = Vector(0, -2.5, 1), rotation = {x = 45, y = 180, z = 0} },\r\n}\r\n\r\ncameraPositions4P = {\r\n    Red    = { position = Vector(-20, -2.5, -1), rotation = {x = 45, y = 0, z = 0} },\r\n    Blue   = { position = Vector(-20, -2.5, 1), rotation = {x = 45, y = 180, z = 0} },\r\n    Green  = { position = Vector(20, -2.5, -1), rotation = {x = 45, y = 0, z = 0} },\r\n    Purple = { position = Vector(20, -2.5, 1), rotation = {x = 45, y = 180, z = 0} }\r\n}\r\n\r\nfunction resetCamera(player, value, index)\r\n    local player_color = player.color\r\n    cameraPositions = cameraPositions2P\r\n    if isFourPlayerMode() then\r\n      cameraPositions = cameraPositions4P\r\n    end\r\n\r\n    local camData = cameraPositions[player_color]\r\n    if camData then\r\n        local player = nil\r\n        for _, p in pairs(Player.getPlayers()) do\r\n            if p.color == player_color then\r\n                player = p\r\n                break\r\n            end\r\n        end\r\n        if not player then\r\n            return\r\n        end\r\n\r\n        player.lookAt({\r\n            position = camData.position,\r\n            pitch = camData.rotation.x,\r\n            yaw = camData.rotation.y,\r\n            roll = camData.rotation.z\r\n        })\r\n    end\r\nend\r\n\r\n-- ================= BANISH QUEUE + REORGANIZE =================\r\n\r\nbanishQueue   = banishQueue   or {}\r\nisBanishBusy  = isBanishBusy  or false\r\n\r\nlocal function getRuneZone(color)\r\n  return getObjectFromGUID(playerrunezones[color])\r\nend\r\n\r\nfunction getPlaymat(color)\r\n  return getObjectFromGUID(playmats[color])\r\nend\r\n\r\nlocal function getRuneCards(zone)\r\n  local t = {}\r\n  for _, o in ipairs(zone.getObjects() or {}) do\r\n    if o.tag == \"Card\" then table.insert(t, o) end\r\n  end\r\n  return t\r\nend\r\n\r\nlocal function zoneHasDecks(zone)\r\n  for _, o in ipairs(zone.getObjects() or {}) do\r\n    if o.tag == \"Deck\" then return true end\r\n  end\r\n  return false\r\nend\r\n\r\nlocal function objectIsInZone(obj, zone)\r\n  for _, o in ipairs(zone.getObjects() or {}) do\r\n    if o == obj then return true end\r\n  end\r\n  return false\r\nend\r\n\r\n-- Wait until: (a) no Decks remain in the zone and (b) all cards are not smooth-moving\r\nlocal function waitRunesCalm(zone, cb)\r\n  Wait.condition(cb, function()\r\n    if zoneHasDecks(zone) then return false end\r\n    for _, c in ipairs(getRuneCards(zone)) do\r\n      if c.isSmoothMoving() then return false end\r\n    end\r\n    return true\r\n  end)\r\nend\r\n\r\n-- Only reorganize when there WERE stacks\r\nlocal function reorganizeMemoryZoneOnly(color, done)\r\n  local zone = getRuneZone(color)\r\n  if not zone then if done then done() end return end\r\n\r\n  local hadDecks = zoneHasDecks(zone)\r\n  if not hadDecks then\r\n    if done then done() end\r\n    return\r\n  end\r\n\r\n  splitDecksInZone(zone)\r\n\r\n  -- brief delay for spawned singles, then lay out evenly and wait until calm\r\n  Wait.time(function()\r\n    local memPos      = zone.getPosition()\r\n    local memoryCards = getRuneCards(zone)\r\n    reorganizeMemoryForTotal(memoryCards, memPos, #memoryCards)\r\n\r\n    waitRunesCalm(zone, function()\r\n      if done then done() end\r\n    end)\r\n  end, 0.2)\r\nend\r\n\r\n\r\nfunction performBanishRoulette(cardsInMemory, targetCard, onDone)\r\n  local cfg = banishAnim or {\r\n    enabled     = true,\r\n    totalTime   = 0.6,\r\n    flashTime   = 0.12,\r\n    perStepMin  = 0.04,\r\n    perStepMax  = 0.12,\r\n    maxCards    = 30,\r\n    colorAll    = {1.0, 0.9, 0.2},  -- yellow\r\n    colorOut    = {1.0, 0.35, 0.35},-- red\r\n    colorTarget = {0.35, 1.0, 0.55} -- green\r\n  }\r\n\r\n  if not cfg.enabled or #cardsInMemory <= 1 or #cardsInMemory > cfg.maxCards then\r\n    if onDone then onDone() end\r\n    return\r\n  end\r\n\r\n  -- Build elimination order (all non-targets, shuffled)\r\n  local pool = {}\r\n  for _, c in ipairs(cardsInMemory) do if c ~= targetCard then table.insert(pool, c) end end\r\n  for i = #pool, 2, -1 do local j = math.random(i); pool[i], pool[j] = pool[j], pool[i] end\r\n\r\n  local flashT  = cfg.flashTime or 0.12\r\n  local steps   = #pool\r\n  local budget  = math.max(0, (cfg.totalTime or 0.6) - flashT)\r\n  local perStep = (steps > 0) and (budget / steps) or 0\r\n  perStep       = math.max(cfg.perStepMin or 0.04, math.min(cfg.perStepMax or 0.12, perStep))\r\n  local keepAll = flashT + steps * perStep + 0.25  -- keep yellow long enough to cover eliminations\r\n\r\n  -- Stage A: keep EVERYONE yellow for the whole sequence\r\n  for _, c in ipairs(cardsInMemory) do\r\n    if c and not c.isDestroyed() then c.highlightOn(cfg.colorAll, keepAll) end\r\n  end\r\n\r\n  -- Stage B: elimination — flash red then turn OFF each non-target\r\n  Wait.time(function()\r\n    for idx, c in ipairs(pool) do\r\n      Wait.time(function()\r\n        if c and not c.isDestroyed() then\r\n          local pulse = math.max(0.06, perStep * 0.6)\r\n          c.highlightOn(cfg.colorOut, pulse)\r\n          Wait.time(function()\r\n            if c and not c.isDestroyed() then c.highlightOff() end\r\n          end, pulse)\r\n        end\r\n      end, (idx - 1) * perStep)\r\n    end\r\n\r\n    -- Stage C: crown the target, then finish\r\n    Wait.time(function()\r\n      if targetCard and not targetCard.isDestroyed() then\r\n        -- If target was kept yellow, overwrite with a short green crown\r\n        targetCard.highlightOn(cfg.colorTarget, 0.8)\r\n      end\r\n      if onDone then onDone() end\r\n    end, steps * perStep + 0.02)\r\n\r\n  end, flashT)\r\nend\r\n\r\n\r\n-- Actually move the selected card to banish\r\nlocal function banishCardToZone(color, card)\r\n  local mat = getPlaymat(color)\r\n  if not (mat and card) then return end\r\n  local banishPos = mat.positionToWorld(deck_position[\"banished\"])\r\n  card.setPositionSmooth(banishPos)\r\n  card.setRotationSmooth(card_rotations[\"left\"])\r\nend\r\n\r\n-- Process a single queued banish request\r\nlocal function processNextBanish()\r\n  if isBanishBusy then return end\r\n  if #banishQueue == 0 then return end\r\n\r\n  -- lock first to avoid races from multiple callers\r\n  isBanishBusy = true\r\n  local job = table.remove(banishQueue, 1)\r\n  if not job then isBanishBusy = false; return end\r\n\r\n  local color = job.color\r\n  local zone  = getRuneZone(color)\r\n  if not zone then isBanishBusy = false; processNextBanish(); return end\r\n\r\n  -- if there are stacks, split & re-layout; otherwise skip straight to pick\r\n  local function afterReady()\r\n    local cards = getRuneCards(zone)\r\n    if #cards == 0 then\r\n      isBanishBusy = false\r\n      processNextBanish()\r\n      return\r\n    end\r\n    local target = cards[math.random(#cards)]\r\n    performBanishRoulette(cards, target, function()\r\n      banishCardToZone(color, target)\r\n      isBanishBusy = false\r\n      processNextBanish()\r\n    end)\r\n  end\r\n\r\n  if zoneHasDecks(zone) then\r\n    reorganizeMemoryZoneOnly(color, afterReady)\r\n  else\r\n    -- no decks; optionally ensure nothing is still moving\r\n    Wait.condition(afterReady, function()\r\n      for _, c in ipairs(getRuneCards(zone)) do\r\n        if c.isSmoothMoving() then return false end\r\n      end\r\n      return true\r\n    end)\r\n  end\r\nend\r\n\r\n-- Call this instead of the old banishOneMemoryCard body\r\nfunction banishOneMemoryCard(player, value, index)\r\n  table.insert(banishQueue, { color = player.color })\r\n  processNextBanish()\r\nend\r\n\r\n\r\nfunction clearPlaymat(player, value, index)\n    local playmat = getObjectFromGUID(playmats[player.color])\n    if not playmat then return end\n    clearFieldAndHand(player, value, index)\n    resetPlayerScore(player, value, index)\n    clearSideboardAndExtra(player, value, index)\n    resetPlayerRuneManagement(player.color)\nend\n\r\nfunction findPlayerZoneByNameRemote(packet)\r\n  return findPlayerZoneByName(packet[1], packet[2])\r\nend\r\n\r\nfunction findPlayerZoneByName(player_color, name_fragment)\r\n  local playmat = getObjectFromGUID(playmats[player_color])\r\n  if not playmat then return end\r\n\r\n  local snap_offset = getSnapPosition(playmat, name_fragment:lower())\r\n\r\n  if not snap_offset then return nil end  -- unknown type\r\n\r\n  local targetPos = playmat.positionToWorld(snap_offset)\r\n\r\n  return targetPos\r\nend\r\n\r\nfunction appropriateRotationForPlayer(player_color)\r\n    local playmat = getObjectFromGUID(playmats[player_color])\r\n    if not playmat then return end\r\n    return playmat.getRotation()\r\nend\r\n\r\nfunction findPlayerZoneLocationByName(player_color, name_fragment)\r\n    local playmat = getObjectFromGUID(playmats[player_color])\r\n    if not playmat then return end\r\n    return playmat.positionToWorld(deck_position[name_fragment])\r\nend\r\n\r\nfunction findPlayerDeckByNameRemote(packet)\n  return findPlayerDeckByName(packet[1], packet[2])\nend\n\ndeck_guid_cache = deck_guid_cache or {\n  Red = {},\n  Blue = {},\n  Green = {},\n  Purple = {}\n}\n\nfunction normalizeDeckName(name_fragment)\n  if not name_fragment then return nil end\n  return tostring(name_fragment):lower()\nend\n\nfunction cacheDeckGuid(player_color, deck_name, obj)\n  local key = normalizeDeckName(deck_name)\n  if not key or not deck_guid_cache[player_color] then return end\n\n  if obj and obj.getGUID and (obj.tag == \"Deck\" or obj.tag == \"Card\") then\n    deck_guid_cache[player_color][key] = obj.getGUID()\n  else\n    deck_guid_cache[player_color][key] = nil\n  end\nend\n\nfunction getCachedDeckByName(player_color, name_fragment)\n  local key = normalizeDeckName(name_fragment)\n  local cache = deck_guid_cache[player_color]\n  if not key or not cache then return nil end\n\n  local guid = cache[key]\n  if not guid then return nil end\n\n  local obj = getObjectFromGUID(guid)\n  if not obj or (obj.tag ~= \"Deck\" and obj.tag ~= \"Card\") then\n    cache[key] = nil\n    return nil\n  end\n\n  local minBound, maxBound = getPlaymatBounds(player_color)\n  if not isPointInBounds(obj.getPosition(), minBound, maxBound) then\n    cache[key] = nil\n    return nil\n  end\n\n  return obj\nend\n\nfunction findPlayerDeckByName(player_color, name_fragment)\n    local playmat = getObjectFromGUID(playmats[player_color])\n    if not playmat then return end\n\n    local cached = getCachedDeckByName(player_color, name_fragment)\n    if cached then\n      return cached\n    end\n\n    local minBound, maxBound = getPlaymatBounds(player_color)\n\r\n    -- Try first by name matching\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        local pos = obj.getPosition()\r\n        if obj.tag == \"Deck\"\n        and obj.getName():lower():find(name_fragment:lower())\n        and isPointInBounds(pos, minBound, maxBound) then\n            cacheDeckGuid(player_color, name_fragment, obj)\n            return obj\n        end\n    end\n\r\n    -- If no deck with matching name, fallback to position check\r\n\r\n    local snap_offset = getSnapPosition(playmat, name_fragment:lower())\r\n    if not snap_offset then return nil end  -- unknown type\r\n\r\n    local targetPos = playmat.positionToWorld(snap_offset)\r\n\r\n    -- Find closest deck to the expected snap point\r\n    local bestDeck = nil\r\n    local bestDist = 1 -- usually like 0.3ish\r\n\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        if obj.tag == \"Deck\" or obj.tag == \"Card\" then\n            local dist = (obj.getPosition() - targetPos):magnitude()\n            if dist < bestDist then\n                bestDeck = obj\n                bestDist = dist\n            end\n        end\n    end\n\n    if bestDeck then\n      cacheDeckGuid(player_color, name_fragment, bestDeck)\n    end\n    return bestDeck\nend\n\r\nlocal function getVisibleDeckEntry(deck)\r\n  local list = deck.getObjects() or {}\r\n  if #list == 0 then return nil end\r\n\r\n  local pick, maxIndex = list[1], (list[1].index or -1)\r\n  for _, e in ipairs(list) do\r\n    local idx = e.index or -1\r\n    if idx > maxIndex then\r\n      pick, maxIndex = e, idx\r\n    end\r\n  end\r\n  return pick or list[#list]\r\nend\r\n\r\nfunction sendMarkerAway(player_color, markertype)\r\n  local markerGUID = markertype[player_color]\r\n  local marker = getObjectFromGUID(markerGUID)\r\n  local markerPos = marker.getPosition()\r\n  if not marker then return end\r\n\r\n  if (marker.getPosition().x>-100) then\r\n    marker.setPosition(marker.getPosition() + Vector(-200, 0, 0))\r\n  end\r\nend\r\n\r\n\r\nfunction onObjectRandomize(object, player_color)\r\n    if object.tag ~= \"Deck\" then return end\r\n\r\n    sendMarkerAway(player_color, notshuffledmarkers)\r\n\r\n    local mainDeck = findPlayerDeckByName(player_color, \"main\")\r\nend\r\n\r\nlocal function isCardFaceDown(card)\r\n  if not card then return false end\r\n  local rot = card.getRotation()\r\n  return rot.z > 90 and rot.z < 270\r\nend\r\n\r\nfunction onObjectLeaveZone(zone, obj)\r\n  if not obj or obj.tag ~= \"Card\" then return end\r\n  removeRevealCardPhysics(obj)\r\n\r\n  local data = parseGMNotes(obj.getGMNotes())\r\n\r\n  if zone.tag==\"Hand\" then\r\n    for _, color in ipairs({\"Red\", \"Blue\", \"Green\", \"Purple\"}) do\r\n      if zone.guid == playerhandzones[color] then\r\n        -- determine if it's face up or face down before we log private or public\r\n        ReplayLog.log(\"CARD_LEAVES_HAND\", color,\r\n          { guid = obj.guid,\r\n            card_id = data.slug},\r\n          hidden and \"private\" or \"public\")\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction onObjectLeaveContainer(container, leavingObject)\r\n    local cardName      = (leavingObject.getName() or \"\"):lower()\r\n    local containerName = (container.getName()     or \"\"):lower()\r\n\r\n    if leavingObject.tag == \"Card\" then\r\n      local data = parseGMNotes(leavingObject.getGMNotes())\r\n      if data and data.type == \"battlefield\" then\r\n        leavingObject.alt_view_angle = {0, 180, -90}\r\n      elseif data and data.type==\"rune\" then\r\n        ReplayLog.log(\"CHANNEL_RUNE\", player_color,\r\n          { guid = leavingObject.guid,\r\n            card_id = data.slug},\r\n          \"public\")\r\n      elseif data and container.getName()==\"main\" then\r\n        for _, color in ipairs({\"Red\", \"Blue\", \"Green\", \"Purple\"}) do\r\n          if container == findPlayerDeckByName(color, \"main\") then\r\n          ReplayLog.log(\"CARD_LEAVES_CONTAINER\", color,\r\n            { guid = leavingObject.guid,\r\n              deck = container.getName(),\r\n              card_id = data.slug},\r\n            \"private\")\r\n          end\r\n        end\r\n      end\r\n\r\n    end\r\n\r\n    if container ~= nil and container.tag == \"Deck\" then\r\n      for _, color in ipairs({\"Red\", \"Blue\", \"Green\", \"Purple\"}) do\r\n        local minBoundChampion, maxBoundChampion = getBoundsOfDeckZone (color, \"champion\")\r\n        if isPointInBounds(container.getPosition(), minBoundChampion, maxBoundChampion) then\r\n          if container and container.tag == \"Card\" or #container.GetObjects()<=1  then\r\n            sendMarkerAway(color, chooseonemarkers)\r\n          end\r\n        end\r\n      end\r\n      Wait.frames(function()\n        applyStackCounter(container)\n      end, 1)\n      local isFaceUp = container.getRotation().z<90\r\n      if isFaceUp then\r\n        local visibledeckentry = getVisibleDeckEntry(container)\r\n        if visibledeckentry ~= nil then\r\n          local slugoverride = toReducedSlug(visibledeckentry.name)\r\n          inscriptCardRulesText(container, slugoverride)\r\n        end\r\n      end\r\n    end\r\nend\r\n\r\nfunction getHomogeneousDeckCount(deck)\r\n  if not deck or deck.tag ~= \"Deck\" then return nil end\r\n\r\n  local objects = deck.getObjects()\r\n  if not objects or #objects == 0 then return nil end\r\n\r\n  local firstSlug = nil\r\n\r\n  for _, entry in ipairs(objects) do\r\n    local notes = entry.gm_notes or entry.GMNotes\r\n    if not notes or notes == \"\" then return nil end\r\n\r\n    local data = parseGMNotes(notes)\r\n    if not data or not data.slug then return nil end\r\n\r\n    if not firstSlug then\r\n      firstSlug = data.slug\r\n    elseif data.slug ~= firstSlug then\r\n      return nil\r\n    end\r\n  end\r\n\r\n  return #objects\r\nend\r\n\r\nfunction applyStackCounter(deck)\r\n  if not deck or deck.isDestroyed() then return end\r\n  local enc = Global.getVar(\"Encoder\")\r\n  if not enc then return end\r\n\r\n  local count = getHomogeneousDeckCount(deck)\r\n\r\n  if count then\r\n    enc.call(\"APIencodeObject\", { obj = deck })\r\n    enc.call(\"APIobjEnableProp\", {\r\n      obj = deck,\r\n      propID = \"πCounter\"\r\n    })\r\n\r\n    enc.call(\"APIobjSetValueData\", {\r\n      obj = deck,\r\n      valueID = \"picounter\",\r\n      data = { picounter = count }\r\n    })\r\n\r\n    enc.call(\"APIrebuildButtons\", { obj = deck })\r\n  else\r\n    enc.call(\"APIencodeObject\", { obj = deck })\r\n    enc.call(\"APIobjDisableProp\", {\r\n      obj = deck,\r\n      propID = \"πCounter\"\r\n    })\r\n    enc.call(\"APIrebuildButtons\", { obj = deck })\r\n  end\r\nend\r\n\r\n\r\nfunction onObjectEnterContainer(container, enteringObject)\n  if not container or container.tag ~= \"Deck\" then return end\n  Wait.frames(function()\n    applyStackCounter(container)\n  end, 1)\n  if not enteringObject or enteringObject.tag ~= \"Card\" then return end\r\n  removeRevealCardPhysics(enteringObject)\r\n\r\n  -- NOTE - need to deal with combining two decks if the player puts new cards on their main deck\r\n  -- NOTE - need to deal with the player sliding the card under if it's a single card\r\n  -- NOTE - need to deal with combining two decks if the player puts new cards in the empty spot then puts their main deck back on top\r\nend\r\n\r\nlocal function resetCardIdFromNotesAndName(notes, name)\n  local data = parseGMNotes(notes or \"\")\n  if data and data.slug and data.slug ~= \"\" then return data.slug end\n  if data and data.uuid and data.uuid ~= \"\" then return data.uuid end\n\n  local fallback = to_slug(name or \"\")\n  if fallback ~= \"\" then return fallback end\n  return nil\nend\n\nlocal function bumpCardSet(out, id, count)\n  if not id then return end\n  local n = tonumber(count) or 0\n  if n <= 0 then return end\n  out[id] = (out[id] or 0) + n\nend\n\nlocal function accumulateCardSetFromObject(obj, out)\n  if not obj then return end\n\n  if obj.tag == \"Deck\" then\n    for _, entry in ipairs(obj.getObjects() or {}) do\n      local notes = entry.gm_notes or entry.GMNotes or \"\"\n      local name = entry.nickname or entry.name or \"\"\n      local id = resetCardIdFromNotesAndName(notes, name)\n      bumpCardSet(out, id, 1)\n    end\n  elseif obj.tag == \"Card\" then\n    local id = resetCardIdFromNotesAndName(obj.getGMNotes(), obj.getName())\n    bumpCardSet(out, id, 1)\n  end\nend\n\nlocal function accumulateCardSetFromZone(player_color, zone_name, out)\n  local minBound, maxBound = getBoundsOfDeckZone(player_color, zone_name)\n  if not minBound then return end\n\n  for _, obj in ipairs(getAllObjects()) do\n    if (obj.tag == \"Deck\" or obj.tag == \"Card\")\n      and isPointInBounds(obj.getPosition(), minBound, maxBound)\n    then\n      accumulateCardSetFromObject(obj, out)\n    end\n  end\nend\n\nlocal function copyCardSet(src)\n  local out = {}\n  for id, count in pairs(src or {}) do\n    local n = tonumber(count) or 0\n    if n > 0 then\n      out[id] = n\n    end\n  end\n  return out\nend\n\nlocal function addCardSetInto(target, addition)\n  for id, count in pairs(addition or {}) do\n    local n = tonumber(count) or 0\n    if n > 0 then\n      target[id] = (target[id] or 0) + n\n    end\n  end\nend\n\nlocal function subtractCardSet(minuend, subtrahend)\n  local out = {}\n  for id, count in pairs(minuend or {}) do\n    local remaining = (tonumber(count) or 0) - (subtrahend and (tonumber(subtrahend[id]) or 0) or 0)\n    if remaining > 0 then\n      out[id] = remaining\n    end\n  end\n  return out\nend\n\nlocal function isCardSetEmpty(set)\n  for _, _ in pairs(set or {}) do\n    return false\n  end\n  return true\nend\n\nlocal function toSpawnCardsFromCardSet(set)\n  local cards = {}\n  local missing = {}\n\n  for id, count in pairs(set or {}) do\n    local n = tonumber(count) or 0\n    if n > 0 then\n      local card = getCardData(id, true)\n      if card then\n        card.quantity = n\n        table.insert(cards, card)\n      else\n        table.insert(missing, id)\n      end\n    end\n  end\n\n  if #missing > 0 then\n    print(\"Could not resolve \" .. tostring(#missing) .. \" cards for GG Go Next reset: \" .. table.concat(missing, \", \"))\n  end\n\n  return cards\nend\n\nfunction makeResetSnapshotForPlayer(player_color)\n  local mainSet = {}\n  local sideboardSet = {}\n  local runeSet = {}\n  local championSet = {}\n\n  accumulateCardSetFromZone(player_color, \"main\", mainSet)\n  accumulateCardSetFromZone(player_color, \"sideboard\", sideboardSet)\n  accumulateCardSetFromZone(player_color, \"rune\", runeSet)\n  accumulateCardSetFromZone(player_color, \"champion\", championSet)\n\n  local mainPool = copyCardSet(mainSet)\n  addCardSetInto(mainPool, sideboardSet)\n\n  return {\n    version = 1,\n    main_pool = mainPool,\n    original_sideboard = sideboardSet,\n    rune = runeSet,\n    champion = championSet\n  }\nend\n\nfunction writeResetSnapshotToPlaymat(player_color)\n  local playmat = getPlaymat(player_color)\n  if not playmat then return false end\n  playmat.setGMNotes(JSON.encode(makeResetSnapshotForPlayer(player_color)))\n  return true\nend\n\nlocal function readResetSnapshotFromPlaymat(player_color)\n  local playmat = getPlaymat(player_color)\n  if not playmat then return nil end\n\n  local notes = playmat.getGMNotes()\n  if not notes or notes == \"\" then return nil end\n\n  local ok, decoded = pcall(JSON.decode, notes)\n  if not ok or type(decoded) ~= \"table\" then return nil end\n  return decoded\nend\n\nfunction computeResetDecksFromSnapshot(player_color)\n  local snapshot = readResetSnapshotFromPlaymat(player_color)\n  if not snapshot then return nil end\n\n  local liveSideboard = {}\n  accumulateCardSetFromZone(player_color, \"sideboard\", liveSideboard)\n\n  local sideboardReference = liveSideboard\n  if isCardSetEmpty(sideboardReference) then\n    sideboardReference = snapshot.original_sideboard or {}\n  end\n\n  local mainSet = subtractCardSet(snapshot.main_pool or {}, sideboardReference)\n\n  return {\n    main = toSpawnCardsFromCardSet(mainSet),\n    rune = toSpawnCardsFromCardSet(snapshot.rune or {}),\n    champion = toSpawnCardsFromCardSet(snapshot.champion or {})\n  }\nend\n\r\nlastResetTimes = {\r\n  Red = 0,\r\n  Blue = 0,\r\n  Green = 0,\r\n  Purple = 0\r\n}\r\n\r\nrebounceProtectionTime = 60\r\n\r\nfunction resetToGameStart(player, value, index)\n    local player_color = player.color\n\n    local now = os.time()\n    if lastResetTimes[player_color] and now - lastResetTimes[player_color] > rebounceProtectionTime then\n      sendAnalytics(\"GG Go Next\", player)\n      lastResetTimes[player_color] = now\n    end\n\n    local reset_decks = computeResetDecksFromSnapshot(player_color)\n    if not reset_decks then\n      broadcastToColor(\"No imported deck snapshot found. Import a deck first.\", player_color, {1, 0, 0})\n      return\n    end\n\n    resetPlayerScore(player, value, index)\n\n    clearFieldAndHand(\n      player,\n      value,\n      index,\n      { legend = \"skip\", battlefield = \"skip\" },\n      { preserveSideboard = true }\n    )\n\n    local championDeck = nil\n    if #reset_decks[\"champion\"] > 0 then\n      championDeck = spawnDeck(\"champion\", reset_decks[\"champion\"], player, false)\n    end\n    if championDeck and championDeck.tag == \"Deck\" and #reset_decks[\"champion\"] > 1 then\n      placeChooseOneMarker(championDeck, player)\n    else\n      sendMarkerAway(player_color, chooseonemarkers)\n    end\n\n    local mainDeck = nil\n    if #reset_decks[\"main\"] > 0 then\n      mainDeck = spawnDeck(\"main\", reset_decks[\"main\"], player, false)\n      if mainDeck then\n        placeNotShuffledMarker(mainDeck, player)\n      end\n    end\n\n    local runeDeck = nil\n    if #reset_decks[\"rune\"] > 0 then\n      runeDeck = spawnDeck(\"rune\", reset_decks[\"rune\"], player, false)\n      if runeDeck and runeDeck.tag == \"Deck\" then\n        runeDeck.randomize()\n      end\n    end\n\n    performResetFlourish(player, mainDeck, \"https://steamusercontent-a.akamaihd.net/ugc/15583394731495481827/DD36C15EBA6223D088BFD2782B9CC5747A9AF5C1/\")\n    performResetFlourish(player, runeDeck, \"https://steamusercontent-a.akamaihd.net/ugc/10421432526134290630/67E6A533DC249862B62893D9D9612D85867DC67D/\")\n\n    resetPlayerRuneManagement(player_color)\nend\n\r\nfunction performResetFlourish(player, deck, sleeve_url)\r\n    if not deck or deck.tag ~= \"Deck\" then return end\r\n\r\n    local count = #deck.getObjects()\r\n    if count < 3 then return end\r\n\r\n    local center = deck.getPosition()\r\n    local radius = 5\r\n    local fixedCount = 12\r\n    local angleStep = (2 * math.pi) / fixedCount\r\n\r\n    local total = math.min(count, 30)\r\n    local cardsToAnimate = total - 2\r\n    local animDuration = 0.5\r\n    local delayPerCard = animDuration / cardsToAnimate\r\n\r\n    for i = 1, cardsToAnimate do\r\n        local angle = angleStep * i\r\n        local offset = Vector(math.cos(angle) * radius, 2, math.sin(angle) * radius)\r\n        local delay = (i - 1) * delayPerCard\r\n\r\n        Wait.time(function()\r\n            local ghost = spawnObject({\r\n                type = \"Card\",\r\n                position = center + offset,\r\n                rotation = {0, 0, 180},\r\n                scale = {0.95, 0.95, 0.95},\r\n                sound = false\r\n\r\n            })\r\n\r\n            if ghost then\r\n                ghost.setCustomObject({\r\n                  face = sleeve_url,\r\n                  back = sleeve_url\r\n                })\r\n\r\n                ghost.setLock(true)\r\n                ghost.setName(\"Flourish\")\r\n                ghost.setDescription(\"\")\r\n                ghost.setVar('noencode', true)\r\n\r\n                Wait.time(function()\r\n                    ghost.setPositionSmooth(center + Vector(0, 2 + i * 0.1, 0), false, true)\r\n                end, 0.2)\r\n\r\n                Wait.time(function()\r\n                    if ghost then ghost.destruct() end\r\n                end, 1.0)\r\n            end\r\n        end, delay)\r\n    end\r\nend\r\n\r\nlocal function getObjectCardTypeForSkip(obj)\n  if not obj then return nil end\n\n  if obj.tag == \"Card\" then\n    local data = parseGMNotes(obj.getGMNotes())\n    return data and data.type\n  end\n\n  if obj.tag == \"Deck\" then\n    local entries = obj.getObjects()\n    if entries and #entries > 0 then\n      local notes = entries[1].gm_notes or entries[1].GMNotes or \"\"\n      local data = parseGMNotes(notes)\n      return data and data.type\n    end\n  end\n\n  return nil\nend\n\nfunction destroyEverythingInZone(zone, skiptypes, preservedGuids)\n  if zone then\n    for _, obj in ipairs(getAllObjects()) do\n      if objectIsInZone(obj, zone) then\n        local tag = obj.tag\n        if (not preservedGuids or not preservedGuids[obj.guid])\n          and (tag == \"Card\" or tag == \"Dice\" or tag == \"Chip\" or tag == \"Token\" or tag == \"Deck\" or tag == \"GoPiece\")\n        then\n          local type = getObjectCardTypeForSkip(obj)\n          if (skiptypes and skiptypes[type]) then\n            -- skip\n          else\n            obj.destroy()\n          end\n        end\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction clearFieldAndHand(player, value, index, skiptypes, options)\n  local player_color = player.color\n  local playmat = getObjectFromGUID(playmats[player_color])\n  if not playmat then return end\n\n  options = options or {}\n  local preservedGuids = {}\n  if options.preserveSideboard then\n    local sideMin, sideMax = getBoundsOfDeckZone(player_color, \"sideboard\")\n    if sideMin then\n      for _, obj in ipairs(getAllObjects()) do\n        if isPointInBounds(obj.getPosition(), sideMin, sideMax) then\n          preservedGuids[obj.guid] = true\n        end\n      end\n    end\n  end\n\n  local minBound, maxBound = getPlaymatBounds(player_color)\n  destroyEverythingInBounds(player, minBound, maxBound, skiptypes, preservedGuids)\n\n  destroyEverythingInZone(getObjectFromGUID(playerbattlefield1v1zonesWest[player_color]), skiptypes, preservedGuids)\n  destroyEverythingInZone(getObjectFromGUID(playerbattlefield1v1zonesEast[player_color]), skiptypes, preservedGuids)\n  destroyEverythingInZone(getObjectFromGUID(playerbattlefieldFFAZonesWest[player_color]), skiptypes, preservedGuids)\n  destroyEverythingInZone(getObjectFromGUID(playerbattlefieldFFAZonesEast[player_color]), skiptypes, preservedGuids)\n  destroyEverythingInZone(getObjectFromGUID(playerbattlefieldFFAZonesCenter[player_color]), skiptypes, preservedGuids)\n\r\n  sendMarkerAway(player_color, notshuffledmarkers)\r\n  sendMarkerAway(player_color, chooseonemarkers)\r\n\r\n  -- destroy anything in *all* of their hand zones (hand 1 and hand 2)\r\n  local p = Player[player_color]\r\n  for handIdx = 1, p.getHandCount() do\r\n    for _, obj in ipairs(p.getHandObjects(handIdx) or {}) do\r\n      obj.destruct()\r\n    end\r\n  end\r\nend\r\n\r\nfunction resetPlayerScore(player, value, index)\r\n  scorecounter = getObjectFromGUID(scorecounters[player.color])\r\n  if scorecounter then\r\n    scorecounter.call(\"reset_val\", { })\r\n  end\r\nend\r\n\r\nfunction getBoundsOfDeckZone (player_color, zoneName)\r\n  local playmat = getObjectFromGUID(playmats[player_color])\r\n  local localPos = getSnapPosition(playmat, zoneName)\r\n\r\n  if playmat and localPos then\r\n\r\n      local worldPos = playmat.positionToWorld(localPos)\r\n\r\n      local halfSizeX = 2.0\r\n      local halfSizeY = 2.0\r\n      local halfSizeZ = 2.0\r\n\r\n      local minBound = Vector(worldPos.x - halfSizeX, worldPos.y - halfSizeY, worldPos.z - halfSizeZ)\r\n      local maxBound = Vector(worldPos.x + halfSizeX, worldPos.y + halfSizeY, worldPos.z + halfSizeZ)\r\n\r\n      return minBound, maxBound\r\n\r\n  end\r\nend\r\n\r\nfunction clearSideboardAndExtra(player, value, index)\r\n  local additional_zones_to_clear = {\r\n    \"sideboard\", \"battlefield\"\r\n  }\r\n  for _, zoneName in ipairs(additional_zones_to_clear) do\r\n      local minBound, maxBound = getBoundsOfDeckZone( player.color, zoneName )\r\n      if minBound then\r\n        destroyEverythingInBounds(player, minBound, maxBound)\r\n      end\r\n  end\r\nend\r\n\r\nlocal function hasTag(obj, tag)\r\n  for _, t in ipairs(obj.getTags()) do\r\n    if t == tag then return true end\r\n  end\r\n  return false\r\nend\r\n\r\nfunction destroyEverythingInBounds(player, minBound, maxBound, skiptypes, preservedGuids)\n  -- Iterate through all objects and delete only cards, dice, and tokens\n  for _, obj in ipairs(getAllObjects()) do\n\n      local pos = obj.getPosition()\n      local tag = obj.tag\n      local isStatusToken = hasTag(obj, \"StatusToken\")\n      -- Check if the object is inside the playmat's area\n      if isPointInBounds(pos, minBound, maxBound)\n        and (not preservedGuids or not preservedGuids[obj.guid])\n      then\n          -- Delete only specific object types\n          if isStatusToken or tag == \"Card\" or tag == \"Dice\" or tag == \"Chip\" or tag == \"Infinite\" or tag == \"Token\" or tag == \"Deck\" or tag == \"GoPiece\" then\n            local type = getObjectCardTypeForSkip(obj)\n            if (skiptypes and skiptypes[type]) then\n              local playmat = getObjectFromGUID(playmats[player.color])\n              if playmat and (tag == \"Card\" or tag == \"Deck\") then\n                wakeUpOneObject(playmat, obj)\n              end\n            else\n              obj.destroy()\n            end\n          end\n      end\n  end\nend\n\r\nfunction getPlaymatBounds(color)\r\n  local mat    = getObjectFromGUID(playmats[color])\r\n  local b, c   = mat.getBounds(), mat.getPosition()\r\n  local hx, hy, hz = b.size.x/2, 50, b.size.z/2\r\n  return Vector(c.x - hx, c.y - hy, c.z - hz), Vector(c.x + hx, c.y + hy, c.z + hz)\r\nend\r\n\r\nfunction wakeUpThingsInZone(zone, playmat)\r\n  if zone and playmat then\r\n    for _, obj in ipairs(zone.getObjects()) do\r\n      if obj.tag == \"Deck\" then\r\n        wakeUpOneObject(playmat, obj)\r\n      elseif obj.tag == \"Card\" then\r\n        local data = parseGMNotes(obj.getGMNotes())\r\n        if data and data.type == \"battlefield\" then\r\n\r\n        else\r\n          wakeUpOneObject(playmat, obj)\r\n        end\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction endTurnProcedure(player, value, index)\r\n    -- make sure Turns is on\r\n    Turns.enable = true\r\n\r\n    -- advance to next player in turn order\r\n    local nextColor = Turns.getNextTurnColor()\r\n    if nextColor then\r\n        Turns.turn_color = nextColor\r\n    end\r\nend\r\n\r\nfunction beginNewTurnProcedure(player, value, index)\r\n  local runezone = getObjectFromGUID(playerrunezones[player.color])\r\n  local playmat = getObjectFromGUID(playmats[player.color])\r\n  if isFourPlayerMode() then\r\n    local battlefieldzonewest = getObjectFromGUID(playerbattlefieldFFAZonesWest[player.color])\r\n    wakeUpThingsInZone(battlefieldzonewest, playmat)\r\n    local battlefieldzoneeast = getObjectFromGUID(playerbattlefieldFFAZonesEast[player.color])\r\n    wakeUpThingsInZone(battlefieldzoneeast, playmat)\r\n    local battlefieldzonecenter = getObjectFromGUID(playerbattlefieldFFAZonesCenter[player.color])\r\n    wakeUpThingsInZone(battlefieldzonecenter, playmat)\r\n  else\r\n    local battlefieldzone = getObjectFromGUID(playerbattlefield1v1zonesWest[player.color])\r\n    wakeUpThingsInZone(battlefieldzone, playmat)\r\n    local battlefieldzone = getObjectFromGUID(playerbattlefield1v1zonesEast[player.color])\r\n    wakeUpThingsInZone(battlefieldzone, playmat)\r\n  end\r\n  local lastrotatingobject = wakeUpEverythingOnPlaymat(player, value, index)\r\n\r\n  local runeCard = nil\r\n  local runeCard2 = nil\r\n  local runeCard3 = nil\r\n\r\n  -- Detect if this is the player's first turn (rune zone has exactly 1 object, the Rune Deck bag/deck)\r\n  local isplayersfirstturn = runezone and #runezone.getObjects() == 1\r\n\r\n  local num_other_players = 0\r\n  local num_other_with_runes = 0\r\n\r\n  if isplayersfirstturn then\r\n    for _, color in ipairs({\"Red\", \"Blue\", \"Green\", \"Purple\"}) do\r\n      if color ~= player.color then\r\n        local mainDeck = findPlayerDeckByName(color, \"main\")\r\n        if mainDeck or Player[color].seated then\r\n          num_other_players = num_other_players + 1\r\n        end\r\n        local rz = getObjectFromGUID(playerrunezones[color])\r\n        if rz then\r\n\r\n          local has_rune_card = false\r\n          for _, obj in ipairs(rz.getObjects()) do\r\n            if obj.tag == \"Card\" then\r\n              has_rune_card = true\r\n              break\r\n            end\r\n          end\r\n          if has_rune_card then\r\n            num_other_with_runes = num_other_with_runes + 1\r\n          end\r\n        end\r\n      end\r\n    end\r\n  end\r\n\r\n  Wait.condition(\r\n    function()\r\n\r\n      -- Draw a card unless this is the first player's first turn in a multiplayer game\r\n      -- (skip draw only for the very first player overall)\r\n      if not isFourPlayerMode() or not (isplayersfirstturn and num_other_with_runes == 0) then\r\n        drawOneCard(player, value, index)\r\n      end\r\n\r\n      runeCard = channelOneRune(player, value, index, false)\r\n      if not runeCard then return end\r\n\r\n      Wait.condition(\r\n        function()\r\n          --repositionAllRunesInZone(player.color)\r\n          runeCard2 = channelOneRune(player, value, index, true)\r\n\r\n          Wait.condition(\r\n            function()\r\n              repositionAllRunesInZone(player.color)\r\n\r\n              -- Channel a third rune if this is the last player's first turn\r\n              -- (all other existing players have already channeled runes)\r\n              if isplayersfirstturn and num_other_with_runes == num_other_players and num_other_players > 0 then\r\n                runeCard3 = channelOneRune(player, value, index, true)\r\n                Wait.condition(\r\n                  function()\r\n                    repositionAllRunesInZone(player.color)\r\n                  end,\r\n                  function()\r\n                    return runeCard3 == nil or not runeCard3.isSmoothMoving()\r\n                  end\r\n                )\r\n              end\r\n            end,\r\n            function()\r\n              return runeCard2 == nil or not runeCard2.isSmoothMoving()\r\n            end\r\n          )\r\n        end,\r\n        function()\r\n          return runeCard == nil or not runeCard.isSmoothMoving()\r\n        end\r\n      )\r\n    end,\r\n    function()\r\n      return lastrotatingobject == nil or not lastrotatingobject.isSmoothMoving()\r\n    end\r\n  )\r\nend\r\n\r\nfunction drawOneCard(player, value, index)\r\n    player_color = player.color\r\n    local mainDeck = findPlayerDeckByName(player_color, \"main\")\r\n    if not mainDeck then\r\n        broadcastToColor(\"No Main Deck found!\", player_color, {1,0,0})\r\n        return\r\n    end\r\n\r\n    local deckObjs = mainDeck.getObjects()\r\n    if #deckObjs == 0 then\r\n        broadcastToColor(\"Main Deck empty!\", player_color, {1,0,0})\r\n        return\r\n    end\r\n    mainDeck.deal(1, player.color, 1)\r\nend\r\n\r\nfunction channelOneRune(player, value, index, offset)\r\n    local player_color = player.color\r\n    local targetposition = getObjectFromGUID(playerrunezones[player_color]).getPosition()\r\n    local targetrotation = getObjectFromGUID(playerrunezones[player_color]).getRotation()\r\n    targetrotation.y=180-targetrotation.y\r\n    if (offset) then\r\n      targetposition.x = targetposition.x + 4\r\n    else\r\n      targetposition.x = targetposition.x - 4\r\n    end\r\n\r\n    local runeDeck = findPlayerDeckByName(player_color, \"rune\")\r\n    cardTaken = nil\r\n\r\n    if runeDeck then\r\n      if runeDeck.tag == \"Deck\" then\r\n\r\n        if not runeDeck then\r\n            broadcastToColor(\"No Rune Deck found!\", player_color, {1,0,0})\r\n            return cardTaken\r\n        end\r\n\r\n        local deckObjs = runeDeck.getObjects()\r\n        if #deckObjs == 0 then\r\n            broadcastToColor(\"Rune Deck empty!\", player_color, {1,0,0})\r\n            return cardTaken\r\n        end\r\n\r\n        cardTaken = runeDeck.takeObject({\r\n            index = 0,  -- Top card\r\n            position = targetposition,\r\n            flip = true\r\n        })\r\n        return cardTaken\r\n      elseif runeDeck.tag == \"Card\" then\r\n        runeDeck.setPositionSmooth(targetposition, false, true)\r\n        runeDeck.setRotationSmooth(targetrotation, false, true)\r\n        cardTaken = runeDeck\r\n      end\r\n    end\r\n    return cardTaken\r\nend\r\n\r\nfunction wakeUpOneObject(playmat, obj)\r\n  local rot = obj.getRotation()\r\n  local isFaceDown = rot.z > 90 and rot.z < 270\r\n\r\n  local newRot = {\r\n      x = playmat.getRotation().x,\r\n      y = playmat.getRotation().y,\r\n      z = isFaceDown and 180 or 0\r\n  }\r\n\r\n  local delta = math.abs(obj.getRotation().y-newRot.y)\r\n  obj.setRotationSmooth(newRot)\r\n  return (delta>45)\r\nend\r\n\r\nfunction wakeUpEverythingOnPlaymat(player, value, index)\r\n    local playmat = getObjectFromGUID(playmats[player.color])\r\n    if not playmat then return end\r\n\r\n    local minBound, maxBound = getPlaymatBounds (player.color)\r\n    local lastrotatingobject = nil\r\n\r\n    for _, obj in ipairs(getAllObjects()) do\r\n        if obj.tag == \"Card\" or obj.tag == \"Deck\" then\r\n            local pos = obj.getPosition()\r\n\r\n            if isPointInBounds(pos, minBound, maxBound) then\r\n              local moving = wakeUpOneObject(playmat, obj)\r\n              if moving then\r\n                lastrotatingobject = obj\r\n              end\r\n            end\r\n        end\r\n    end\r\n    return lastrotatingobject\r\nend\r\n\r\nfunction isPointInBounds(point, minBound, maxBound)\r\n\r\n  return point.x >= minBound.x and point.x <= maxBound.x and\r\n     point.y >= minBound.y and point.y <= maxBound.y and\r\n     point.z >= minBound.z and point.z <= maxBound.z\r\nend\r\n\r\nfunction wakeUpEverythingInBounds(minBound, maxBound, relativeObject)\r\n\r\nend\r\n\r\n\r\n\r\n-- Helper: split any Deck in the zone into single cards, laid out in a line\r\nfunction splitDecksInZone(zone)\r\n    local pos = zone.getPosition()\r\n    for _, obj in ipairs(zone.getObjects()) do\r\n        if obj.tag == \"Deck\" then\r\n            local contents = obj.getObjects() or {}\r\n            local n        = #contents\r\n            if n > 0 then\r\n                local spacing = 0.6                       -- distance between cards\r\n                local startX  = pos.x - spacing*(n-1)/2  -- center the line\r\n                for i = 1, n do\r\n                    local x = startX + (i-1)*spacing\r\n                    obj.takeObject({\r\n                        index    = 1,\r\n                        position = { 4*x, pos.y + 2, pos.z+0.5 },\r\n                        smooth   = false\r\n                    })\r\n                end\r\n            end\r\n            obj.destruct()\r\n        end\r\n    end\r\nend\r\n\r\nfunction reserveAndReorganizeMemory(player, value, index)\r\n    -- 1) get the memory zone\r\n    local memZone = getObjectFromGUID(playerrunezones[player.color])\r\n    if not memZone then\r\n        log(\"Memory Zone for \" .. player.color .. \" is nil.\")\r\n        return\r\n    end\r\n\r\n    -- 2) split any decks into cards\r\n    splitDecksInZone(memZone)\r\n\r\n    -- 3) wait a moment for those new cards to appear\r\n    Wait.time(function()\r\n        local memPos = memZone.getPosition()\r\n\r\n        -- 4) gather all cards now in memory\r\n        local memoryCards = {}\r\n        for _, o in ipairs(memZone.getObjects()) do\r\n            if o.tag == \"Card\" then\r\n                table.insert(memoryCards, o)\r\n            end\r\n        end\r\n        local memCount = #memoryCards\r\n\r\n        -- 5) find face-down cards in hand\r\n        local handZone = getObjectFromGUID(playerhandzones[player.color])\r\n        if not handZone then\r\n            log(\"Hand Zone for \" .. player.color .. \" is nil.\")\r\n            return\r\n        end\r\n        local cardsToMove = {}\r\n        for _, c in ipairs(handZone.getObjects() or {}) do\r\n            if c.tag == \"Card\" and math.abs(c.getRotation().z) > 90 then\r\n                table.insert(cardsToMove, c)\r\n            end\r\n        end\r\n        local handCount = #cardsToMove\r\n\r\n        -- 6) compute total and reorganize existing memory\r\n        local totalCount = memCount + handCount\r\n        reorganizeMemoryForTotal(memoryCards, memPos, totalCount)\r\n\r\n        -- 7) if no new cards, we’re done\r\n        if handCount == 0 then\r\n            return\r\n        end\r\n\r\n        -- 8) otherwise wait a bit more, then move the new cards in place\r\n        Wait.time(function()\r\n            for i, card in ipairs(cardsToMove) do\r\n                local offset   = memCount + (i - 1)\r\n                local finalPos = getMemoryPosition(memPos, offset, totalCount)\r\n\r\n                -- quick mid-air reposition\r\n                local cp = card.getPosition()\r\n                card.setPosition({\r\n                    x = (cp.x + finalPos.x) / 2,\r\n                    y = (cp.y + finalPos.y + 40) / 2,\r\n                    z = (cp.z + finalPos.z) / 2,\r\n                })\r\n                card.setPositionSmooth(finalPos)\r\n            end\r\n        end, 0.5)\r\n\r\n    end, 0.2)\r\nend\r\n\r\n\r\n-------------------------------------------------------------------------------\r\n-- Helper: Reorganize existing memory cards for a future total\r\n-------------------------------------------------------------------------------\r\nfunction reorganizeMemoryForTotal(cardsInMemory, memPos, futureTotal)\r\n    if #cardsInMemory == 0 then return end\r\n\r\n    local spacingSign = (memPos.z < 0) and 1 or -1\r\n\r\n    table.sort(cardsInMemory, function(a, b)\r\n      return a.getPosition().x*spacingSign < b.getPosition().x*spacingSign\r\n    end)\r\n\r\n    local baseCount = 7\r\n    local baseSpacing = 3.2\r\n    local ySpacing = 0.05\r\n    local maxWidth = (baseCount - 1) * baseSpacing\r\n\r\n\r\n    local effectiveSpacing\r\n    if futureTotal <= baseCount then\r\n        effectiveSpacing = baseSpacing * spacingSign\r\n    else\r\n        effectiveSpacing = (maxWidth / (futureTotal - 1)) * spacingSign\r\n    end\r\n\r\n    -- same centered layout logic\r\n    local startOffset = (futureTotal - 1) / 2\r\n    local initial = memPos.x - startOffset * effectiveSpacing\r\n    local yPos = memPos.y + 1\r\n    local zPos = memPos.z\r\n\r\n    for i, card in ipairs(cardsInMemory) do\r\n        local offset = (i - 1)\r\n        local finalPos = {\r\n            x = initial + offset * effectiveSpacing,\r\n            y = yPos + offset * ySpacing,\r\n            z = zPos\r\n        }\r\n        card.setPositionSmooth(finalPos)\r\n    end\r\nend\r\n\r\n-------------------------------------------------------------------------------\r\n-- Helper: Calculate final position for a new card offset\r\n-------------------------------------------------------------------------------\r\nfunction getMemoryPosition(memPos, offset, futureTotal)\r\n    local baseCount = 7\r\n    local baseSpacing = 3.2\r\n    local maxWidth = (baseCount - 1) * baseSpacing\r\n    local spacingSign = (memPos.z < 0) and 1 or -1\r\n\r\n    local effectiveSpacing\r\n    if futureTotal <= baseCount then\r\n        effectiveSpacing = baseSpacing * spacingSign\r\n    else\r\n        effectiveSpacing = (maxWidth / (futureTotal - 1)) * spacingSign\r\n    end\r\n\r\n    local startOffset = (futureTotal - 1) / 2\r\n    local initialX = memPos.x - startOffset * effectiveSpacing\r\n    return {\r\n        x = initialX + offset * effectiveSpacing,\r\n        y = memPos.y + 2,\r\n        z = memPos.z\r\n    }\r\nend\r\n\r\n\r\nfunction recollectMemory(player, value, index)\r\n\r\n  local memoryGuid = playerrunezones[player.color]\r\n  local memoryZone = getObjectFromGUID(memoryGuid)\r\n\r\n  if memoryZone == nil then log(\"Memory Zone for player \" .. player.color ..  \" is nil.\") return end\r\n\r\n\r\n  if (memoryZone.getObjects()) ~= nil then\n    for _,item in ipairs(memoryZone.getObjects()) do\r\n      if item.tag == \"Card\" then\r\n        item.deal(1,player.color)\r\n      elseif item.tag == \"Deck\" then\r\n        item.deal(99, player.color)\r\n      end\r\n    end\r\n  end\r\n\r\nend\r\n\r\n-- Wait until the object is stable, optionally switch to newState, then call thenFn (if provided).\r\nfunction waitToSwitchState(obj, newState, thenFn)\r\n  if not obj or obj.isDestroyed() then return end\r\n\r\n  local function stable()\r\n    return obj and not obj.isDestroyed()\r\n       and not obj.isSmoothMoving()\r\n       and not obj.spawning\r\n  end\r\n\r\n  local function afterSettled()\r\n    if thenFn then thenFn() end\r\n  end\r\n\r\n  local cur = obj.getStateId()\r\n  if cur == newState then\r\n    -- Already in desired state; just wait for stability\r\n    Wait.condition(afterSettled, stable)\r\n    return\r\n  end\r\n\r\n  if cur ~= -1 then\r\n    -- Switch state, then wait for it to finish\r\n    obj.setState(newState)\r\n    Wait.condition(afterSettled, function()\r\n      return stable() and obj.getStateId() == newState\r\n    end)\r\n  else\r\n    -- No alt states; just wait for stability and continue\r\n    Wait.condition(afterSettled, stable)\r\n  end\r\nend\r\n\r\n\r\nfunction getLastStateIndex(obj)\r\n  local states = obj.getStates()\r\n  if states ~= nil then\r\n    return #states+1\r\n  end\r\n  return 1\r\nend\r\n\r\ncachedCardJson = {}\r\nallowPullFromIndex = true\r\n\r\nlocal function getVisibleDeckEntry(deck)\r\n  local list = deck.getObjects() or {}\r\n  if #list == 0 then return nil end\r\n\r\n  local pick, maxIndex = list[1], (list[1].index or -1)\r\n  for _, e in ipairs(list) do\r\n    local idx = e.index or -1\r\n    if idx > maxIndex then\r\n      pick, maxIndex = e, idx\r\n    end\r\n  end\r\n  return pick or list[#list]\r\nend\r\n\r\nlocal function subjectCardName(obj)\r\n  if not obj then return nil end\r\n  if obj.tag == \"Card\" then\r\n    return obj.getName()\r\n  elseif obj.tag == \"Deck\" then\r\n    local entry = getVisibleDeckEntry(obj)\r\n    if entry then\r\n      -- entry.nickname is usually the printed title; fall back to name\r\n      return entry.nickname or entry.name\r\n    end\r\n  end\r\n  return nil\r\nend\r\n\r\nlocal function subjectCardName(obj)\r\n  local name = obj.getName() or \"\"\r\n  local front, back = name:match(\"^%s*(.-)%s*/%s*(.-)%s*$\")\r\n  if not front then\r\n    return name -- single-sided (or already a clean name)\r\n  end\r\n  -- In your table: z ~ 0 => face-down, z ~ 180 => face-up\r\n  local isFaceDown = (math.abs(obj.getRotation().z) > 90)\r\n  return isFaceDown and back or front\r\nend\r\n\r\nfunction inscriptCardRulesText(obj, slugoverride)\r\nend\r\n\r\n-- Rune color map (from your card library)\r\nlocal colorOrder = {}  -- Auto-filled on first drop\r\nlocal pilePositions = {\r\n    color1_untapped = {x = -8.8, y = 0.2, z = 1.25},\r\n    color1_tapped   = {x = -2.9, y = 0.2, z = 1.25},\r\n    color2_untapped = {x =  2.9, y = 0.2, z = 1.25},\r\n    color2_tapped   = {x =  8.8, y = 0.2, z = 1.25}\r\n}\r\n\r\nfunction onObjectDrop(player_color, obj)\r\n  if not obj then return end\r\n  removeRevealCardPhysics(obj)\r\n\r\n  -- Ignore UI\r\n  if obj.getName() == \"Quick Actions Panel\" then return end\r\n\r\n  local pos = obj.getPosition()\n\r\n  if obj.tag == \"Card\" or obj.tag == \"Deck\" then\r\n    local data = parseGMNotes(obj.getGMNotes())\r\n    local runezone = playerrunezones[player_color]\r\n\r\n    if data and data.type == \"rune\" and runezone\r\n       and objectIsInZone(obj, getObjectFromGUID(runezone)) then\r\n      repositionAllRunesInZone(player_color)\r\n      return\r\n    end\r\n\r\n    for _, o in ipairs(getAllObjects()) do\r\n      if o.getName() == \"Quick Actions Panel\" and o.tag == \"Card\" then\r\n        local target = o.positionToWorld({-2.7,0,0})\r\n        target.y, pos.y = 0, 0\r\n        if (pos - target):magnitude() < 3.3 then\r\n          handleBottomDeck(obj, player_color)\r\n          return\r\n        end\r\n      end\r\n    end\r\n  end\r\n\r\n  ------------------------------------------------------------------\r\n  -- Auto-rename decks dropped in main deck area\r\n  ------------------------------------------------------------------\r\n  if obj.tag == \"Deck\" then\n    local minB, maxB = getBoundsOfDeckZone(player_color, \"main\")\n    if minB then\n      local pos = obj.getPosition()\n      if isPointInBounds(pos, minB, maxB) then\n        local name = obj.getName()\n        if not name:lower():find(\"main\") then\n          obj.setName(name .. \"main\")\n        end\n        cacheDeckGuid(player_color, \"main\", obj)\n      end\n    end\n    return\n  end\n\r\n  -- CARD ONLY FROM HERE\r\n  if obj.tag ~= \"Card\" then return end\r\n\r\n  local data = parseGMNotes(obj.getGMNotes())\r\n  if not data then return end\r\n\r\n  local hidden = isCardFaceDown(obj)\r\n  local guid   = obj.guid\r\n\r\n\r\n--------------------------------------------------\r\n  -- DECKS (snap-based, intent-driven)\r\n  --------------------------------------------------\r\n  local playmat = getPlaymat(player_color)\r\n  if not playmat then return end\r\n  local flatpos = vector(pos.x, 0, pos.z)\r\n\r\n  for _, target_deck in ipairs({\"main\",\"rune\",\"trash\"}) do\r\n    local world = playmat.positionToWorld(getSnapPosition(playmat, target_deck))\r\n    world = vector(world[1], 0, world[3])\r\n    if (flatpos - world):magnitude() < 1.5 then\r\n      ReplayLog.log(\"CARD_ENTER_DECK\", player_color,\r\n        { guid = guid, card_id = hidden, deck=target_deck and nil or data.slug },\r\n        hidden and \"private\" or \"public\")\r\n      return\r\n    end\r\n  end\r\n  --------------------------------------------------\r\n  -- BASE (bounds-based, per player color)\r\n  --------------------------------------------------\r\n  playerbase = getObjectFromGUID(playerbases[player_color])\r\n  if playerbase and objectIsInZone(obj, playerbase) then\r\n    ReplayLog.log(\"CARD_DROPPED_BASE\", player_color,\r\n      { guid = guid, card_id = data.slug },\r\n      hidden and \"private\" or \"public\")\r\n    return\r\n  end\r\n\r\n  local hits = Physics.cast({\r\n    origin       = pos + vector(0,3,0),\r\n    direction    = {0,-1,0},\r\n    max_distance = 5,\r\n    type         = 1, -- ray\r\n  })\r\n\r\n  local battlefield_location = nil\r\n  local battlefield_list = isFourPlayerMode() and battlefieldsFFA or battlefields1v1\r\n\r\n  for _, hit in pairs(hits) do\r\n    local hitObj = hit.hit_object\r\n    if hitObj and hitObj.tag == \"Tile\" then\r\n      for location, bf_guid in pairs(battlefield_list) do\r\n        if bf_guid == hitObj.guid then\r\n          battlefield_location = location\r\n        end\r\n      end\r\n    end\r\n  end\r\n\r\n  if battlefield_location then\r\n    ReplayLog.log(\"CARD_DROPPED_BATTLEFIELD\", player_color,\r\n      { guid = guid, card_id = data.slug, location = battlefield_location },\r\n      hidden and \"private\" or \"public\")\r\n    return\r\n  end\r\n\r\n\r\nend\r\n\r\n\r\n\r\n\r\nfunction onObjectEnterZone(zone, obj)\r\n  if not obj or obj.tag ~= \"Card\" then return end\r\n\r\n  local data = parseGMNotes(obj.getGMNotes())\r\n  if not data then return end\r\n\r\n  local hidden = isCardFaceDown(obj)\r\n\r\n\r\n\r\n  local colors_to_iterate = isFourPlayerMode() and {\"Red\", \"Blue\", \"Green\", \"Purple\"} or {\"Red\", \"Blue\"}\r\n\r\n  for _, color in ipairs(colors_to_iterate) do\r\n    if zone.guid == playerhandzones[color] then\r\n      ReplayLog.log(\"CARD_ENTERS_HAND\", color,\r\n        { guid = obj.guid, card_id = data.slug, hidden = hidden },\r\n        \"private\")\r\n    elseif zone.guid == playerglimpsezones[color] then\r\n      ReplayLog.log(\"CARD_ENTERS_PEEK\", color,\r\n        { guid = obj.guid, card_id = data.slug },\r\n        \"private\")\r\n    end\r\n  end\r\nend\r\n\r\nfunction onAdjustScoreRemote(params)\r\n  onAdjustScore(params.player_color, params.new_score)\r\nend\r\n\r\nfunction onAdjustScore(player_color, new_score)\r\n  ReplayLog.log(\"ADJUST_SCORE\", player_color,\r\n    { new_score = new_score },\r\n    \"public\")\r\nend\r\n\r\nfunction onAdjustMightRemote(params)\r\n  onAdjustMight(params.obj, params.total_might)\r\nend\r\n\r\nfunction onAdjustMight(obj, total_might)\r\n  local data = parseGMNotes(obj.getGMNotes())\r\n  ReplayLog.log(\"ADJUST_MIGHT\", player_color,\r\n    { guid = obj.guid, card_id = data.slug, total_might=total_might,\r\n      tapped=isTapped },\r\n    \"public\")\r\nend\r\n\r\nfunction onEquipGearRemote(params)\r\n  onEquipGear(params.unit_object, params.gear_object, params.player_color)\r\nend\r\n\r\nfunction onEquipGear(unit_object, gear_object, player_color)\r\n  local unit_data = parseGMNotes(unit_object.getGMNotes())\r\n  local gear_data = parseGMNotes(gear_object.getGMNotes())\r\n  ReplayLog.log(\"GEAR_EQUIPPED\", player_color,\r\n    { unit_guid = unit_object.guid, gear_guid = gear_object.guid,\r\n      unit_card_id = unit_data.slug, gear_card_id = gear_data.slug,\r\n      tapped=isTapped },\r\n    \"public\")\r\nend\r\n\r\nfunction onObjectRotate(rotated_object, spin, flip, player_color, old_spin, old_flip)\r\n    if rotated_object.tag ~= \"Card\" or rotated_object.getName() == \"Quick Actions Panel\"  then return end\r\n\r\n    local data = parseGMNotes(rotated_object.getGMNotes())\r\n\r\n    local isHidden = flip==180\r\n    local isTapped = not ((old_spin > 45) and math.abs(old_spin - 180) > 45)\r\n\r\n    if(flip~=old_flip)then\r\n      if(isHidden)then\r\n        ReplayLog.log(\"CARD_FLIPPED_DOWN\", player_color,\r\n          { guid = rotated_object.guid, card_id = data.slug, hidden = isHidden },\r\n          \"public\")\r\n      else\r\n        ReplayLog.log(\"CARD_FLIPPED_UP\", player_color,\r\n          { guid = rotated_object.guid, card_id = data.slug, hidden = isHidden },\r\n          \"public\")\r\n      end\r\n    end\r\n    if(spin~=old_spin)then\r\n      ReplayLog.log(\"CARD_ROTATED\", player_color,\r\n        { guid = rotated_object.guid, card_id = data.slug, tapped=isTapped },\r\n        isHidden and \"private\" or \"public\")\r\n    end\r\n\r\n    local type = data and data.type\r\n    if type ~= \"rune\" then return end\r\n\r\n    local fieldGUID    = playerbases[player_color]\r\n    local runezoneGUID = playerrunezones[player_color]\r\n    if not fieldGUID or not runezoneGUID then return end\r\n    if not objectIsInZone(rotated_object, getObjectFromGUID(runezoneGUID)) then return end\r\n\r\n    -- tell the repositioner which rune changed, and what its intended state is\r\n    repositionAllRunesInZone(player_color, rotated_object, isTapped)\r\nend\r\n\r\n-- 0 / 180 / 360 = UNTAPPED\r\n-- 90 / 270      = TAPPED\r\n-- ±45° threshold around each\r\nfunction isRotationTapped(rotY, debugLabel)\r\n    if (rotY > 45 and rotY < 135) or (rotY > 225 and rotY < 315) then\r\n      return true\r\n    end\r\n    return false\r\nend\r\n\r\nlocal RUNE_COUNT_COLORS = {\r\n  fury  = { text = \"#E26A6A\", outline = \"#9C3E3E\" }, -- soft crimson\r\n  mind  = { text = \"#6A8FE2\", outline = \"#3E5A9C\" }, -- muted sapphire\r\n  calm  = { text = \"#6FCF9B\", outline = \"#3E8A63\" }, -- gentle jade\r\n  body  = { text = \"#E2A36A\", outline = \"#9C6A3E\" }, -- warm amber\r\n  order = { text = \"#E2D26A\", outline = \"#9C8F3E\" }, -- pale gold\r\n  chaos = { text = \"#B58AE6\", outline = \"#6E4A9C\" }, -- soft violet\r\n}\r\n\r\nlocal RUNE_PILE_ORDER = {\r\n  \"color1_untapped\",\"color1_tapped\",\r\n  \"color2_untapped\",\"color2_tapped\",\r\n}\r\n\r\n-- tappedRune: the rune that was just rotated (may be nil)\r\n-- tappedState: boolean, true=tapped, false=untapped (only relevant if tappedRune is non-nil)\r\nfunction repositionAllRunesInZone(player_color, tappedRune, tappedState)\r\n    local runeZone = getObjectFromGUID(playerrunezones[player_color])\r\n    if not runeZone then return end\r\n\r\n    local allObjects = runeZone.getObjects()\r\n\r\n    -- For preserving pile order\r\n    if not runePileOrder[player_color] then runePileOrder[player_color] = {} end\r\n    local pileMap = runePileOrder[player_color]\r\n    playerRunesByPile[player_color] = {}\r\n    local runesByPile = playerRunesByPile[player_color]\r\n\r\n\r\n    if (#allObjects<3) then -- just the playmat and one rune, so let's reset the colors\r\n      resetPlayerRuneManagement(player_color)\r\n    end\r\n\r\n    -- Categorize runes\r\n    for _, obj in ipairs(allObjects) do\r\n        if obj.tag == \"Card\" then\r\n            local data = parseGMNotes(obj.getGMNotes())\r\n            if data and data.type == \"rune\" then\r\n                local color_identity = data.color_identity\r\n                local color = normalizeRuneColor(color_identity)\r\n                local colorIdx = getColorIndex(player_color, color)\r\n                if colorIdx > 2 then\r\n                  colorIdx = 2\r\n                end\r\n                local isTapped\r\n                if tappedRune and obj == tappedRune then\r\n                    -- override: trust the state from onObjectRotate\r\n                    isTapped = tappedState and true or false\r\n                else\r\n                    -- fallback: infer from rotation\r\n                    local rotY = obj.getRotation().y\r\n                    isTapped = isRotationTapped(rotY, \"rune \"..obj.getName())\r\n                end\r\n\r\n                local pileKey = \"color\" .. colorIdx .. (isTapped and \"_tapped\" or \"_untapped\")\r\n                runesByPile[pileKey] = runesByPile[pileKey] or {}\r\n                pileMap[pileKey] = pileMap[pileKey] or {}\r\n\r\n                -- Update order tracking: if new rune not in list, add it at the end\r\n                local guid = obj.getGUID()\r\n                local found = false\r\n                for _, g in ipairs(pileMap[pileKey]) do\r\n                    if g == guid then found = true break end\r\n                end\r\n                if not found then\r\n                    table.insert(pileMap[pileKey], guid)\r\n                end\r\n\r\n                -- Store object reference\r\n                runesByPile[pileKey][guid] = obj\r\n            end\r\n        end\r\n    end\r\n\r\n    local zonePos = runeZone.getPosition()\r\n    local zoneRot = runeZone.getRotation()\r\n\r\n    local rotationIsFlipped = zoneRot.y>90 and zoneRot.y<270\r\n\r\n    local rotationMultiplier = rotationIsFlipped and -1 or 1\r\n\r\n    local baseY       = 1.00\r\n    local fanStepX    = -0.75 * rotationMultiplier  -- how much to fan along X\r\n    local fanStepZ    = 0.4 * rotationMultiplier  -- how much to fan along Z\r\n    local heightStep  = 0.08   -- how much higher each step on the positive side\r\n\r\n    local runeCounts = {}\r\n\r\n    for pileKey, runeDict in pairs(runesByPile) do\r\n    local posOffset = pilePositions[pileKey]\r\n    if posOffset then\r\n        local orderedGUIDs = pileMap[pileKey] or {}\r\n        local runes = {}\r\n        -- Build rune list in proper order, remove invalid GUIDs\r\n        local validGUIDs = {}\r\n        for _, guid in ipairs(orderedGUIDs) do\r\n            local rune = runeDict[guid]\r\n            if rune then\r\n                table.insert(runes, rune)\r\n                table.insert(validGUIDs, guid)  -- still valid\r\n            end\r\n        end\r\n        pileMap[pileKey] = validGUIDs  -- cleanup dead refs\r\n\r\n        -- ensure tappedRune goes last\r\n        if tappedRune then\r\n            for i, r in ipairs(runes) do\r\n                if r == tappedRune then\r\n                    table.remove(runes, i)\r\n                    table.insert(runes, r)\r\n                    break\r\n                end\r\n            end\r\n        end\r\n\r\n        updateRuneRecycleButtons(player_color, runes)\r\n\r\n        local baseX = zonePos.x + posOffset.x * rotationMultiplier\r\n        local baseZ = zonePos.z + posOffset.z * rotationMultiplier\r\n\r\n        local n = #runes\r\n        local center = (n + 1) / 2\r\n        local pileIsTapped = (pileKey:match(\"_tapped\") ~= nil)\r\n\r\n        for i, rune in ipairs(runes) do\r\n            local idxOffset = (i - center)\r\n\r\n            local finalPos = {\r\n                x = baseX + idxOffset * fanStepX,\r\n                y = baseY + i * heightStep,\r\n                z = baseZ + idxOffset * fanStepZ\r\n            }\r\n\r\n            rune.setPositionSmooth(finalPos, false, true)\r\n\r\n            local yaw = zoneRot.y + (pileIsTapped and 270 or 180)\r\n\r\n            rune.setRotation(Vector(zoneRot.x, yaw, zoneRot.z))\r\n        end\r\n    end\r\n\r\n    inscriptRuneCounts(player_color)\r\n\r\n  end\r\nend\r\n\r\nfunction inscriptRuneCounts(player_color)\r\n    local runeCounts = {}\r\n    local runesByPile = playerRunesByPile[player_color] or {}\r\n\r\n    -- compute total runes across all piles\r\n    local totalRunes = 0\r\n    for _, pile in pairs(runesByPile) do\r\n        for _ in pairs(pile) do\r\n            totalRunes = totalRunes + 1\r\n        end\r\n    end\r\n\r\n    for _, pileKey in ipairs(RUNE_PILE_ORDER) do\r\n        local colorIdx  = tonumber(pileKey:match(\"color(%d+)\"))\r\n        local colorName = getPlayerRuneColors(player_color)[colorIdx]\r\n        local palette   = RUNE_COUNT_COLORS[colorName]\r\n\r\n        local count = 0\r\n        if runesByPile[pileKey] then\r\n            for _ in pairs(runesByPile[pileKey]) do\r\n                count = count + 1\r\n            end\r\n        end\r\n\r\n        table.insert(runeCounts, {\r\n            count         = ((count > 0)and(totalRunes > 4)) and count or \" \",  -- ← blank instead of 0\r\n            text_color    = palette and palette.text or \"#FFFFFF\",\r\n            outline_color = palette and palette.outline or \"#FFFFFF\",\r\n        })\r\n    end\r\n\r\n    local playmat = getPlaymat(player_color)\r\n    playmat.call(\"InscriptRuneCountsRemote\", {\r\n        runeCounts = runeCounts,\r\n    })\r\nend\r\n\r\n-- Helper: Normalize rune color\r\nfunction normalizeRuneColor(color_identity)\r\n    if not color_identity then return \"unknown\" end\r\n    return color_identity:lower():match(\"^%s*([^,%s]+)\") or \"unknown\"\r\nend\r\n\r\nruneColorOrder = {}\r\n\r\nrunePileOrder = {}\r\n\r\nrunePileCounts = {}\r\nplayerRunesByPile = {}\r\n\r\nfunction getPlayerRuneColors(player_color)\r\n    if not runeColorOrder[player_color] then\r\n        runeColorOrder[player_color] = {}\r\n    end\r\n    return runeColorOrder[player_color]\r\nend\r\n\r\nfunction resetPlayerRuneManagement(player_color)\r\n    runeColorOrder[player_color] = {}\r\n    runePileOrder[player_color] = {}\r\n    runePileCounts[player_color] = {}\r\n    playerRunesByPile[player_color] = {}\r\n    inscriptRuneCounts(player_color)\r\nend\r\n\r\nfunction getColorIndex(player_color, color)\r\n    local playerColors = getPlayerRuneColors(player_color)\r\n    for i, c in ipairs(playerColors) do\r\n        if c == color then return i end\r\n    end\r\n    -- Auto-assign\r\n    table.insert(playerColors, color)\r\n    return #playerColors\r\nend\r\n\r\nlocal function getDeckTypeFromTopCard(deck)\r\n    local objects = deck.getObjects()\r\n    if not objects or #objects == 0 then\r\n        return \"main\"\r\n    end\r\n\r\n    -- Top card = last entry\r\n    local topCard = objects[1]\r\n    local data = parseGMNotes(topCard.gm_notes)\r\n\r\n    if data and data.type == \"rune\" then\r\n        return \"rune\"\r\n    end\r\n\r\n    return \"main\"\r\nend\r\n\r\nfunction handleBottomDeckRemote(packet)\r\n  handleBottomDeck(packet[1], packet[2])\r\nend\r\n\r\nfunction isFaceDown(obj)\r\n  local rot = obj.getRotation()\r\n  local isFaceDown = rot.z > 90 and rot.z < 270\r\n  return isFaceDown\r\nend\r\n\r\nfunction handleBottomDeck(droppedObject, player_color)\r\n    repositionAllRunesInZone(player_color)\r\n    local deck_name = \"main\"\r\n\r\n    if droppedObject.tag == \"Deck\" then\r\n        deck_name = getDeckTypeFromTopCard(droppedObject)\r\n        for _, card in ipairs(droppedObject.getObjects()) do\r\n          local data = parseGMNotes(card.gm_notes)\r\n          if data then\r\n            ReplayLog.log(\"CARD_RECYCLE\", player_color,\r\n              { guid = card.guid, card_id = data.slug },\r\n              \"public\")\r\n\r\n            if data.type == \"rune\" then\r\n              deck_name = \"rune\"\r\n            end\r\n          end\r\n        end\r\n    else\r\n        local data = parseGMNotes(droppedObject.getGMNotes())\r\n        if data then\r\n          ReplayLog.log(\"CARD_RECYCLE\", player_color,\r\n            { guid = droppedObject.guid,\r\n              card_id = data.slug},\r\n            \"public\")\r\n          if data.type == \"rune\" then\r\n            deck_name = \"rune\"\r\n          end\r\n        end\r\n    end\r\n    local deck = findPlayerDeckByName(player_color, deck_name)\r\n    local recycled_position = nil\r\n    if deck then\r\n        recycled_position = deck.getPosition()\r\n    else\r\n        recycled_position = findPlayerZoneLocationByName(player_color, deck_name)\r\n        broadcastToColor(\"Cannot find your \".. deck_name ..\" deck - starting a new one!\", player_color, {.8,.8,.8})\r\n    end\r\n\r\n\r\n\r\n    local targetRotation = nil\r\n    if deck then\r\n        targetRotation = deck.getRotation()\r\n    else\r\n        targetRotation = getPlaymat(player_color).getRotation()\r\n        targetRotation.z = 180\r\n    end\r\n\r\n    local liftedPos = Vector(recycled_position.x, 4, recycled_position.z)\r\n    local lowerPos = Vector(recycled_position.x, 3, recycled_position.z)\r\n\r\n    if deck then\r\n      -- Step 1: Lock and Lift the deck\r\n      deck.setLock(true)\r\n      --deck.interactable=false\r\n      deck.setPositionSmooth(liftedPos, false, true)\r\n    end\r\n\r\n    local nm = droppedObject.getName()\r\n\r\n    Wait.time(function()\r\n        if droppedObject and droppedObject.tag == \"Deck\" then\r\n          droppedObject.randomize()\r\n        end\r\n        droppedObject.setRotationSmooth(targetRotation, false, true)\r\n        droppedObject.setPositionSmooth(Vector(recycled_position.x, 2, recycled_position.z), false, true)\r\n\r\n        Wait.condition(function()\r\n            Wait.time(function()\r\n              if deck then\r\n                  -- Step 3: Move deck back down\r\n                  deck.setLock(false)\r\n                  deck.setPositionSmooth(recycled_position, true, true)\r\n\r\n                  -- Step 4: After short delay, unlock the deck\r\n                  Wait.condition(function()\r\n                      Wait.condition(function()\r\n                          local newDeck = findPlayerDeckByName(player_color, \"main\")\r\n                          if newDeck then\n                              local name = newDeck.getName()\n                              if not name:lower():find(\"main\") then\n                                  newDeck.setName(name .. \"main\")\n                              end\n                              cacheDeckGuid(player_color, \"main\", newDeck)\n                          end\n                      end, function () return not(droppedObject and deck)end)\n                  end, function () return not deck.isSmoothMoving() end)\n              end\r\n            end, 0.5)\r\n        end, function () return not (droppedObject and droppedObject.isSmoothMoving()) end)\r\n    end, 0.1)\r\nend\r\n\r\n\r\n\r\nlocal recycleXmlUI = [[\r\n<Panel\r\n    id=\"recycleRunePanel\"\r\n    position=\"100 -150 -100\"\r\n    width=\"120\"\r\n    height=\"120\"\r\n    scale=\"0.45 0.45 0.45\"\r\n    rotation=\"180 180 0\"\r\n>\r\n    <!-- Visible recycle icon -->\r\n    <Image\r\n        image=\"]] .. \"https://steamusercontent-a.akamaihd.net/ugc/15915881332567971029/2E5286DB61D68505EB444F1574CE9B84A4EF7370/\" .. [[\"\r\n        preserveAspect=\"true\"\r\n        color=\"white\"\r\n    />\r\n</Panel>\r\n]]\r\n\r\nlocal RUNE_COLORS = {\r\n  [\"Fury Rune\"]  = {1.00, 0.42, 0.42}, -- soft crimson\r\n  [\"Mind Rune\"]  = {0.42, 0.56, 0.89}, -- muted sapphire\r\n  [\"Calm Rune\"]  = {0.44, 0.81, 0.61}, -- gentle jade\r\n  [\"Body Rune\"]  = {0.89, 0.64, 0.42}, -- warm amber\r\n  [\"Order Rune\"] = {0.89, 0.82, 0.42}, -- pale gold\r\n  [\"Chaos Rune\"] = {0.71, 0.54, 0.90}, -- soft violet\r\n}\r\n\r\nfunction onRecycleRuneClicked(clicked_rune, player_color, alt_click)\r\n  if alt_click or not clicked_rune then return end\r\n  broadcastToAll(player_color .. \" recycled \".. clicked_rune.getName(), RUNE_COLORS[clicked_rune.getName()])\r\n  handleBottomDeck(clicked_rune, player_color)\r\n\r\n  -- Rebuild piles AFTER the move settles\r\n  Wait.time(function()\r\n      repositionAllRunesInZone(player_color)\r\n  end, 0.3)\r\nend\r\n\r\nfunction updateRuneRecycleButtons(player_color, runesInOrder)\r\n    -- Clear buttons on all runes in this pile\r\n    for _, rune in ipairs(runesInOrder) do\r\n        rune.clearButtons()\r\n        rune.UI.setXml(\"\")\r\n    end\r\n\r\n    -- Add button only to top rune\r\n    local topRune = runesInOrder[#runesInOrder]\r\n    if not topRune then return end\r\n\r\n    topRune.createButton({\r\n        label          = \"R\",\r\n        click_function = \"onRecycleRuneClicked\",\r\n        function_owner = self,\r\n        position       = {-1, 0.3, -1.45},\r\n        rotation       = {0, 0, 0},\r\n        width          = 500,\r\n        height         = 500,\r\n        font_size      = 400,\r\n        color          = {0.15, 0.15, 0.15, 0.01},\r\n        font_color     = {1, 1, 1, 1},\r\n        tooltip        = \"Recycle rune\",\r\n    })\r\n    topRune.UI.setXml(recycleXmlUI)\r\nend\r\n\r\nfunction linkToDeckBottom(obj, player_color, alt)\n    local cards = {}\n    local decks = {}\n    local seen = {}\n\n    local function addRecycleCandidate(candidate)\n        if not candidate or candidate.isDestroyed() then return end\n        if not candidate.getGUID then return end\n\n        local guid = candidate.getGUID()\n        if not guid or seen[guid] then return end\n\n        if candidate.tag == \"Card\" then\n            candidate.use_gravity = true\n            table.insert(cards, candidate)\n            seen[guid] = true\n        elseif candidate.tag == \"Deck\" then\n            candidate.use_gravity = true\n            table.insert(decks, candidate)\n            seen[guid] = true\n        end\n    end\n\n    -- Collect cards directly\n    for guid, _ in pairs(revealCards) do\n        addRecycleCandidate(getObjectFromGUID(guid))\n    end\n\n    -- Also include anything currently in the peek zone (hand 2 / glimpse zone).\n    local glimpseGuid = playerglimpsezones[player_color]\n    if glimpseGuid then\n        local glimpseZone = getObjectFromGUID(glimpseGuid)\n        if glimpseZone and glimpseZone.getObjects then\n            local zoneObjects = glimpseZone.getObjects() or {}\n            for _, zoneObject in ipairs(zoneObjects) do\n                addRecycleCandidate(zoneObject)\n            end\n        end\n    end\n\n    if #cards == 0 and #decks == 0 then\n        broadcastToColor(\n            \"Drop cards here to send them to the bottom of your main deck!\",\n            player_color,\n            {255,0,0}\r\n        )\r\n        return\r\n    end\r\n\r\n    -- Clear reveal tracking immediately\r\n    revealCards = {}\r\n    revealZoneArrivedCards = {}\r\n\r\n    -- Group them like pressing G (works for 1 or many)\r\n    local grouped = {}\n    if #cards > 0 then\n      grouped = group(cards)\n    end\n\n    local handledGroupedDeck = false\n    for _, revealCleanupObject in ipairs(decks) do\n      handledGroupedDeck = true\n      revealCleanupObject.use_gravity = false\n      Wait.frames(function()\n          revealCleanupObject.use_gravity = true\n          handleBottomDeck(revealCleanupObject, player_color)\n      end, 100)\n    end\n\n    for _, revealCleanupObject in ipairs(grouped) do\n      handledGroupedDeck = true\n      revealCleanupObject.use_gravity = false\n      Wait.frames(function()\r\n          revealCleanupObject.use_gravity = true\r\n          handleBottomDeck(revealCleanupObject, player_color)\r\n      end, 100)\r\n    end\r\n    if not handledGroupedDeck then\n      -- Failed to group Reveal cards, cards are put to bottom individually\n      for _, card in ipairs(cards) do\n          handleBottomDeck(card, player_color)\n      end\n    end\r\nend\r\n\r\nlocal function split_on_slash(name)\r\n  local left, right = name:match(\"^(.-)%s*/%s*(.+)$\")\r\n  return left and trimSpaces(left) or trimSpaces(name), right and trimSpaces(right) or nil\r\nend\r\n\r\nfunction selectPlaymat(player, value, id)\r\n  local playmatURLs = {\r\n          [\"Black L2P\"] = \"https://steamusercontent-a.akamaihd.net/ugc/13464931927252746682/1E8607BBAFC08DB6A3EE58ED47C98C091FF093B8/\",\r\n          [\"Annie\"] = \"https://steamusercontent-a.akamaihd.net/ugc/10667298690503202213/9E6516EF30D0735C454C278877616084FAD4CB23/\",\r\n          [\"Garen\"] = \"https://steamusercontent-a.akamaihd.net/ugc/17173828141960066498/536566AA8E9405C569D4CBFF5B35F13869F6C1AF/\",\r\n          [\"Kaisa\"] = \"https://steamusercontent-a.akamaihd.net/ugc/13197435846164283101/0AF0BF8A71C21CD9F564ADE2027B3A86801FBAE5/\",\r\n          [\"Lux\"] = \"https://steamusercontent-a.akamaihd.net/ugc/16121468295904191785/E0F5255EA50697EFD827AECA8F2F9F4EF869D60E/\",\r\n          [\"Sivir\"] = \"https://steamusercontent-a.akamaihd.net/ugc/12471663842005817322/551AC1D92C2B343EE14DC01C61F8BE0F60311208/\",\r\n          [\"Teemo\"] = \"https://steamusercontent-a.akamaihd.net/ugc/12746141895995053426/8ACB99C527D8DD1A642481EBF342C8DC4A6B3D11/\",\r\n          [\"Miss Fortune\"] = \"https://steamusercontent-a.akamaihd.net/ugc/10614267249531241702/BF16E5184B15729037804E17B49F29C1F18BB784/\",\r\n          [\"Azir\"] = \"https://steamusercontent-a.akamaihd.net/ugc/13891395535637251510/C389C24EFF45051A9A018CFC7A7AF5896BA57D9D/\",\r\n          [\"Viktor\"] = \"https://steamusercontent-a.akamaihd.net/ugc/13241164620197739608/5D41D005EEE0BB645B41164AFF33E45513AF2927/\",\r\n          [\"KDAAhri\"] = \"https://steamusercontent-a.akamaihd.net/ugc/16423960532685119503/86D083C183E85DA15A94D1C724051B28AD502EA6/\",\r\n\r\n      }\r\n\r\n      local name = tostring(id)\r\n      local url = playmatURLs[name]\r\n      if url then\r\n          UI.setAttribute(\"playmat_input\", \"text\", url)\r\n          setPlaymatImage(player, url)\r\n      else\r\n          broadcastToAll(\"Unknown playmat: \" .. name, {1,0,0})\r\n      end\r\n  end\r\n\r\nlocal function setObjectCardScale(obj, scale)\r\n  if not obj or obj.isDestroyed() then return end\r\n  if obj.tag ~= \"Card\" and obj.tag ~= \"Deck\" then return end\r\n\r\n  local s = obj.getScale()\r\n  obj.setScale({ scale, s.y, scale })\r\nend\r\n\r\nlocal function rescaleCardsInDeckPositionsForPlayer(player)\r\n  local scale = card_scale_by_player[player.steam_id]\r\n  if not scale then return end\r\n\r\n  for deckName, _ in pairs(deck_position) do\r\n    local obj = findPlayerDeckByName(player.color, deckName)\r\n    if obj then\r\n      setObjectCardScale(obj, scale)\r\n    end\r\n  end\r\nend\r\n\r\nlocal function getAllBattlefieldZonesForPlayer(color)\r\n  local zones = {}\r\n\r\n  local function add(zoneTable)\r\n    if zoneTable and zoneTable[color] then\r\n      local z = getObjectFromGUID(zoneTable[color])\r\n      if z then table.insert(zones, z) end\r\n    end\r\n  end\r\n\r\n  add(playerbattlefield1v1zonesWest)\r\n  add(playerbattlefield1v1zonesEast)\r\n  add(playerbattlefieldFFAZonesWest)\r\n  add(playerbattlefieldFFAZonesEast)\r\n  add(playerbattlefieldFFAZonesCenter)\r\n  add(playerhandzones)\r\n  add(playerglimpsezones)\r\n\r\n  return zones\r\nend\r\n\r\nlocal function rescaleCardsInLooseZonesForPlayer(player)\r\n  local scale = card_scale_by_player[player.steam_id]\r\n  if not scale then return end\r\n\r\n  local minBound, maxBound = getPlaymatBounds(player.color)\r\n  local battlefieldZones = getAllBattlefieldZonesForPlayer(player.color)\r\n\r\n  for _, obj in ipairs(getAllObjects()) do\r\n    if obj.tag == \"Card\" or obj.tag == \"Deck\" then\r\n      local pos = obj.getPosition()\r\n\r\n      -- On playmat\r\n      if isPointInBounds(pos, minBound, maxBound) then\r\n        setObjectCardScale(obj, scale)\r\n      end\r\n\r\n      -- In battlefield zones\r\n      for _, zone in ipairs(battlefieldZones) do\r\n        if objectIsInZone(obj, zone) then\r\n          setObjectCardScale(obj, scale)\r\n          break\r\n        end\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nfunction toggleMiniCards(player, value, index)\r\n  if value and card_scale_by_player[player.steam_id] ~= mini_card_scale then\r\n    card_scale_by_player[player.steam_id] = mini_card_scale\r\n  else\r\n    card_scale_by_player[player.steam_id] = regular_card_scale\r\n  end\r\n  rescaleCardsInDeckPositionsForPlayer(player)\r\n  rescaleCardsInLooseZonesForPlayer(player)\r\nend\r\n\r\nlastSleeveType = 0\r\n\r\nfunction selectSleeve(player, value, id)\r\n  local sleeveURLs = {\r\n          [\"Ahri\"] = \"https://steamusercontent-a.akamaihd.net/ugc/11767779140149303569/269D15ACCCA2272CEAC5F6B96724EC876F89648B/\",\r\n          [\"Annie\"] = \"https://steamusercontent-a.akamaihd.net/ugc/17345936801799494998/E0F9A50D72B0D618FA842BEC7A08B2B8092444F4/\",\r\n          [\"Garen\"] = \"https://steamusercontent-a.akamaihd.net/ugc/15624552861989742606/C9966874A98A2819028948E19EC160E8B8F190A8/\",\r\n          [\"Jinx\"] = \"https://steamusercontent-a.akamaihd.net/ugc/12869347630212120992/A9C1611641BC46698D95A0B8D6B70224C93CF0A7/\",\r\n          [\"Kaisa\"] = \"https://steamusercontent-a.akamaihd.net/ugc/10455744582926772132/783694DF2E0D1550527A631F60AA0754E936DAD1/\",\r\n          [\"Katarina\"] = \"https://steamusercontent-a.akamaihd.net/ugc/9311580774364883617/11CF72C87B021B734B25EBFD0659864B37F8881E/\",\r\n          [\"Lux\"] = \"https://steamusercontent-a.akamaihd.net/ugc/14554312028412297825/F59DB9AB592EECC411764C62C1208BAEFB51C243/\",\r\n          [\"MissFortune\"] = \"https://steamusercontent-a.akamaihd.net/ugc/11582177796210393312/03D6F449E5A7F3EF509089D2A3A081C8C5B31E8D/\",\r\n          [\"Sivir\"] = \"https://steamusercontent-a.akamaihd.net/ugc/17593964027477610815/724D9D2317B46B1A9B2B0ACFCEC62D8251CCE105/\",\r\n          [\"Teemo\"] = \"https://steamusercontent-a.akamaihd.net/ugc/10308471603864957900/BDEEAE55B7F2B0B97ED384DE9AC022B2AD0D9947/\",\r\n          [\"Volibear\"] = \"https://steamusercontent-a.akamaihd.net/ugc/10492787311417741355/ECD591C72014289E5F3B88B626927C8197C85D85/\",\r\n          [\"Yone\"] = \"https://steamusercontent-a.akamaihd.net/ugc/12807229855579378891/F991911B0DC632F94D3A7937B0FCBC54977EF584/\",\r\n      }\r\n\r\n      local name = tostring(id)\r\n      local url = sleeveURLs[name]\r\n      if url then\r\n          if lastSleeveType == 0 then\r\n              UI.setAttribute(\"sleeve_input\", \"text\", url)\r\n              setMainDeckSleeve(player, url)\r\n              lastSleeveType = 1\r\n          elseif lastSleeveType == 1 then\r\n              UI.setAttribute(\"rune_deck_sleeve_input\", \"text\", url)\r\n              setRuneDeckSleeve(player, url)\r\n              lastSleeveType = 2\r\n          else\r\n              UI.setAttribute(\"battlefield_deck_sleeve_input\", \"text\", url)\r\n              setBattlefieldDeckSleeve(player, url)\r\n              lastSleeveType = 0\r\n          end\r\n          lastSleeveInputWasMain = not lastSleeveInputWasMain\r\n      else\r\n          broadcastToAll(\"Unknown sleeve: \" .. name, {1,0,0})\r\n      end\r\n  end\r\n\r\n  -- ---------- helpers ----------\r\n  local function urlencode(s)\r\n    return (tostring(s):gsub(\"\\n\", \"\\r\\n\"):gsub(\"([^%w _%-%.~])\", function(c)\r\n      return string.format(\"%%%02X\", string.byte(c))\r\n    end):gsub(\" \", \"%%20\"))\r\n  end\r\n\r\n  local function clean(s)\r\n    s = (s or \"\"):lower()\r\n    s = s:gsub(\"[%p]\", \" \"):gsub(\"%s+\", \" \"):gsub(\"^%s+\", \"\"):gsub(\"%s+$\", \"\")\r\n    return s\r\n  end\r\n\r\n  -- rank:\r\n  -- 1 = exact match\r\n  -- 2 = exact word match (earlier word wins)\r\n  -- 3 = word startswith (earlier word wins)\r\n  -- 4 = contains (earlier position wins)\r\n  -- else = 100\r\n\r\n  local function rankName(name, q)\r\n      local n = clean(name)\r\n      local qn = clean(q)\r\n\r\n      if n == qn then\r\n          return 1\r\n      end\r\n\r\n      local qlen = #qn\r\n\r\n      -- Scan words with positions\r\n      local wordIndex = 0\r\n      for startPos, word in n:gmatch(\"()(%S+)\") do\r\n          wordIndex = wordIndex + 1\r\n\r\n          if word == qn then\r\n              -- Rank 2, bias earlier words\r\n              return 2 + wordIndex * 0.001\r\n          end\r\n\r\n          if word:sub(1, qlen) == qn then\r\n              -- Rank 3, bias earlier words\r\n              return 3 + wordIndex * 0.001\r\n          end\r\n      end\r\n\r\n      -- Contains fallback (plain find, earliest position wins)\r\n      local pos = n:find(qn, 1, true)\r\n      if pos then\r\n          return 4 + pos * 0.001\r\n      end\r\n\r\n      return 100\r\n  end\r\n\r\n-- reduced tools slug from TITLE (left side of '/', slugified)\r\nlocal function reducedSlugFromTitle(name)\r\n  name = name or \"\"\r\n  -- take only the left side before a slash (if any)\r\n  local left = name:match(\"^(.-)%s*/%s*.+$\") or name\r\n  left = left:lower()\r\n\r\n  -- handle possessives like \"revenant’s\" / \"revenant's\" → \"revenants\"\r\n  left = left:gsub(\"['’]s\", \"s\")\r\n\r\n  -- drop leftover apostrophes/backticks (straight or curly)\r\n  left = left:gsub(\"[‘’´`']\", \"\")\r\n\r\n  -- spaces → hyphen\r\n  left = left:gsub(\"%s+\", \"-\")\r\n\r\n  -- turn any remaining non-alnum, non-hyphen chars into hyphen\r\n  left = left:gsub(\"[^%w%-]+\", \"-\")\r\n\r\n  -- collapse multiple hyphens and trim edges\r\n  left = left:gsub(\"%-+\", \"-\"):gsub(\"^%-+\", \"\"):gsub(\"%-+$\", \"\")\r\n\r\n  return left\r\nend\r\n\r\nlocal function spawnFromToolsSlug(slug, player)\r\n    cardData = getCardData(slug)\r\n    text = JSON.encode(cardData)\r\n    local blob = '{\"cards\":{\"spawn\":[' .. text .. ']}}'\r\n    local ok, json = pcall(JSON.decode, blob)\r\n    local locationOverride = player.GetPointerPosition()\r\n    local rotationOverride = {0, player.GetPointerRotation(), 0}\r\n    locationOverride.y = locationOverride.y+1\r\n    if ok and json then\r\n      deck = Global.call(\"spawnDeckRemote\", { json = json, player = player, locationOverride = locationOverride, rotationOverride = rotationOverride })\r\n      return deck\r\n    end\r\nend\r\n\r\n\r\n\r\n\r\nfunction RipBoosterPack(params)\r\n  local collationlib = Cyberpunk_CollationLibrary or Global.getVar(\"Cyberpunk_CollationLibrary\")\r\n  local ok, pack_contents = pcall(collationlib.call, \"GeneratePack\", params.setcode)\r\n  if not ok or not pack_contents then return end\r\n\r\n  local spawn_list = {}\r\n\r\n  for _, card_id in ipairs(pack_contents) do\r\n    table.insert(spawn_list, getCardData(card_id))\r\n  end\r\n\r\n  local blob = {\r\n    cards = {\r\n      spawn = spawn_list\r\n    }\r\n  }\r\n\r\n  local player = Player[params.player_color]\r\n  local locationOverride = player.GetPointerPosition()\r\n  local rotationOverride = {180, 180+player.GetPointerRotation(), 0}\r\n  locationOverride.y = locationOverride.y + 1\r\n\r\n  Global.call(\"spawnDeckRemote\", {\r\n    json = blob,\r\n    player = player,\r\n    locationOverride = locationOverride,\r\n    rotationOverride = rotationOverride\r\n  })\r\n  params.object.destroy()\r\nend\r\n\r\n\r\n-- cache of { {slug=..., name=...}, ... }\r\nCyberpunk_NameIndex = Cyberpunk_NameIndex or nil\r\n\r\nlocal function buildCyberpunkNameIndex()\r\n    local lib = Cyberpunk_CardLibrary or Global.getVar(\"Cyberpunk_CardLibrary\")\r\n    if not lib then\r\n        print(\"ERROR: Cyberpunk_CardLibrary not set on Global\")\r\n        return false\r\n    end\r\n\r\n    local ok, cardMap = pcall(lib.call, \"getMap\")\r\n    if not ok or not cardMap then\r\n        print(\"ERROR: getMap() failed on Cyberpunk_CardLibrary\")\r\n        return false\r\n    end\r\n\r\n    local index = {}\r\n    for slug, data in pairs(cardMap) do\r\n        table.insert(index, {\r\n            slug = slug,\r\n            name = (data and data.name) or \"\"\r\n        })\r\n    end\r\n\r\n    Cyberpunk_NameIndex = index\r\n    print(\"Cyberpunk name index built with \" .. tostring(#index) .. \" entries.\")\r\n    return true\r\nend\r\n\r\nfunction spawnFromNameFragmentRemote(payload)\r\n  return spawnFromNameFragment(payload.nameFragment, payload.player_color)\r\nend\r\n\r\nfunction spawnFromNameFragment(nameFragment, player_color)\r\n  cardFromSlug = getCardData(nameFragment, true)\r\n  if cardFromSlug then\r\n    Player[player_color].broadcast(\"Spawning: \" .. cardFromSlug.name .. \" [\" .. nameFragment .. \"]\", {0.6,1,0.6})\r\n    return spawnFromToolsSlug(nameFragment, Player[player_color])\r\n  end\r\n  if not Cyberpunk_NameIndex then\r\n      if not buildCyberpunkNameIndex() then\r\n          Player[player_color].broadcast(\"Spawn not ready (library error).\", {1,0.3,0.3})\r\n          return false\r\n      end\r\n  end\r\n\r\n  local initialEntry = {name=\"NA\"}\r\n  local bestEntry = initialEntry\r\n  local bestRank = rankName(initialEntry.name, nameFragment)\r\n\r\n\r\n  for _, entry in ipairs(Cyberpunk_NameIndex) do\r\n      local name = entry.name or \"\"\r\n      if name ~= \"\" then\r\n          local r = rankName(name, nameFragment)\r\n          if not bestRank or r < bestRank or (r == bestRank and string.len(name) < string.len(bestEntry.name)) then\r\n              bestRank = r\r\n              bestEntry = entry\r\n          end\r\n      end\r\n  end\r\n\r\n  if bestEntry == initialEntry then\r\n      Player[player_color].broadcast(\"No results for: \" .. nameFragment, {1,0.9,0})\r\n      return false\r\n  end\r\n\r\n  local slug = bestEntry.slug\r\n  local name = bestEntry.name or slug\r\n\r\n  Player[player_color].broadcast(\"Spawning: \" .. name .. \" [\" .. slug .. \"]\", {0.6,1,0.6})\r\n  local spawned_object = spawnFromToolsSlug(slug, Player[player_color])\r\n  if spawned_object then\r\n    ReplayLog.log(\"CARD_SPAWNED\", player_color,\r\n      { guid = spawned_object.guid,\r\n        card_id = slug },\r\n      \"public\")\r\n    local menu_provider = Cyberpunk_CardMenu or Global.getVar(\"Cyberpunk_CardMenu\")\r\n    Wait.condition(\r\n      function () menu_provider.call(\"init_card\", spawned_object) end,\r\n      function() return not spawned_object.spawning end\r\n    )\r\n  end\r\n  return spawned_object\r\nend\r\n\r\nfunction tutorFromDeckByNameFragment(nameFragment, player)\r\n    local deck = findPlayerDeckByName(player.color, \"main\")\r\n    if not deck or deck.tag ~= \"Deck\" then\r\n        player.broadcast(\"No main deck found.\", {1,0.4,0.4})\r\n        return false\r\n    end\r\n\r\n    local objects = deck.getObjects()\r\n    if not objects or #objects == 0 then\r\n        player.broadcast(\"Your deck is empty.\", {1,0.4,0.4})\r\n        return false\r\n    end\r\n\r\n    local bestIdx = nil\r\n    local bestRank = nil\r\n    local bestName = nil\r\n\r\n    for i, entry in ipairs(objects) do\r\n        local name = entry.nickname or entry.name or \"\"\r\n        if name ~= \"\" then\r\n            local r = rankName(name, nameFragment)\r\n            if not bestRank or r < bestRank or (r == bestRank and #name < #bestName) then\r\n                bestRank = r\r\n                bestIdx = i\r\n                bestName = name\r\n            end\r\n        end\r\n    end\r\n\r\n    if not bestIdx then\r\n        player.broadcast(\"No match in deck for: \" .. nameFragment, {1,0.9,0})\r\n        return false\r\n    end\r\n\r\n    local rotationTarget = player.GetPointerRotation()\r\n\r\n    -- Pull the card (visibly from deck)\r\n    local taken = deck.takeObject({\r\n        index    = bestIdx - 1, -- TTS uses 0-based indexing\r\n        position = deck.getPosition() + Vector(0, 2.0, 0), -- lift from deck first\r\n        rotation = {180, rotationTarget+180, 0},\r\n        smooth   = true,\r\n    })\r\n\r\n    if not taken then\r\n        player.broadcast(\"Failed to tutor card.\", {1,0.3,0.3})\r\n        return false\r\n    end\r\n\r\n    -- Immediately hide information\r\n    --taken.setRotation({0, 180, 0}) -- face-down\r\n    taken.setVelocity({0,0,0})\r\n    taken.setAngularVelocity({0,0,0})\r\n\r\n    -- Move to cursor after a short moment (keeps visual continuity)\r\n    Wait.frames(function()\r\n        if not taken then return end\r\n        taken.setPositionSmooth(player.getPointerPosition() + Vector(0, 1.5, 0))\r\n    end, 5)\r\n\r\n    -- Private confirmation\r\n    player.broadcast(\r\n        \"Tutored a card to your cursor.\",\r\n        {0.6, 1, 0.6}\r\n    )\r\n\r\n    -- Public anonymized broadcast\r\n    for _, p in pairs(Player.getPlayers()) do\r\n        if p.color ~= player.color then\r\n            p.broadcast(\r\n                player.steam_name .. \" tutored a card.\",\r\n                {0.8, 0.8, 0.8}\r\n            )\r\n        end\r\n    end\r\n\r\n    return taken\r\nend\r\n\r\nfunction onChat(message, player)\r\n    local m = (message or \"\"):lower()\r\n\r\n    if m:sub(1,6) == \"spawn \" then\r\n        local query = message:sub(7):match(\"^%s*(.-)%s*$\")\r\n        if query ~= \"\" and getPlaymat(player.color) then\r\n            spawnFromNameFragment(query, player.color)\r\n        end\r\n        return false\r\n    end\r\n\r\n    if m:sub(1,6) == \"tutor \" then\r\n        local query = message:sub(7):match(\"^%s*(.-)%s*$\")\r\n        if query == \"\" then\r\n            player.broadcast(\"Usage: tutor <card name>\", {1,0.9,0})\r\n            return false\r\n        end\r\n        tutorFromDeckByNameFragment(query, player)\r\n        return false\r\n    end\r\nend\r\n\r\nfunction onPlayerChangeColor(player_color)\r\n    Wait.time(function()\r\n        resetCamera(player_color)\r\n    end, 0.5) -- Delay allows default camera animation to complete\r\nend\r\n\r\nhotkey_table =\r\n{\r\n  [1] = banishOneMemoryCard,\r\n  [2] = reserveAndReorganizeMemory,\r\n  [3] = wakeUpEverythingOnPlaymat,\r\n  [4] = revealRandomMemoryCard,\r\n  [5] = glimpseQuickAction,\r\n  [9] = resetCamera,\r\n  [10] = recollectMemory,\r\n}\r\n\r\n\r\nfunction onScriptingButtonUp(index, player_color)\r\n    local player = Player[player_color]\r\n    functionToDo = hotkey_table[index]\r\n    if(functionToDo) then\r\n        functionToDo(player, index, index)\r\n    end\r\nend\n",
  "LuaScriptState": "{\"cd\":{\"move\":false,\"scale\":false},\"tid\":[]}",
  "XmlUI": "<!--\r\nXml UI. See documentation:\r\nhttps://api.tabletopsimulator.com/ui/introUI/\r\n-->\r\n\r\n<Panel visibility=\"Red|Blue|Green|Purple|White\">\r\n  <HorizontalLayout\r\n    id=\"menu_layout\"\r\n    childAlignment=\"MiddleRight\"\r\n    childForceExpandWidth=\"false\"\r\n    rectAlignment=\"LowerRight\"\r\n    height=\"40\"\r\n    padding=\"0 80 0 10\"\r\n    visibility=\"Black|Red|Blue|Green|Purple|Brown\"\r\n  >\r\n     <Button\r\n        colors=\"#FF9F2F|#FFB45A|#E0871F|#1A2433\"\r\n        fontStyle=\"Bold\"\r\n        minHeight=\"33\"\r\n        minWidth=\"70\"\r\n        onClick=\"toggleImportLayout\"\r\n      >Import Deck</Button>\r\n      <Button\r\n        colors=\"#00FFFF|#88FFFF|#008888|#DDFFFF\"\r\n        fontStyle=\"Bold\"\r\n        minHeight=\"33\"\r\n        minWidth=\"85\"\r\n        onClick=\"toggleMiniCards\"\r\n      >Toggle Mini cards</Button>\r\n      <Button\r\n        colors=\"#00FFFF|#88FFFF|#008888|#DDFFFF\"\r\n        fontStyle=\"Bold\"\r\n        minHeight=\"33\"\r\n        minWidth=\"70\"\r\n        onClick=\"togglePlayerCount\"\r\n      >Toggle 2P / 4P</Button>\r\n\r\n  </HorizontalLayout>\r\n  <HorizontalLayout\r\n    id=\"tablehelp_layout\"\r\n    childAlignment=\"MiddleRight\"\r\n    childForceExpandWidth=\"false\"\r\n    rectAlignment=\"LowerRight\"\r\n    height=\"40\"\r\n    padding=\"0 80 0 10\"\r\n    visibility=\"White\"\r\n  >\r\n    <Button\r\n      colors=\"#FF9F2F|#FFB45A|#E0871F|#1A2433\"\r\n      fontStyle=\"Bold\"\r\n      minHeight=\"33\"\r\n      minWidth=\"70\"\r\n      onClick=\"showSitDownHelp\"\r\n    >Import Deck</Button>\r\n    <Button\r\n      colors=\"#00FFFF|#88FFFF|#008888|#DDFFFF\"\r\n      fontStyle=\"Bold\"\r\n      minHeight=\"33\"\r\n      minWidth=\"85\"\r\n      onClick=\"showSitDownHelp\"\r\n    >Toggle Mini cards</Button>\r\n    <Button\r\n      colors=\"#00FFFF|#88FFFF|#008888|#DDFFFF\"\r\n      fontStyle=\"Bold\"\r\n      minHeight=\"33\"\r\n      minWidth=\"70\"\r\n      onClick=\"togglePlayerCount\"\r\n    >Toggle 2P / 4P</Button>\r\n\r\n  </HorizontalLayout>\r\n\r\n  <VerticalLayout\r\n    id=\"options_layout\"\r\n    childAlignment=\"LowerRight\"\r\n    childForceExpandHeight=\"false\"\r\n    childForceExpandWidth=\"false\"\r\n    rectAlignment=\"LowerRight\"\r\n    width=\"170\"\r\n    padding=\"0 80 0 10\"\r\n    visibility=\"Black\"\r\n  >\r\n    <Button\r\n      colors=\"#FF0000|#FF8888|#880000|#FFDDDD\"\r\n      fontStyle=\"Bold\"\r\n      preferredHeight=\"33\"\r\n      minWidth=\"33\"\r\n      onClick=\"toggleOptionsLayout\"\r\n    >✖</Button>\r\n    <Button\r\n      colors=\"#00FF00|#88FF88|#008800|#DDFFDD\"\r\n      fontStyle=\"Bold\"\r\n      preferredHeight=\"40\"\r\n      minWidth=\"170\"\r\n      onClick=\"toggleAnalytics\"\r\n    >Toggle Analytics</Button>\r\n    <Button\r\n      colors=\"#00FF00|#88FF88|#008800|#DDFFDD\"\r\n      fontStyle=\"Bold\"\r\n      preferredHeight=\"40\"\r\n      minWidth=\"170\"\r\n      onClick=\"toggleBigMat\"\r\n    >Toggle Big Mat</Button>\r\n\r\n  </VerticalLayout>\r\n\r\n  <HorizontalLayout\r\n    id=\"helpers_layout\"\r\n    visibility=\"Black\"\r\n    childAlignment=\"LowerRight\"\r\n    childForceExpandWidth=\"false\"\r\n    rectAlignment=\"LowerRight\"\r\n    width=\"340\"\r\n    padding=\"0 80 0 0\"\r\n  >\r\n    <VerticalLayout\r\n      id=\"quick_quick_actions_help\"\r\n      childAlignment=\"LowerRight\"\r\n      childForceExpandHeight=\"false\"\r\n      rectAlignment=\"LowerRight\"\r\n      width=\"33\"\r\n      padding=\"0 0 0 10\"\r\n      visibility=\"Black\"\r\n    >\r\n      <Button colors=\"#CCAA66|#EEDD99|#997744|#FFEEBB\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"veryCool\">Hotkeys can be remapped in options</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"recollectMemory\">Numpad 0 - Recollect⬇��⬇⬇</Button>\r\n      <Button colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"reserveAndReorganizeMemory\">Numpad 2 - Reserve</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"wakeUpEverythingOnPlaymat\">Numpad 3 - Wake Up</Button>\r\n      <Button colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"banishOneMemoryCard\">Numpad 1 - Banish 1 Card</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"glimpseQuickAction\">Numpad 5 - Glimpse 1 Card⬇⬇⬇</Button>\r\n      <Button colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"revealRandomMemoryCard\">Numpad 4 - Reveal 1 Card⬇⬇⬇</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"resetCamera\">Numpad 9 - Reset Cam</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"resetToGameStart\">GG Go Next - Reset to Game Start</Button>\n    </VerticalLayout>\r\n\r\n    <VerticalLayout\r\n      id=\"quick_action_buttons_layout\"\r\n      childAlignment=\"LowerRight\"\r\n      childForceExpandHeight=\"false\"\r\n      childForceExpandWidth=\"false\"\r\n      rectAlignment=\"LowerRight\"\r\n      preferredWidth=\"90\"\r\n      padding=\"0 0 0 10\"\r\n    >\r\n      <HorizontalLayout id=\"helpers_options_layout\" childAlignment=\"LowerRight\" childForceExpandHeight=\"false\" childForceExpandWidth=\"false\" rectAlignment=\"LowerRight\" minWidth=\"90\" height=\"33\">\r\n        <Button colors=\"#CCAA66|#EEDD99|#997744|#FFEEBB\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"45\" onClick=\"toggleQuickHelp\">?</Button>\r\n        <Button colors=\"#DD6666|#FF9999|#AA4444|#FFBBBB\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"45\" onClick=\"toggleHelpersLayout\">✖</Button>\r\n      </HorizontalLayout>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"recollectMemory\">Recollect</Button>\r\n      <Button colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"reserveAndReorganizeMemory\">Reserve</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"wakeUpEverythingOnPlaymat\">Wake Up</Button>\r\n      <Button colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"banishOneMemoryCard\">Banish 1</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"glimpseQuickAction\">Glimpse 1</Button>\r\n      <Button colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"revealRandomMemoryCard\">Reveal 1</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"resetCamera\">Reset Cam⬇⬇⬇</Button>\r\n      <Button colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\" fontStyle=\"Bold\" preferredHeight=\"33\" minWidth=\"90\" onClick=\"resetToGameStart\">GG Go Next</Button>\n    </VerticalLayout>\r\n  </HorizontalLayout>\r\n\r\n  <VerticalLayout\r\n    id=\"import_layout\"\r\n    padding=\"0 80 0 40\"\r\n    visibility=\"Black\"\r\n    height=\"30\"\r\n    maxHeight=\"30\"\r\n    minHeight=\"30\"\r\n    rectAlignment=\"LowerRight\"\r\n    childForceExpandHeight=\"false\"\r\n  >\r\n    <HorizontalLayout\r\n      id=\"import_upper_layout\"\r\n      childAlignment=\"LowerRight\"\r\n      childForceExpandWidth=\"false\"\r\n      rectAlignment=\"LowerRight\"\r\n        padding=\"0 0 0 46\"\r\n      maxHeight=\"30\"\r\n      minHeight=\"30\"\r\n    >\r\n      <InputField\r\n        id=\"decklist_input\"\r\n        minWidth=\"350\"\r\n        preferredWidth=\"350\"\r\n        resizeTextForBestFit=\"false\"\r\n        onEndEdit=\"setDecklist\"\r\n        maxHeight=\"30\"\r\n        minHeight=\"30\"\r\n        placeholder=\"Deck Code (RiftMana, Piltover Archive, etc)\"\r\n      />\r\n    </HorizontalLayout>\r\n\r\n    <HorizontalLayout\r\n      id=\"import_basic_layout\"\r\n      childAlignment=\"LowerRight\"\r\n      childForceExpandWidth=\"false\"\r\n      padding=\"0 0 0 40\"\r\n      rectAlignment=\"LowerRight\"\r\n      maxHeight=\"30\"\r\n      minHeight=\"30\"\r\n    >\r\n\r\n      <Button\r\n        id=\"import_deck\"\r\n        colors=\"#FF9F2F|#FFB45A|#E0871F|#1A2433\"\r\n        fontStyle=\"Bold\"\r\n        minHeight=\"33\"\r\n        minWidth=\"158\"\r\n        onClick=\"importCyberpunkDeck\"\r\n      >Import Deck</Button>\r\n      <Button\r\n        colors=\"#00FFFF|#88FFFF|#008888|#DDFFFF\"\r\n        minHeight=\"33\"\r\n        minWidth=\"158\"\r\n        fontStyle=\"Bold\"\r\n        onClick=\"toggleMoreLayout\"\r\n      >Sleeves ☰</Button>\r\n      <Button\r\n        colors=\"#FF9F2F|#FFB45A|#E0871F|#1A2433\"\r\n        minHeight=\"33\"\r\n        minWidth=\"33\"\r\n        onClick=\"toggleImportLayout\"\r\n      >✖</Button>\r\n    </HorizontalLayout>\r\n  </VerticalLayout>\r\n\r\n</Panel>\r\n\r\n<Panel\r\n  id=\"fullscreen_import_container\"\r\n  anchorMin=\"0 0\"\r\n  anchorMax=\"1 1\"\r\n  offsetX=\"0\"\r\n  offsetY=\"0\"\r\n  width=\"0\"\r\n  height=\"0\"\r\n  visibility=\"Pink\"\r\n>\r\n  <Panel\r\n    id=\"import_sleeve_layout\"\r\n    rectAlignment=\"LowerRight\"\r\n    anchorMin=\"1 0\"\r\n    anchorMax=\"1 0\"\r\n    offsetX=\"-200\"\r\n    offsetY=\"200\"\r\n    width=\"1000\"\r\n    height=\"800\"\r\n    visibility=\"Black\"\r\n  >\r\n    <VerticalLayout\r\n      padding=\"10 120 10 50\"\r\n      childAlignment=\"LowerRight\"\r\n      childForceExpandHeight=\"false\"\r\n      childForceExpandWidth=\"false\"\r\n    >\r\n      <Text padding = \"0 400 100 100\" offsetX=\"-200\" fontSize=\"32\" color=\"#FFFFFF\">Preset Playmats</Text>\r\n\r\n      <GridLayout\r\n        cellSize=\"100 30\"\r\n        spacing=\"5 5\"\r\n        padding=\"0 20 0 0\"\r\n        childAlignment=\"LowerRight\"\r\n        childForceExpandHeight=\"false\"\r\n        childForceExpandWidth=\"false\"\r\n      >\r\n            <Button id=\"Black L2P\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Black L2P')\">Black L2P</Button>\r\n            <Button id=\"Annie\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Annie')\">Annie</Button>\r\n            <Button id=\"Garen\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Garen')\">Garen</Button>\r\n            <Button id=\"Kaisa\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Kaisa')\">Kai'sa</Button>\r\n            <Button id=\"Lux\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Lux')\">Lux</Button>\r\n            <Button id=\"Sivir\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Sivir')\">Sivir</Button>\r\n            <Button id=\"Teemo\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Teemo')\">Teemo</Button>\r\n            <Button id=\"Miss Fortune\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Miss Fortune')\">Miss Fortune</Button>\r\n            <Button id=\"Azir\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Azir')\">Azir</Button>\r\n            <Button id=\"Viktor\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('Viktor')\">Viktor</Button>\r\n            <Button id=\"KDAAhri\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectPlaymat('KDAAhri')\">KDA Ahri</Button>\r\n\r\n      </GridLayout>\r\n\r\n      <Text padding = \"0 400 100 100\" offsetX=\"-200\" fontSize=\"32\" color=\"#FFFFFF\">Or Paste URL for Custom Playmat</Text>\r\n      <InputField\r\n        id=\"playmat_input\"\r\n        minWidth=\"300\"\r\n        preferredWidth=\"300\"\r\n        onEndEdit=\"setPlaymatImage\"\r\n        placeholder=\"Playmat URL (Optional)\"\r\n        minHeight=\"33\"\r\n      />\r\n\r\n      <Text offsetX=\"-200\" fontSize=\"32\" color=\"#FFFFFF\"> </Text>\r\n      <Text offsetX=\"-200\" fontSize=\"32\" color=\"#FFFFFF\">Preset Sleeves</Text>\r\n      <GridLayout\r\n        cellSize=\"100 30\"\r\n        spacing=\"5 5\"\r\n        padding=\"0 20 0 0\"\r\n        childAlignment=\"LowerRight\"\r\n        childForceExpandHeight=\"false\"\r\n        childForceExpandWidth=\"false\"\r\n      >\r\n            <Button id=\"Ahri\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Ahri')\">Ahri</Button>\r\n            <Button id=\"Annie\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Annie')\">Annie</Button>\r\n            <Button id=\"Garen\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Garen')\">Garen</Button>\r\n            <Button id=\"Jinx\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Jinx')\">Jinx</Button>\r\n            <Button id=\"Kaisa\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Kaisa')\">Kai'sa</Button>\r\n            <Button id=\"Katarina\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Katarina')\">Katarina</Button>\r\n            <Button id=\"Lux\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Lux')\">Lux</Button>\r\n            <Button id=\"MissFortune\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('MissFortune')\">Miss Fortune</Button>\r\n            <Button id=\"Sivir\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Sivir')\">Sivir</Button>\r\n            <Button id=\"Teemo\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Teemo')\">Teemo</Button>\r\n            <Button id=\"Volibear\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Volibear')\">Volibear</Button>\r\n            <Button id=\"Yone\" colors=\"#FFD700|#FFEA70|#AA8800|#FFF5C0\" fontStyle=\"Bold\" onClick=\"selectSleeve('Yone')\">Yone</Button>\r\n      </GridLayout>\r\n      <Text padding = \"0 400 100 100\" offsetX=\"-200\" fontSize=\"32\" color=\"#FFFFFF\">Or Paste URL for Custom Sleeves</Text>\r\n      <HorizontalLayout\r\n        childAlignment=\"MiddleRight\"\r\n        childForceExpandHeight=\"false\"\r\n        childForceExpandWidth=\"false\"\r\n        rectAlignment=\"LowerRight\"\r\n        padding=\"5 5 5 5\"\r\n      >\r\n        <InputField\r\n          id=\"battlefield_deck_sleeve_input\"\r\n          minWidth=\"300\"\r\n          preferredWidth=\"300\"\r\n          onEndEdit=\"setBattlefieldDeckSleeve\"\r\n          placeholder=\"Legend/Battlefield Deck Sleeve URL (Optional)\"\r\n          minHeight=\"33\"\r\n        />\r\n        <InputField\r\n          id=\"rune_deck_sleeve_input\"\r\n          minWidth=\"300\"\r\n          preferredWidth=\"300\"\r\n          onEndEdit=\"setRuneDeckSleeve\"\r\n          placeholder=\"Rune Deck Sleeve URL (Optional)\"\r\n          minHeight=\"33\"\r\n        />\r\n        <InputField\r\n          id=\"sleeve_input\"\r\n          minWidth=\"250\"\r\n          preferredWidth=\"250\"\r\n          resizeTextForBestFit=\"false\"\r\n          onEndEdit=\"setMainDeckSleeve\"\r\n          placeholder=\"Main Deck Sleeve URL (Optional)\"\r\n          minHeight=\"33\"\r\n        />\r\n      </HorizontalLayout>\r\n      <Text offsetX=\"-200\" fontSize=\"32\" color=\"#FFFFFF\"> </Text>\r\n    </VerticalLayout>\r\n  </Panel>\r\n</Panel>\n",
  "CustomUIAssets": [
    {
      "Type": 0,
      "Name": "token1",
      "URL": "https://img.silvie.org/api-data/nne5o3cm9l.jpg"
    },
    {
      "Type": 0,
      "Name": "token2",
      "URL": "https://img.silvie.org/api-data/5w3jf01o25.jpg"
    },
    {
      "Type": 0,
      "Name": "token3",
      "URL": "https://img.silvie.org/api-data/9iitvxs9je.jpg"
    },
    {
      "Type": 0,
      "Name": "token4",
      "URL": "https://img.silvie.org/api-data/lahlir23ij.jpg"
    },
    {
      "Type": 0,
      "Name": "token5",
      "URL": "https://img.silvie.org/api-data/4etu184ozc.jpg"
    },
    {
      "Type": 0,
      "Name": "token6",
      "URL": "https://img.silvie.org/api-data/dxkwmp7pxt.jpg"
    },
    {
      "Type": 0,
      "Name": "token7",
      "URL": "https://img.silvie.org/api-data/wvyfjo9iit.jpg"
    },
    {
      "Type": 0,
      "Name": "token8",
      "URL": "https://img.silvie.org/api-data/i184h5lahl.jpg"
    },
    {
      "Type": 0,
      "Name": "token9",
      "URL": "https://img.silvie.org/api-data/rragp8m7o0.jpg"
    },
    {
      "Type": 0,
      "Name": "token10",
      "URL": "https://img.silvie.org/api-data/91zv75lahl.jpg"
    },
    {
      "Type": 0,
      "Name": "token11",
      "URL": "https://img.silvie.org/api-data/571itod02g.jpg"
    },
    {
      "Type": 0,
      "Name": "token12",
      "URL": "https://img.silvie.org/api-data/xko170miji.jpg"
    },
    {
      "Type": 0,
      "Name": "token13",
      "URL": "https://img.silvie.org/api-data/fc1arsagp8.jpg"
    },
    {
      "Type": 0,
      "Name": "token14",
      "URL": "https://img.silvie.org/api-data/5g9b5m7sqe.jpg"
    },
    {
      "Type": 0,
      "Name": "token15",
      "URL": "https://img.silvie.org/api-data/6kd7hocc33.jpg"
    },
    {
      "Type": 0,
      "Name": "token16",
      "URL": "https://img.silvie.org/api-data/ms0kxj0clc.jpg"
    },
    {
      "Type": 0,
      "Name": "token17",
      "URL": "https://img.silvie.org/api-data/uiqurzblrs.jpg"
    }
  ],
  "ObjectStates": [
    {
      "GUID": "35894d",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": 0.0,
        "posY": 0.9599957,
        "posZ": -15.0,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 7.5,
        "scaleY": 1.0,
        "scaleZ": 7.5
      },
      "Nickname": "Red Playmat Template",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": false,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/13464931927252746682/1E8607BBAFC08DB6A3EE58ED47C98C091FF093B8/",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 3,
          "Thickness": 0.1,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\n    Global.call(\"setMatSnapPoints\", self)\n    self.interactable = false\nend\n\r\ndeck_text = \"\"\r\n\r\nfunction setDecklistFromPlaymat(player, value, index)\r\n  deck_text = value\r\nend\r\n\r\nfunction closeImportViewPlaymat(player, value, index)\r\n  self.UI.setXml(\"\")\r\nend\r\n\r\nfunction importCyberpunkDeckFromPlaymat(player, value, index)\r\n  if deck_text==\"\" then\r\n    broadcastToColor(\"Paste a Deck Code, TTS code, or Riftmana/Piltover URL to import.\", player.color, {.9,.6,.3})\r\n  else\r\n    Global.call(\"importCyberpunkDeckFromPlaymatRemote\", {player=player, playmat=self, deck_text=deck_text})\r\n  end\r\nend\r\n\nfunction InscriptRuneCountsRemote(params)\n  InscriptRuneCounts(params.runeCounts)\nend\n\r\nfunction ImportFinished()\r\n  self.UI.setXml(\"\")\r\nend\r\n\r\nfunction InscriptRuneCounts(runeCounts)\n  if #runeCounts>0 then\n    updateRuneCountsUI(runeCounts)\n  else\n    self.UI.setXml(\"\") -- clear UI\n  end\nend\r\n\nfunction updateRuneCountsUI(runeCounts)\n    runeCounts = runeCounts or {}\n\n    local PANEL_WIDTH      = 3200\n    local PANEL_HEIGHT     = 400\n    local PANEL_SCALE      = 0.1\n    local TITLE_FONT_SIZE  = 120\n    local OUTLINE_SIZE     = 2\n    local DEFAULT_TEXT_COLOR = \"#FFFFFF\"\n    local DEFAULT_OUTLINE_COLOR = \"rgba(0,0,0,1)\"\n\n    local function makeTextEntry(entry)\n        entry = entry or {}\n        return {\n            tag = \"Text\",\n            attributes = {\n                text        = entry.count or \"\",\n                fontSize    = TITLE_FONT_SIZE,\n                color       = entry.text_color or DEFAULT_TEXT_COLOR,\n                alignment   = \"LowerCenter\",\n                wrap        = true,\n                outline     = entry.outline_color or DEFAULT_OUTLINE_COLOR,\n                outlineSize = OUTLINE_SIZE,\n            }\n        }\n    end\n\n    local children = {}\n    for i = 1, 4 do\n        table.insert(children, makeTextEntry(runeCounts[i]))\n    end\n\n    local panel = {\n        tag = \"Panel\",\n        attributes = {\n            anchor   = \"LowerMiddle\",\n            position = \"0 80 -25\",\n            rotation = \"0 0 180\",\n            width    = PANEL_WIDTH,\n            height   = PANEL_HEIGHT,\n            scale    = PANEL_SCALE,\n        },\n        children = {\n            {\n                tag = \"HorizontalLayout\",\n                attributes = {\n                    childForceExpandHeight = false,\n                    childAlignment         = \"LowerCenter\",\n                },\n                children = children\n            }\n        }\n    }\n\n    self.UI.setXmlTable({ panel })\nend",
      "LuaScriptState": "",
      "XmlUI": "<Panel\n  id=\"decklist_root\"\n  width=\"380\"\n  height=\"110\"\n  position=\"0 0 -15\"\n  rotation=\"0 0 180\"\n  color=\"#1A2433EE\"\n  cornerRadius=\"14\"\n  padding=\"6 6 6 6\"\n>\n  <!-- Outer accent border -->\n  <Panel\n    width=\"100%\"\n    height=\"100%\"\n    color=\"#FFDF2F44\"\n    cornerRadius=\"12\"\n    padding=\"1 1 1 1\"\n  >\n    <!-- Inner panel -->\n    <Panel\n      width=\"100%\"\n      height=\"100%\"\n      color=\"#222E42FF\"\n      cornerRadius=\"10\"\n      padding=\"8 8 8 8\"\n    >\n      <HorizontalLayout\n        width=\"100%\"\n        height=\"100%\"\n        spacing=\"10\"\n        childAlignment=\"MiddleCenter\"\n      >\n        <!-- LEFT IMAGE -->\n        <Image\n          id=\"import_icon\"\n          image=\"https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/\"\n          preserveAspect=\"true\"\n          preferredWidth=\"64\"\n          preferredHeight=\"64\"\n          color=\"#FFFFFFFF\"\n        />\n\n        <!-- RIGHT CONTENT -->\n        <VerticalLayout\n          width=\"100%\"\n          height=\"100%\"\n          spacing=\"8\"\n          childAlignment=\"MiddleCenter\"\n        >\n          <InputField\n            id=\"decklist_input\"\n            preferredWidth=\"260\"\n            minWidth=\"260\"\n            minHeight=\"32\"\n            maxHeight=\"32\"\n            onEndEdit=\"setDecklistFromPlaymat\"\n            placeholder=\"Deck Code, TTS Code, or URL\"\n            cornerRadius=\"8\"\n          />\n\n          <HorizontalLayout><Button\n            id=\"import_deck\"\n            colors=\"#FF9F2F|#FFB45A|#E0871F|#1A2433\"\n            fontStyle=\"Bold\"\n            fontSize=\"18\"\n            minHeight=\"34\"\n            minWidth=\"230\"\n            cornerRadius=\"10\"\n            onClick=\"importCyberpunkDeckFromPlaymat\"\n          >\n            Import Deck\n          </Button>\n          <Button\n            id=\"import_deck\"\n            colors=\"#CC4F2F|#FFB45A|#E0871F|#1A2433\"\n            fontStyle=\"Bold\"\n            fontSize=\"18\"\n            minHeight=\"34\"\n            minWidth=\"40\"\n            maxWidth=\"34\"\n            cornerRadius=\"10\"\n            onClick=\"closeImportViewPlaymat\"\n          >X</Button>\n        </HorizontalLayout>\n\n          <HorizontalLayout childAlignment=\"MiddleCenter\" padding=\"20 0 0 0 \">\n            <Toggle\n              id=\"mini_cards_toggle\"\n              onValueChanged=\"Global/toggleMiniCards\"\n              textColor=\"#9999AAFF\"\n              fontSize=\"12\"\n            >Mini cards</Toggle>\n          </HorizontalLayout>\n\n        </VerticalLayout>\n      </HorizontalLayout>\n    </Panel>\n  </Panel>\n</Panel>",
      "CustomUIAssets": [
        {
          "Type": 0,
          "Name": "endturn-normal",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863277395/A092BCFD880CA3757527F36E0386C44006118822/"
        },
        {
          "Type": 0,
          "Name": "endturn-pressed",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863164430/55334AC15533963C78C4BEDCEB4D343CC96E42DC/"
        },
        {
          "Type": 0,
          "Name": "endturn-hover",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863163751/B00FDA5887FE62BD6EF5055293C47F20AAB65929/"
        }
      ],
      "AttachedSnapPoints": [
        {
          "Position": {
            "x": 1.62,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.21,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.21,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.21,
            "y": 0.5,
            "z": 0.46
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.21,
            "y": 0.5,
            "z": 0.46
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.9,
            "y": 0.1,
            "z": 1.22
          },
          "Rotation": {
            "x": 0.0,
            "y": 270.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.9,
            "y": 0.1,
            "z": 1.22
          },
          "Rotation": {
            "x": 0.0,
            "y": 270.0,
            "z": 0.0
          }
        }
      ]
    },
    {
      "GUID": "f0607e",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": 0.0,
        "posY": 0.9599999,
        "posZ": 15.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 7.5,
        "scaleY": 1.0,
        "scaleZ": 7.5
      },
      "Nickname": "Blue Playmat Template",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/13464931927252746682/1E8607BBAFC08DB6A3EE58ED47C98C091FF093B8/",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 3,
          "Thickness": 0.1,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\n    Global.call(\"setMatSnapPoints\", self)\n    self.interactable = false\nend\n\ndeck_text = \"\"\n\nfunction setDecklistFromPlaymat(player, value, index)\n  deck_text = value\nend\n\nfunction closeImportViewPlaymat(player, value, index)\n  self.UI.setXml(\"\")\nend\n\nfunction importCyberpunkDeckFromPlaymat(player, value, index)\n  if deck_text==\"\" then\n    broadcastToColor(\"Paste a Deck Code, TTS code, or Riftmana/Piltover URL to import.\", player.color, {.9,.6,.3})\n  else\n    Global.call(\"importCyberpunkDeckFromPlaymatRemote\", {player=player, playmat=self, deck_text=deck_text})\n  end\nend\n\nfunction InscriptRuneCountsRemote(params)\n  InscriptRuneCounts(params.runeCounts)\nend\n\nfunction ImportFinished()\n  self.UI.setXml(\"\")\nend\n\nfunction InscriptRuneCounts(runeCounts)\n  if #runeCounts>0 then\n    updateRuneCountsUI(runeCounts)\n  else\n    self.UI.setXml(\"\") -- clear UI\n  end\nend\n\nfunction updateRuneCountsUI(runeCounts)\n    runeCounts = runeCounts or {}\n\n    local PANEL_WIDTH      = 3200\n    local PANEL_HEIGHT     = 400\n    local PANEL_SCALE      = 0.1\n    local TITLE_FONT_SIZE  = 120\n    local OUTLINE_SIZE     = 2\n    local DEFAULT_TEXT_COLOR = \"#FFFFFF\"\n    local DEFAULT_OUTLINE_COLOR = \"rgba(0,0,0,1)\"\n\n    local function makeTextEntry(entry)\n        entry = entry or {}\n        return {\n            tag = \"Text\",\n            attributes = {\n                text        = entry.count or \"\",\n                fontSize    = TITLE_FONT_SIZE,\n                color       = entry.text_color or DEFAULT_TEXT_COLOR,\n                alignment   = \"LowerCenter\",\n                wrap        = true,\n                outline     = entry.outline_color or DEFAULT_OUTLINE_COLOR,\n                outlineSize = OUTLINE_SIZE,\n            }\n        }\n    end\n\n    local children = {}\n    for i = 1, 4 do\n        table.insert(children, makeTextEntry(runeCounts[i]))\n    end\n\n    local panel = {\n        tag = \"Panel\",\n        attributes = {\n            anchor   = \"LowerMiddle\",\n            position = \"0 80 -25\",\n            rotation = \"0 0 180\",\n            width    = PANEL_WIDTH,\n            height   = PANEL_HEIGHT,\n            scale    = PANEL_SCALE,\n        },\n        children = {\n            {\n                tag = \"HorizontalLayout\",\n                attributes = {\n                    childForceExpandHeight = false,\n                    childAlignment         = \"LowerCenter\",\n                },\n                children = children\n            }\n        }\n    }\n\n    self.UI.setXmlTable({ panel })\nend",
      "LuaScriptState": "",
      "XmlUI": "<Panel\r\n  id=\"decklist_root\"\r\n  width=\"380\"\r\n  height=\"110\"\r\n  position=\"0 0 -15\"\r\n  rotation=\"0 0 180\"\r\n  color=\"#1A2433EE\"\r\n  cornerRadius=\"14\"\r\n  padding=\"6 6 6 6\"\r\n>\r\n  <!-- Outer accent border -->\r\n  <Panel\r\n    width=\"100%\"\r\n    height=\"100%\"\r\n    color=\"#FFDF2F44\"\r\n    cornerRadius=\"12\"\r\n    padding=\"1 1 1 1\"\r\n  >\r\n    <!-- Inner panel -->\r\n    <Panel\r\n      width=\"100%\"\r\n      height=\"100%\"\r\n      color=\"#222E42FF\"\r\n      cornerRadius=\"10\"\r\n      padding=\"8 8 8 8\"\r\n    >\r\n      <HorizontalLayout\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        spacing=\"10\"\r\n        childAlignment=\"MiddleCenter\"\r\n      >\r\n        <!-- LEFT IMAGE -->\r\n        <Image\r\n          id=\"import_icon\"\r\n          image=\"https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/\"\r\n          preserveAspect=\"true\"\r\n          preferredWidth=\"64\"\r\n          preferredHeight=\"64\"\r\n          color=\"#FFFFFFFF\"\r\n        />\r\n\r\n        <!-- RIGHT CONTENT -->\r\n        <VerticalLayout\r\n          width=\"100%\"\r\n          height=\"100%\"\r\n          spacing=\"8\"\r\n          childAlignment=\"MiddleCenter\"\r\n        >\r\n          <InputField\r\n            id=\"decklist_input\"\r\n            preferredWidth=\"260\"\r\n            minWidth=\"260\"\r\n            minHeight=\"32\"\r\n            maxHeight=\"32\"\r\n            onEndEdit=\"setDecklistFromPlaymat\"\r\n            placeholder=\"Deck Code, TTS Code, or URL\"\r\n            cornerRadius=\"8\"\r\n          />\r\n\r\n          <HorizontalLayout><Button\r\n            id=\"import_deck\"\r\n            colors=\"#FF9F2F|#FFB45A|#E0871F|#1A2433\"\r\n            fontStyle=\"Bold\"\r\n            fontSize=\"18\"\r\n            minHeight=\"34\"\r\n            minWidth=\"230\"\r\n            cornerRadius=\"10\"\r\n            onClick=\"importCyberpunkDeckFromPlaymat\"\r\n          >\r\n            Import Deck\r\n          </Button>\r\n          <Button\r\n            id=\"import_deck\"\r\n            colors=\"#CC4F2F|#FFB45A|#E0871F|#1A2433\"\r\n            fontStyle=\"Bold\"\r\n            fontSize=\"18\"\r\n            minHeight=\"34\"\r\n            minWidth=\"40\"\r\n            maxWidth=\"34\"\r\n            cornerRadius=\"10\"\r\n            onClick=\"closeImportViewPlaymat\"\r\n          >X</Button>\r\n        </HorizontalLayout>\r\n\r\n          <HorizontalLayout childAlignment=\"MiddleCenter\" padding=\"20 0 0 0 \">\r\n            <Toggle\r\n              id=\"mini_cards_toggle\"\r\n              onValueChanged=\"Global/toggleMiniCards\"\r\n              textColor=\"#9999AAFF\"\r\n              fontSize=\"12\"\r\n            >Mini cards</Toggle>\r\n          </HorizontalLayout>\r\n\r\n        </VerticalLayout>\r\n      </HorizontalLayout>\r\n    </Panel>\r\n  </Panel>\r\n</Panel>",
      "CustomUIAssets": [
        {
          "Type": 0,
          "Name": "endturn-normal",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863277395/A092BCFD880CA3757527F36E0386C44006118822/"
        },
        {
          "Type": 0,
          "Name": "endturn-pressed",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863164430/55334AC15533963C78C4BEDCEB4D343CC96E42DC/"
        },
        {
          "Type": 0,
          "Name": "endturn-hover",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863163751/B00FDA5887FE62BD6EF5055293C47F20AAB65929/"
        }
      ],
      "AttachedSnapPoints": [
        {
          "Position": {
            "x": 1.62,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.21,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.21,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.21,
            "y": 0.5,
            "z": 0.46
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.21,
            "y": 0.5,
            "z": 0.46
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.9,
            "y": 0.1,
            "z": 1.22
          },
          "Rotation": {
            "x": 0.0,
            "y": 270.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.9,
            "y": 0.1,
            "z": 1.22
          },
          "Rotation": {
            "x": 0.0,
            "y": 270.0,
            "z": 0.0
          }
        }
      ]
    },
    {
      "GUID": "9e87d8",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 0.0,
        "posY": 3.0,
        "posZ": -27.5,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 30.0,
        "scaleY": 12.0,
        "scaleZ": 7.0
      },
      "Nickname": "Hand 1 (Red)",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.856,
        "g": 0.09999997,
        "b": 0.09399996,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Red",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "32941e",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 0.0,
        "posY": 3.0,
        "posZ": 27.5,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 30.0,
        "scaleY": 12.0,
        "scaleZ": 7.0
      },
      "Nickname": "Hand 1 (Blue)",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.117999978,
        "g": 0.53,
        "b": 1.0,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Blue",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "5ddb44",
      "Name": "Infinite_Bag",
      "Transform": {
        "posX": -2.0,
        "posY": 0.0,
        "posZ": 2.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Status Tokens",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.018586874,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MaterialIndex": -1,
      "MeshIndex": -1,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "ContainedObjects": [
        {
          "GUID": "7ec8c2",
          "Name": "Custom_Token",
          "Transform": {
            "posX": -12.0630636,
            "posY": 1.07000029,
            "posZ": 1.65103507,
            "rotX": 8.947516e-06,
            "rotY": 3.46845383e-07,
            "rotZ": -1.90864444e-06,
            "scaleX": 0.47075966,
            "scaleY": 1.0,
            "scaleZ": 0.47075966
          },
          "Nickname": "Float Token",
          "Description": "",
          "GMNotes": "",
          "AltLookAngle": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          },
          "ColorDiffuse": {
            "r": 1.0,
            "g": 1.0,
            "b": 1.0
          },
          "Tags": [
            "StatusToken"
          ],
          "LayoutGroupSortIndex": 0,
          "Value": 0,
          "Locked": false,
          "Grid": true,
          "Snap": true,
          "IgnoreFoW": false,
          "MeasureMovement": false,
          "DragSelectable": true,
          "Autoraise": true,
          "Sticky": true,
          "Tooltip": true,
          "GridProjection": false,
          "HideWhenFaceDown": false,
          "Hands": false,
          "CustomImage": {
            "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/12603962990235933102/35BFB67B408A229113E87E51AE32592273A2155A/",
            "ImageSecondaryURL": "",
            "ImageScalar": 1.0,
            "WidthScale": 0.0,
            "CustomToken": {
              "Thickness": 0.1,
              "MergeDistancePixels": 15.0,
              "StandUp": false,
              "Stackable": true
            }
          },
          "LuaScript": "status_token_modes = {\r\n    [\"Float\"] = \"https://steamusercontent-a.akamaihd.net/ugc/12603962990235933102/35BFB67B408A229113E87E51AE32592273A2155A/\",\r\n    [\"Mighty\"] = \"https://steamusercontent-a.akamaihd.net/ugc/9466263804734080223/7783378230D05122F13D909AD1BEC54A0193C710/\",\r\n    [\"Ganking\"] = \"https://steamusercontent-a.akamaihd.net/ugc/13595869276222322351/8126866066A0C1517EB949F4481123CE1E23541B/\",\r\n    [\"Hidden\"] = \"https://steamusercontent-a.akamaihd.net/ugc/9282182403135233141/3C9D66DD201D1B16857845C11832D93D0F864225/\",\r\n    [\"Deflect\"] = \"https://steamusercontent-a.akamaihd.net/ugc/17587493008513316502/A2D63AD34B755097D2C60E6AF25005169A52159B/\",\r\n    [\"Deathknell\"] = \"https://steamusercontent-a.akamaihd.net/ugc/10411708337604808672/84794C48D3251093EB5729CBB66A875FCD8EB2DE/\",\r\n    [\"Temporary\"] = \"https://steamusercontent-a.akamaihd.net/ugc/11014272529216860740/746F1721516E64A68D597767A35F66911CCFFC02/\",\r\n    [\"Tank\"] = \"https://steamusercontent-a.akamaihd.net/ugc/17488271310462753863/C5398C69A83CD877EE8EA719731710893F53453E/\",\r\n    [\"Assault\"] = \"https://steamusercontent-a.akamaihd.net/ugc/11986826304869004265/DC1FA302EB6E57CB7E61776E198C62E86B72D725/\",\r\n    [\"Assault 3\"] = \"https://steamusercontent-a.akamaihd.net/ugc/12919208068904869458/97B8862AAF53B9E194E24ACB7EBD4691D6559186/\",\r\n    [\"Shield\"] = \"https://steamusercontent-a.akamaihd.net/ugc/11491241060871351556/B653DDB03D9D0C5F1479A3CE56756392AFB951E0/\",\r\n    [\"Shield 3\"] = \"https://steamusercontent-a.akamaihd.net/ugc/10446144312172833824/B94544E4AE0179C8862493573ED09B0F7C8B9B70/\",\r\n}\r\n\r\nstatus_token_modes_by_number = {}\r\nstatus_token_numbers_by_mode = {}\r\nnum_token_types = 0\r\n\r\ncurrent_mode = \"Mighty\"\r\ncurrent_mode_number = 1\r\n\r\nfunction findKeyByValue(table, value)\r\n    for key, val in pairs(table) do\r\n        if val == value then\r\n            return key\r\n        end\r\n    end\r\n    return nil\r\nend\r\n\r\nfunction onLoad()\r\n    status_token_modes_by_number = {}\r\n    status_token_numbers_by_mode = {}\r\n    num_token_types = 0\r\n    for mode, _ in pairs(status_token_modes) do\r\n        self.addContextMenuItem(\"Switch to \" .. mode, function() setTokenImage(mode) end)\r\n        num_token_types = num_token_types + 1\r\n        status_token_modes_by_number[num_token_types] = mode\r\n        status_token_numbers_by_mode[mode] = num_token_types\r\n    end\r\n    self.addTag(\"StatusToken\")\r\nend\r\n\r\nfunction setTokenImage(mode)\r\n    local custom = self.getCustomObject()\r\n    custom.image = status_token_modes[mode]\r\n    self.setCustomObject(custom)\r\n    self.setName(mode .. \" Token\")\r\n    self.reload()\r\n    current_mode = mode\r\n    current_mode_number = status_token_numbers_by_mode[mode]\r\nend\r\n\r\nfunction onNumberTyped(player_color, number)\r\n  if (number==0) then\r\n      number = (current_mode_number % num_token_types)+1\r\n  end\r\n  setTokenImage(status_token_modes_by_number[number])\r\n  return true\r\nend\r\n\r\nfunction getCorrectRotation()\r\n  local sideOfTable = self.getPosition().z > 0\r\n  return sideOfTable and {0,0,0} or {0,180,0}\r\nend\r\n\r\nfunction onDrop(color)\r\n    self.setRotationSmooth(getCorrectRotation(), false, true)\r\nend\r\n\r\nfunction onRotate(spin, flip, player_color, old_spin, old_flip)\r\n  local tokenPos = self.getPosition()\r\n\r\n  local closest, bestDist = nil, 2.0  -- only within 1 unit\r\n  for _, obj in ipairs(getAllObjects()) do\r\n    if obj.tag == \"Card\" and not obj.hasTag(\"StatusToken\") then\r\n      local d = (obj.getPosition() - tokenPos):magnitude()\r\n      if d < bestDist then\r\n        closest, bestDist = obj, d\r\n      end\r\n    end\r\n  end\r\n\r\n  if closest then\r\n    local r = closest.getRotation()\r\n    local sideOfTable = self.getPosition().z > 0\r\n    if sideOfTable then\r\n      r.y = (r.y + spin) % 360\r\n    else\r\n      r.y = (r.y - spin) % 360\r\n    end\r\n    closest.setRotationSmooth(r, false, true)\r\n  end\r\n\r\n  Wait.time(function()\r\n    self.setRotationSmooth(getCorrectRotation(), false, true)\r\n  end, 0.1)\r\nend\r\n",
          "LuaScriptState": "",
          "XmlUI": ""
        }
      ]
    },
    {
      "GUID": "7fd7f6",
      "Name": "Infinite_Bag",
      "Transform": {
        "posX": 2.0,
        "posY": 0.0,
        "posZ": -2.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "D6",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 0.018586874,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MaterialIndex": -1,
      "MeshIndex": -1,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "ContainedObjects": [
        {
          "GUID": "365f0c",
          "Name": "Die_6_Rounded",
          "Transform": {
            "posX": -18.72342,
            "posY": 3.35814,
            "posZ": 5.744548,
            "rotX": 3.132744,
            "rotY": 0.140358061,
            "rotZ": 2.82054281,
            "scaleX": 1.5,
            "scaleY": 1.5,
            "scaleZ": 1.5
          },
          "Nickname": "",
          "Description": "",
          "GMNotes": "",
          "AltLookAngle": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          },
          "ColorDiffuse": {
            "r": 1.0,
            "g": 0.4235294,
            "b": 0.0
          },
          "LayoutGroupSortIndex": 0,
          "Value": 0,
          "Locked": false,
          "Grid": true,
          "Snap": true,
          "IgnoreFoW": false,
          "MeasureMovement": false,
          "DragSelectable": true,
          "Autoraise": true,
          "Sticky": true,
          "Tooltip": true,
          "GridProjection": false,
          "HideWhenFaceDown": false,
          "Hands": false,
          "MaterialIndex": 3,
          "LuaScript": "function onLoad()\n    for _, markerName in ipairs(Global.call(\"dice_types\")) do\n        self.addContextMenuItem(\"Set to \" .. markerName, function(playerColor)\n            setMarker(markerName)\n        end)\n    end\nend\n\nfunction setMarker(markerName)\n    local color =(Global.call(\"dice_colors\"))[markerName] or {r=1, g=1, b=1}\n    self.setColorTint(color)\n    self.setName(markerName .. \" Counter\")\nend\n",
          "LuaScriptState": "",
          "XmlUI": "",
          "RotationValues": [
            {
              "Value": "1",
              "Rotation": {
                "x": 0.0,
                "y": 0.0,
                "z": 0.0
              }
            },
            {
              "Value": "2",
              "Rotation": {
                "x": 90.0,
                "y": 0.0,
                "z": 0.0
              }
            },
            {
              "Value": "3",
              "Rotation": {
                "x": 0.0,
                "y": 0.0,
                "z": 90.0
              }
            },
            {
              "Value": "4",
              "Rotation": {
                "x": 0.0,
                "y": 0.0,
                "z": -90.0
              }
            },
            {
              "Value": "5",
              "Rotation": {
                "x": -90.0,
                "y": 0.0,
                "z": 0.0
              }
            },
            {
              "Value": "6",
              "Rotation": {
                "x": 0.0,
                "y": 0.0,
                "z": -180.0
              }
            }
          ]
        }
      ]
    },
    {
      "GUID": "2c30da",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 220.025574,
        "posY": 3.0,
        "posZ": 27.5,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 30.0,
        "scaleY": 12.0,
        "scaleZ": 7.0
      },
      "Nickname": "Hand 1 (Purple)",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.627,
        "g": 0.124999978,
        "b": 0.941,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Purple",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "c6b5a0",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 220.025574,
        "posY": 3.0,
        "posZ": -27.5,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 30.0,
        "scaleY": 12.0,
        "scaleZ": 7.0
      },
      "Nickname": "Hand 1 (Green)",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.191999972,
        "g": 0.701,
        "b": 0.167999953,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Green",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "53ddd0",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": 219.853317,
        "posY": 0.9600003,
        "posZ": -15.0,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 7.5,
        "scaleY": 1.0,
        "scaleZ": 7.5
      },
      "Nickname": "Green Playmat Template",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/13464931927252746682/1E8607BBAFC08DB6A3EE58ED47C98C091FF093B8/",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 3,
          "Thickness": 0.1,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\r\n    Global.call(\"setMatSnapPoints\", self)\r\n    self.interactable = false\r\nend\r\n\r\ndeck_text = \"\"\r\n\r\nfunction setDecklistFromPlaymat(player, value, index)\r\n  deck_text = value\r\nend\r\n\r\nfunction closeImportViewPlaymat(player, value, index)\r\n  self.UI.setXml(\"\")\r\nend\r\n\r\nfunction importCyberpunkDeckFromPlaymat(player, value, index)\r\n  if deck_text==\"\" then\r\n    broadcastToColor(\"Paste a Deck Code, TTS code, or Riftmana/Piltover URL to import.\", player.color, {.9,.6,.3})\r\n  else\r\n    Global.call(\"importCyberpunkDeckFromPlaymatRemote\", {player=player, playmat=self, deck_text=deck_text})\r\n  end\r\nend\r\n\r\nfunction InscriptRuneCountsRemote(params)\r\n  InscriptRuneCounts(params.runeCounts)\r\nend\r\n\r\nfunction ImportFinished()\r\n  self.UI.setXml(\"\")\r\nend\r\n\r\nfunction InscriptRuneCounts(runeCounts)\r\n  if #runeCounts>0 then\r\n    updateRuneCountsUI(runeCounts)\r\n  else\r\n    self.UI.setXml(\"\") -- clear UI\r\n  end\r\nend\r\n\r\nfunction updateRuneCountsUI(runeCounts)\r\n    runeCounts = runeCounts or {}\r\n\r\n    local PANEL_WIDTH      = 3200\r\n    local PANEL_HEIGHT     = 400\r\n    local PANEL_SCALE      = 0.1\r\n    local TITLE_FONT_SIZE  = 120\r\n    local OUTLINE_SIZE     = 2\r\n    local DEFAULT_TEXT_COLOR = \"#FFFFFF\"\r\n    local DEFAULT_OUTLINE_COLOR = \"rgba(0,0,0,1)\"\r\n\r\n    local function makeTextEntry(entry)\r\n        entry = entry or {}\r\n        return {\r\n            tag = \"Text\",\r\n            attributes = {\r\n                text        = entry.count or \"\",\r\n                fontSize    = TITLE_FONT_SIZE,\r\n                color       = entry.text_color or DEFAULT_TEXT_COLOR,\r\n                alignment   = \"LowerCenter\",\r\n                wrap        = true,\r\n                outline     = entry.outline_color or DEFAULT_OUTLINE_COLOR,\r\n                outlineSize = OUTLINE_SIZE,\r\n            }\r\n        }\r\n    end\r\n\r\n    local children = {}\r\n    for i = 1, 4 do\r\n        table.insert(children, makeTextEntry(runeCounts[i]))\r\n    end\r\n\r\n    local panel = {\r\n        tag = \"Panel\",\r\n        attributes = {\r\n            anchor   = \"LowerMiddle\",\r\n            position = \"0 80 -25\",\r\n            rotation = \"0 0 180\",\r\n            width    = PANEL_WIDTH,\r\n            height   = PANEL_HEIGHT,\r\n            scale    = PANEL_SCALE,\r\n        },\r\n        children = {\r\n            {\r\n                tag = \"HorizontalLayout\",\r\n                attributes = {\r\n                    childForceExpandHeight = false,\r\n                    childAlignment         = \"LowerCenter\",\r\n                },\r\n                children = children\r\n            }\r\n        }\r\n    }\r\n\r\n    self.UI.setXmlTable({ panel })\r\nend",
      "LuaScriptState": "",
      "XmlUI": "<Panel\n  id=\"decklist_root\"\n  width=\"380\"\n  height=\"110\"\n  position=\"0 0 -15\"\n  rotation=\"0 0 180\"\n  color=\"#1A2433EE\"\n  cornerRadius=\"14\"\n  padding=\"6 6 6 6\"\n>\n  <!-- Outer accent border -->\n  <Panel\n    width=\"100%\"\n    height=\"100%\"\n    color=\"#FFDF2F44\"\n    cornerRadius=\"12\"\n    padding=\"1 1 1 1\"\n  >\n    <!-- Inner panel -->\n    <Panel\n      width=\"100%\"\n      height=\"100%\"\n      color=\"#222E42FF\"\n      cornerRadius=\"10\"\n      padding=\"8 8 8 8\"\n    >\n      <HorizontalLayout\n        width=\"100%\"\n        height=\"100%\"\n        spacing=\"10\"\n        childAlignment=\"MiddleCenter\"\n      >\n        <!-- LEFT IMAGE -->\n        <Image\n          id=\"import_icon\"\n          image=\"https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/\"\n          preserveAspect=\"true\"\n          preferredWidth=\"64\"\n          preferredHeight=\"64\"\n          color=\"#FFFFFFFF\"\n        />\n\n        <!-- RIGHT CONTENT -->\n        <VerticalLayout\n          width=\"100%\"\n          height=\"100%\"\n          spacing=\"8\"\n          childAlignment=\"MiddleCenter\"\n        >\n          <InputField\n            id=\"decklist_input\"\n            preferredWidth=\"260\"\n            minWidth=\"260\"\n            minHeight=\"32\"\n            maxHeight=\"32\"\n            onEndEdit=\"setDecklistFromPlaymat\"\n            placeholder=\"Deck Code, TTS Code, or URL\"\n            cornerRadius=\"8\"\n          />\n\n          <HorizontalLayout><Button\n            id=\"import_deck\"\n            colors=\"#FF9F2F|#FFB45A|#E0871F|#1A2433\"\n            fontStyle=\"Bold\"\n            fontSize=\"18\"\n            minHeight=\"34\"\n            minWidth=\"230\"\n            cornerRadius=\"10\"\n            onClick=\"importCyberpunkDeckFromPlaymat\"\n          >\n            Import Deck\n          </Button>\n          <Button\n            id=\"import_deck\"\n            colors=\"#CC4F2F|#FFB45A|#E0871F|#1A2433\"\n            fontStyle=\"Bold\"\n            fontSize=\"18\"\n            minHeight=\"34\"\n            minWidth=\"40\"\n            maxWidth=\"34\"\n            cornerRadius=\"10\"\n            onClick=\"closeImportViewPlaymat\"\n          >X</Button>\n        </HorizontalLayout>\n\n          <HorizontalLayout childAlignment=\"MiddleCenter\" padding=\"20 0 0 0 \">\n            <Toggle\n              id=\"mini_cards_toggle\"\n              onValueChanged=\"Global/toggleMiniCards\"\n              textColor=\"#9999AAFF\"\n              fontSize=\"12\"\n            >Mini cards</Toggle>\n          </HorizontalLayout>\n\n        </VerticalLayout>\n      </HorizontalLayout>\n    </Panel>\n  </Panel>\n</Panel>",
      "CustomUIAssets": [
        {
          "Type": 0,
          "Name": "endturn-normal",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863277395/A092BCFD880CA3757527F36E0386C44006118822/"
        },
        {
          "Type": 0,
          "Name": "endturn-pressed",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863164430/55334AC15533963C78C4BEDCEB4D343CC96E42DC/"
        },
        {
          "Type": 0,
          "Name": "endturn-hover",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863163751/B00FDA5887FE62BD6EF5055293C47F20AAB65929/"
        }
      ],
      "AttachedSnapPoints": [
        {
          "Position": {
            "x": 1.62,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.21,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.21,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.21,
            "y": 0.5,
            "z": 0.46
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.21,
            "y": 0.5,
            "z": 0.46
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.9,
            "y": 0.1,
            "z": 1.22
          },
          "Rotation": {
            "x": 0.0,
            "y": 270.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.9,
            "y": 0.1,
            "z": 1.22
          },
          "Rotation": {
            "x": 0.0,
            "y": 270.0,
            "z": 0.0
          }
        }
      ]
    },
    {
      "GUID": "a251c2",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": 219.853317,
        "posY": 0.9599992,
        "posZ": 15.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 7.5,
        "scaleY": 1.0,
        "scaleZ": 7.5
      },
      "Nickname": "Purple Playmat Template",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/13464931927252746682/1E8607BBAFC08DB6A3EE58ED47C98C091FF093B8/",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 3,
          "Thickness": 0.1,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\n    Global.call(\"setMatSnapPoints\", self)\n    self.interactable = false\nend\n\ndeck_text = \"\"\n\nfunction setDecklistFromPlaymat(player, value, index)\n  deck_text = value\nend\n\nfunction closeImportViewPlaymat(player, value, index)\n  self.UI.setXml(\"\")\nend\n\nfunction importCyberpunkDeckFromPlaymat(player, value, index)\n  if deck_text==\"\" then\n    broadcastToColor(\"Paste a Deck Code, TTS code, or Riftmana/Piltover URL to import.\", player.color, {.9,.6,.3})\n  else\n    Global.call(\"importCyberpunkDeckFromPlaymatRemote\", {player=player, playmat=self, deck_text=deck_text})\n  end\nend\n\nfunction InscriptRuneCountsRemote(params)\n  InscriptRuneCounts(params.runeCounts)\nend\n\nfunction ImportFinished()\n  self.UI.setXml(\"\")\nend\n\nfunction InscriptRuneCounts(runeCounts)\n  if #runeCounts>0 then\n    updateRuneCountsUI(runeCounts)\n  else\n    self.UI.setXml(\"\") -- clear UI\n  end\nend\n\nfunction updateRuneCountsUI(runeCounts)\n    runeCounts = runeCounts or {}\n\n    local PANEL_WIDTH      = 3200\n    local PANEL_HEIGHT     = 400\n    local PANEL_SCALE      = 0.1\n    local TITLE_FONT_SIZE  = 120\n    local OUTLINE_SIZE     = 2\n    local DEFAULT_TEXT_COLOR = \"#FFFFFF\"\n    local DEFAULT_OUTLINE_COLOR = \"rgba(0,0,0,1)\"\n\n    local function makeTextEntry(entry)\n        entry = entry or {}\n        return {\n            tag = \"Text\",\n            attributes = {\n                text        = entry.count or \"\",\n                fontSize    = TITLE_FONT_SIZE,\n                color       = entry.text_color or DEFAULT_TEXT_COLOR,\n                alignment   = \"LowerCenter\",\n                wrap        = true,\n                outline     = entry.outline_color or DEFAULT_OUTLINE_COLOR,\n                outlineSize = OUTLINE_SIZE,\n            }\n        }\n    end\n\n    local children = {}\n    for i = 1, 4 do\n        table.insert(children, makeTextEntry(runeCounts[i]))\n    end\n\n    local panel = {\n        tag = \"Panel\",\n        attributes = {\n            anchor   = \"LowerMiddle\",\n            position = \"0 80 -25\",\n            rotation = \"0 0 180\",\n            width    = PANEL_WIDTH,\n            height   = PANEL_HEIGHT,\n            scale    = PANEL_SCALE,\n        },\n        children = {\n            {\n                tag = \"HorizontalLayout\",\n                attributes = {\n                    childForceExpandHeight = false,\n                    childAlignment         = \"LowerCenter\",\n                },\n                children = children\n            }\n        }\n    }\n\n    self.UI.setXmlTable({ panel })\nend",
      "LuaScriptState": "",
      "XmlUI": "<Panel\n  id=\"decklist_root\"\n  width=\"380\"\n  height=\"110\"\n  position=\"0 0 -15\"\n  rotation=\"0 0 180\"\n  color=\"#1A2433EE\"\n  cornerRadius=\"14\"\n  padding=\"6 6 6 6\"\n>\n  <!-- Outer accent border -->\n  <Panel\n    width=\"100%\"\n    height=\"100%\"\n    color=\"#FFDF2F44\"\n    cornerRadius=\"12\"\n    padding=\"1 1 1 1\"\n  >\n    <!-- Inner panel -->\n    <Panel\n      width=\"100%\"\n      height=\"100%\"\n      color=\"#222E42FF\"\n      cornerRadius=\"10\"\n      padding=\"8 8 8 8\"\n    >\n      <HorizontalLayout\n        width=\"100%\"\n        height=\"100%\"\n        spacing=\"10\"\n        childAlignment=\"MiddleCenter\"\n      >\n        <!-- LEFT IMAGE -->\n        <Image\n          id=\"import_icon\"\n          image=\"https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/\"\n          preserveAspect=\"true\"\n          preferredWidth=\"64\"\n          preferredHeight=\"64\"\n          color=\"#FFFFFFFF\"\n        />\n\n        <!-- RIGHT CONTENT -->\n        <VerticalLayout\n          width=\"100%\"\n          height=\"100%\"\n          spacing=\"8\"\n          childAlignment=\"MiddleCenter\"\n        >\n          <InputField\n            id=\"decklist_input\"\n            preferredWidth=\"260\"\n            minWidth=\"260\"\n            minHeight=\"32\"\n            maxHeight=\"32\"\n            onEndEdit=\"setDecklistFromPlaymat\"\n            placeholder=\"Deck Code, TTS Code, or URL\"\n            cornerRadius=\"8\"\n          />\n\n          <HorizontalLayout><Button\n            id=\"import_deck\"\n            colors=\"#FF9F2F|#FFB45A|#E0871F|#1A2433\"\n            fontStyle=\"Bold\"\n            fontSize=\"18\"\n            minHeight=\"34\"\n            minWidth=\"230\"\n            cornerRadius=\"10\"\n            onClick=\"importCyberpunkDeckFromPlaymat\"\n          >\n            Import Deck\n          </Button>\n          <Button\n            id=\"import_deck\"\n            colors=\"#CC4F2F|#FFB45A|#E0871F|#1A2433\"\n            fontStyle=\"Bold\"\n            fontSize=\"18\"\n            minHeight=\"34\"\n            minWidth=\"40\"\n            maxWidth=\"34\"\n            cornerRadius=\"10\"\n            onClick=\"closeImportViewPlaymat\"\n          >X</Button>\n        </HorizontalLayout>\n\n          <HorizontalLayout childAlignment=\"MiddleCenter\" padding=\"20 0 0 0 \">\n            <Toggle\n              id=\"mini_cards_toggle\"\n              onValueChanged=\"Global/toggleMiniCards\"\n              textColor=\"#9999AAFF\"\n              fontSize=\"12\"\n            >Mini cards</Toggle>\n          </HorizontalLayout>\n\n        </VerticalLayout>\n      </HorizontalLayout>\n    </Panel>\n  </Panel>\n</Panel>",
      "CustomUIAssets": [
        {
          "Type": 0,
          "Name": "endturn-normal",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863277395/A092BCFD880CA3757527F36E0386C44006118822/"
        },
        {
          "Type": 0,
          "Name": "endturn-pressed",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863164430/55334AC15533963C78C4BEDCEB4D343CC96E42DC/"
        },
        {
          "Type": 0,
          "Name": "endturn-hover",
          "URL": "https://steamusercontent-a.akamaihd.net/ugc/1591414472863163751/B00FDA5887FE62BD6EF5055293C47F20AAB65929/"
        }
      ],
      "AttachedSnapPoints": [
        {
          "Position": {
            "x": 1.62,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.21,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.21,
            "y": 0.5,
            "z": -0.48
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.21,
            "y": 0.5,
            "z": 0.46
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.21,
            "y": 0.5,
            "z": 0.46
          },
          "Rotation": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": -2.9,
            "y": 0.1,
            "z": 1.22
          },
          "Rotation": {
            "x": 0.0,
            "y": 270.0,
            "z": 0.0
          }
        },
        {
          "Position": {
            "x": 2.9,
            "y": 0.1,
            "z": 1.22
          },
          "Rotation": {
            "x": 0.0,
            "y": 270.0,
            "z": 0.0
          }
        }
      ]
    },
    {
      "GUID": "9231d7",
      "Name": "Infinite_Bag",
      "Transform": {
        "posX": 2.0,
        "posY": 0.0,
        "posZ": 2.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Booster Packs",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.7716449,
        "g": 0.301927149,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MaterialIndex": -1,
      "MeshIndex": -1,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "ContainedObjects": [
        {
          "GUID": "afd2a7",
          "Name": "Custom_Model",
          "Transform": {
            "posX": -33.5918427,
            "posY": 0.9600001,
            "posZ": -2.8666563,
            "rotX": -2.878286e-07,
            "rotY": 180.028534,
            "rotZ": -1.446971e-07,
            "scaleX": 2.29999781,
            "scaleY": 2.29999781,
            "scaleZ": 2.29999781
          },
          "Nickname": "Flip it to Rip it",
          "Description": "",
          "GMNotes": "",
          "AltLookAngle": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          },
          "ColorDiffuse": {
            "r": 1.0,
            "g": 1.0,
            "b": 1.0
          },
          "LayoutGroupSortIndex": 0,
          "Value": 0,
          "Locked": false,
          "Grid": true,
          "Snap": true,
          "IgnoreFoW": false,
          "MeasureMovement": false,
          "DragSelectable": true,
          "Autoraise": true,
          "Sticky": true,
          "Tooltip": true,
          "GridProjection": false,
          "HideWhenFaceDown": false,
          "Hands": false,
          "CustomMesh": {
            "MeshURL": "https://steamusercontent-a.akamaihd.net/ugc/15249694951183841335/65D2821F64803B6C477009B3825E3EB797D93655/",
            "DiffuseURL": "https://steamusercontent-a.akamaihd.net/ugc/14410242526919890640/D7B6EB271552D25B8718DEB4E05F84577822AB00/",
            "NormalURL": "",
            "ColliderURL": "",
            "Convex": true,
            "MaterialIndex": 3,
            "TypeIndex": 0,
            "CustomShader": {
              "SpecularColor": {
                "r": 1.0,
                "g": 1.0,
                "b": 1.0
              },
              "SpecularIntensity": 0.0,
              "SpecularSharpness": 2.0,
              "FresnelStrength": 0.0
            },
            "CastShadows": true
          },
          "LuaScript": "local PACK_SET_CONFIG = {\n  SFD = {\n    label = \"SFD\",\n    image = \"https://steamusercontent-a.akamaihd.net/ugc/14410242526919890640/D7B6EB271552D25B8718DEB4E05F84577822AB00/\",\n  },\n  OGN = {\n    label = \"OGN\",\n    image = \"https://steamusercontent-a.akamaihd.net/ugc/18145712918562890733/12DCF9231FFDEF5ED47C92AC8E18B8AD48220080/\",\n  },\n}\n\nlocal current_setcode = \"SFD\"\nlocal PACK_STATE_KEY = \"rb_pack_set\"\n\nlocal function parseGMNotesSafe(raw)\n  if not raw or raw == \"\" then return {} end\n  local ok, parsed = pcall(JSON.decode, raw)\n  if ok and type(parsed) == \"table\" then\n    return parsed\n  end\n  return {}\nend\n\nlocal function readSetcodeFromGMNotes()\n  local data = parseGMNotesSafe(self.getGMNotes())\n  local candidate = data[PACK_STATE_KEY]\n  if PACK_SET_CONFIG[candidate] then\n    return candidate\n  end\n  return nil\nend\n\nlocal function buildGMNotesForSet(setcode)\n  local data = parseGMNotesSafe(self.getGMNotes())\n  data[PACK_STATE_KEY] = setcode\n  return JSON.encode(data)\nend\n\nlocal function writeSetcodeToGMNotes()\n  self.setGMNotes(buildGMNotesForSet(current_setcode))\nend\n\nlocal function rebuildSelfForSet(setcode, player_color)\n  local cfg = PACK_SET_CONFIG[setcode]\n  if not cfg then return end\n\n  local data = self.getData()\n  data.Nickname = \"Flip it to rip it\"\n  data.GMNotes = buildGMNotesForSet(setcode)\n  if type(data.CustomMesh) == \"table\" then\n    data.CustomMesh.DiffuseURL = cfg.image\n  end\n\n  local pos = self.getPosition()\n  local rot = self.getRotation()\n  local lock = self.getLock()\n  local scale = self.getScale()\n\n  spawnObjectData({\n    data = data,\n    position = pos,\n    rotation = rot,\n    callback_function = function(new_obj)\n      new_obj.setLock(lock)\n      new_obj.setScale(scale)\n      if player_color then\n        broadcastToColor(\"Booster set to \" .. cfg.label, player_color, {0.6, 1, 0.6})\n      end\n    end\n  })\n\n  self.destruct()\nend\n\nlocal function setPackSet(new_setcode, player_color)\n  if not PACK_SET_CONFIG[new_setcode] then return end\n  current_setcode = new_setcode\n  rebuildSelfForSet(new_setcode, player_color)\nend\n\nfunction onSave()\n  return JSON.encode({ setcode = current_setcode })\nend\n\nfunction onLoad(saved_data)\n  local gm_setcode = readSetcodeFromGMNotes()\n  if gm_setcode then\n    current_setcode = gm_setcode\n  elseif saved_data and saved_data ~= \"\" then\n    local ok, state = pcall(JSON.decode, saved_data)\n    if ok and type(state) == \"table\" and PACK_SET_CONFIG[state.setcode] then\n      current_setcode = state.setcode\n    end\n  end\n\n  self.clearContextMenu()\n  self.addContextMenuItem(\"Set to SFD\", function(player_color) setPackSet(\"SFD\", player_color) end)\n  self.addContextMenuItem(\"Set to OGN\", function(player_color) setPackSet(\"OGN\", player_color) end)\n\n  writeSetcodeToGMNotes()\n  self.setName(\"Flip it to rip it\")\nend\n\nfunction onObjectRotate(rotated_object, spin, flip, player_color, old_spin, old_flip)\n  if flip ~= old_flip and rotated_object == self then\n    Global.call(\"RipBoosterPack\", { player_color = player_color, object = self, setcode = current_setcode })\n  end\nend\n",
          "LuaScriptState": "",
          "XmlUI": ""
        }
      ]
    },
    {
      "GUID": "e5fb87",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 2.5,
        "posY": 3.0,
        "posZ": -12.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 23.0,
        "scaleY": 5.0,
        "scaleZ": 6.5
      },
      "Nickname": "Field",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "5fd0e9",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 222.0,
        "posY": 3.0,
        "posZ": -12.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 23.0,
        "scaleY": 5.0,
        "scaleZ": 6.5
      },
      "Nickname": "Field",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "1236a0",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -2.5,
        "posY": 3.0,
        "posZ": 12.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 23.0,
        "scaleY": 5.0,
        "scaleZ": 6.5
      },
      "Nickname": "Field",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "936992",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 217.5,
        "posY": 3.0,
        "posZ": 12.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 23.0,
        "scaleY": 5.0,
        "scaleZ": 6.5
      },
      "Nickname": "Field",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "db3661",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 0.0,
        "posY": 3.0,
        "posZ": 20.0,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 22.0,
        "scaleY": 4.0,
        "scaleZ": 4.0
      },
      "Nickname": "Memory",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "70b7c0",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 0.0,
        "posY": 3.0,
        "posZ": -20.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 22.0,
        "scaleY": 4.0,
        "scaleZ": 4.0
      },
      "Nickname": "Memory",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "980a93",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 219.870544,
        "posY": 3.0,
        "posZ": -20.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 22.0,
        "scaleY": 4.0,
        "scaleZ": 4.0
      },
      "Nickname": "Memory",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "82dc50",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 219.870544,
        "posY": 3.0,
        "posZ": 20.0,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 22.0,
        "scaleY": 4.0,
        "scaleZ": 4.0
      },
      "Nickname": "Memory",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "06c960",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 16.5,
        "posY": 2.0,
        "posZ": 11.5,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 3.5,
        "scaleY": 2.0,
        "scaleZ": 5.0
      },
      "Nickname": "MaterialDeckZone",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "f19275",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -16.5,
        "posY": 2.0,
        "posZ": -11.5,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 3.5,
        "scaleY": 2.0,
        "scaleZ": 5.0
      },
      "Nickname": "MaterialDeckZone",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "2eb031",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 236.5,
        "posY": 2.0,
        "posZ": 11.5,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 3.5,
        "scaleY": 2.0,
        "scaleZ": 5.0
      },
      "Nickname": "MaterialDeckZone",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "a5b274",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 203.25,
        "posY": 2.0,
        "posZ": -11.5,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 3.5,
        "scaleY": 2.0,
        "scaleZ": 5.0
      },
      "Nickname": "MaterialDeckZone",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "d80f44",
      "Name": "CardCustom",
      "Transform": {
        "posX": -177.425,
        "posY": 2.009996,
        "posZ": -11.4000015,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 1.87838769,
        "scaleY": 1.0,
        "scaleZ": 1.87838769
      },
      "Nickname": "Not Shuffled Marker",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 600800,
      "SidewaysCard": false,
      "CustomDeck": {
        "6008": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/17427120730306895427/17ABF55BE4E6E7ACB30AFF51D9B664D241CA725A/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/17427120730306895427/17ABF55BE4E6E7ACB30AFF51D9B664D241CA725A/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "b5216f",
      "Name": "CardCustom",
      "Transform": {
        "posX": -222.575,
        "posY": 2.01000023,
        "posZ": 11.4,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 1.87838769,
        "scaleY": 1.0,
        "scaleZ": 1.87838769
      },
      "Nickname": "Not Shuffled Marker",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 601000,
      "SidewaysCard": false,
      "CustomDeck": {
        "6010": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/17427120730306895427/17ABF55BE4E6E7ACB30AFF51D9B664D241CA725A/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/17427120730306895427/17ABF55BE4E6E7ACB30AFF51D9B664D241CA725A/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "6bfa05",
      "Name": "CardCustom",
      "Transform": {
        "posX": -153.571686,
        "posY": 2.01000071,
        "posZ": -11.4000015,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 1.87838769,
        "scaleY": 1.0,
        "scaleZ": 1.87838769
      },
      "Nickname": "Not Shuffled Marker",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 600700,
      "SidewaysCard": false,
      "CustomDeck": {
        "6007": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/17427120730306895427/17ABF55BE4E6E7ACB30AFF51D9B664D241CA725A/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/17427120730306895427/17ABF55BE4E6E7ACB30AFF51D9B664D241CA725A/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "52ab11",
      "Name": "CardCustom",
      "Transform": {
        "posX": -198.72168,
        "posY": 2.00999975,
        "posZ": 11.4,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 1.87838769,
        "scaleY": 1.0,
        "scaleZ": 1.87838769
      },
      "Nickname": "Not Shuffled Marker",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 600900,
      "SidewaysCard": false,
      "CustomDeck": {
        "6009": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/17427120730306895427/17ABF55BE4E6E7ACB30AFF51D9B664D241CA725A/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/17427120730306895427/17ABF55BE4E6E7ACB30AFF51D9B664D241CA725A/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "7cf430",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": -50.0,
        "posY": 0.97,
        "posZ": 0.0,
        "rotX": 0.00138230971,
        "rotY": 90.00011,
        "rotZ": -0.00381862721,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "",
      "Description": "https://steamcommunity.com/sharedfiles/filedetails/?id=3606647746",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "http://icons.iconarchive.com/icons/danleech/simple/1024/steam-icon.png",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 2,
          "Thickness": 0.1,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\r\n  link='https://steamcommunity.com/sharedfiles/filedetails/?id=3606647746',\r\n\r\n  self.setName(link)\r\n  self.setDescription(link)\r\n\r\n  self.createButton({\r\n    click_function='showLink',\r\n    function_owner=self,\r\n    position={0,0.1,0},\r\n    width=10,\r\n    height=10,\r\n    scale={100,100,100},\r\n    color={1,1,1,0},\r\n    hover_color={1,1,1,0.25},\r\n    tooltip='show link to this table\\nin the steam workshop (Please Rate!)'\r\n  })\r\nend\r\n\r\nfunction showLink()\r\n  self.createInput({\r\n    input_function='null',\r\n    function_owner=self,\r\n    label=link,\r\n    position={0,1,-1.5},\r\n    width=4200,\r\n    height=170,\r\n    font_size=140,\r\n    scale={2,2,2},\r\n    color={0.1,0.1,0.1},\r\n    font_color={1,1,1},\r\n    alignment=3,\r\n    value=link,\r\n    tooltip='ctrl-C'\r\n  })\r\n\r\n  self.clearButtons()\r\n\r\n  self.createButton({\r\n    click_function='hideLink',\r\n    function_owner=self,\r\n    position={0,0.1,0},\r\n    width=10,\r\n    height=10,\r\n    scale={100,100,100},\r\n    color={1,1,1,0},\r\n    hover_color={1,1,1,0.25},\r\n    tooltip='hide link'\r\n  })\r\n\r\n  wid=Wait.time(hideLink,10)\r\nend\r\n\r\nfunction hideLink()\r\n  if wid then\r\n    Wait.stop(wid)\r\n  end\r\n  self.clearInputs()\r\n  self.clearButtons()\r\n  self.createButton({\r\n    click_function='showLink',\r\n    function_owner=self,\r\n    position={0,0.1,0},\r\n    width=10,\r\n    height=10,\r\n    scale={100,100,100},\r\n    color={1,1,1,0},\r\n    hover_color={1,1,1,0.25},\r\n    tooltip='show link to this table\\nin the steam workshop (Please Rate!)'\r\n  })\r\nend\r\n\r\nfunction null()\r\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "02e062",
      "Name": "PiecePack_Arms",
      "Transform": {
        "posX": -46.75,
        "posY": -5.0,
        "posZ": 0.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 1.3499999,
        "scaleY": 1.3499999,
        "scaleZ": 1.3499999
      },
      "Nickname": "Encoder",
      "Description": "NEW functions remove need for spawning zones~\n",
      "GMNotes": "",
      "Memo": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": false,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "-- this thingy has been modified by π for his table\n-- if you take it and try to use it AS-IS it might not work and break other stuff on your table\n-- get the vanilla version from the original un-modified mod here, by Tyrant:\n-- https://steamcommunity.com/sharedfiles/filedetails/?id=828894732\n-- I will not provide support for my version -- I honestly don't remember what I changed to get it to work for me the way I needed\n-- just in case, I might have it set to non-interactable to filter out folks who can't script at all\n\n\n--By Tipsy Hobbit\nmod_name = \"Encoder\"\npostfix = ''\nversion = '4.6.1'\nversion_string = \"No longer save styles.\"\nchange_log = [[NEW functions remove need for spawning zones~\n]]\n\n--Important URLs for tracking updates, as-well-as downloading xml menus for the encoder.\nURLS={\n  ENCODER='https://raw.githubusercontent.com/Jophire/Tabletop-Simulator-Workshop-Items/master/Encoder/Encoder%20Core.lua',\n  ENCODER_BETA='https://raw.githubusercontent.com/Jophire/Tabletop-Simulator-Workshop-Items/update_branch/Encoder/Encoder%20Core.lua',\n  XML='https://raw.githubusercontent.com/Jophire/Tabletop-Simulator-Workshop-Items/update_branch/Encoder/XML.json',\n  BASIC_MENU='https://raw.githubusercontent.com/Jophire/Tabletop-Simulator-Workshop-Items/master/Encoder/Modules/Encoder_Menu_Default.lua'\n  }\n\n--Base values of the encoder.\nCORE_VALUE = {\n  menu_count = 0,\n  style_count = 0,\n  beta = false,\n  style = \"Basic_Style\"\n}\n--Basic Style used by default when creating buttons.\nbasicstyleTableDefault = {\n  label='',\n  position={0,0.28,0},\n  rotation={0,0,0},\n  scale={1,1,1},\n  width=60,\n  height=60,\n  font_size=10,\n  color= {0,0,0,1},\n  font_color= {1,1,1,1},\n  hover_color= {0.3,0.3,0.3,1},\n  press_color= {0.6,0.6,0.6,1},\n  tooltip=\"\"\n}\n\n--Use the API to access these.\nlocal EncodedObjects = {}\n--[[\nObject Structure\nEncodedObjects[objID] = {\n\tthis = Object\n\toName = Original Name\n  oDesc = Original Description\n  values = {valueID = value}\n\tencoded = {propID = boolean}\n  menus = {}\n\tediting = nil\n  flip = 1\n  disabled = false\n]]\nlocal Players = {}\n--[[\n  For attaching values to player colors instead of objects.\n  {ply=color} is how color is referenced in data for the api.\n  Players[color] = {\n    this = color\n    values = {valueID = value}\n    encoded = {propID = boolean}\n    editing = nil\n    style = nil\n  }\n]]\nlocal Properties = {} --Modules add properties for the encoder to call and display.\n--[[\n  propID = internal name,\n  name = external name,\n  values = {},  --List of Values this property calls on. DOES NOT GET REGISTERED FROM HERE.\n  funcOwner = obj,\n  activateFunc ='callEditor',\n  visible = true, --Should this property show up in the menu.\n  visible_in_hand = false, --Should this modules buttons render in player hands.\n  tags = '{json list}',--A json list of tags. 'tool,property,hidden'\n  xml_index = tableindex\n  }\n]]\nlocal Values = {} --Properties rely on registered values to keep track of data.\n--[[\n  valueID = internal name, used by Values as key,\n  type = Lua type definition\n  default = 'default_value'\n  desc = A description for other module creators to understand the values use.\n]]\nlocal Zones = {} --Zones created by the encoder.\n--[[\n  name=Zone name\n  func_enter = function to call on enter\n  func_leave = function to call on exit,\n  funcOwner = what object owns the functions,\n  color = --Player color this zone belongs to.\n]]\nlocal Styles = {}\nStyles[\"Basic_Style\"] = {styleID=\"Basic_Style\",name=\"Basic Style\",desc=\"Comes with the encoder.\",styleTable=basicstyleTableDefault}\n--[[\n  styleID = internal name,\n  name = '',\n  desc = '',\n  styleTable = buttonTable\n]]\nlocal Menus = {} --Menu Modules are always drawn.\n--[[\n  menuID = internal name,\n  funcOwner = obj,\n  activateFunc = func name --Encoder calls this to create the menus.\n]]\n\n\n\n-- Preps the core code for module integration as well\n--   as load in any save_data\n-----------------------------------------------------\n-- @param save_data Game data from autosaves.\nfunction onLoad(saved_data)\n  basic_buttons = {}\n\t-- Version Display\n  -- broadcastToAll(mod_name..\" \"..version..postfix,{0.2,0.2,0.2})\n\tself.setDescription(change_log)\n\t-- Set Global Encoder variable to the last spawned encoder.\n  Global.setVar('Encoder',self)\n\n  -- Make the core pretty.\n  basic_buttons['Name'] = {click_function='doNothing',function_owner=self,label='Encoder',position={-0,0.12,-0.115},rotation={0,0,0},width=0,height=0,font_size=145,color={0,0,0,1},font_color={1,0,0,1}}\n  -- Version Display\n  barSize,fsize,offset_x,offset_y = updateSize(''..version,60,6.0,1,0)\n  basic_buttons['VersionDisp'] = {click_function='doNothing',function_owner=self,label=''..version,position={0.6+offset_x*0.47,0.12,0.05+offset_y},rotation={0,0,0},width=0,height=0,font_size=fsize,color={0,0,0,1},font_color={1,0,0,1}}\n\t--basic_buttons['toggleUI'] = {click_function='minimize',function_owner=self,label='Toggle UI',position={0+offset_x*0,0.12,0.4+offset_y},rotation={0,0,0},width=300,height=100,font_size=fsize,color={0,0,0,1},font_color={1,0,0,1}}\n\n  --Register Default Values\n  APIregisterValue({valueID=\"obj_owner\",type='color',default='Grey',desc='Who owns this object.'})\n\n  --Load up the save data.\n  if saved_data ~= nil and saved_data ~= \"\" then\n    loaded_data = JSON.decode(saved_data)\n    if loaded_data.properties ~= nil then\n      for i,v in pairs(loaded_data.properties) do\n        if v ~= nil and v ~= \"\" then\n          Properties[i] = JSON.decode(v)\n          Properties[i].funcOwner = getObjectFromGUID(Properties[i].funcOwner)\n          local k = i\n          Wait.condition(\n          function() Properties[k].funcOwner.call('registerModule',nil) end,\n          function() return Properties[k].funcOwner ~= nil end,\n          0.1, --second?\n          function() Properties[k] = nil end\n          )\n            --buildPropFunction(i)\n        end\n      end\n    end\n    if loaded_data.zones ~= nil then\n      for k,v in pairs(loaded_data.zones) do\n        if v ~= nil and v~= \"\" then\n          Zones[k] = JSON.decode(v)\n          Zones[k].funcOwner = getObjectFromGUID(Zones[k].funcOwner)\n          local i = k\n          Wait.condition(\n          function() end,\n          function() return getObjectFromGUID(i) ~= nil and Zones[i].funcOwner ~= nil end,\n          0.2,\n          function() Zones[i] = nil end)\n        end\n      end\n    end\n    if loaded_data.values ~= nil then\n      for i,v in pairs(loaded_data.values) do\n        if i ~= nil and v ~= nil and v ~= \"\" then\n          Values[i] = JSON.decode(v)\n          if Values[i].validate == nil then\n            buildValueValidationFunction(i)\n          end\n        end\n      end\n    end\n    if loaded_data.players ~= nil then\n      Players = JSON.decode(loaded_data.players)\n    end\n    if loaded_data.cards ~= nil then\n      for i,v in pairs(loaded_data.cards) do\n        if i ~= nil and v ~= nil and v ~= \"\" then\n          EncodedObjects[i] = JSON.decode(v)\n          EncodedObjects[i].this = getObjectFromGUID(i)\n          if EncodedObjects[i].this == nil then\n            EncodedObjects[i] = nil\n          else\n            local o = EncodedObjects[i].this\n            Wait.frames(function() buildButtons(o) end,2)\n          end\n        end\n      end\n    end\n    if loaded_data.menus ~= nil then\n      CORE_VALUE.menu_count = 0\n      for i,v in pairs(loaded_data.menus) do\n        if i ~= nil and v ~= nil and v ~= \"\" then\n          Menus[i] = JSON.decode(v)\n          Menus[i].funcOwner = getObjectFromGUID(Menus[i].funcOwner)\n          local k = i\n          Wait.condition(\n          function()\n          Menus[k].funcOwner.call('registerModule',nil)\n          CORE_VALUE.menu_count = CORE_VALUE.menu_count + 1\n          end,\n          function() return Menus[k].funcOwner ~= nil end,\n          0.1, --second?\n          function() Menus[k] = nil end\n          )\n        end\n      end\n      if CORE_VALUE.menu_count == 0 then\n        --log(CORE_VALUE.menu_count,\"No menus currently exist.\",\"missing_module\")\n      end\n    end\n  end\n\n  for k,v in pairs(Player.getColors()) do\n    encodePlayer(v)\n  end\n  createEncoderButtons()\n\n  self.clearContextMenu()\n  self.addContextMenuItem('Main Branch', function(p)\n    if Player[p].admin then\n      CORE_VALUE.beta = false\n      Player[p].broadcast('Switching back to the stable update branch.')\n      Player[p].broadcast(\"Please don't forget to preform a version check to force the swith to occur.\")\n    else\n      Player[p].broadcast('Please ask the server host or an admin to change versions.')\n    end\n  end\n  )\n  self.addContextMenuItem('Beta Branch', function(p)\n    if Player[p].admin then\n      CORE_VALUE.beta = true\n      Player[p].broadcast('Switching to the un-stable update branch.')\n      Player[p].broadcast(\"Please don't forget to preform a version check to force the swith to occur.\")\n      Player[p].broadcast(\"Bugs are to be expected.\")\n    else\n      Player[p].broadcast('Please ask the server host or an admin to change versions.')\n    end\n  end\n  )\n  self.addContextMenuItem('Update', function(p)\n    if Player[p].admin then\n      callVersionCheck(p)\n      broadcastToAll('Preforming an update.')\n    else\n      Player[p].broadcast('Please ask the server host or an admin to check for updates.')\n    end\n  end\n  )\n  self.addContextMenuItem('Clean Tables', function(p)\n    garbageCollect()\n  end\n  )\n  if CORE_VALUE.beta then\n    WebRequest.get(URLS['ENCODER_BETA'],self,\"updateCheck\")\n  else\n    WebRequest.get(URLS['ENCODER'],self,\"updateCheck\")\n  end\n\n  --In the event that there are no menus registered, download the default menu.\n  Wait.frames(function()\n    buildZones()\n    if CORE_VALUE.menu_count == 0 then\n      broadcastToAll(\"No menu module located. Spawning the default menu module.\")\n      WebRequest.get(URLS['BASIC_MENU'],self,\"getMenuModule\")\n    end\n  end\n  ,\n  2\n  )\n\n\t--WebRequest.get(URLS['XML'],self,\"buildUI\")\nend\n\n-- Saves core data on save triggers.\n------------------------------------\nfunction onSave()\n  local data_to_save = {}\n  data_to_save[\"cards\"] = {}\n  data_to_save[\"properties\"] = {}\n  data_to_save[\"zones\"] = {}\n  data_to_save[\"values\"] = {}\n  data_to_save[\"players\"] = JSON.encode(Players)\n  data_to_save[\"menus\"] = {}\n\n  for i,v in pairs(EncodedObjects) do\n    --Removing Object reference before encoding.\n    EncodedObjects[i].this = getObjectFromGUID(i)\n    if EncodedObjects[i].this ~= nil then\n      local tempThis = EncodedObjects[i].this\n      EncodedObjects[i].this = \"\"\n      data_to_save[\"cards\"][i] = JSON.encode(EncodedObjects[i])\n      EncodedObjects[i].this = tempThis\n    end\n  end\n  for i,v in pairs(Zones) do\n    if Zones[i].funcOwner ~= nil then\n      local tempThis = Zones[i].funcOwner\n      Zones[i].funcOwner = Zones[i].funcOwner.getGUID()\n      data_to_save[\"zones\"][i] = JSON.encode(Zones[i])\n      Zones[i].funcOwner = tempThis\n    end\n  end\n  for i,v in pairs(Properties) do\n    --Removing Object reference before encoding.\n    if Properties[i].funcOwner ~= nil then\n      local tempThis = Properties[i].funcOwner\n      Properties[i].funcOwner = Properties[i].funcOwner.getGUID()\n      data_to_save[\"properties\"][i] = JSON.encode(Properties[i])\n      Properties[i].funcOwner = tempThis\n    end\n  end\n  for i,v in pairs(Values) do\n    local tempThis = Values[i].validate\n    Values[i].validate = ''\n    data_to_save[\"values\"][i] = JSON.encode(Values[i])\n    Values[i].validate = tempThis\n  end\n  for i,v in pairs(Menus) do\n    if Menus[i].funcOwner ~= nil then\n      local tempThis = Menus[i].funcOwner\n      Menus[i].funcOwner = Menus[i].funcOwner.getGUID()\n      data_to_save[\"menus\"][i] = JSON.encode(Menus[i])\n      Menus[i].funcOwner = tempThis\n    end\n  end\n  saved_data = JSON.encode(data_to_save)\n  return saved_data\nend\n\n-- Calls the version check for the encoder, and any modules\n-- which support an update check.\nfunction callVersionCheck()\n  if CORE_VALUE.beta then\n    WebRequest.get(URLS['ENCODER_BETA'],self,\"versionCheck\")\n  else\n    WebRequest.get(URLS['ENCODER'],self,\"versionCheck\")\n  end\n  for k,v in pairs(Properties) do\n    u = v.funcOwner.getVar('UPDATE_URL')\n    if u ~= nil then\n      WebRequest.get(u,v.funcOwner,\"updateModule\")\n    end\n  end\n  for k,v in pairs(Menus) do\n    u = v.funcOwner.getVar('UPDATE_URL')\n    if u ~= nil then\n      WebRequest.get(u,v.funcOwner,\"updateModule\")\n    end\n  end\nend\n\n--Just checks if an update is available without actually updating.\nfunction updateCheck(wr)\n  wr = wr.text\n  local ver = versionComp(string.match(wr,\"version = '(.-)'\"),version)\n  if ''..ver ~= ''..version then\n    -- broadcastToAll(\"An update has been found. Please right click the encoder and select update.\")\n  else\n    -- broadcastToAll(\"No update found at this time. Carry on.\")\n  end\nend\n--The callVersionCheck callback for the encoder webrequest.\nfunction versionCheck(wr)\n  wr = wr.text\n  local ver = versionComp(string.match(wr,\"version = '(.-)'\"),version)\n  if ''..ver ~= ''..version then\n    if CORE_VALUE.beta == true then\n      broadcastToAll(\"An update has been found for the beta branch. Reloading encoder.\")\n    else\n      broadcastToAll(\"An update has been found for the main branch. Reloading encoder.\")\n    end\n    self.script_code = wr\n    self.reload()\n  else\n    broadcastToAll(\"No update found at this time. Carry on.\")\n  end\nend\n--Compares two version strings of \"(/d*.+)*\"\n--Examples: 1, 1.2, 0.1111.2, 0.0.0.0.1, 192.168.0.1\nfunction versionComp(a,b)\n  --First does the pattern only contain ([0-9]+)%.?\n  --Pattern for versioning ##.##.##.##\n  va = {}\n  vb = {}\n  for f in string.gmatch(a,'([0-9]+)%.?') do\n    table.insert(va,tonumber(f))\n  end\n  for f in string.gmatch(b,'([0-9]+)%.?') do\n    table.insert(vb,tonumber(f))\n  end\n  for k = 1, #va >= #vb and #va or #vb do\n    if (va[k] ~= nil and va[k] or 0) > (vb[k] ~= nil and vb[k] or 0) then\n      return a\n    elseif (va[k] ~= nil and va[k] or 0) < (vb[k] ~= nil and vb[k] or 0) then\n      return b\n    end\n  end\n  return b\nend\n\n-- NEW- Registers each players hands as a zone for the encoder to track.\n-- This is used to more reliably hide/reveal card buttons as it transitions zones.\nfunction buildZones()\n  local hands = {}\n  local color = nil\n  for k,v in pairs(Hands.getHands()) do\n    --Hand Color\n    color = v.getValue()\n    --How many hands of this color have shown up. Init to 0 if nil.\n    if hands[color] == nil then\n      hands[color] = 0\n    end\n    hands[color] = hands[color]+1\n    --Zone id is hand color + hand count for that color.\n    id = color..\"_\"..hands[color]\n    Zones[v.guid] = {\n        name = id,\n        func_enter = 'hideCardDetails',\n        func_leave = 'showCardDetails',\n        funcOwner = self,\n        color = color}\n  end\nend\n--Spawns in the default menu module if no menu module exists.\nfunction getMenuModule(wr)\n  local wr = wr.text\n  params = {}\n  params.type = \"PiecePack_Crowns\"\n  params.position = self.getPosition()+Vector(0,1,0)\n  params.rotation = self.getRotation()\n  params.scale = Vector(1,1,1)*(2/3)\n  params.sound = false\n  params.callback_function = function(obj)\n      obj.setName('Menu Module')\n      obj.script_code = wr\n      obj.reload()\n      Wait.condition(function() obj.call(\"registerModule\",nil) end,function() return obj.spawning end)\n    end\n  spawnObject(params)\nend\n\n\n\n-- Functions to hide or show card details as it transitions from hand to table and back.\nfunction hideCardDetails(tar)\n  tar= tar[1]\n  if EncodedObjects[tar.getGUID()] ~= nil then\n    buildButtons(tar,true)\n  end\nend\nfunction showCardDetails(tar)\n  tar = tar[1]\n  if EncodedObjects[tar.getGUID()] ~= nil then\n    buildButtons(tar,false)\n  end\nend\n\n-- Event Triggers\nfunction onObjectEnterZone(zone, obj)\n  if Zones[zone.getGUID()] ~= nil then\n    --log(\"Object has entered zone: \"..Zones[zone.getGUID()].name)\n    self.call(Zones[zone.getGUID()].func_enter,{obj})\n  end\nend\nfunction onObjectLeaveZone(zone, obj)\n  if Zones[zone.getGUID()] ~= nil then\n    self.call(Zones[zone.getGUID()].func_leave,{obj})\n  end\nend\nfunction onObjectLeaveContainer(ctr,obj)\n  if EncodedObjects[obj.getGUID()] ~= nil then\n    EncodedObjects[obj.getGUID()].this = getObjectFromGUID(obj.getGUID())\n    if obj.use_hands == true then\n      Wait.condition( function()\n      Wait.condition(\n        function() local hand = handCheck(obj) buildButtons(obj,hand) end,\n        function() return obj == nil or obj.resting end\n      ) end,\n      function() return not obj.resting end)\n    end\n  end\nend\nfunction onObjectDestroyed(obj)\n  if obj == self then\n    for i,v in pairs(EncodedObjects) do\n      EncodedObjects[i].this = getObjectFromGUID(i)\n      v.this.clearButtons()\n      v.this.setName(v.name)\n      v.this.clearContextMenu()\n    end\n\t\tfor k,v in pairs(Player.getColors()) do\n\t\t\tif v ~= \"Grey\" then\n\t\t\t\t--UI.setAttribute(k..\"MainMenu\",\"active\",false)\n\t\t\tend\n\t\tend\n    for k,v in pairs(Zones) do\n      o = getObjectFromGUID(k)\n      if o ~= nil and o.type ~= \"Hand\" then\n        o.destruct()\n      end\n    end\n  end\nend\nfunction onObjectDropped(c,obj)\n  local ver = versionComp(Global.getVar('Encoder').getVar('version'),version)\n  if ver == version and mod_name == 'Encoder' or Global.getVar('Encoder') == nil then\n    Global.setVar('Encoder',self)\n  end\n  if EncodedObjects[obj.getGUID()] ~= nil and EncodedObjects[obj.getGUID()].disable ~= true then\n  if obj.use_hands == true then\n    Wait.condition(\n      function() if obj ~= nil then local hand = handCheck(obj) buildButtons(obj,hand) end end,\n      function() return obj == nil or obj.resting end\n    )\n  end\n  end\n  if obj.getVar(\"pID\") ~= nil then\n    obj.call(\"registerModule\")\n  end\nend\n--Use a raycast to check if an object is resting in a hand or not.\n--Currently has a problem with tables that have multiple points of\n--  impact during a raycast.\nfunction handCheck(obj)\n  if obj ~= nil and obj.getLock() == false and obj.held_by_color == nil then\n    for k,v in pairs(obj.getZones()) do\n      if Zones[v.guid] ~= nil and v.type == \"Hand\" then\n        --log(\"In hand: \"..Zones[v.guid].name)\n        return true\n      end\n    end\n  end\n  return false\nend\n\n--Does nothing, required for buttons.\nfunction doNothing()\nend\n\n--Create the encoders own buttons.\nfunction createEncoderButtons()\n  for i,v in pairs(basic_buttons) do\n    self.createButton(v)\n  end\nend\n\n-- If the encoder is deleted, make sure to cleanup.\nfunction encodeObject(o)\n  if o.getVar('noencode') == true then\n    return false\n  end\n  if EncodedObjects[o.getGUID()] == nil and o ~= self then\n    EncodedObjects[o.getGUID()] = {\n    this = o,\n    oName = o.getName(),\n    oDesc = o.getDescription(),\n    values = {},\n    encoded = {},\n    menus = {},\n    editing = nil,\n    flip = 1,\n    disable = false\n    }\n    buildButtons(o)\n    -- buildContextMenu(o)\n    return true\n  end\n  return false\nend\n--Encodes a given player color, preping them for use with the api.\nfunction encodePlayer(c)\n  if Players[c] == nil then\n    Players[c] = {\n      this = c,\n      values = {},\n      encoded = {},\n      editing = nil,\n      style = \"basic\",\n      menus = {}\n    }\n    --updateXML(c)\n    return true\n  end\n  return false\nend\n--Helper function for creating uniform button sizes.\nfunction updateSize(text,font_size,max_len,x_just,y_just)\n  local temp = ''..text\n  local size = 0\n  local depth = 0\n  local old_i = 0\n  local i = 0\n  local fsize = font_size\n  while old_i < #temp do\n    i = string.find(temp,\"\\n\",old_i)\n    if i == nil then\n      i = #temp\n    end\n    if i - old_i > size then\n      size = i-old_i\n    end\n    old_i = i+1\n    depth = depth+1\n  end\n  if size <= max_len then\n    fsize = font_size\n  else\n    fsize = font_size*(max_len/size)\n  end\n\n  offset_x = x_just*(size/19+0.05)*-1--*(fsize/(150/86)))\n  offset_y = 0--y_just*((depth/2*fsize)+8)\n  barSize = size*((fsize/(150/83)))+20\n  return barSize,fsize,offset_x,offset_y\nend\n\n--Creates the context menu option for flipping a card for registered objects.\nfunction buildContextMenu(o)\n  o.addContextMenuItem('Flip Menu',function(ply) flipMenu(o,0) end)\nend\n\n--Calls the menus/property modules createButtons funciton\n--  when updating a given object.\nfunction buildButtons(o,h)\n  if h == nil then\n    h = handCheck(o)\n  end\n  if o==nil then return end\n  if EncodedObjects[o.getGUID()].disable ~= true then\n    o.clearButtons()\n    o.clearInputs()\n    if EncodedObjects[o.getGUID()].editing == nil then\n      for k,v in pairs(Menus) do\n        if v.funcOwner ~= nil then\n          if EncodedObjects[o.getGUID()].menus[k] == nil then\n            EncodedObjects[o.getGUID()].menus[k] = {open=false,pos=0}\n          end\n          if v.visible_in_hand == nil then\n            v.visible_in_hand = 0\n          end\n          if h==true and v.visible_in_hand>=1 then\n            v.funcOwner.call(v.activateFunc,{obj=o})\n          elseif h~=true and v.visible_in_hand<=1 then\n            v.funcOwner.call(v.activateFunc,{obj=o})\n          end\n        else\n          --log(v.funcOwner,\"Missing module for menu \"..k,'missing_module')\n        end\n      end\n      for k,v in pairs(EncodedObjects[o.getGUID()].encoded) do\n        if v == true and Properties[k]~=nil and Properties[k].funcOwner~= nil then\n          if Properties[k].visible_in_hand == nil then\n            Properties[k].visible_in_hand = 0\n          end\n          if h==true and Properties[k].visible_in_hand>=1 then\n            Properties[k].funcOwner.call(\"createButtons\",{obj=o})\n          elseif h~=true and Properties[k].visible_in_hand<=1 then\n            Properties[k].funcOwner.call(\"createButtons\",{obj=o})\n          end\n        end\n      end\n    else\n      k = EncodedObjects[o.getGUID()].editing\n      if Properties[k]~=nil and Properties[k].funcOwner~= nil then\n        Properties[k].funcOwner.call(\"createButtons\",{obj=o})\n      end\n      flip = EncodedObjects[o.getGUID()].flip\n      temp = \" X \"\n      barSize,fsize,offset_x,offset_y = updateSize(temp,90,90,0,0)\n      ob = {\n      label=temp, click_function='closeEditor', function_owner=self,\n      position={(-1.1+offset_x)*flip,0.28*flip,(1.4+offset_y)}, height=100, width=barSize, font_size=fsize,\n      rotation={0,0,90-90*flip}\n      }\n      for k,v in pairs(APIgetStyleTable()) do\n        if ob[k] == nil then\n          ob[k] = v\n        end\n      end\n      o.createButton(ob)\n    end\n  end\nend\n--Safety button in the event that an api user does not add a\n-- way to give back control of buttons to the encoder.\nfunction closeEditor(o)\n  if type(o) == 'String' then\n    Players[o].editing = nil\n  else\n    EncodedObjects[o.getGUID()].editing = nil\n  end\n  buildButtons(o)\nend\n\n--Disables encoding of a card.\nfunction disableEncoding(o,p)\n  EncodedObjects[o.getGUID()].disable = true\n  o.setName(EncodedObjects[o.getGUID()].oName)\n  local selection =Player[p].getSelectedObjects()\n  if selection ~= nil then\n    for k,v in pairs(selection) do\n      if EncodedObjects[v.getGUID()] ~= nil and v ~= o then\n        EncodedObjects[v.getGUID()].disable = true\n        v.setName(EncodedObjects[v.getGUID()].oName)\n        v.clearButtons()\n        v.clearInputs()\n        buildButtons(v)\n      end\n    end\n  end\n  o.clearButtons()\n  o.clearInputs()\n  buildButtons(o)\nend\n--Flips the menu for the front face to the backface and reverse.\nfunction flipMenu(o,p)\n  local flip = EncodedObjects[o.getGUID()].flip\n  if flip ~= 1 then\n    EncodedObjects[o.getGUID()].flip = 1\n\t\to.hide_when_face_down = true\n  else\n    EncodedObjects[o.getGUID()].flip = -1\n\t\to.hide_when_face_down = false\n  end\n  if type(p) == \"string\" then\n    local selection =Player[p].getSelectedObjects()\n    if selection ~= nil then\n      for k,v in pairs(selection) do\n        if EncodedObjects[v.getGUID()] ~= nil and v ~= o then\n          flipMenu(v,0)\n        end\n      end\n    end\n  end\n  buildButtons(o)\nend\n--Turn target property on or off, calling the relevant Module functions.\nfunction toggleProperty(o,p)\n  if EncodedObjects[o.getGUID()] ~= nil then\n    local prop = EncodedObjects[o.getGUID()].encoded[p]\n    if prop == nil then\n      EncodedObjects[o.getGUID()].encoded[p] = true\n    else\n      if prop ~= true then\n        EncodedObjects[o.getGUID()].encoded[p] = true\n      else\n        EncodedObjects[o.getGUID()].encoded[p] = false\n      end\n    end\n    for k,v in pairs(Properties[p].values) do\n      if Values[v] ~= nil and EncodedObjects[o.getGUID()].values[v] == nil then\n        EncodedObjects[o.getGUID()].values[v] = Values[v].default\n      end\n    end\n    return EncodedObjects[o.getGUID()].encoded[p]\n  elseif type(o) == 'String' and Players[o] ~= nil then\n    local prop = Players[o].encoded[p]\n    if prop == nil then\n      Players[o].encoded[p] = true\n    else\n      if prop ~= true then\n        Players[o].encoded[p] = true\n      else\n        Players[o].encoded[p] = false\n      end\n    end\n    for k,v in pairs(Properties[p].values) do\n      if Values[v] ~= nil and Players[o].values[v] == nil then\n        Players[o].values[v] = Values[v].default\n      end\n    end\n    return Players[o].encoded[p]\n  end\nend\n\n\n-- Factories\nfunction buildValueValidationFunction(p)\n  v=Values[p]\n  if v.validType ~= nil and v.validType ~= 'nil' then\n    if string.find('stringnumberboolean',v.validType) then\n      local vt = v.validType\n      Values[p]['validate']= function(val,cur)\n        if type(val) == vt then return val else return cur end end\n    elseif string.find(v.validType, 'pattern%b()') then\n      local _,_,pat = string.find(v.validType,'pattern(%b())')\n      if #pat > 2 then\n        pat = string.sub(pat,2,-2)\n        Values[p]['validate']= function(val,cur)\n        if string.find(val,pat) then return val else return cur end end\n      end\n    elseif string.find(v.validType, 'color') then\n      Values[p]['validate']= function(val,cur)\n      if val == '' or val == nil or Player[val] ~= nil then return val else return cur end end\n    end\n  else\n    Values[p]['validate']= function(val,cur) return val end\n  end\n  _G[p..'Validate']= Values[p]['validate']\nend\n\n\n--##########################\n--#API Functions\n--[[Almost all function within the api require a table to be passed to them.\nTable keys that are used are as follows.\nobj = the object that is the target of the api call. RW\nply = the player color that is the target of the api call. RW\npropID = the property that is the target of the api call. RW\nvalueID = the value that is the target of the api call. RW\ndata = a table of key value pairs related to the cards encoded data RW\n{obj=__,ply='',propID='',valueID='',data={valueID=value}}\nnot all of the values are required for every API function.\n]]\n\n--REGISTRATION\n\n--##########################\n--#PROPERTY FUNCTIONS\n--[[register a new property.\n  Takes a table\n  {propID='internalname',name='Button name',values={list of values},funcOwner=obj,callOnActivate=boolean,activateFunc='function name'}\n]]\nfunction APIregisterProperty(p)\n--[[propID = internal name,\n  name = external name,\n  values = {},  --List of Values this property calls on. DOES NOT GET REGISTERED FROM HERE.\n  funcOwner = obj,\n  callOnActivate = true,\n  activateFunc ='callEditor',\n  visible = true, --Should this property show up in the menu.\n  tags = {list},--A list of tags. 'tool,property,hidden'\n  xml_index = tableindex\n  }]]\n  Properties[p.propID] = deepcopy(p)\n  --log(nil,Properties[p.propID].propID..\" Registered\",0)\n  --buildPropFunction(p.propID)\n\t--updateUI()\nend\n--Lists currently registered properties.\nfunction APIgetPropsList(p)\n  tags = {}\n  if p ~= nil and p.tags ~= nil then\n    for k,v in pairs(p.tags) do\n      tags[k] = v\n    end\n  end\n  data = {}\n  for k,v in pairs(Properties) do\n    if #tags ~= 0 then\n      if v.tags == nil or v.tags == '' then\n        Properties[k].tags = 'untagged'\n      end\n      for i=1, #tags do\n        if string.find(v.tags,tags[i]) then\n          if v.funcOwner == nil then\n            data[k]='[Red]MISSING![White]'\n          else\n            data[k]=''\n          end\n          data[k]=data[k]..v.propID..\" : \"..v.name..\" {\"\n          for m,n in pairs(v.values) do\n            data[k]=data[k]..n..\",\"\n          end\n          data[k]=data[k]..\"}\"\n          break;\n        end\n      end\n    else\n      if v.funcOwner == nil then\n        data[k]='[Red]MISSING![White]'\n      else\n        data[k]=''\n      end\n      data[k]=data[k]..v.propID..\" : \"..v.name..\" {\"\n      for m,n in pairs(v.values) do\n        data[k]=data[k]..n..\",\"\n      end\n      data[k]=data[k]..\"}\"\n    end\n  end\n  return data\nend\n--checks if a given property is registered, returns BOOL\nfunction APIpropertyExists(p)\n  return Properties[p.propID] ~= nil\nend\n--returns a list of values the property ues.\nfunction APIgetPropValues(p)\n  if Properties[p.propID] ~= nil then\n    return Properties[p.propID].values\n  end\n  return {}\nend\n--Returns the Property Table\nfunction APIgetProp(p)\n  return Properties[p.propID]\nend\n\n--##########################\n--#VALUE FUNCTIONS\n--[[register a new value.\n  Takes a table\n  {valueID='internalname',validType=#CHECK_VALID_TYPES,desc='What is it used for',default=value}\n  #CHECK_VALID_TYPES:\n    'string'\n    'boolean'\n    'number'\n    'pattern(here)'--example pattern(%%Color%%) the only acceptable value would be a string %Color%\n    'color' --Player colors\n]]\nfunction APIregisterValue(p)\n  --if Values[p.valueID] == nil then\n    Values[p.valueID] = {}\n    Values[p.valueID]['default']= p.default\n    Values[p.valueID]['validType']= p.validType\n    Values[p.valueID]['desc']= p.desc ~= nil and p.desc or 'No Description Given'\n    buildValueValidationFunction(p.valueID)\n  --end\n  --table.insert(Values[p.valueID]['props'],p.propID)\nend\n--Lists currently registered values.\nfunction APIlistValues()\n  data = {}\n  for k,v in pairs(Values) do\n    data[k]=v.validType..\" --\"..v.desc\n  end\n  return data\nend\n--checks if a given value is registered, returns BOOL\nfunction APIvalueExists(p)\n  return Values[p.valueID] ~= nil\nend\n\n--##########################\n--#MENU FUNCTIONS\n--[[Register a new menu. ]]\nfunction APIregisterMenu(p)\n  Menus[p.menuID] = {\n    menuID = p.menuID,\n    funcOwner = p.funcOwner,\n    activateFunc = p.activateFunc,\n    visible_in_hand = p.visible_in_hand\n   }\nend\nfunction APIlistMenus()\n  data = {}\n  for k,v in pairs(Menus) do\n    table.insert(data,k)\n  end\n  return data\nend\nfunction APIgetMenu(p)\n  return Menus[p.menuID]\nend\n--Get or Set menu data of a given object.\n--{obj=obj,menuID=menu ID,data=data}\nfunction APIobjGetMenuData(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    data = EncodedObjects[target].menus[p.menuID]\n    if data == nil then\n      data = {open=false,pos=0}\n    end\n    return data\n  end\nend\nfunction APIobjSetMenuData(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    if EncodedObjects[target].menus[p.menuID] == nil then\n      EncodedObjects[target].menus[p.menuID] = {open=false,pos=0}\n    end\n    for k,v in pairs(p.data) do\n      EncodedObjects[target].menus[p.menuID][k] = v\n    end\n  end\nend\nfunction APIobjGetMenus(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    return EncodedObjects[target].menus\n  end\nend\nfunction APIobjToggleMenu(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    if EncodedObjects[target].menus[p.menuID] == nil then\n      EncodedObjects[target].menus[p.menuID] = {open=false,pos=0}\n    end\n    if EncodedObjects[target].menus[p.menuID].open ~= true then\n      EncodedObjects[target].menus[p.menuID].open = true\n    else\n      EncodedObjects[target].menus[p.menuID].open = false\n    end\n  end\nend\n\n--##########################\n--#STYLE FUNCTIONS\nfunction APIregisterStyle(p)\n  Styles[p.styleID] = {\n    styleID = p.styleID,\n    name = p.name,\n    desc = p.desc,\n    styleTable = p.styleTable\n  }\nend\nfunction APIlistStyles()\n  data = {}\n  for k,v in pairs(Styles) do\n    data[k] = k..\" = \"..v.name..\":\"..v.desc\n  end\n  return data\nend\nfunction APIsetGlobalStyle(p)\n  if Styles[p.styleID] ~= nil then\n    CORE_VALUE.style = p.styleID\n  end\nend\nfunction APIgetGlobalStyle()\n  return CORE_VALUE.style\nend\nfunction APIgetStyleTable(p)\n  if p ~= nil then\n    if p.styleID ~= nil then\n      if Styles[p.styleID] ~= nil then\n        return Styles[p.styleID].styleTable\n      end\n    elseif p.color ~= nil and Players[p.color].style ~= nil then\n      if Styles[Players[p.color].style] ~= nil then\n        return Styles[Players[p.color].style].styleTable\n      end\n    end\n  end\n  return Styles[CORE_VALUE.style].styleTable\nend\n\n--##########################\n--#ZONE FUNCTIONS\nfunction APIregisterZone(p)\n  Zones[p.guid] = {\n    name=p.name,\n    func_enter = p.func_enter,\n    func_leave = p.func_exit,\n    funcOwner = p.funcOwner,\n    color = p.color}\nend\nfunction APIlistZones()\n  return Zones\nend\nfunction APIgetZone(p)\n  return Zones[p.guid]\nend\nfunction APIisZone(p)\n  return Zones[p.guid] ~= nil\nend\n\n--##########################\n--#GETTERS/SETTERS\n\n--OBJECT/PLAYER FUNCTIONS\n--Toggles target prop on or off: {obj=obj,propID=propID}\nfunction APItoggleProperty(p)\n  if p.obj ~= nil then\n    toggleProperty(p.obj,p.propID)\n  end\n  if p.ply ~= nil then\n    toggleProperty(p.ply,p.propID)\n  end\nend\n--OBJECT FUNCTIONS\n--registers a new object to be encoded.\nfunction APIencodeObject(p)\n  encodeObject(p.obj)\nend\n--checks if a given object is encoded, returns BOOL\nfunction APIobjectExists(p)\n  return EncodedObjects[p.obj.getGUID()] ~= nil\nend\n--Returns if the object is disabled or not.\nfunction APIobjDisabled(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    return EncodedObjects[target].disable\n  end\n  return false\nend\nfunction APIobjReset(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    for k,v in pairs(EncodedObjects[target].encoded) do\n      APIobjResetProp({obj=p.obj,propID=k})\n    end\n  end\nend\n--To remove items accidentaly added.\nfunction APIobjRemove(p)\n  p.obj.clearButtons()\n  p.obj.clearInputs()\n  p.obj.setVar(\"noencode\",\"Will no longer be encoded.\")\n  local e = EncodedObjects[p.obj.getGUID()]\n  EncodedObjects[p.obj.getGUID()] = nil\n  return e\nend\n--Clones object p.obj data to p.clone\nfunction APIobjCloneData(p)\n  local new_target = p.obj.getGUID()\n  local target = p.data.getGUID()\n  if EncodedObjects[target] ~= nil then\n    if EncodedObjects[new_target] == nil then\n      encodeObject(p.new_obj)\n    end\n    EncodedObjects[new_target] = deepcopy(EncodedObjects[target])\n    EncodedObjects[new_target].this = p.new_obj\n  end\nend\nfunction APIobjUpdateThis(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    EncodedObjects[target].this = getObjectFromGUID(target)\n  end\nend\n\n\n--Is a given Property enabled: {obj=obj,propID=propID}\nfunction APIobjIsPropEnabled(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    if EncodedObjects[target].encoded[p.propID] ~= nil then\n      return EncodedObjects[target].encoded[p.propID]\n    else\n      return false\n    end\n  end\n  return false\nend\n--Returns a list of props and if they are active or not: {obj=obj}\nfunction APIobjGetProps(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    return EncodedObjects[target].encoded\n  end\nend\n--Set a prop to active or not: {obj=obj,data={propID=bool}}\nfunction APIobjSetProps(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    EncodedObjects[target].encoded = p.data\n  end\nend\n--Call target properties activateFunc: {obj=obj,propID=propID,color=player.color,data=alt_click}\nfunction APIobjCallProp(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    local prop = Properties[p.propID]\n    if prop ~= nil then\n      prop.funcOwner.call(prop.activateFunc,{p.obj,p.color or nil,p.data or false})\n    end\n  end\nend\n--Enable target prop: {obj=obj,propID=propID}\nfunction APIobjEnableProp(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    local prop = EncodedObjects[p.obj.getGUID()].encoded[p.propID]\n    if prop ~= true then\n      toggleProperty(p.obj,p.propID)\n    end\n  end\nend\n--Disable target prop: {obj=obj,propID=propID}\nfunction APIobjDisableProp(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    local prop = EncodedObjects[p.obj.getGUID()].encoded[p.propID]\n    if prop ~= false then\n      toggleProperty(p.obj,p.propID)\n    end\n  end\nend\n--Rest Prop\nfunction APIobjResetProp(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    EncodedObjects[target].encoded[p.propID] = false\n    for k,v in pairs(Properties[p.propID].values) do\n      EncodedObjects[target].values[v] = Values[v].default\n    end\n  end\nend\n\n--Get or Set a single value based on valueID. Returns the value.\n--{obj=obj,valueID=valueID,data={valueID=value}}\nfunction APIobjGetValueData(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil and Values[p.valueID] ~= nil then\n    if EncodedObjects[target].values[p.valueID] == nil then\n      EncodedObjects[target].values[p.valueID] = Values[p.valueID].default\n    end\n    val = EncodedObjects[target].values[p.valueID]\n    data = {}\n    data[p.valueID]=val\n    return data\n  end\nend\nfunction APIobjSetValueData(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil and Values[p.valueID] ~= nil then\n    EncodedObjects[target].values[p.valueID] = _G[p.valueID..\"Validate\"](p.data[p.valueID],EncodedObjects[target].values[p.valueID])\n  end\nend\nfunction APIobjDefaultValue(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil and  Values[p.valueID] ~= nil then\n    EncodedObjects[target].values[p.valueID] = Values[p.valueID].default\n  end\nend\n--Get or Set value data based on propID. Returns and accepts an array of Key-Values. Key is a valid valueID.\n--{obj=obj,propID=propID,data={valueID=value}}\nfunction APIobjGetPropData(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    data = {}\n    for k,v in pairs(Properties[p.propID].values) do\n      if EncodedObjects[target].values[v] == nil and  Values[v] ~= nil then\n        EncodedObjects[target].values[v] = Values[v].default\n      end\n      data[v]=EncodedObjects[target].values[v]\n    end\n    return data\n  end\nend\nfunction APIobjSetPropData(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    for k,v in pairs(Properties[p.propID].values) do\n      if Values[v] ~= nil and p.data[v] ~= nil then\n        EncodedObjects[target].values[v] = Values[v][\"validate\"](p.data[v],EncodedObjects[target].values[v])\n      end\n    end\n  end\nend\n--Get or Set all value data of a given object.\n--{obj=obj}\nfunction APIobjGetAllData(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n   return EncodedObjects[target].values\n  end\nend\n--{obj=obj,data={valueID=value}}\nfunction APIobjSetAllData(p)\n  local target = p.obj.getGUID()\n  if EncodedObjects[target] ~= nil then\n    for k,v in pairs(p.data) do\n      if Values[k] ~= nil then\n        EncodedObjects[target].values[k] = _G[k..\"Validate\"](v,EncodedObjects[target].values[k])\n      else\n        --log(k,'Unknown value '..k..'.','value')\n      end\n    end\n  end\nend\n\n--PLAYER FUNCTIONS\n--registers a new Player color to be encoded.\nfunction APIencodePlayer(p)\n  encodePlayer(p.ply)\nend\n--checks if a given player color is registered, returns BOOL\nfunction APIplayerExists(p)\n  return Players[p.ply] ~= nil\nend\n--Is a given Property enabled: {ply=color,propID=propID}\nfunction APIplyIsPropEnabled(p)\n  local target = p.ply\n  if EncodedObjects[target] ~= nil then\n    if Players[target].encoded[p.propID] ~= nil then\n      return Players[target].encoded[p.propID]\n    else\n      return false\n    end\n  end\n  return false\nend\n--Returns a list of props and if they are active or not: {ply=color}\nfunction APIplyGetProps(p)\n  local target = p.ply\n  if Players[target] ~= nil then\n    return Players[target].encoded\n  end\nend\n--Set a prop to active or not: {ply=color,data={propID=bool}}\nfunction APIplySetProps(p)\n  local target = p.ply\n  if Players[target] ~= nil then\n    Players[target].encoded = p.data\n  end\nend\n--Enable target prop: {ply=color,propID=propID}\nfunction APIplyEnableProp(p)\n  local target = p.ply\n  if Players[target] ~= nil then\n    local prop = Players[p.obj.getGUID()].encoded[p.propID]\n    if prop ~= true then\n      Players(p.obj,p.propID)\n    end\n  end\nend\n--Disable target prop: {ply=color,propID=propID}\nfunction APIplyDisableProp(p)\n  local target = p.ply\n  if Players[target] ~= nil then\n    local prop = Players[p.obj.getGUID()].encoded[p.propID]\n    if prop ~= false then\n      Players(p.obj,p.propID)\n    end\n  end\nend\n--{ply=color,valueID=valueID,data={valueID=value}}\nfunction APIplyGetValueData(p)\n  local target = p.ply\n  if Players[target] ~= nil and Values[p.valueID] ~= nil then\n    if Players[target].values[p.valueID] == nil then\n      Players[target].values[p.valueID] = Values[p.valueID].default\n    end\n    val = Players[target].values[p.valueID]\n    data = {}\n    data[p.valueID]=val\n    return data\n  end\nend\nfunction APIplySetValueData(p)\n  local target = p.ply\n  if Players[target] ~= nil and Values[p.valueID] ~= nil then\n    Players[target].values[p.valueID] = _G[p.valueID..\"Validate\"](p.data[p.valueID],Players[target].values[p.valueID])\n  end\nend\nfunction APIplyDefaultValue(p)\n  local target = p.ply\n  if Players[target] ~= nil and  Values[p.valueID] ~= nil then\n    Players[target].values[p.valueID] = Values[p.valueID].default\n  end\nend\n--Get or Set value data based on propID. Returns and accepts an array of Key-Values. Key is a valid valueID.\n--{ply=ply,propID=propID,data={valueID=value}}\nfunction APIplyGetPropData(p)\n  local target = p.ply\n  if Players[target] ~= nil then\n    data = {}\n    for k,v in pairs(Properties[p.propID].values) do\n      if Players[target].values[v] == nil and  Values[v] ~= nil then\n        Players[target].values[v] = Values[v].default\n      end\n      data[v]=Players[target].values[v]\n    end\n    return data\n  end\nend\nfunction APIplySetPropData(p)\n  local target = p.ply\n  if Players[target] ~= nil then\n    for k,v in pairs(Properties[p.propID].values) do\n      if Values[v] ~= nil and p.data[v] ~= nil then\n        Players[target].values[v] = Values[v][\"validate\"](p.data[v],Players[target].values[v])\n      end\n    end\n  end\nend\n--{ply=color}\nfunction APIplyGetAllData(p)\n  local target = p.ply\n  if Players[target] ~= nil then\n   return Players[target].values\n  end\nend\n--{ply=color,data={valueID=value}}\nfunction APIplySetAllData(p)\n  local target = p.ply\n  if Players[target] ~= nil then\n    for k,v in pairs(p.data) do\n      if Values[k] ~= nil then\n        Players[target].values[k] = _G[k..\"Validate\"](v,Players[target].values[k])\n      else\n        --log(k,'Unknown value '..k..'.','value')\n      end\n    end\n  end\nend\n\n\n\n\n--BUTTON UI FUNCTIONS\n--sets current editing state, so that buttons don't overlap.\n--the p.propID that is called must have a function createButtons({obj=object being edited})\nfunction APIsetEditing(p)\n  if p.obj ~= nil then\n    EncodedObjects[p.obj.getGUID()].editing = p.propID\n  else\n    Players[p.ply].editing = p.propID\n  end\nend\n--gets current editing state, so that buttons don't overlap.\n--returns the propID currently be edited.\nfunction APIgetEditing(p)\n  if p.obj ~= nil then\n    return EncodedObjects[p.obj.getGUID()].editing\n  else\n    return Players[p.ply].editing\n  end\nend\n--Clears the editing value to allow other objects to gain control of editing.\nfunction APIclearEditing(p)\n  if p.obj ~= nil then\n    EncodedObjects[p.obj.getGUID()].editing = nil\n  else\n    Players[p.ply].editing = nil\n  end\nend\n--Builds the card buttons for all enabled properties.\nfunction APIrebuildButtons(p)\n  if p.obj ~= nil then\n    buildButtons(p.obj)\n  else\n    updateXML(p.ply)\n  end\nend\nfunction APIformatButton(p)\n  return updateSize(p.str,p.font_size,p.max_len,p.xJust,p.yJust)\nend\n--Flips which side of the card the buttons show up on.\nfunction APIFlip(p)\n  flipMenu(p.obj,p.flip)\nend\n--Returns which side the menu is currently on.\nfunction APIgetFlip(p)\n  return EncodedObjects[p.obj.getGUID()].flip\nend\n\n\n--MISC FUNCTIONS\nfunction APIdisableEncoding(p)\n  if EncodedObjects[p.obj.getGUID()] ~= nil then\n    EncodedObjects[p.obj.getGUID()].disable = true\n    p.obj.clearButtons()\n    p.obj.clearInputs()\n  end\nend\nfunction APIenableEncoding(p)\n  if EncodedObjects[p.obj.getGUID()] ~= nil then\n    EncodedObjects[p.obj.getGUID()].disable = false\n\t\tbuildButtons(p.obj)\n  end\nend\nfunction APIobjGetOName(p)\n\treturn EncodedObjects[p.obj.getGUID()].oName\nend\nfunction APIobjGetODesc(p)\n\treturn EncodedObjects[p.obj.getGUID()].oDesc\nend\n\n--Compares two version strings '###.##.###.##' which is made up of any number of digits and periods.\nfunction APIversionComp(p)\n  return versionComp(p.wv,p.cv)\nend\n\n--CLEANUP\nfunction APIremoveProperty(p)\n  Properties[p.propID] = nil\n\t--updateUI()\nend\n\n\n-- Tool Functions\nfunction deepcopy(orig)\n    local orig_type = type(orig)\n    local copy\n    if orig_type == 'table' then\n        copy = {}\n        for orig_key, orig_value in next, orig, nil do\n            copy[deepcopy(orig_key)] = deepcopy(orig_value)\n        end\n        setmetatable(copy, deepcopy(getmetatable(orig)))\n    else -- number, string, boolean, etc\n        copy = orig\n    end\n    return copy\nend\n\nfunction garbageCollect()\n  for k,v in pairs(EncodedObjects) do\n    if v.this == nil then\n      if getObjectFromGUID(k) == nil then\n        EncodedObjects[k] = nil\n      end\n    end\n  end\n  for k,v in pairs(Properties) do\n    if v.funcOwner == nil then\n      Properties[k] = nil\n    end\n  end\n  for k,v in pairs(Zones) do\n    if v.funcOwner == nil then\n      Zones[k] = nil\n    end\n  end\n  for k,v in pairs(Menus) do\n    if v.funcOwner == nil then\n      Menus[k] = nil\n    end\n  end\nend",
      "LuaScriptState": "{\"cards\":{\"3afac6\":\"{\\\"disable\\\":true,\\\"encoded\\\":{\\\"cyberpunk-card-menu\\\":true},\\\"flip\\\":1,\\\"menus\\\":{\\\"πMenu\\\":{\\\"open\\\":true,\\\"pos\\\":0}},\\\"oDesc\\\":\\\"\\\",\\\"oName\\\":\\\"Quick Actions Panel\\\",\\\"this\\\":\\\"\\\",\\\"values\\\":{\\\"cyberpunk_cards_equipped\\\":[],\\\"cyberpunk_equipped_spawns\\\":[],\\\"cyberpunk_might\\\":{\\\"gear_might_delta\\\":0,\\\"temp_might_delta\\\":0}}}\",\"e6da45\":\"{\\\"disable\\\":true,\\\"encoded\\\":{\\\"cyberpunk-card-menu\\\":true},\\\"flip\\\":1,\\\"menus\\\":{\\\"πMenu\\\":{\\\"open\\\":true,\\\"pos\\\":0}},\\\"oDesc\\\":\\\"\\\",\\\"oName\\\":\\\"Quick Actions Panel\\\",\\\"this\\\":\\\"\\\",\\\"values\\\":{\\\"cyberpunk_cards_equipped\\\":[],\\\"cyberpunk_equipped_spawns\\\":[],\\\"cyberpunk_might\\\":{\\\"gear_might_delta\\\":0,\\\"temp_might_delta\\\":0}}}\"},\"menus\":{\"πMenu\":\"{\\\"activateFunc\\\":\\\"createMenu\\\",\\\"funcOwner\\\":\\\"c369d7\\\",\\\"menuID\\\":\\\"πMenu\\\",\\\"visible_in_hand\\\":1}\"},\"players\":\"{\\\"Black\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Black\\\",\\\"values\\\":[]},\\\"Blue\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Blue\\\",\\\"values\\\":[]},\\\"Brown\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Brown\\\",\\\"values\\\":[]},\\\"Green\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Green\\\",\\\"values\\\":[]},\\\"Grey\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Grey\\\",\\\"values\\\":[]},\\\"Orange\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Orange\\\",\\\"values\\\":[]},\\\"Pink\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Pink\\\",\\\"values\\\":[]},\\\"Purple\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Purple\\\",\\\"values\\\":[]},\\\"Red\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Red\\\",\\\"values\\\":[]},\\\"Teal\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Teal\\\",\\\"values\\\":[]},\\\"White\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"White\\\",\\\"values\\\":[]},\\\"Yellow\\\":{\\\"encoded\\\":[],\\\"menus\\\":[],\\\"style\\\":\\\"basic\\\",\\\"this\\\":\\\"Yellow\\\",\\\"values\\\":[]}}\",\"properties\":{\"GA_Suppress\":\"{\\\"activateFunc\\\":\\\"suppress\\\",\\\"funcOwner\\\":\\\"c2df33\\\",\\\"name\\\":\\\"Banished\\\",\\\"propID\\\":\\\"GA_Suppress\\\",\\\"tags\\\":\\\"tool,face_prop\\\",\\\"values\\\":[\\\"ga_suppressed\\\"]}\",\"moon-mtg-equip\":\"{\\\"activateFunc\\\":\\\"\\\",\\\"funcOwner\\\":\\\"7deec9\\\",\\\"name\\\":\\\"Manage Equipment\\\",\\\"propID\\\":\\\"moon-mtg-equip\\\",\\\"tags\\\":\\\"basic,counter\\\",\\\"values\\\":[\\\"moon_mtg_equip\\\"],\\\"visible\\\":false,\\\"visible_in_hand\\\":0}\",\"cyberpunk-card-menu\":\"{\\\"activateFunc\\\":\\\"\\\",\\\"funcOwner\\\":\\\"7deec9\\\",\\\"name\\\":\\\"Card Menu\\\",\\\"propID\\\":\\\"cyberpunk-card-menu\\\",\\\"tags\\\":\\\"basic,counter\\\",\\\"values\\\":[\\\"cyberpunk_might\\\",\\\"cyberpunk_cards_equipped\\\",\\\"cyberpunk_equipped_spawns\\\"],\\\"visible\\\":false,\\\"visible_in_hand\\\":0}\",\"πCounter\":\"{\\\"activateFunc\\\":\\\"toggleProp\\\",\\\"funcOwner\\\":\\\"def0af\\\",\\\"name\\\":\\\"Counter[sup][i]π[/i][/sup]\\\",\\\"propID\\\":\\\"πCounter\\\",\\\"tags\\\":\\\"basic\\\",\\\"values\\\":[\\\"picounter\\\"]}\",\"πGlimpse\":\"{\\\"activateFunc\\\":\\\"toggleProp\\\",\\\"funcOwner\\\":\\\"de4346\\\",\\\"name\\\":\\\"Scry Module\\\",\\\"propID\\\":\\\"πGlimpse\\\",\\\"tags\\\":\\\"tool,table_tool\\\",\\\"values\\\":[],\\\"visible\\\":false,\\\"visible_in_hand\\\":2}\",\"πotepad\":\"{\\\"activateFunc\\\":\\\"toggleProp\\\",\\\"funcOwner\\\":\\\"7a0067\\\",\\\"name\\\":\\\"Notepad[sup][i]π[/i][/sup]\\\",\\\"propID\\\":\\\"πotepad\\\",\\\"tags\\\":\\\"tool\\\",\\\"values\\\":[\\\"note\\\"],\\\"visible_in_hand\\\":1}\",\"πScry\":\"{\\\"activateFunc\\\":\\\"toggleProp\\\",\\\"funcOwner\\\":\\\"de4346\\\",\\\"name\\\":\\\"Scry Module\\\",\\\"propID\\\":\\\"πScry\\\",\\\"tags\\\":\\\"tool,table_tool\\\",\\\"values\\\":[],\\\"visible\\\":false,\\\"visible_in_hand\\\":2}\"},\"values\":{\"activeIcons\":\"{\\\"default\\\":[],\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"nil\\\"}\",\"activeMode\":\"{\\\"default\\\":\\\"mtg_faceDownCreature\\\",\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"string\\\"}\",\"cardDesc\":\"{\\\"default\\\":\\\"Morphin' Time Error\\\",\\\"desc\\\":\\\"save a cards description here\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"string\\\"}\",\"cardName\":\"{\\\"default\\\":\\\"Morphin' Time Error\\\",\\\"desc\\\":\\\"save a cards name here\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"string\\\"}\",\"ga_suppressed\":\"{\\\"default\\\":false,\\\"desc\\\":\\\"GA: Is the card suppressed?.\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"boolean\\\"}\",\"iconLayout\":\"{\\\"default\\\":\\\"art\\\",\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"string\\\"}\",\"iconMenuOn\":\"{\\\"default\\\":false,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"boolean\\\"}\",\"moon_mtg_equip\":\"{\\\"default\\\":[],\\\"desc\\\":\\\"who up describing they values (when are these ever used)\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"nil\\\"}\",\"mtg_colors\":\"{\\\"default\\\":\\\"\\\",\\\"desc\\\":\\\"MTG:Color Identity of the card.\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"pattern(^[wubrg]*$)\\\"}\",\"mtg_deathtouchcounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_defendercounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_doublestrikecounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_exert\":\"{\\\"default\\\":false,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"boolean\\\"}\",\"mtg_firststrikecounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_flyingcounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_frozen\":\"{\\\"default\\\":false,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"boolean\\\"}\",\"mtg_hastecounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_hexproofcounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_indestructiblecounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_lifelinkcounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_menacecounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_monstrous\":\"{\\\"default\\\":false,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"boolean\\\"}\",\"mtg_reachcounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_renowned\":\"{\\\"default\\\":false,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"boolean\\\"}\",\"mtg_stuncounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_suspendcounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_token\":\"{\\\"default\\\":false,\\\"desc\\\":\\\"MTG:is this a token? Tokens are non-card permanents.\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"boolean\\\"}\",\"mtg_tramplecounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"mtg_vigilancecounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"note\":\"{\\\"default\\\":{\\\"editON\\\":true,\\\"text\\\":\\\"\\\"},\\\"desc\\\":\\\"Write whatever you want onto the card\\\",\\\"validate\\\":\\\"\\\"}\",\"obj_owner\":\"{\\\"default\\\":\\\"Grey\\\",\\\"desc\\\":\\\"Who owns this object.\\\",\\\"validate\\\":\\\"\\\"}\",\"picounter\":\"{\\\"default\\\":0,\\\"desc\\\":\\\"it's a big counter\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"number\\\"}\",\"cyberpunk_card_menu_active\":\"{\\\"default\\\":[],\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"nil\\\"}\",\"cyberpunk_cards_equipped\":\"{\\\"default\\\":[],\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"nil\\\"}\",\"cyberpunk_equipped_spawns\":\"{\\\"default\\\":[],\\\"desc\\\":\\\"Cached GMNotes.spawn of equipped cards\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"nil\\\"}\",\"cyberpunk_might\":\"{\\\"default\\\":[],\\\"desc\\\":\\\"\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"nil\\\"}\",\"subMenuOpen\":\"{\\\"default\\\":false,\\\"desc\\\":\\\"is the sub menu open\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"boolean\\\"}\",\"tyrantUnified\":\"{\\\"default\\\":{\\\"activeFace\\\":1,\\\"cardFaces\\\":[{\\\"basePower\\\":0,\\\"baseToughness\\\":0,\\\"isPlaneswalker\\\":false,\\\"pwAbilities\\\":[],\\\"pwCount\\\":0},{\\\"basePower\\\":0,\\\"baseToughness\\\":0,\\\"isPlaneswalker\\\":false,\\\"pwAbilities\\\":[],\\\"pwCount\\\":0}],\\\"controllerColor\\\":\\\"Grey\\\",\\\"displayCounters\\\":false,\\\"displayDFC\\\":false,\\\"displayOwnership\\\":true,\\\"displayPlaneswalkerAbilities\\\":false,\\\"displayPlusOne\\\":false,\\\"displayPowTou\\\":false,\\\"doubleFaceStates\\\":false,\\\"doubleFaceType\\\":\\\"none\\\",\\\"exactCopyOffset\\\":0,\\\"hasNonLoyaltyCounter\\\":false,\\\"hasParsed\\\":false,\\\"namedCounters\\\":0,\\\"ownerColor\\\":\\\"Grey\\\",\\\"plusOneCounters\\\":0,\\\"power\\\":0,\\\"toughness\\\":0},\\\"desc\\\":\\\"why do my values have descriptions\\\",\\\"validate\\\":\\\"\\\",\\\"validType\\\":\\\"nil\\\"}\"},\"zones\":{\"2c30da\":\"{\\\"color\\\":\\\"Purple\\\",\\\"func_enter\\\":\\\"hideCardDetails\\\",\\\"func_leave\\\":\\\"showCardDetails\\\",\\\"funcOwner\\\":\\\"02e062\\\",\\\"name\\\":\\\"Purple_1\\\"}\",\"32941e\":\"{\\\"color\\\":\\\"Blue\\\",\\\"func_enter\\\":\\\"hideCardDetails\\\",\\\"func_leave\\\":\\\"showCardDetails\\\",\\\"funcOwner\\\":\\\"02e062\\\",\\\"name\\\":\\\"Blue_1\\\"}\",\"6b7af4\":\"{\\\"color\\\":\\\"Purple\\\",\\\"func_enter\\\":\\\"hideCardDetails\\\",\\\"func_leave\\\":\\\"showCardDetails\\\",\\\"funcOwner\\\":\\\"02e062\\\",\\\"name\\\":\\\"Purple_2\\\"}\",\"7b7b42\":\"{\\\"color\\\":\\\"Red\\\",\\\"func_enter\\\":\\\"hideCardDetails\\\",\\\"func_leave\\\":\\\"showCardDetails\\\",\\\"funcOwner\\\":\\\"02e062\\\",\\\"name\\\":\\\"Red_2\\\"}\",\"9e87d8\":\"{\\\"color\\\":\\\"Red\\\",\\\"func_enter\\\":\\\"hideCardDetails\\\",\\\"func_leave\\\":\\\"showCardDetails\\\",\\\"funcOwner\\\":\\\"02e062\\\",\\\"name\\\":\\\"Red_1\\\"}\",\"c6b5a0\":\"{\\\"color\\\":\\\"Green\\\",\\\"func_enter\\\":\\\"hideCardDetails\\\",\\\"func_leave\\\":\\\"showCardDetails\\\",\\\"funcOwner\\\":\\\"02e062\\\",\\\"name\\\":\\\"Green_1\\\"}\",\"d45d18\":\"{\\\"color\\\":\\\"Blue\\\",\\\"func_enter\\\":\\\"hideCardDetails\\\",\\\"func_leave\\\":\\\"showCardDetails\\\",\\\"funcOwner\\\":\\\"02e062\\\",\\\"name\\\":\\\"Blue_2\\\"}\",\"fab8ed\":\"{\\\"color\\\":\\\"Green\\\",\\\"func_enter\\\":\\\"hideCardDetails\\\",\\\"func_leave\\\":\\\"showCardDetails\\\",\\\"funcOwner\\\":\\\"02e062\\\",\\\"name\\\":\\\"Green_2\\\"}\"}}",
      "AttachedDecals": [
        {
          "Transform": {
            "posX": 0.001930126,
            "posY": 0.08080203,
            "posZ": -0.009992131,
            "rotX": 90.0,
            "rotY": 0.3445205,
            "rotZ": 0.0,
            "scaleX": 1.31226742,
            "scaleY": 1.31226838,
            "scaleZ": 1.00943685
          },
          "CustomDecal": {
            "Name": "Encoder Icon",
            "ImageURL": "https://drive.google.com/uc?export=download&id=1hRPLfnEkqUS7uhinjpJ2IrU9BOJ6UqON",
            "Size": 1.0
          },
          "OwnerSteamID": 0
        }
      ]
    },
    {
      "GUID": "de4346",
      "Name": "PiecePack_Arms",
      "Transform": {
        "posX": -46.75,
        "posY": -5.75,
        "posZ": 2.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 0.629999757,
        "scaleY": 0.629999757,
        "scaleZ": 0.629999757
      },
      "Nickname": "πGlimpse",
      "Description": "",
      "GMNotes": "",
      "Memo": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "pID = \"πGlimpse\"\r\nversion = 3.14159\r\n\r\nfunction onload()\r\n  self.createButton({\r\n    click_function='registerModule', function_owner=self, label='[i]'..pID..'[/i]', tooltip='register '..pID,\r\n    position={0,0.1,0}, rotation={0,0,0}, scale={0.5,1,0.5},\r\n    height=250, width=700, font_size=150,  color={0.1,0.1,0.1,1}, font_color={1,1,1,1},\r\n  })\r\n  Wait.condition(registerModule,function() return Global.getVar('Encoder') ~= nil and true or false end)\r\nend\r\n\r\nfunction registerModule()\r\n  enc = Global.getVar('Encoder')\r\n  tableGUIDs = Global.getTable('data')\r\n  if enc ~= nil then\r\n\t\tproperties = {\r\n      propID = pID,\r\n      name = \"Scry Module\",\r\n      values = {},\r\n      funcOwner = self,\r\n      tags=\"tool,table_tool\",\r\n      activateFunc ='toggleProp',\r\n      visible=false,\r\n      visible_in_hand=2\r\n\t\t}\r\n\t\tenc.call(\"APIregisterProperty\",properties)\r\n  end\r\nend\r\n\r\nfunction toggleProp(obj,ply)\r\n  enc.call(\"APItoggleProperty\",{obj=obj,propID=pID})\r\n  enc.call(\"APIrebuildButtons\",{obj=obj})\r\nend\r\n\r\n-- disable scry buttons when leaving hand 2\r\n function onObjectLeaveZone(zone,obj)\r\n   if obj==nil then return end --wtf? how can this happen? but it does\r\n   if obj.type~=\"Card\" then return end\r\n   enc = Global.getVar('Encoder')\r\n   if enc then\r\n     Zones=enc.call(\"APIlistZones\",{})\r\n     encZone=Zones[zone.getGUID()]\r\n     if encZone then\r\n       isHand2=encZone.name:find('Hand 2')\r\n       if isHand2 then\r\n         -- using GMnotes as a scry-zone flag (in case the object is just passing through the scry zone)\r\n         if obj.getGMNotes()=='scryEnter' then obj.setGMNotes('') end\r\n         -- check that the object is encoded\r\n         if not(enc.call(\"APIobjectExists\",{obj=obj})) then return end\r\n         -- if encoded and scry is enabled, disable it\r\n         if enc.call(\"APIobjIsPropEnabled\",{obj=obj,propID=pID}) then\r\n           enc.call(\"APIobjDisableProp\",{obj=obj,propID=pID})\r\n         end\r\n       end\r\n     end\r\n   end\r\n end\r\n\r\nfunction onObjectDestroy(obj)\r\n  pcall(function()\r\n    if obj==nil then return end --wtf? how can this happen? but it does\r\n    enc = Global.getVar('Encoder')\r\n    if obj.type~=\"Card\" or enc==nil then return end\r\n    if enc.call(\"APIobjIsPropEnabled\",{obj=obj,propID=pID}) then\r\n      enc.call(\"APIobjDisableProp\",{obj=obj,propID=pID})\r\n    end\r\n  end)\r\nend\r\n\r\n-- disable scry if the card lands on the table (height < 2)\r\nfunction onObjectDrop(ply,obj)\r\n  if obj==nil then return end --wtf? how can this happen? but it does\r\n  if obj.type~=\"Card\" then return end\r\n  enc = Global.getVar('Encoder')\r\n  if enc==nil then return end\r\n  if not(enc.call(\"APIobjIsPropEnabled\",{obj=obj,propID=pID})) then return end\r\n\r\n  local inHand2=false\r\n  if obj==nil then return end\r\n  for _,col in pairs(Player.getAvailableColors()) do\r\n    local handObjs=Player[col].getHandObjects(2)\r\n    for _,handObj in pairs(handObjs) do\r\n      if obj==handObj then\r\n        inHand2=true\r\n      end\r\n    end\r\n  end\r\n  if not inHand2 then\r\n    enc.call(\"APIobjDisableProp\",{obj=obj,propID=pID})\r\n    enc.call(\"APIrebuildButtons\",{obj=obj})\r\n  end\r\nend\r\n\r\nfunction createButtons(t)\r\n  card=t.obj\r\n  if card==nil then return end\r\n\r\n  local backpars={    -- background frame\r\n    label='', tooltip='', click_function = 'null', function_owner = self,\r\n    position = {0, 0, 0}, width = 500, height = 400, font_size = 250,\r\n    scale = {1.25,1.25,1.25}, rotation = {0,0,180},\r\n    color = {0.7,0.7,0.7}, font_color = {1, 1, 1},\r\n  }\r\n  local forgpars={    -- foreground button with label\r\n    label='', tooltip='', click_function = 'null', function_owner = self,\r\n    position = {0, 0, 0}, width = 500, height = 400, font_size = 250,\r\n    scale = {1.2,1.2,1.2}, rotation = {0,0,0},\r\n    color = {0.16,0.16,0.16}, font_color = {1, 1, 1, 1}, hover_color = {0.4,0.4,0.4}\r\n  }\r\n\r\n  local lab='▲'\r\n  local tip='to top deck'\r\n  local fun='move2TopLib'\r\n  local pos={-0.4, 0.1, -3}\r\n  forgpars.label=lab\r\n  forgpars.tooltip=tip\r\n  forgpars.click_function=fun\r\n  forgpars.position=pos\r\n  backpars.position=pos\r\n  card.createButton(backpars)\r\n  card.createButton(forgpars)\r\n\r\n  local lab='▼'\r\n  local tip='to bottom deck'\r\n  local fun='move2BotLib'\r\n  local pos={-0.4, 0.1, -2}\r\n  forgpars.label=lab\r\n  forgpars.tooltip=tip\r\n  forgpars.click_function=fun\r\n  forgpars.position=pos\r\n  backpars.position=pos\r\n  card.createButton(backpars)\r\n  card.createButton(forgpars)\r\n\r\n  local lab='☠'\r\n  local tip='move to graveyard'\r\n  local fun='move2Grav'\r\n  local pos={-0.4, 0.1, 2}\r\n  forgpars.label=lab\r\n  forgpars.tooltip=tip\r\n  forgpars.click_function=fun\r\n  forgpars.position=pos\r\n  backpars.position=pos\r\n  card.createButton(backpars)\r\n  card.createButton(forgpars)\r\nend\r\n\r\nfunction move2Lib(card, playerColor, alt)\r\n  if not(alt) then\r\n    move2TopLib(card,playerColor)\r\n  else\r\n    move2BotLib(card,playerColor)\r\n  end\r\nend\r\n\r\nfunction move2TopLib(card, playerColor)\r\n  enc = Global.getVar('Encoder')\r\n  enc.call(\"APIobjDisableProp\",{obj=card,propID=pID})\r\n  local deck = Global.call(\"findPlayerDeckByNameRemote\", { playerColor, \"main\" })\r\n  local deckPos = deck.getPosition()\r\n  local target = {x=deckPos.x, y=deckPos.y+3, z=deckPos.z}    -- above deck\r\n  card.clearButtons()\r\n  card.setHiddenFrom(allBut(playerColor))\r\n  Wait.time(function() unhide(card) end, 0.2)\r\n  local cardRot = card.getRotation()\r\n  cardRot.z = 180\r\n  card.setRotationSmooth(cardRot,false,true)\r\n  Wait.time(function() handTrigger(card) card.setPositionSmooth(target,false,true) end, 0.2)\r\n  Wait.time(function() checkMoveSuccess(card,target,playerColor) end, 0.5)\r\n\r\n  selected = Player[playerColor].getSelectedObjects()\r\n  for i,obj in ipairs(shuffleList(selected)) do\r\n    if enc.call(\"APIobjIsPropEnabled\",{obj=obj,propID=pID}) then\r\n      Wait.frames(function() move2TopLib(obj, playerColor) end,i)\r\n    end\r\n  end\r\n  Player[playerColor].clearSelectedObjects()\r\n\r\nend\r\n\r\nfunction move2BotLib(card, playerColor)\r\n  enc = Global.getVar('Encoder')\r\n  enc.call(\"APIobjDisableProp\",{obj=card,propID=pID})\r\n  local deck = Global.call(\"findPlayerDeckByNameRemote\", { playerColor, \"main\" })\r\n  local deckPos = deck.getPosition()\r\n  local target  = {x=deckPos.x, y=1.1, z=deckPos.z}\r\n  card.clearButtons()\r\n  card.setHiddenFrom(allBut(playerColor))\r\n  Wait.time(function() unhide(card) end, 0.2)\r\n  local cardRot = card.getRotation()\r\n  cardRot.z = 180\r\n  card.setRotationSmooth(cardRot,false,true)\r\n  Wait.time(function() handTrigger(card) card.setPositionSmooth(target,false,true) end, 0.2)\r\n  Wait.time(function() checkMoveSuccess(card,target,playerColor) end, 0.5)\r\n\r\n  selected = Player[playerColor].getSelectedObjects()\r\n  for i,obj in ipairs(shuffleList(selected)) do\r\n    if enc.call(\"APIobjIsPropEnabled\",{obj=obj,propID=pID}) then\r\n      Wait.frames(function() move2BotLib(obj, playerColor) end, i)\r\n    end\r\n  end\r\n  Player[playerColor].clearSelectedObjects()\r\nend\r\n\r\nfunction move2Grav(card, playerColor)\r\n  enc = Global.getVar('Encoder')\r\n  enc.call(\"APIobjDisableProp\",{obj=card,propID=pID})\r\n  local gravPos = Global.call(\"findPlayerZoneByNameRemote\", { playerColor, \"graveyard\" })\r\n  local target  = {x=gravPos.x, y=3, z=gravPos.z}\r\n  card.clearButtons()\r\n  local cardRot = card.getRotation()\r\n  cardRot.z = 0\r\n  card.setRotationSmooth(cardRot,false,true)\r\n  Wait.time(function() handTrigger(card) card.setPositionSmooth(target,false,true) end, 0.2)\r\n  Wait.time(function() checkMoveSuccess(card,target,playerColor) end, 0.5)\r\n\r\n  selected = Player[playerColor].getSelectedObjects()\r\n  for i,obj in ipairs(shuffleList(selected)) do\r\n    if enc.call(\"APIobjIsPropEnabled\",{obj=obj,propID=pID}) then\r\n      Wait.frames(function() move2Grav(obj, playerColor) end, i)\r\n    end\r\n  end\r\n  Player[playerColor].clearSelectedObjects()\r\nend\r\n\r\nfunction shuffleList(list)\r\n  math.randomseed(os.time())\r\n\tfor i = #list, 2, -1 do\r\n\t\tlocal j = math.random(i)\r\n\t\tlist[i], list[j] = list[j], list[i]\r\n\tend\r\n  return list\r\nend\r\n\r\n-- for hiding cards\r\nfunction allBut(playerColor)\r\n  local players = {}\r\n  for key, color in pairs(Color.list) do\r\n    if color ~= playerColor then\r\n      table.insert(players,color)\r\n    end\r\n  end\r\n  return players\r\nend\r\nfunction unhide(card,nframes)\r\n  if card~=nil then\r\n    card.setHiddenFrom({})\r\n  end\r\nend\r\n\r\n-- when returning cards from the scry-zone, turn off hand-zone's pull briefly\r\nfunction handTrigger(obj)\r\n  if obj~=nil then\r\n    obj.use_hands=false\r\n    Wait.time(function() handOn(obj) end, 0.1)\r\n  end\r\nend\r\nfunction handOn(obj)\r\n  if obj~=nil then\r\n    obj.use_hands=true\r\n  end\r\nend\r\n\r\n-- check that the card made it to it's target, if not, teleport it\r\nfunction checkMoveSuccess(card,targetPos,playerColor)\r\n  if card==nil then return end   -- the card is gone, probably stacked into a deck already\r\n  -- use hands orientation to determine which coordinate to use to check position\r\n  -- currently only set up to work with hands rotated 0,90,180,270 degrees\r\n  local handForw=Player[playerColor].getHandTransform(2).forward\r\n  local posDiff = 0\r\n  if math.abs(handForw.z)>0.5 then\r\n    posDiff = math.abs(card.getPosition().z - targetPos.z)\r\n  elseif math.abs(handForw.x)>0.5 then\r\n    posDiff = math.abs(card.getPosition().x - targetPos.x)\r\n  end\r\n  if posDiff>1 then\r\n    card.setPosition(targetPos)\r\n  end\r\nend",
      "LuaScriptState": "",
      "AttachedDecals": [
        {
          "Transform": {
            "posX": 0.0,
            "posY": 0.083,
            "posZ": -0.35,
            "rotX": 90.0,
            "rotY": 180.0,
            "rotZ": 0.0,
            "scaleX": 1.75,
            "scaleY": 1.75,
            "scaleZ": 1.75
          },
          "CustomDecal": {
            "Name": "pi",
            "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/1661232230975361286/3CF5E2DD99194550D4F60636711E73363BA610F9/",
            "Size": 1.0
          },
          "OwnerSteamID": 0
        }
      ]
    },
    {
      "GUID": "c369d7",
      "Name": "PiecePack_Arms",
      "Transform": {
        "posX": -46.75,
        "posY": -4.25,
        "posZ": 2.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 0.629999757,
        "scaleY": 0.629999757,
        "scaleZ": 0.629999757
      },
      "Nickname": "πMenu",
      "Description": "",
      "GMNotes": "",
      "Memo": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "--[[πMenu\r\nall props on one side\r\n<<< open menu button along the top edge of card\r\n]]\r\n\r\n--[[Basic Menu\r\nby Tipsy Hobbit//STEAM_0:1:13465982\r\nThe basic menu style, default for the encoder.\r\nIf no menu has been registered, then the encoder will spawn this from the github.\r\n]]\r\npID=\"πMenu\"\r\nversion = '3.14159'\r\n\r\n-- Amaranth charWidth table ripped from https://gist.github.com/tjakubo2/7b6248e765163ffcf9963ab1f59f3e18\r\ncharWidth = {\r\n        ['`'] = 2381, ['~'] = 2381, ['1'] = 1724, ['!'] = 1493, ['2'] = 2381,\r\n        ['@'] = 4348, ['3'] = 2381, ['#'] = 3030, ['4'] = 2564, ['$'] = 2381,\r\n        ['5'] = 2381, ['%'] = 3846, ['6'] = 2564, ['^'] = 2564, ['7'] = 2174,\r\n        ['&'] = 2777, ['8'] = 2564, ['*'] = 2174, ['9'] = 2564, ['('] = 1724,\r\n        ['0'] = 2564, [')'] = 1724, ['-'] = 1724, ['_'] = 2381, ['='] = 2381,\r\n        ['+'] = 2381, ['q'] = 2564, ['Q'] = 3226, ['w'] = 3704, ['W'] = 4167,\r\n        ['e'] = 2174, ['E'] = 2381, ['r'] = 1724, ['R'] = 2777, ['t'] = 1724,\r\n        ['T'] = 2381, ['y'] = 2564, ['Y'] = 2564, ['u'] = 2564, ['U'] = 3030,\r\n        ['i'] = 1282, ['I'] = 1282, ['o'] = 2381, ['O'] = 3226, ['p'] = 2564,\r\n        ['P'] = 2564, ['['] = 1724, ['{'] = 1724, [']'] = 1724, ['}'] = 1724,\r\n        ['|'] = 1493, ['\\\\']= 1923, ['a'] = 2564, ['A'] = 2777, ['s'] = 1923,\r\n        ['S'] = 2381, ['d'] = 2564, ['D'] = 3030, ['f'] = 1724, ['F'] = 2381,\r\n        ['g'] = 2564, ['G'] = 2777, ['h'] = 2564, ['H'] = 3030, ['j'] = 1075,\r\n        ['J'] = 1282, ['k'] = 2381, ['K'] = 2777, ['l'] = 1282, ['L'] = 2174,\r\n        [';'] = 1282, [':'] = 1282, ['\\''] = 855, ['\"'] = 1724, ['z'] = 1923,\r\n        ['Z'] = 2564, ['x'] = 2381, ['X'] = 2777, ['c'] = 1923, ['C'] = 2564,\r\n        ['v'] = 2564, ['V'] = 2777, ['b'] = 2564, ['B'] = 2564, ['n'] = 2564,\r\n        ['N'] = 3226, ['m'] = 3846, ['M'] = 3846, [','] = 1282, ['<'] = 2174,\r\n        ['.'] = 1282, ['>'] = 2174, ['/'] = 1923, ['?'] = 2174, [' '] = 1282,\r\n        ['avg'] = 2500\r\n    }\r\n-- Get real string width as per char table\r\nfunction GetStringWidth(str)\r\n    local len = 0\r\n    for i = 1, #str do\r\n        local c = str:sub(i,i)\r\n        len = len + (charWidth[c] or charWidth.avg)\r\n    end\r\n    return len\r\nend\r\n\r\n-- spent an hour trying to find the pattern to go from len to correct button width\r\n-- it changes with scale...\r\nscales = { 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1}\r\nscaleR = {6143,4730,4730,4725,4760,4740,4784,4856,4685,4623}\r\n-- ^^^ WHAT THE HELL IS THE PATTERN HERE?! no pattern, kinda messed up? ^^^\r\nscaleI = 5\r\nxScale=scales[scaleI]\r\ngetWidthOffset = function(str,align,fSize,xScale)\r\n  local width  = GetStringWidth(str)/scaleR[scaleI]*fSize+100/scales[scaleI]\r\n  local offset = width*xScale*align/2/480.8\r\n  return width,offset\r\nend\r\n\r\nfunction onload()\r\n  Global.setVar('GA_Menu',self)\r\n  Wait.condition(registerModule,function() return Global.getVar('Encoder') ~= nil and true or false end)\r\n  self.createButton({\r\n    click_function='registerModule', function_owner=self, label='[i]'..pID..'[/i]', tooltip='register '..pID,\r\n    position={0,0.1,0}, rotation={0,0,0}, scale={0.5,1,0.5},\r\n    height=250, width=600, font_size=150,  color={0.1,0.1,0.1,1}, font_color={1,1,1,1},\r\n  })\r\nend\r\n\r\nfunction registerModule()\r\n  enc = Global.getVar('Encoder')\r\n\r\n  if enc ~= nil then\r\n    menu={\r\n      menuID=pID,\r\n      funcOwner=self,\r\n      activateFunc='createMenu',\r\n      visible_in_hand=1\r\n    }\r\n    enc.call(\"APIregisterMenu\",menu)\r\n\r\n    Style = {}\r\n    Style.proto = {\r\n      scale={xScale,1,xScale},\r\n      height=1200*0.1/xScale,\r\n      font_size=1000*0.1/xScale,\r\n      color={0.1,0.1,0.1,1},\r\n      font_color={1,1,1,1}\r\n    }\r\n\r\n    Style.mt = {}\r\n    Style.mt.__index = Style.proto\r\n    function Style.new(o)\r\n      for k,v in pairs(Style.proto) do\r\n        if o[k] == nil then\r\n          o[k] = v\r\n        end\r\n      end\r\n      return o\r\n    end\r\n  end\r\nend\r\n\r\nfunction createMenu(t)\r\n\r\n  if Style==nil then\r\n    registerModule()\r\n  end\r\n\r\n  local o = t.obj\r\n  enc = Global.getVar('Encoder')\r\n  if enc ~= nil then\r\n    local flip = enc.call(\"APIgetFlip\",{obj=o})\r\n    local scaler = {x=1,y=1,z=1}--o.getScale()\r\n    local zpos =  0.3*flip\r\n    local xpos = -1.1*flip\r\n    local props = enc.call(\"APIgetPropsList\")   -- get ALL props\r\n    md = enc.call(\"APIobjGetMenuData\",{obj=o,menuID=pID})\r\n    if md.open == false then\r\n\r\n      o.createButton(Style.new{     -- black text background for cards with white borders\r\n      label=\"[b]<<<[/b]\", click_function='toggleMenu', function_owner=self,\r\n      position={-0.875*flip,zpos,-1.485}, scale={0.5,1,0.3}, height=0, width=0, font_size=200,\r\n      rotation={0,0,90-90*flip},color={0,0,0,0},font_color={0,0,0,50}\r\n      })\r\n      o.createButton(Style.new{     -- white text menu button\r\n      label=\"<<<\", click_function='toggleMenu', function_owner=self,\r\n      position={-0.875*flip,zpos,-1.485}, scale={0.5,1,0.3}, height=350, width=450, font_size=200,\r\n      rotation={0,0,90-90*flip},color={0.1,0.1,0.1,0},font_color={1,1,1,50},hover_color={0.1,0.1,0.1,1/50},tooltip=\"Open Menu\"\r\n      })\r\n\r\n    else\r\n\r\n      o.createButton(Style.new{\r\n      label=\">>>\", click_function='toggleMenu', function_owner=self,\r\n      position={-0.875*flip,zpos,-1.485}, scale={0.5,1,0.3}, height=350, width=450, font_size=200,\r\n      rotation={0,0,90-90*flip},color={0.1,0.1,0.1,1},font_color={1,1,1,1},tooltip=\"Close Menu\"\r\n      })\r\n\r\n      local propOrder = {}\r\n      local propOrder = {   -- force a specific menu order by using the first 2 letters of the props name\r\n        ['co']=0,     -- counter\r\n        ['no']=2,     -- notepad\r\n        ['ke']=2,     -- keywords\r\n        ['im']=3,     -- importer\r\n        ['su']=4.5,   -- suppression\r\n        ['ma']=5.5,     -- manifest\r\n        ['sp']=6.5,   -- spawn tokens\r\n        ['ga']=8.5,   -- gather\r\n        ['mo']=8.5,     -- morph\r\n      }\r\n\r\n      onProps=enc.call(\"APIobjGetProps\",{obj=o})\r\n\r\n      local nOrder = 0\r\n      for i,v in pairs(propOrder) do\r\n        if v+1>nOrder then nOrder=v+1 end\r\n      end\r\n      local count = 0\r\n      local pos = 0\r\n      for h,j in pairs(props) do\r\n        v = enc.call(\"APIgetProp\",{propID=h})\r\n        if v.funcOwner ~= nil and v.visible ~= false then\r\n\r\n          if onProps[h]==true then\r\n            fColor={1,1,0}\r\n          else\r\n            fColor={1,1,1,0.75}\r\n          end\r\n\r\n          propName = v.name\r\n          propName_repPi = propName:gsub('%[sup%]%[i%]π%[/i%]%[/sup%]','p') -- replace my π with p\r\n          width,xOffset = getWidthOffset(propName_repPi,-1,Style.proto.font_size,Style.proto.scale[1])\r\n\r\n          t2 = propName:sub(1,2):lower()  -- force a specific menu order by using the first 2 letters of the props name\r\n          pos = propOrder[t2]\r\n          if pos==nil then pos=nOrder+count; count=count+1 end\r\n\r\n          o.createButton(Style.new{\r\n          label=propName, click_function=v.activateFunc, function_owner=v.funcOwner,\r\n          position={xpos+xOffset*2*flip,zpos,-1.4+pos*0.25}, rotation={0,0,90-90*flip}, width=width*2,\r\n          font_color=fColor, height=450, font_size=400\r\n          })\r\n\r\n        end\r\n      end\r\n\r\n      if nOrder+count<10 then count=10-nOrder end -- if small amount of props, keep flip menu and disable encoding at the bottom of card\r\n\r\n      propName = \"Flip Menu\"\r\n      width,xOffset = getWidthOffset(propName,-1,Style.proto.font_size,Style.proto.scale[1])\r\n      pos=nOrder+count; count=count+1\r\n      o.createButton(Style.new{\r\n      label=propName, click_function='piFlipMenu', function_owner=self, font_color={1,1,1,0.75},\r\n      position={xpos+xOffset*flip,zpos,-1.35+pos*0.25}, rotation={0,0,90-90*flip}, width=width\r\n      })\r\n\r\n      propName = \"Disable Encoding\"\r\n      width,xOffset = getWidthOffset(propName,-1,Style.proto.font_size,Style.proto.scale[1])\r\n      pos=nOrder+count; count=count+1\r\n      o.createButton(Style.new{\r\n      label=propName, click_function='disableEncoding', function_owner=enc, font_color={1,0,0,1},\r\n      position={xpos+xOffset*flip,zpos,-1.35+pos*0.25}, rotation={0,0,90-90*flip}, width=width\r\n      })\r\n\r\n    end\r\n  end\r\nend\r\n\r\nfunction piFlipMenu(o)    -- also flips the object\r\n  enc = Global.getVar('Encoder')\r\n  if enc then\r\n    enc.call('APIFlip',{obj=o})\r\n    o.flip()\r\n  end\r\nend\r\n\r\nfunction toggleMenu(o)\r\n  enc = Global.getVar('Encoder')\r\n  if enc ~= nil then\r\n    enc.call(\"APIobjToggleMenu\",{obj=o,menuID=pID})\r\n    enc.call(\"APIrebuildButtons\",{obj=o})\r\n  end\r\nend\r\n\r\nfunction shutMenu(payload)\r\n  toggleMenu(payload.obj)\r\nend",
      "LuaScriptState": "",
      "AttachedDecals": [
        {
          "Transform": {
            "posX": 0.0,
            "posY": 0.083,
            "posZ": -0.35,
            "rotX": 90.0,
            "rotY": 180.0,
            "rotZ": 0.0,
            "scaleX": 1.75,
            "scaleY": 1.75,
            "scaleZ": 1.75
          },
          "CustomDecal": {
            "Name": "pi",
            "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/1661232230975361286/3CF5E2DD99194550D4F60636711E73363BA610F9/",
            "Size": 1.0
          },
          "OwnerSteamID": 0
        }
      ]
    },
    {
      "GUID": "7a0067",
      "Name": "PiecePack_Arms",
      "Transform": {
        "posX": -46.75,
        "posY": -4.25,
        "posZ": 3.5,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 0.629999757,
        "scaleY": 0.629999757,
        "scaleZ": 0.629999757
      },
      "Nickname": "πNotepad",
      "Description": "",
      "GMNotes": "",
      "Memo": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "-- this thingy has been modified by ��� for his table\n-- if you take it and try to use it AS-IS it might not work and break other stuff on your table\n-- get the vanilla version from the original un-modified mod here, by Tipsy Hobbit:\n-- https://steamcommunity.com/sharedfiles/filedetails/?id=828894732\n-- if you do take my modified version, please let me know\n-- just in case, I might have it set to non-interactable to filter out folks who can't script at all\n\n--Notepad\n--by Tipsy Hobbit//STEAM_0:1:13465982\n--redesigned by pie\n\npID = \"πotepad\"\nversion = 3.14159\n\nfunction onload()\n  self.createButton({\n    click_function='registerModule', function_owner=self, label='[i]'..pID..'[/i]', tooltip='register '..pID,\n    position={0,0.1,0}, rotation={0,0,0}, scale={0.5,1,0.5},\n    height=250, width=700, font_size=150,  color={0.1,0.1,0.1,1}, font_color={1,1,1,1},\n  })\n\n  Wait.condition(registerModule,function() return Global.getVar('Encoder') ~= nil and true or false end)\nend\n\nfunction registerModule()\n  enc = Global.getVar('Encoder')\n  if enc ~= nil then\n\t\tproperties = {\n\t\tpropID = pID,\n\t\tname = \"Notepad[sup][i]π[/i][/sup]\",\n\t\tvalues = {'note'},\n    funcOwner = self,\n\t\ttags='tool',\n\t\tactivateFunc ='toggleProp',\n    visible_in_hand=1\n\t\t}\n\t\tenc.call(\"APIregisterProperty\",properties)\n    value = {\n    valueID = 'note',\n    validType = nil,\n    desc = \"Write whatever you want onto the card\",\n    default = {text='',editON=true}\n    }\n    enc.call(\"APIregisterValue\",value)\n  end\nend\n\nfunction toggleProp(obj,ply)\n  enc.call(\"APItoggleProperty\",{obj=obj,propID=pID})\n  enc.call(\"APIrebuildButtons\",{obj=obj})\n  local ga_menu = Global.getVar('GA_Menu')\n  ga_menu.call(\"shutMenu\", {obj=obj})\nend\n\nfunction createButtons(t)\n  enc = Global.getVar('Encoder')\n  if enc ~= nil then\n    flip = enc.call(\"APIgetFlip\",{obj=t.obj})\n\t\tdata = enc.call(\"APIobjGetPropData\",{obj=t.obj,propID=pID})\n\n    if data.note.editON then\n      ttip = 'Lock Text'\n    else\n      ttip = 'Unlock Text'\n    end\n    t.obj.createButton({\n      click_function='toggleEdit',\n      function_owner=self,\n      label='',\n      position={0.835*flip,0.28*flip,0.275},\n      scale={0.4,1,0.4},\n      width=1250/4,\n      height=950/4,\n      font_size=850/4,\n      color={0.1,0.1,0.1},\n      font_color={1,1,1},\n      tooltip=ttip\n    })\n\n    if data.note.editON then\n\n      t.obj.createButton({      -- toggleEdit button\n        click_function='toggleEdit',\n        function_owner=self,\n        label='✏',\n        position={0.840*flip,0.28*flip,0.27},\n        scale={0.4,1,0.3},\n        rotation={0,225,0},\n        width=0,\n        height=0,\n        font_size=850/4,\n        color={0.1,0.1,0.1},\n        font_color={1,1,1},\n      })\n\n      t.obj.createInput({      -- text input field\n        label=\"\\n\\n\\n\\nenter text here\",\n        input_function='editText',\n        function_owner=self,\n        alignment=3,\n        value=data.note.text,\n        validation=1,\n        tab=3,\n        position={0,0.28*flip,-.95},\n        rotation={0,0,90-90*flip},\n        scale={0.5,0,0.5},\n        height=540,\n        width=1770,\n        font_size=250,\n        color={0.1,0.1,0.1,0.9},\n        font_color={1,1,1,1/0.9},\n      })\n\n    else\n\n      bLabel = insertBreaks(data.note.text)\n\n      t.obj.createButton({      -- the text\n        click_function='null',\n        function_owner=self,\n        label=bLabel,\n        position={0,0.28*flip,-0.838},  -- button needs a small shift relative to input field\n        rotation={0,0,90-90*flip},\n        scale={0.5,0,0.5},\n        height=0,\n        width=0,\n        font_size=250,\n        color={0.1,0.1,0.1,0.9},\n        font_color={1,1,1,1/0.9},\n      })\n\n      t.obj.createButton({      -- toggleEdit button\n        click_function='toggleEdit',\n        function_owner=self,\n        label='✉',\n        position={0.835*flip,0.28*flip,0.295},\n        scale={0.4,1,0.4},\n        width=0,\n        height=0,\n        font_size=850/4,\n        color={0.1,0.1,0.1},\n        font_color={1,1,1}\n      })\n\n    end\n\n  end\nend\n\nfunction toggleEdit(obj,ply)\n  data = enc.call(\"APIobjGetPropData\",{obj=obj,propID=pID})\n  data.note.editON = not data.note.editON\n  enc.call(\"APIobjSetPropData\",{obj=obj,propID=pID,data=data})\n  enc.call(\"APIrebuildButtons\",{obj=obj})\nend\n\nfunction editText(obj,ply,val,sel)\n\tif sel == false then\n\t\tenc = Global.getVar('Encoder')\n\t\tif enc ~= nil then\n\t\t\tdata = enc.call(\"APIobjGetPropData\",{obj=obj,propID=pID})\n\t\t\tdata.note.text = val\n\t\t\tenc.call(\"APIobjSetPropData\",{obj=obj,propID=pID,data=data})\n\t\tend\n\telse\n\t\tlog(val,\"input_text\", \"Notepad\"..obj.getGUID())\n\tend\nend\n\ncharWidth = {\n        ['`'] = 2381, ['~'] = 2381, ['1'] = 1724, ['!'] = 1493, ['2'] = 2381,\n        ['@'] = 4348, ['3'] = 2381, ['#'] = 3030, ['4'] = 2564, ['$'] = 2381,\n        ['5'] = 2381, ['%'] = 3846, ['6'] = 2564, ['^'] = 2564, ['7'] = 2174,\n        ['&'] = 2777, ['8'] = 2564, ['*'] = 2174, ['9'] = 2564, ['('] = 1724,\n        ['0'] = 2564, [')'] = 1724, ['-'] = 1724, ['_'] = 2381, ['='] = 2381,\n        ['+'] = 2381, ['q'] = 2564, ['Q'] = 3226, ['w'] = 3704, ['W'] = 4167,\n        ['e'] = 2174, ['E'] = 2381, ['r'] = 1724, ['R'] = 2777, ['t'] = 1724,\n        ['T'] = 2381, ['y'] = 2564, ['Y'] = 2564, ['u'] = 2564, ['U'] = 3030,\n        ['i'] = 1282, ['I'] = 1282, ['o'] = 2381, ['O'] = 3226, ['p'] = 2564,\n        ['P'] = 2564, ['['] = 1724, ['{'] = 1724, [']'] = 1724, ['}'] = 1724,\n        ['|'] = 1493, ['\\\\']= 1923, ['a'] = 2564, ['A'] = 2777, ['s'] = 1923,\n        ['S'] = 2381, ['d'] = 2564, ['D'] = 3030, ['f'] = 1724, ['F'] = 2381,\n        ['g'] = 2564, ['G'] = 2777, ['h'] = 2564, ['H'] = 3030, ['j'] = 1075,\n        ['J'] = 1282, ['k'] = 2381, ['K'] = 2777, ['l'] = 1282, ['L'] = 2174,\n        [';'] = 1282, [':'] = 1282, ['\\''] = 855, ['\"'] = 1724, ['z'] = 1923,\n        ['Z'] = 2564, ['x'] = 2381, ['X'] = 2777, ['c'] = 1923, ['C'] = 2564,\n        ['v'] = 2564, ['V'] = 2777, ['b'] = 2564, ['B'] = 2564, ['n'] = 2564,\n        ['N'] = 3226, ['m'] = 3846, ['M'] = 3846, [','] = 1282, ['<'] = 2174,\n        ['.'] = 1282, ['>'] = 2174, ['/'] = 1923, ['?'] = 2174, [' '] = 1282,\n        ['avg'] = 2500\n    }\n\n-- Get real string width as per char table\nfunction findStringLength(str)\n    local len = 0\n    local k=0\n    for i = 1, #str do\n        local c = str:sub(i,i)\n        len = len + (charWidth[c] or charWidth.avg)\n    end\n    return len\nend\n\n--------------------------------------------------------------------------------\n-- Over-engineered method to convert input string to button string\n-- inserting line-breaks whenever the width of a line exceeds the box\nmaxWidth=59837    -- found by trial and error\nmaxNlines=9\nfunction insertBreaks(str)\n\n  -- first, split the str by any existing line-breaks\n  local strTable={}\n  local brInd=nil\n  while str:find('\\n') do\n    brInd=str:find('\\n')\n    table.insert(strTable,str:sub(1,brInd))\n    str=str:sub(brInd+1,-1)\n  end\n  table.insert(strTable,str)\n\n  -- split each string further by maxWidth\n  local strTable2={}\n  local nLines = 0\n  for _,str in ipairs(strTable) do\n\n    str=str:gsub('[\\n]','')    -- remove \\n, it'll get reinserted with table.concat\n\n    local len = 0\n    local stInd = 1\n    local enInd = nil\n    local parsing = true\n    local i=0\n\n    while parsing do\n\n      i=i+1\n      local c = str:sub(i,i)\n      if c==' ' then enInd=i end  -- save last encoutered space ind\n      prevLen = len\n      len = len + (charWidth[c] or charWidth.avg)\n\n      if i>=#str and len<=maxWidth then   -- reached the end of string\n        local snip=str:sub(stInd,i)\n        table.insert(strTable2,snip)\n        nLines=nLines+1\n        parsing = false\n        break\n      end\n\n      if len>maxWidth then   -- maxWidth reached\n        if enInd then        -- a space was found\n          local snip = str:sub(stInd,enInd-1)\n          table.insert(strTable2,snip)\n          nLines=nLines+1\n          len=0\n          stInd=enInd+1\n          i=enInd\n          enInd=nil\n        else                 -- a long sequence of characters without space\n          local snip = str:sub(stInd,i-1)\n          table.insert(strTable2,snip)\n          nLines=nLines+1\n          len=0\n          stInd=i\n          i=i-1\n          enInd=nil\n        end\n\n        if i>=#str then\n          parsing = false\n        end\n\n      end\n\n      if nLines>maxNlines then    -- max number of lines reached\n        parsing=false\n      end\n\n    end\n  end\n\n  while nLines<maxNlines do       -- fill up the rest of the lines\n    nLines=nLines+1\n    table.insert(strTable2,' ')\n  end\n\n  return table.concat(strTable2,'\\n')\n\nend\n--------------------------------------------------------------------------------\n\n\nfunction null()\nend",
      "LuaScriptState": "",
      "AttachedDecals": [
        {
          "Transform": {
            "posX": 0.0,
            "posY": 0.083,
            "posZ": -0.35,
            "rotX": 90.0,
            "rotY": 180.0,
            "rotZ": 0.0,
            "scaleX": 1.75,
            "scaleY": 1.75,
            "scaleZ": 1.75
          },
          "CustomDecal": {
            "Name": "pi",
            "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/1661232230975361286/3CF5E2DD99194550D4F60636711E73363BA610F9/",
            "Size": 1.0
          },
          "OwnerSteamID": 0
        }
      ]
    },
    {
      "GUID": "def0af",
      "Name": "PiecePack_Arms",
      "Transform": {
        "posX": -46.75,
        "posY": -5.0,
        "posZ": 5.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 0.63,
        "scaleY": 0.63,
        "scaleZ": 0.63
      },
      "Nickname": "πCounter",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "--bigCounter\n--by π\n\npID = \"πCounter\"\nversion = 3.14159\n\nfunction onload()\n  self.createButton({\n    click_function='registerModule', function_owner=self, label='[i]'..pID..'[/i]', tooltip='register '..pID,\n    position={0,0.1,0}, rotation={0,0,0}, scale={0.5,1,0.5},\n    height=250, width=700, font_size=150,  color={0.1,0.1,0.1,1}, font_color={1,1,1,1},\n  })\n\n  Wait.condition(registerModule,function() return Global.getVar('Encoder') ~= nil and true or false end)\nend\n\nfunction registerModule()\n  enc = Global.getVar('Encoder')\n  if enc ~= nil then\n\t\tproperties = {\n\t\tpropID = pID,\n\t\tname = \"Counter[sup][i]π[/i][/sup]\",\n\t\tvalues = {'picounter'},\n    funcOwner = self,\n\t\ttags='basic',\n\t\tactivateFunc ='toggleProp'\n\t\t}\n\t\tenc.call(\"APIregisterProperty\",properties)\n    value = {\n    valueID = 'picounter',\n    validType = 'number',\n    desc = \"it's a big counter\",\n    default = 0\n    }\n    enc.call(\"APIregisterValue\",value)\n  end\nend\n\nscript=\"self.max_typed_number=999 function onNumberTyped(ply, int) enc = Global.getVar('Encoder') if enc ~= nil then enc.call('APIobjSetValueData',{obj=self,valueID='picounter',data={picounter=int}}) enc.call('APIrebuildButtons',{obj=self}) return true end end\"\n\nfunction toggleProp(obj,ply)\n  enc = Global.getVar('Encoder')\n  if enc then\n    enc.call(\"APItoggleProperty\",{obj=obj,propID=pID})\n\n    if enc.call(\"APIobjIsPropEnabled\",{obj=obj,propID=pID}) then\n      obj.setLuaScript(script)\n    else\n      obj.setLuaScript('')\n      enc.call(\"APIobjSetValueData\",{obj=obj,valueID='picounter',data={picounter=0}})\n    end\n\n    obj=obj.reload()\n    Wait.condition(function()\n      enc.call(\"APIobjUpdateThis\",{obj=obj})\n      enc.call(\"APIrebuildButtons\",{obj=obj})\n    end, function() return not(obj.spawning) end)\n\n  end\n  local ga_menu = Global.getVar('GA_Menu')\n  ga_menu.call(\"shutMenu\", {obj=obj})\nend\n\nfunction createButtons(t)\n  enc = Global.getVar('Encoder')\n  if enc ~= nil then\n    flip = enc.call(\"APIgetFlip\",{obj=t.obj})\n    dat  = enc.call(\"APIobjGetValueData\",{obj=t.obj,valueID='picounter'})\n    picounter = dat.picounter\n    pos = Vector(0,2*flip,-0.45)\n\n    t.obj.createButton({\n      click_function='toggleProp',\n      function_owner=self,\n      tooltip='close counter',\n      label='×',\n      position=Vector(0.65*flip,0.25*flip,-1.09),\n      rotation=Vector(0,0,90-flip*90),\n      width=400,\n      height=400,\n      font_size=600,\n      scale={0.25,0.25,0.25},\n      color={0.1,0.1,0.1,0.6},\n      font_color={1,1,1},\n    })\n\n    bpars={\n      click_function='null',\n      function_owner=self,\n      label=tostring(picounter),\n      position=pos,\n      rotation=Vector(0,0,90-flip*90),\n      width=0,\n      height=0,\n      font_size=1000,\n      scale={0.8,0.8,0.8},\n      color={0,0,0,0},\n      hover_color={0,0,0,0},\n      font_color={0,0,0,100},\n    }\n\n    for i=-1,1,1 do         -- outline\n      for j=-1,1,1 do\n        opars=bpars\n        opars.position=pos+Vector(0.035*i,0,0.035*j)\n        t.obj.createButton(bpars)\n      end\n    end\n\n    bpars.position=Vector(-0.05,0.28*flip,-0.4)\n    bpars.font_color={0.1,0.1,0.1,90}\n    t.obj.createButton(bpars)\n\n    bpars.click_function='add_subtract'\n    bpars.position=pos\n    bpars.width=600\n    bpars.height=600\n    bpars.font_color={1,1,1,100}\n    t.obj.createButton(bpars)\n\n  end\nend\n\nmin_val=0\nmax_val=999\nfunction add_subtract(obj,color,alt)\n  dat = enc.call(\"APIobjGetValueData\",{obj=obj,valueID='picounter'})\n  picounter = dat.picounter\n  new_value = math.min(math.max(picounter + (alt and -1 or 1), min_val), max_val)\n  if picounter ~= new_value then\n    picounter = new_value\n    enc.call(\"APIobjSetValueData\",{obj=obj,valueID='picounter',data={picounter=picounter}})\n    enc.call(\"APIrebuildButtons\",{obj=obj})\n  end\nend\n\nfunction null()\nend",
      "LuaScriptState": "",
      "AttachedDecals": [
        {
          "Transform": {
            "posX": 0.0,
            "posY": 0.083,
            "posZ": -0.35,
            "rotX": 90.0,
            "rotY": 180.0,
            "rotZ": 0.0,
            "scaleX": 1.75,
            "scaleY": 1.75,
            "scaleZ": 1.75
          },
          "CustomDecal": {
            "Name": "pi",
            "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/1661232230975361286/3CF5E2DD99194550D4F60636711E73363BA610F9/",
            "Size": 1.0
          },
          "OwnerSteamID": 0
        }
      ]
    },
    {
      "GUID": "cd83de",
      "Name": "PiecePack_Crowns",
      "Transform": {
        "posX": -46.75,
        "posY": -5.0,
        "posZ": 8.0,
        "rotX": 90.0,
        "rotY": 90.00001,
        "rotZ": 0.0,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Auto Player Promoter",
      "Description": "This tool makes sure all players (present and future) are promoted so they have \"host\" powers: delete/spawn/copy/paste/etc.\r\n\r\nThe tool also takes care that deliberately demoted players are never automatically promoted again (such as if they drop & rejoin or if time is rewound).\r\n\r\nYou'll probably want to hide this underneath the table, disable tooltip, and disable interactivity (see script).",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "--::[[ Auto Player Promoter ]]::--\r\n-- Version 1.0\r\n-- By Kevin O'Mara (Quickle)\r\n-- https://steamcommunity.com/profiles/76561197997376704\r\n\r\n--[[\r\nThis script runs in the background and makes sure all players are promoted so\r\nthey have \"host\" powers (delete/spawn/copy/paste/etc.) For more info on host:\r\nhttp://berserk-games.com/knowledgebase/player-roles/\r\n\r\nAdditionally, if a player gets \"demoted\", the script takes care they are never\r\nautomatically promoted again (i.e. when the player drops and re-joins the match,\r\nthe game is saved and loaded in the future, or time is rewound/fast forwarded).\r\n\r\nPlayers are promoted at the following times:\r\n* All players are promoted each time the game first loads (including Undo/Redo).\r\n* New players are promoted upon joining the match.\r\n\r\nWhether a player is \"demoted\" is recorded at the following times:\r\n* All players are recorded when the game saves (including auto saves).\r\n* Individual players are recorded when they leave the match.\r\n\r\nUndo / Redo\r\n* Undo - A demoted player may become promoted again if time rewinds to a point\r\n  when they were previously promoted.\r\n* Redo - A player will never become demoted when time fast forwards, even if\r\n  they had previously been demoted at that autosave.\r\n--]]\r\n\r\n\r\n\r\n--------------------------------------------------------------------------------\r\n--[[ CONFIGURATION  ]]----------------------------------------------------------\r\n--------------------------------------------------------------------------------\r\n--[[\r\nYou can modify the script's behavior by changing these variables:\r\n--]]\r\n\r\n-- When true, this object is interactable by Players.\r\n-- You may wish to lock this object and hide it somewhere. To do so, simply:\r\n--  1. Set this value to 'true' & save the script.\r\n--  2. Move the object somewhere & save the game.\r\n--  3. Set this value back to 'false' & save the script.\r\nlocal objectIsInteractable = true\n\r\n-- When true, a chat message announces each time a player is automatically\r\n-- promoted or would have been promoted (but wasn't because they are \"demoted\").\r\n-- Lets players know they are being promoted by a script rather than the host.\r\nlocal chatEnabled = false\n\r\n-- When true, debug information is written the log window (host only).\r\nlocal loggingEnabled = false\r\n\r\n\r\n--------------------------------------------------------------------------------\r\n--[[ SCRIPT CODE  ]]------------------------------------------------------------\r\n--------------------------------------------------------------------------------\r\n\r\n--[[ Utility Methods ]]---------------------------------------------------------\r\n\r\nlocal function _log(element, label)\r\n    -- Log a message with the prefix \"AutoPlayerPromoter: \".\r\n    -- Wrapper for `log()`: https://api.tabletopsimulator.com/base/#log\r\n    if loggingEnabled then\r\n        log(element, \"AutoPlayerPromoter: \" .. tostring(label))\r\n    end\r\nend\r\n\r\nlocal function _printToAll(message)\r\n    -- Print a message to chat, but only if `chatEnabled` is `true`.\r\n    -- Wrapper for `print()`: https://api.tabletopsimulator.com/base/#print\r\n    if chatEnabled then\r\n        printToAll(message)\r\n    end\r\nend\r\n\r\nlocal function _playerAsTable(player)\r\n    -- Return a <Player> object (https://api.tabletopsimulator.com/player/) as a\r\n    -- simple key-value table, which can be expanded by the built-in logging\r\n    -- method: https://api.tabletopsimulator.com/base/#log\r\n    return {\r\n        steam_name  = player.steam_name,\r\n        steam_id    = player.steam_id,\r\n        promoted    = player.promoted,\r\n        host        = player.host,\r\n        admin       = player.admin,\r\n        color       = player.color,\r\n        team        = player.team,\r\n        seated      = player.seated,\r\n        blindfolded = player.blindfolded,\r\n        lift_height = player.lift_height,\r\n    }\r\nend\r\n--//////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n--[[ Player Promotion Tracker ]]------------------------------------------------\r\n--[[\r\nKeeps track of which players are demoted and offers a method to promote players.\r\n--]]\r\n\r\n-- Steam IDs of Players who have had their promotion revoked.\r\n-- @type: Set<string>\r\nlocal _demotedPlayerSteamIds = {}\r\n\r\nfunction isOnDemotedPlayerList(player)\r\n    -- @param player <Player> (https://api.tabletopsimulator.com/player/)\r\n    return _demotedPlayerSteamIds[player.steam_id] ~= nil\r\nend\r\n\r\nfunction isPromoted(player)\r\n    -- @param player <Player> (https://api.tabletopsimulator.com/player/)\r\n    return player.promoted or player.host\r\nend\r\n\r\nfunction tryPromotePlayer(player)\r\n    -- @param player <Player> (https://api.tabletopsimulator.com/player/)\r\n    if isOnDemotedPlayerList(player) then\r\n        _log(_playerAsTable(player), \"Will not promote player because they are on the Demoted Player List: \")\r\n        _printToAll(\"AutoPlayerPromoter: Not promoting player \" .. tostring(player.steam_name) .. \", because they were demoted by host.\")\r\n    elseif isPromoted(player) then\r\n        _log(_playerAsTable(player), \"Will not promote player because they are already promoted or host: \")\r\n    else\r\n        _log(_playerAsTable(player), \"Promoting player: \")\r\n        _printToAll(\"AutoPlayerPromoter: Promoting \" .. tostring(player.steam_name))\r\n        player.promote()\r\n    end\r\nend\r\n\r\nfunction savePlayerPromotionState(player)\r\n    -- @param player <Player> (https://api.tabletopsimulator.com/player/)\r\n    if isPromoted(player) then\r\n        _log(_playerAsTable(player), \"Saving player's promotion status. Player is <promoted>: \")\r\n        _demotedPlayerSteamIds[player.steam_id] = nil\r\n    else\r\n        _log(_playerAsTable(player), \"Saving player's promotion status. Player is <demoted>: \")\r\n        _demotedPlayerSteamIds[player.steam_id] = {}\r\n    end\r\nend\r\n--//////////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\n--[[ Event Hooks ]]-------------------------------------------------------------\r\n--[[\r\nMakes sure players are getting promoted and recorded at the right times by\r\nresponding to events.\r\n--]]\r\n\r\nfunction onLoad(saveData)\r\n    self.interactable = objectIsInteractable\r\n\r\n    _log(saveData, \"Loading from script state: \")\r\n    if saveData == \"\" then\r\n        _demotedPlayerSteamIds = {}\r\n    else\r\n        _demotedPlayerSteamIds = JSON.decode(saveData)\r\n    end\r\n\r\n    local players = Player.getPlayers()\r\n    for _, player in ipairs(players) do\r\n        tryPromotePlayer(player)\r\n    end\r\nend\r\n\r\nfunction onPlayerConnect(player)\r\n    -- @param player <Player> (https://api.tabletopsimulator.com/player/)\r\n    tryPromotePlayer(player)\r\nend\r\n\r\nfunction onPlayerDisconnect(player)\r\n    -- @param player <Player> (https://api.tabletopsimulator.com/player/)\r\n    savePlayerPromotionState(player)\r\nend\r\n\r\nfunction onSave()\r\n    local players = Player.getPlayers()\r\n    for _, player in ipairs(players) do\r\n        savePlayerPromotionState(player)\r\n    end\r\n\r\n    saveData = JSON.encode(_demotedPlayerSteamIds)\r\n    _log(saveData, \"Saving script state: \")\r\n    return saveData\r\nend\r\n--//////////////////////////////////////////////////////////////////////////////",
      "LuaScriptState": "[]"
    },
    {
      "GUID": "c2df33",
      "Name": "PiecePack_Arms",
      "Transform": {
        "posX": -46.75,
        "posY": -5.75,
        "posZ": -5.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 0.629999757,
        "scaleY": 0.629999757,
        "scaleZ": 0.629999757
      },
      "Nickname": "Suppression",
      "Description": "",
      "GMNotes": "",
      "Memo": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "--Suppressed\n--By Tipsy Hobbit, adapted for GA by Amphi\npID = \"GA_Suppress\"\nversion = '1.12'\n\nfunction onload()\n  self.createButton({\n  label=\"+\", click_function='registerModule', function_owner=self,\n  position={0,0.2,-0.5}, height=100, width=100, font_size=100,\n  rotation={0,0,0},tooltip=\"Version: \"..version\n  })\n  Wait.condition(registerModule,function() return Global.getVar('Encoder') ~= nil and true or false end)\nend\nfunction registerModule()\n  enc = Global.getVar('Encoder')\n  if enc ~= nil then\n\t\tproperties = {\n\t\tpropID = pID,\n\t\tname = \"Banished\",\n\t\tvalues = {'ga_suppressed'},\n\t\tfuncOwner = self,\n\t\ttags='tool,face_prop',\n\t\tactivateFunc ='suppress'\n\t\t}\n\t\tenc.call(\"APIregisterProperty\",properties)\n    value = {\n    valueID = 'ga_suppressed',\n    validType = 'boolean',\n    desc = 'GA: Is the card suppressed?.',\n    default = false\n    }\n    enc.call(\"APIregisterValue\",value)\n  end\nend\nfunction createButtons(t)\n  enc = Global.getVar('Encoder')\n  if enc ~= nil then\n    flip = enc.call(\"APIgetFlip\",{obj=t.obj})\n    scaler = {x=0.5,y=0.5,z=0.5}--t.obj.getScale()\n    temp = \"BANISHED\\r\\nclick to return\"\n    barSize,fsize,offset_x,offset_y = enc.call('APIformatButton',{str=temp,font_size=400,max_len=90,xJust=0,yJust=0})\n    t.obj.createButton({\n    label=temp, click_function='unsuppress', function_owner=self,\n    position={(0+offset_x)*flip*scaler.x,0.63*flip*scaler.z,(0+offset_y)*scaler.y}, height=800, width=1300, font_size=200,color={0,0,0,1},font_color={0.3,0.8,0.3,1},\n    rotation={0,90,90-90*flip,tooltip=\"This object is Suppressed.\"}\n    })\n  end\nend\nfunction suppress(obj,ply)\n  enc = Global.getVar('Encoder')\n  if enc ~= nil then\n    enc.call(\"APItoggleProperty\",{obj=obj,propID=pID})\n    data = enc.call(\"APIobjGetPropData\",{obj=obj,propID=pID})\n\t\tif data.ga_suppressed ~= true then\n\t\t\tdata.ga_suppressed = true\n    else\n      data.ga_suppressed = false\n    end\n    enc.call(\"APIobjSetPropData\",{obj=obj,propID=pID,data=data})\n    enc.call(\"APIrebuildButtons\",{obj=obj})\n  end\n  local ga_menu = Global.getVar('GA_Menu')\n  ga_menu.call(\"shutMenu\", {obj=obj})\nend\nfunction unsuppress(obj,ply)\n  enc = Global.getVar('Encoder')\n  if enc ~= nil and enc.call(\"APIobjectExists\",{obj=obj}) then\n    flip = enc.call(\"APIgetFlip\",{obj=obj})\n\n\t\tdata = enc.call(\"APIobjGetPropData\",{obj=obj,propID=pID})\n\t\tif data.ga_suppressed == true then\n\t\t\tdata.ga_suppressed = false\n\t\t\tenc.call(\"APIobjSetPropData\",{obj=obj,propID=pID,data=data})\n      enc.call(\"APIobjDisableProp\",{obj=obj,propID=pID})\n\t\tend\n\t\tif type(ply) == \"string\" then\n\t\t\tlocal selection =Player[ply].getSelectedObjects()\n\t\t\tif selection ~= nil then\n\t\t\t\tfor k,v in pairs(selection) do\n\t\t\t\t\tif v ~= tar and enc.call(\"APIobjectExists\",{obj=v}) == true then\n\t\t\t\t\t\tunsuppress(v,0)\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\tend\n\t\tend\n    enc.call(\"APIrebuildButtons\",{obj=obj})\n  end\nend\nfunction updateModule(wr)\n  enc = Global.getVar('Encoder')\n  if enc ~= nil then\n    wr = wr.text\n    wrv = string.match(wr,\"version = '(.-)'\")\n    if wrv == 'DEPRECIATED' then\n      enc.call(\"APIremoveProperty\",{propID=pID})\n      self.destruct()\n    end\n    local ver = enc.call(\"APIversionComp\",{wv=wrv,cv=version})\n    if ''..ver ~= ''..version then\n      broadcastToAll(\"An update has been found for \"..pID..\". Reloading Module.\")\n      self.script_code = wr\n      self.reload()\n    else\n      broadcastToAll(\"No update found for \"..pID..\". Carry on.\")\n    end\n  end\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "7b7b42",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 24.0,
        "posY": 4.5,
        "posZ": -28.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 15.0,
        "scaleY": 4.0,
        "scaleZ": 2.0
      },
      "Nickname": "Hand 2 (Red)",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.856,
        "g": 0.09999997,
        "b": 0.09399996,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Red",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "d45d18",
      "Name": "HandTrigger",
      "Transform": {
        "posX": -24.0,
        "posY": 4.5,
        "posZ": 28.0,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 15.0,
        "scaleY": 4.0,
        "scaleZ": 2.0
      },
      "Nickname": "Hand 2 (Blue)",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.117999978,
        "g": 0.53,
        "b": 1.0,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Blue",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "fab8ed",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 244.0,
        "posY": 4.5,
        "posZ": -28.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 15.0,
        "scaleY": 4.0,
        "scaleZ": 2.0
      },
      "Nickname": "Hand 2 (Green)",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.191999972,
        "g": 0.701,
        "b": 0.167999953,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Green",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "6b7af4",
      "Name": "HandTrigger",
      "Transform": {
        "posX": 196.0,
        "posY": 4.5,
        "posZ": 28.0,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 15.0,
        "scaleY": 4.0,
        "scaleZ": 2.0
      },
      "Nickname": "Hand 2 (Purple)",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.627,
        "g": 0.124999978,
        "b": 0.941,
        "a": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": false,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "FogColor": "Purple",
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "c2d323",
      "Name": "PiecePack_Arms",
      "Transform": {
        "posX": -46.75,
        "posY": -5.75,
        "posZ": -5.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 0.629999757,
        "scaleY": 0.629999757,
        "scaleZ": 0.629999757
      },
      "Nickname": "Riftbound_CardLibrary",
      "Description": "",
      "GMNotes": "",
      "Memo": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "local cards = JSON.decode([====[\n[\r\n  {\r\n    \"id\": \"69675c6c8b5e9ad6eb87a33d\",\r\n    \"slug\": \"yorinobu-arasaka-embracing-destruction-69675c6c8b5e9ad6eb87a33d\",\r\n    \"name\": \"Yorinobu Arasaka - Embracing Destruction\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Red\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Arasaka • Corpo\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"ADIA\",\r\n    \"ability\": \"The first time a friendly Arasaka unit attacks each turn, draw a card. Then, if you have less than 20 * (Street Cred), discard 1 card from your hand to your trash.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a001.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/yorinobu-arasaka-embracing-destruction-69675c6c8b5e9ad6eb87a33d\",\r\n    \"imagePath\": \"data/card-art/69675c6c8b5e9ad6eb87a33d.png\"\r\n  },\r\n  {\r\n    \"id\": \"696fb4431860bf853822a945\",\r\n    \"slug\": \"jackie-welles-pour-one-out-for-me-696fb4431860bf853822a945\",\r\n    \"name\": \"Jackie Welles - Pour One Out For Me\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"α002\",\r\n    \"color\": \"Blue\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Merc\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Envar\",\r\n    \"ability\": \"The first time you play a blue unit or blue gear each turn, you may increase a friendly gig by 2. Then, if it's at max value, draw a card.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a002.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/jackie-welles-pour-one-out-for-me-696fb4431860bf853822a945\",\r\n    \"imagePath\": \"data/card-art/696fb4431860bf853822a945.png\"\r\n  },\r\n  {\r\n    \"id\": \"69675c6c8b5e9ad6eb87a33e\",\r\n    \"slug\": \"v-corporate-exile-69675c6c8b5e9ad6eb87a33e\",\r\n    \"name\": \"V - Corporate Exile\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Blue\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Corpo • Merc\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Envar\",\r\n    \"ability\": \"GO SOLO (Pay this card's cost to play it as a ready unit. It can attack this turn.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a003.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/v-corporate-exile-69675c6c8b5e9ad6eb87a33e\",\r\n    \"imagePath\": \"data/card-art/69675c6c8b5e9ad6eb87a33e.png\"\r\n  },\r\n  {\r\n    \"id\": \"69675c6c8b5e9ad6eb87a33f\",\r\n    \"slug\": \"goro-takemura-hands-unclean-69675c6c8b5e9ad6eb87a33f\",\r\n    \"name\": \"Goro Takemura - Hands Unclean\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Arasaka • Corpo\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Bad Moon Studio\",\r\n    \"ability\": \"GO SOLO (Pay this card's cost to play it as a ready unit. It can attack this turn.) BLOCKER (When a rival units attacks, you may spend this unit to redirect the attack to this unit.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a004.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/goro-takemura-hands-unclean-69675c6c8b5e9ad6eb87a33f\",\r\n    \"imagePath\": \"data/card-art/69675c6c8b5e9ad6eb87a33f.png\"\r\n  },\r\n  {\r\n    \"id\": \"69675c6c8b5e9ad6eb87a340\",\r\n    \"slug\": \"saburo-arasaka-stubborn-patriach-69675c6c8b5e9ad6eb87a340\",\r\n    \"name\": \"Saburo Arasaka - Stubborn Patriach\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Arasaka • Corpo\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"ADIA\",\r\n    \"ability\": \"Your Arasaka units have +1 power when attacking. (Units steal an extra gig for every 10 power.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a005.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/saburo-arasaka-stubborn-patriach-69675c6c8b5e9ad6eb87a340\",\r\n    \"imagePath\": \"data/card-art/69675c6c8b5e9ad6eb87a340.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac0d\",\r\n    \"slug\": \"viktor-vektor-sit-down-and-relax-697107581860bf853828ac0d\",\r\n    \"name\": \"Viktor Vektor - Sit Down and Relax\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Yellow\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Merc • Ripperdoc\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Envar\",\r\n    \"ability\": \"FLIP Search the top 5 cards of your deck for up yo 2 gear that costs 2 or less each. Reveal them and add them to your hand. (Place the other cards on the bottom of your deck in a random order.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a006.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/viktor-vektor-sit-down-and-relax-697107581860bf853828ac0d\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac0d.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac0e\",\r\n    \"slug\": \"armored-minotaur-697107581860bf853828ac0e\",\r\n    \"name\": \"Armored Minotaur\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Red\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Arasaka • Drone • Militech\",\r\n    \"ram\": \"4\",\r\n    \"artist\": \"CD PROJEKT RED\",\r\n    \"ability\": \"PLAY If you have 12+ * (Street Cred), defeat a rival unit with power 5 or less.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a007.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/armored-minotaur-697107581860bf853828ac0e\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac0e.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac19\",\r\n    \"slug\": \"ruthless-lowlife-697107581860bf853828ac19\",\r\n    \"name\": \"Ruthless Lowlife\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Red\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Arasaka • Merc\",\r\n    \"ram\": \"1\",\r\n    \"artist\": \"Jeffrey Alan Love\",\r\n    \"ability\": \"When a rival steals one or more friendly gigs, if this unit is spent, the value of those gigs becomes 1.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a008.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/ruthless-lowlife-697107581860bf853828ac19\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac19.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac1a\",\r\n    \"slug\": \"swordwise-huscle-697107581860bf853828ac1a\",\r\n    \"name\": \"Swordwise Huscle\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Red\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Arasaka • Merc\",\r\n    \"ram\": \"1\",\r\n    \"artist\": \"Olgierd Ciszak\",\r\n    \"ability\": \"Card TypeUnitColorRedClassificationArasaka • Merc\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a009.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/swordwise-huscle-697107581860bf853828ac1a\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac1a.png\"\r\n  },\r\n  {\r\n    \"id\": \"69675c6c8b5e9ad6eb87a341\",\r\n    \"slug\": \"delamain-cab-69675c6c8b5e9ad6eb87a341\",\r\n    \"name\": \"Delamain Cab\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Blue\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Vehicle\",\r\n    \"ram\": \"3\",\r\n    \"artist\": \"Daniel Valaisis\",\r\n    \"ability\": \"Card TypeUnitColorBlueClassificationVehicle\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a010.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/delamain-cab-69675c6c8b5e9ad6eb87a341\",\r\n    \"imagePath\": \"data/card-art/69675c6c8b5e9ad6eb87a341.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac1b\",\r\n    \"slug\": \"evelyn-parker-scheming-siren-697107581860bf853828ac1b\",\r\n    \"name\": \"Evelyn Parker - Scheming Siren\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Blue\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Doll\",\r\n    \"ram\": \"1\",\r\n    \"artist\": \"Olgierd Ciszak\",\r\n    \"ability\": \"When a rival steals one or more friendly gigs, if this unit is spent, draw a card.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a011.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/evelyn-parker-scheming-siren-697107581860bf853828ac1b\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac1b.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac1c\",\r\n    \"slug\": \"mt0d12-flathead-697107581860bf853828ac1c\",\r\n    \"name\": \"MT0D12 Flathead\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Blue\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Drone • Militech\",\r\n    \"ram\": \"3\",\r\n    \"artist\": \"Frederico Sabbatini\",\r\n    \"ability\": \"If you have 7+ * (Street Cred), this unit can't be blocked.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a012.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/mt0d12-flathead-697107581860bf853828ac1c\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac1c.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac1d\",\r\n    \"slug\": \"jackie-welles-ride-or-die-choom-697107581860bf853828ac1d\",\r\n    \"name\": \"Jackie Welles - Ride Or DIe Choom\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Yellow\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Merc\",\r\n    \"ram\": \"3\",\r\n    \"artist\": \"Ilya Kuvshinov\",\r\n    \"ability\": \"This unit has +2 power for each of your friendly gigs. (Units steal an extra gig for every 10 power.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a013.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/jackie-welles-ride-or-die-choom-697107581860bf853828ac1d\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac1d.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac1e\",\r\n    \"slug\": \"secondhand-bombus-697107581860bf853828ac1e\",\r\n    \"name\": \"Secondhand Bombus\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Yellow\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Drone • Zetatech\",\r\n    \"ram\": \"1\",\r\n    \"artist\": \"Luca Claretti\",\r\n    \"ability\": \"This unit can't attack. BLOCKER (When a rival unit attacks, you may spend this unit to redirect the attack to it.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a014.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/secondhand-bombus-697107581860bf853828ac1e\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac1e.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac1f\",\r\n    \"slug\": \"t-bug-amateur-philosopher-697107581860bf853828ac1f\",\r\n    \"name\": \"T-Bug - Amateur Philosopher\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Yellow\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Merc • Netrunner\",\r\n    \"ram\": \"1\",\r\n    \"artist\": \"CD PROJEKT RED\",\r\n    \"ability\": \"Card TypeUnitColorYellowClassificationMerc • Netrunner\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a015.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/t-bug-amateur-philosopher-697107581860bf853828ac1f\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac1f.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac20\",\r\n    \"slug\": \"corpo-security-697107581860bf853828ac20\",\r\n    \"name\": \"Corpo Security\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Corpo\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Daniel Valaisis\",\r\n    \"ability\": \"This unit can't attack. BLOCKER (When a rival unit attacks, you may spend this unit to redirect the attack to it.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a016.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/corpo-security-697107581860bf853828ac20\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac20.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac0f\",\r\n    \"slug\": \"emergency-atlus-697107581860bf853828ac0f\",\r\n    \"name\": \"Emergency Atlus\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Corpo • Vehicle\",\r\n    \"ram\": \"3\",\r\n    \"artist\": \"Robert Sammelin\",\r\n    \"ability\": \"Card TypeUnitColorGreenClassificationCorpo • Vehicle\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a017.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/emergency-atlus-697107581860bf853828ac0f\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac0f.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac10\",\r\n    \"slug\": \"goro-takemura-losing-his-way-697107581860bf853828ac10\",\r\n    \"name\": \"Goro Takemura - Losing His Way\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Unit\",\r\n    \"classification\": \"Arasaka • Corpo\",\r\n    \"ram\": \"3\",\r\n    \"artist\": \"Ilya Kuvshinov\",\r\n    \"ability\": \"This unit has +1 power during your turn for each face-up legend in your legends area.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a018.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/goro-takemura-losing-his-way-697107581860bf853828ac10\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac10.png\"\r\n  },\r\n  {\r\n    \"id\": \"696a701c1860bf853806f62a\",\r\n    \"slug\": \"mantis-blades-696a701c1860bf853806f62a\",\r\n    \"name\": \"Mantis Blades\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Red\",\r\n    \"cardType\": \"Gear\",\r\n    \"classification\": \"Cyberware\",\r\n    \"ram\": \"1\",\r\n    \"artist\": \"Giada Marchisio, Kieran McKeown\",\r\n    \"ability\": \"(Equip to a unit or face-up legend.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a019.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/mantis-blades-696a701c1860bf853806f62a\",\r\n    \"imagePath\": \"data/card-art/696a701c1860bf853806f62a.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac11\",\r\n    \"slug\": \"satori-sword-of-saburo-697107581860bf853828ac11\",\r\n    \"name\": \"Satori - Sword of Saburo\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Red\",\r\n    \"cardType\": \"Gear\",\r\n    \"classification\": \"Arasaka • Weapon\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Ivan Shavrin\",\r\n    \"ability\": \"(Equip to a unit or face-up legend.) ATTACK If this unit wins a fight against a rival unit, draw a card.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a020.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/satori-sword-of-saburo-697107581860bf853828ac11\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac11.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac12\",\r\n    \"slug\": \"industrial-assembly-697107581860bf853828ac12\",\r\n    \"name\": \"Industrial Assembly\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Red\",\r\n    \"cardType\": \"Program\",\r\n    \"classification\": \"Arasaka • Plan\",\r\n    \"ram\": \"1\",\r\n    \"artist\": \"Alexander Dudar\",\r\n    \"ability\": \"Increase a friendly gig by 4. Then, if you have 7+ * (Street Cred), draw a card. (Discard programs after they resolve.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a021.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/industrial-assembly-697107581860bf853828ac12\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac12.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac13\",\r\n    \"slug\": \"dying-night-vs-pistol-697107581860bf853828ac13\",\r\n    \"name\": \"Dying Night - V's Pistol\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Blue\",\r\n    \"cardType\": \"Gear\",\r\n    \"classification\": \"Merc • Weapon\",\r\n    \"ram\": \"3\",\r\n    \"artist\": \"Ivan Shavrin\",\r\n    \"ability\": \"(Equip to a unit or face-up legend.) ATTACK If you have 7+ * (Street Cred), defeat a rival gear card that costs 2 or less.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a022.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/dying-night-vs-pistol-697107581860bf853828ac13\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac13.png\"\r\n  },\r\n  {\r\n    \"id\": \"696e62701860bf853818fd07\",\r\n    \"slug\": \"floor-it-696e62701860bf853818fd07\",\r\n    \"name\": \"Floor It\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Blue\",\r\n    \"cardType\": \"Program\",\r\n    \"classification\": \"Merc • Plan\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"DOFRESH\",\r\n    \"ability\": \"Return a spent unit with cost 4 or less to its owner's hand. (Discard programs after they resolve.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a023.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/floor-it-696e62701860bf853818fd07\",\r\n    \"imagePath\": \"data/card-art/696e62701860bf853818fd07.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac14\",\r\n    \"slug\": \"sandevistan-697107581860bf853828ac14\",\r\n    \"name\": \"Sandevistan\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Gear\",\r\n    \"classification\": \"Cyberware\",\r\n    \"ram\": \"4\",\r\n    \"artist\": \"CD PROJEKT RED\",\r\n    \"ability\": \"(Equip to a unit or face-up legend.) PLAY This unit can attack spent units this turn.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a024.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/sandevistan-697107581860bf853828ac14\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac14.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac15\",\r\n    \"slug\": \"corporate-surveillance-697107581860bf853828ac15\",\r\n    \"name\": \"Corporate Surveillance\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Program\",\r\n    \"classification\": \"\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"John Liew\",\r\n    \"ability\": \"Spend a rival unit with cost 3 or less. (Discard programs after they resolve.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a025.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/corporate-surveillance-697107581860bf853828ac15\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac15.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac16\",\r\n    \"slug\": \"kiroshi-optics-697107581860bf853828ac16\",\r\n    \"name\": \"Kiroshi Optics\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Yellow\",\r\n    \"cardType\": \"Gear\",\r\n    \"classification\": \"Cyberware • Implant\",\r\n    \"ram\": \"1\",\r\n    \"artist\": \"CD PROJEKT RED\",\r\n    \"ability\": \"(Equip to a unit or face-up legend.) ATTACK Look at a friendly face-down legend without revealing it.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a026.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/kiroshi-optics-697107581860bf853828ac16\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac16.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac17\",\r\n    \"slug\": \"mandibular-upgrade-697107581860bf853828ac17\",\r\n    \"name\": \"Mandibular Upgrade\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Yellow\",\r\n    \"cardType\": \"Gear\",\r\n    \"classification\": \"Cyberware • Implant\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Lea Leonowicz\",\r\n    \"ability\": \"(Equip to a unit or face-up legend.) BLOCKER (When a rival unit attacks, you may spend this unit to redirect the attack to it.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a027.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/mandibular-upgrade-697107581860bf853828ac17\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac17.png\"\r\n  },\r\n  {\r\n    \"id\": \"697107581860bf853828ac18\",\r\n    \"slug\": \"reboot-optics-697107581860bf853828ac18\",\r\n    \"name\": \"Reboot Optics\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Yellow\",\r\n    \"cardType\": \"Program\",\r\n    \"classification\": \"Tech\",\r\n    \"ram\": \"CardNexusBeta© 2026CardNexus. All rights reservedSupported GamesLorcanaOnePiece Card GameSorcery: Contested RealmPokemonMagic: The GatheringFlesh and BloodRise TCGRiftbound: League of Legends TCGCyberpunk TCGLegalPrivacy PolicyTerms and conditionsHelp CenterAll game titles, artwork, and trademarks are property of their respective owners. CardNexus is an independent platform not affiliated with any game publishers.Game datafor all supported games comes from various community sources and fan contributions.\",\r\n    \"artist\": \"Miguel Valderrama\",\r\n    \"ability\": \"Give a friendly unit +4 power this turn. Defeat it at the end of the turn. (Discard programs after they resolve.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a028.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/reboot-optics-697107581860bf853828ac18\",\r\n    \"imagePath\": \"data/card-art/697107581860bf853828ac18.png\"\r\n  },\r\n  {\r\n    \"id\": \"69675c6c8b5e9ad6eb87a342\",\r\n    \"slug\": \"saburo-arasaka-stubborn-patriach-69675c6c8b5e9ad6eb87a342\",\r\n    \"name\": \"Saburo Arasaka - Stubborn Patriach\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Arasaka • Corpo\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Vincenzo Riccardi\",\r\n    \"ability\": \"Your Arasaka units have +1 power when attacking. (Units steal an extra gig for every 10 power.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a029.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/saburo-arasaka-stubborn-patriach-69675c6c8b5e9ad6eb87a342\",\r\n    \"imagePath\": \"data/card-art/69675c6c8b5e9ad6eb87a342.png\"\r\n  },\r\n  {\r\n    \"id\": \"69675c6c8b5e9ad6eb87a343\",\r\n    \"slug\": \"goro-takemura-hands-unclean-69675c6c8b5e9ad6eb87a343\",\r\n    \"name\": \"Goro Takemura - Hands Unclean\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Green\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Arasaka • Corpo\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Vincenzo Riccardi\",\r\n    \"ability\": \"GO SOLO (Pay this card's cost to play it as a ready unit. It can attack this turn.) BLOCKER (When a rival units attacks, you may spend this unit to redirect the attack to this unit.)\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a030.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/goro-takemura-hands-unclean-69675c6c8b5e9ad6eb87a343\",\r\n    \"imagePath\": \"data/card-art/69675c6c8b5e9ad6eb87a343.png\"\r\n  },\r\n  {\r\n    \"id\": \"69675c6c8b5e9ad6eb87a344\",\r\n    \"slug\": \"yorinobu-arasaka-embracing-destruction-69675c6c8b5e9ad6eb87a344\",\r\n    \"name\": \"Yorinobu Arasaka - Embracing Destruction\",\r\n    \"set\": \"Alpha Kit Set\",\r\n    \"setNumber\": \"000\",\r\n    \"color\": \"Red\",\r\n    \"cardType\": \"Legend\",\r\n    \"classification\": \"Arasaka • Corpo\",\r\n    \"ram\": \"2\",\r\n    \"artist\": \"Vincenzo Riccardi\",\r\n    \"ability\": \"The first time a friendly Arasaka unit attacks each turn, draw a card. Then, if you have less than 20 * (Street Cred), discard 1 card from your hand to your trash.\",\r\n    \"imageUrl\": \"https://ik.imagekit.io/cardnexus/production/cyberpunk/a031.png/tr:w-640,q-80\",\r\n    \"detailUrl\": \"https://app.cardnexus.com/en/explore/cyberpunk/alpha-kit-set/card/yorinobu-arasaka-embracing-destruction-69675c6c8b5e9ad6eb87a344\",\r\n    \"imagePath\": \"data/card-art/69675c6c8b5e9ad6eb87a344.png\"\r\n  }\r\n]\n]====]) or {}\n\nlocal cardData = {}\nlocal tts_to_id_map = {}\n\nlocal function put(key, value)\n  if key and key ~= \"\" then\n    cardData[key] = value\n  end\nend\n\nfor _, card in ipairs(cards) do\n  local record = {\n    id = card.id,\n    slug = card.slug,\n    name = card.name or card.id or \"\",\n    description = card.ability or \"\",\n    image = card.imageUrl or card.imagePath or \"\",\n    gmNotes = JSON.encode(card),\n  }\n\n  put(card.id, record)\n  put(card.slug, record)\n  put(card.setNumber, record)\n\n  if card.setNumber and card.id then\n    tts_to_id_map[card.setNumber] = card.id\n  end\nend\n\nfunction getMap() return cardData end\nfunction getTTSMap() return tts_to_id_map end\nfunction getParams(params) return cardData[params['slug']] end\nfunction getTTSParams(params) return cardData[tts_to_id_map[params.slug]] or cardData[params.slug] end\nfunction onLoad(saved_data)\n  Global.setVar('Cyberpunk_CardLibrary', self)\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "c2d324",
      "Name": "PiecePack_Arms",
      "Transform": {
        "posX": -46.75,
        "posY": -5.75,
        "posZ": -5.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 0.629999757,
        "scaleY": 0.629999757,
        "scaleZ": 0.629999757
      },
      "Nickname": "Riftbound_CollationLibrary",
      "Description": "",
      "GMNotes": "",
      "Memo": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": false,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "-- Auto-generated by scripts/build_cyberpunk_collation.py\r\n-- Source: S:\\Dev\\TTS\\aipipeline\\workspaces\\cyberpunk\\scripts\\objects\\0025_c2d323_cyberpunk-cardlibrary\\LuaScript.lua\r\n\r\nSFD_Common_Pool = {\"SFD-001\",\"SFD-002\",\"SFD-003\",\"SFD-004\",\"SFD-005\",\"SFD-006\",\"SFD-007\",\"SFD-008\",\"SFD-009\",\"SFD-010\",\"SFD-031\",\"SFD-032\",\"SFD-033\",\"SFD-034\",\"SFD-035\",\"SFD-036\",\"SFD-037\",\"SFD-038\",\"SFD-039\",\"SFD-040\",\"SFD-061\",\"SFD-062\",\"SFD-063\",\"SFD-064\",\"SFD-065\",\"SFD-066\",\"SFD-067\",\"SFD-068\",\"SFD-069\",\"SFD-070\",\"SFD-091\",\"SFD-092\",\"SFD-093\",\"SFD-094\",\"SFD-095\",\"SFD-096\",\"SFD-097\",\"SFD-098\",\"SFD-099\",\"SFD-100\",\"SFD-121\",\"SFD-122\",\"SFD-123\",\"SFD-124\",\"SFD-125\",\"SFD-126\",\"SFD-127\",\"SFD-128\",\"SFD-129\",\"SFD-130\",\"SFD-151\",\"SFD-152\",\"SFD-153\",\"SFD-154\",\"SFD-155\",\"SFD-156\",\"SFD-157\",\"SFD-158\",\"SFD-159\",\"SFD-160\",\"SFD-207\"}\r\nSFD_Uncommon_Pool = {\"SFD-011\",\"SFD-012\",\"SFD-013\",\"SFD-014\",\"SFD-015\",\"SFD-016\",\"SFD-017\",\"SFD-018\",\"SFD-041\",\"SFD-042\",\"SFD-043\",\"SFD-044\",\"SFD-045\",\"SFD-046\",\"SFD-047\",\"SFD-048\",\"SFD-071\",\"SFD-072\",\"SFD-073\",\"SFD-074\",\"SFD-075\",\"SFD-076\",\"SFD-077\",\"SFD-078\",\"SFD-101\",\"SFD-102\",\"SFD-103\",\"SFD-104\",\"SFD-105\",\"SFD-106\",\"SFD-107\",\"SFD-108\",\"SFD-131\",\"SFD-132\",\"SFD-133\",\"SFD-134\",\"SFD-135\",\"SFD-136\",\"SFD-137\",\"SFD-138\",\"SFD-161\",\"SFD-162\",\"SFD-163\",\"SFD-164\",\"SFD-165\",\"SFD-166\",\"SFD-167\",\"SFD-168\",\"SFD-208\",\"SFD-209\",\"SFD-210\",\"SFD-211\",\"SFD-212\",\"SFD-213\",\"SFD-214\",\"SFD-215\",\"SFD-216\",\"SFD-217\",\"SFD-218\",\"SFD-219\",\"SFD-220\",\"SFD-221\"}\r\nSFD_Rare_Pool = {\"SFD-019\",\"SFD-020\",\"SFD-021\",\"SFD-022\",\"SFD-023\",\"SFD-024\",\"SFD-025\",\"SFD-026\",\"SFD-049\",\"SFD-050\",\"SFD-051\",\"SFD-052\",\"SFD-053\",\"SFD-054\",\"SFD-055\",\"SFD-056\",\"SFD-079\",\"SFD-080\",\"SFD-081\",\"SFD-082\",\"SFD-083\",\"SFD-084\",\"SFD-085\",\"SFD-086\",\"SFD-109\",\"SFD-110\",\"SFD-111\",\"SFD-112\",\"SFD-113\",\"SFD-114\",\"SFD-115\",\"SFD-116\",\"SFD-139\",\"SFD-140\",\"SFD-141\",\"SFD-142\",\"SFD-143\",\"SFD-144\",\"SFD-145\",\"SFD-146\",\"SFD-169\",\"SFD-170\",\"SFD-171\",\"SFD-172\",\"SFD-173\",\"SFD-174\",\"SFD-175\",\"SFD-176\",\"SFD-181\",\"SFD-183\",\"SFD-185\",\"SFD-187\",\"SFD-189\",\"SFD-193\",\"SFD-195\",\"SFD-199\",\"SFD-201\",\"SFD-203\",\"SFD-205\"}\r\nSFD_Epic_Pool = {\"SFD-027\",\"SFD-028\",\"SFD-029\",\"SFD-030\",\"SFD-057\",\"SFD-058\",\"SFD-059\",\"SFD-060\",\"SFD-087\",\"SFD-088\",\"SFD-089\",\"SFD-090\",\"SFD-117\",\"SFD-118\",\"SFD-119\",\"SFD-120\",\"SFD-147\",\"SFD-148\",\"SFD-149\",\"SFD-150\",\"SFD-177\",\"SFD-178\",\"SFD-179\",\"SFD-180\",\"SFD-182\",\"SFD-184\",\"SFD-186\",\"SFD-188\",\"SFD-190\",\"SFD-191\",\"SFD-192\",\"SFD-194\",\"SFD-196\",\"SFD-197\",\"SFD-198\",\"SFD-200\",\"SFD-202\",\"SFD-204\",\"SFD-206\"}\r\nSFD_Showcase_Pool = {\"SFD-020a\",\"SFD-026a\",\"SFD-028a\",\"SFD-029a\",\"SFD-050a\",\"SFD-054a\",\"SFD-057a\",\"SFD-058a\",\"SFD-082a\",\"SFD-085a\",\"SFD-088a\",\"SFD-089a\",\"SFD-110a\",\"SFD-113a\",\"SFD-119a\",\"SFD-120a\",\"SFD-141a\",\"SFD-143a\",\"SFD-148a\",\"SFD-149a\",\"SFD-170a\",\"SFD-171a\",\"SFD-177a\",\"SFD-180a\",\"SFD-222\",\"SFD-223\",\"SFD-223s\",\"SFD-224\",\"SFD-224s\",\"SFD-225\",\"SFD-225s\",\"SFD-226\",\"SFD-227\",\"SFD-227s\",\"SFD-228\",\"SFD-228s\",\"SFD-229\",\"SFD-230\",\"SFD-230s\",\"SFD-231\",\"SFD-232\",\"SFD-232s\",\"SFD-233\",\"SFD-233s\",\"SFD-234\",\"SFD-235\",\"SFD-235s\",\"SFD-236\",\"SFD-236s\",\"SFD-237\",\"SFD-237s\",\"SFD-238\",\"SFD-239\",\"SFD-239s\",\"SFD-240\",\"SFD-241\",\"SFD-242\",\"SFD-243\",\"SFD-244\",\"SFD-245\",\"SFD-246\",\"SFD-247\",\"SFD-248\",\"SFD-249\",\"SFD-250\",\"SFD-251\"}\r\nSFD_RarePlus_Roll = { { pool = \"SFD_Rare_Pool\", weight = 87.5 }, { pool = \"SFD_Epic_Pool\", weight = 12.5 } }\r\nSFD_Any_Roll = { { pool = \"SFD_Common_Pool\", weight = 75 }, { pool = \"SFD_Uncommon_Pool\", weight = 22 }, { pool = \"SFD_Rare_Pool\", weight = 2.5 }, { pool = \"SFD_Epic_Pool\", weight = 0.4 }, { pool = \"SFD_Showcase_Pool\", weight = 0.1 } }\r\n\r\nOGN_Common_Pool = {\"OGN-001\",\"OGN-002\",\"OGN-003\",\"OGN-004\",\"OGN-005\",\"OGN-006\",\"OGN-007\",\"OGN-008\",\"OGN-009\",\"OGN-010\",\"OGN-011\",\"OGN-012\",\"OGN-013\",\"OGN-014\",\"OGN-042\",\"OGN-043\",\"OGN-044\",\"OGN-045\",\"OGN-046\",\"OGN-047\",\"OGN-048\",\"OGN-049\",\"OGN-050\",\"OGN-051\",\"OGN-052\",\"OGN-053\",\"OGN-054\",\"OGN-055\",\"OGN-083\",\"OGN-084\",\"OGN-085\",\"OGN-086\",\"OGN-087\",\"OGN-088\",\"OGN-089\",\"OGN-090\",\"OGN-091\",\"OGN-092\",\"OGN-093\",\"OGN-094\",\"OGN-095\",\"OGN-096\",\"OGN-124\",\"OGN-125\",\"OGN-126\",\"OGN-127\",\"OGN-128\",\"OGN-129\",\"OGN-130\",\"OGN-131\",\"OGN-132\",\"OGN-133\",\"OGN-134\",\"OGN-135\",\"OGN-136\",\"OGN-137\",\"OGN-165\",\"OGN-166\",\"OGN-167\",\"OGN-168\",\"OGN-169\",\"OGN-170\",\"OGN-171\",\"OGN-172\",\"OGN-173\",\"OGN-174\",\"OGN-175\",\"OGN-176\",\"OGN-177\",\"OGN-178\",\"OGN-206\",\"OGN-207\",\"OGN-208\",\"OGN-209\",\"OGN-210\",\"OGN-211\",\"OGN-212\",\"OGN-213\",\"OGN-214\",\"OGN-215\",\"OGN-216\",\"OGN-217\",\"OGN-218\",\"OGN-219\",\"OGN-271\",\"OGN-272\",\"OGN-273\",\"OGN-274\"}\r\nOGN_Uncommon_Pool = {\"OGN-015\",\"OGN-016\",\"OGN-017\",\"OGN-018\",\"OGN-019\",\"OGN-020\",\"OGN-021\",\"OGN-022\",\"OGN-023\",\"OGN-024\",\"OGN-056\",\"OGN-057\",\"OGN-058\",\"OGN-059\",\"OGN-060\",\"OGN-061\",\"OGN-062\",\"OGN-063\",\"OGN-064\",\"OGN-065\",\"OGN-097\",\"OGN-098\",\"OGN-099\",\"OGN-100\",\"OGN-101\",\"OGN-102\",\"OGN-103\",\"OGN-104\",\"OGN-105\",\"OGN-106\",\"OGN-138\",\"OGN-139\",\"OGN-140\",\"OGN-141\",\"OGN-142\",\"OGN-143\",\"OGN-144\",\"OGN-145\",\"OGN-146\",\"OGN-147\",\"OGN-179\",\"OGN-180\",\"OGN-181\",\"OGN-182\",\"OGN-183\",\"OGN-184\",\"OGN-185\",\"OGN-186\",\"OGN-187\",\"OGN-188\",\"OGN-220\",\"OGN-221\",\"OGN-222\",\"OGN-223\",\"OGN-224\",\"OGN-225\",\"OGN-226\",\"OGN-227\",\"OGN-228\",\"OGN-229\",\"OGN-275\",\"OGN-276\",\"OGN-277\",\"OGN-278\",\"OGN-279\",\"OGN-280\",\"OGN-281\",\"OGN-282\",\"OGN-283\",\"OGN-284\",\"OGN-285\",\"OGN-286\",\"OGN-287\",\"OGN-288\",\"OGN-289\",\"OGN-290\",\"OGN-291\",\"OGN-292\",\"OGN-293\",\"OGN-294\",\"OGN-295\",\"OGN-296\",\"OGN-297\",\"OGN-298\"}\r\nOGN_Rare_Pool = {\"OGN-025\",\"OGN-026\",\"OGN-027\",\"OGN-028\",\"OGN-029\",\"OGN-030\",\"OGN-031\",\"OGN-032\",\"OGN-033\",\"OGN-034\",\"OGN-035\",\"OGN-036\",\"OGN-066\",\"OGN-067\",\"OGN-068\",\"OGN-069\",\"OGN-070\",\"OGN-071\",\"OGN-072\",\"OGN-073\",\"OGN-074\",\"OGN-075\",\"OGN-076\",\"OGN-077\",\"OGN-107\",\"OGN-108\",\"OGN-109\",\"OGN-110\",\"OGN-111\",\"OGN-112\",\"OGN-113\",\"OGN-114\",\"OGN-115\",\"OGN-116\",\"OGN-117\",\"OGN-118\",\"OGN-148\",\"OGN-149\",\"OGN-150\",\"OGN-151\",\"OGN-152\",\"OGN-153\",\"OGN-154\",\"OGN-155\",\"OGN-156\",\"OGN-157\",\"OGN-158\",\"OGN-159\",\"OGN-189\",\"OGN-190\",\"OGN-191\",\"OGN-192\",\"OGN-193\",\"OGN-194\",\"OGN-195\",\"OGN-196\",\"OGN-197\",\"OGN-198\",\"OGN-199\",\"OGN-200\",\"OGN-230\",\"OGN-231\",\"OGN-232\",\"OGN-233\",\"OGN-234\",\"OGN-235\",\"OGN-236\",\"OGN-237\",\"OGN-238\",\"OGN-239\",\"OGN-240\",\"OGN-241\",\"OGN-247\",\"OGN-249\",\"OGN-251\",\"OGN-253\",\"OGN-255\",\"OGN-257\",\"OGN-259\",\"OGN-261\",\"OGN-263\",\"OGN-265\",\"OGN-267\",\"OGN-269\"}\r\nOGN_Epic_Pool = {\"OGN-037\",\"OGN-038\",\"OGN-039\",\"OGN-040\",\"OGN-041\",\"OGN-078\",\"OGN-079\",\"OGN-080\",\"OGN-081\",\"OGN-082\",\"OGN-119\",\"OGN-120\",\"OGN-121\",\"OGN-121a\",\"OGN-122\",\"OGN-123\",\"OGN-160\",\"OGN-161\",\"OGN-162\",\"OGN-163\",\"OGN-164\",\"OGN-201\",\"OGN-202\",\"OGN-203\",\"OGN-204\",\"OGN-205\",\"OGN-242\",\"OGN-243\",\"OGN-244\",\"OGN-245\",\"OGN-246\",\"OGN-248\",\"OGN-250\",\"OGN-252\",\"OGN-254\",\"OGN-256\",\"OGN-258\",\"OGN-260\",\"OGN-262\",\"OGN-264\",\"OGN-266\",\"OGN-268\",\"OGN-270\"}\r\nOGN_Showcase_Pool = {\"OGN-007a\",\"OGN-027a\",\"OGN-030a\",\"OGN-039a\",\"OGN-041a\",\"OGN-042a\",\"OGN-066a\",\"OGN-076a\",\"OGN-078a\",\"OGN-079a\",\"OGN-089a\",\"OGN-112a\",\"OGN-117a\",\"OGN-119a\",\"OGN-126a\",\"OGN-151a\",\"OGN-158a\",\"OGN-162a\",\"OGN-164a\",\"OGN-166a\",\"OGN-193a\",\"OGN-197a\",\"OGN-202a\",\"OGN-205a\",\"OGN-214a\",\"OGN-238a\",\"OGN-240a\",\"OGN-243a\",\"OGN-246a\",\"OGN-299\",\"OGN-299s\",\"OGN-300\",\"OGN-300s\",\"OGN-301\",\"OGN-301s\",\"OGN-302\",\"OGN-302s\",\"OGN-303\",\"OGN-303s\",\"OGN-304\",\"OGN-304s\",\"OGN-305\",\"OGN-305s\",\"OGN-306\",\"OGN-306s\",\"OGN-307\",\"OGN-307s\",\"OGN-308\",\"OGN-308s\",\"OGN-309\",\"OGN-309s\",\"OGN-310\",\"OGN-310s\"}\r\nOGN_RarePlus_Roll = { { pool = \"OGN_Rare_Pool\", weight = 87.5 }, { pool = \"OGN_Epic_Pool\", weight = 12.5 } }\r\nOGN_Any_Roll = { { pool = \"OGN_Common_Pool\", weight = 75 }, { pool = \"OGN_Uncommon_Pool\", weight = 22 }, { pool = \"OGN_Rare_Pool\", weight = 2.5 }, { pool = \"OGN_Epic_Pool\", weight = 0.4 }, { pool = \"OGN_Showcase_Pool\", weight = 0.1 } }\r\n\r\npack_collations = {\r\n  SFD = {\r\n    { type = \"SFD_Common_Pool\", count = 7 },\r\n    { type = \"SFD_Uncommon_Pool\", count = 3 },\r\n    { type = \"SFD_RarePlus_Roll\", count = 2 },\r\n    { type = \"SFD_Any_Roll\", count = 1 },\r\n  },\r\n  OGN = {\r\n    { type = \"OGN_Common_Pool\", count = 7 },\r\n    { type = \"OGN_Uncommon_Pool\", count = 3 },\r\n    { type = \"OGN_RarePlus_Roll\", count = 2 },\r\n    { type = \"OGN_Any_Roll\", count = 1 },\r\n  },\r\n}\r\n\r\n-- Counts: SFD C/U/R/E/S = 61/62/59/39/66\r\n-- Counts: OGN C/U/R/E/S = 88/84/84/43/53\r\n\r\n-- =========================\n-- Utility\n-- =========================\n\r\nfunction randomFromPool(pool, used)\r\n  if not pool or #pool == 0 then return nil end\r\n\r\n  local attempts = 0\r\n  while attempts < 50 do\r\n    local card = pool[math.random(#pool)]\r\n    if not used[card] then\r\n      return card\r\n    end\r\n    attempts = attempts + 1\r\n  end\r\n\r\n  return nil\r\nend\r\n\r\nfunction weightedRoll(rollTable, used)\r\n  local total = 0\r\n  for _, entry in ipairs(rollTable) do\r\n    total = total + entry.weight\r\n  end\r\n\r\n  local attempts = 0\r\n  while attempts < 50 do\r\n    local roll = math.random() * total\r\n    local running = 0\r\n\r\n    for _, entry in ipairs(rollTable) do\r\n      running = running + entry.weight\r\n      if roll <= running then\r\n        local pool = _G[entry.pool]\r\n        local card = randomFromPool(pool, used)\r\n        if card then return card end\r\n        break\r\n      end\r\n    end\r\n\r\n    attempts = attempts + 1\r\n  end\r\n\r\n  return nil\r\nend\r\n\r\n-- =========================\r\n-- Pack Generation\r\n-- =========================\r\n\r\nfunction GeneratePack(set_id)\n  local collation = pack_collations[set_id]\n  if not collation then\n    print(\"Unknown set:\", set_id)\n    return {}\r\n  end\r\n\r\n  local card_list = {}\r\n  local used = {}\r\n\r\n  for _, entry in ipairs(collation) do\r\n    for i = 1, entry.count do\r\n      local card\r\n\r\n      if entry.type:find(\"_Roll\") then\r\n        card = weightedRoll(_G[entry.type], used)\r\n      else\r\n        card = randomFromPool(_G[entry.type], used)\r\n      end\r\n\r\n      if card then\r\n        used[card] = true\r\n        table.insert(card_list, card)\r\n      else\r\n        print(\"Warning: Could not find unique card for\", entry.type)\r\n      end\r\n    end\r\n  end\r\n\r\n  return card_list\r\nend\r\n\r\n-- =========================\r\n-- TTS Hook\r\n-- =========================\r\n\r\nfunction onLoad(saved_data)\n  Global.setVar(\"Cyberpunk_CollationLibrary\", self)\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "3afac6",
      "Name": "CardCustom",
      "Transform": {
        "posX": 21.1557388,
        "posY": 0.973605,
        "posZ": -10.0397863,
        "rotX": -6.708807e-09,
        "rotY": 180.0,
        "rotZ": -1.29298456e-08,
        "scaleX": 0.8,
        "scaleY": 1.0,
        "scaleZ": 0.9
      },
      "Nickname": "Quick Actions Panel",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": false,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 600500,
      "SidewaysCard": false,
      "CustomDeck": {
        "6005": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/15915881332567971029/2E5286DB61D68505EB444F1574CE9B84A4EF7370/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "function getCorrectRotation()\r\n  local sideOfTable = self.getPosition().z > 0\r\n  return sideOfTable and {0,0,0} or {0,180,0}\r\nend\r\n\r\nfunction onDrop(color)\r\n    self.setRotationSmooth(getCorrectRotation(), false, true)\r\nend\r\n\r\nfunction onLoad()\r\n  -- ---------- Side drop-zone button ----------\r\n  self.createButton({\r\n      label          = \"♻\",\r\n      click_function = \"linkToDeckBottom\",\r\n      function_owner = Global,\r\n      position       = {3, -0.35, 0},\r\n      rotation       = {0, 0, 0},\r\n      width          = 1400,\r\n      height         = 1200,\r\n      font_size      = 600,\r\n      color          = {0.44, 0.66, 0.77, 1},\r\n      font_color     = {0, 0, 0, 1},\r\n      tooltip        = \"Drop cards here to recycle\",\r\n  })\r\n  Wait.frames(function() buildQuickActionUI() end, 10)\r\nend\r\n\r\nlocal function findById(node, wantId)\r\n  if type(node) ~= \"table\" then return nil end\r\n\r\n  local attrs = node.attributes\r\n  if attrs and attrs.id == wantId then\r\n    return node\r\n  end\r\n\r\n  local kids = node.children\r\n  if kids then\r\n    for _, child in ipairs(kids) do\r\n      local found = findById(child, wantId)\r\n      if found then return found end\r\n    end\r\n  end\r\n\r\n  return nil\r\nend\r\n\r\nfunction buildQuickActionUI()\r\n  local buttons = Global.getVar(\"QUICK_ACTION_BUTTONS\")\r\n  if type(buttons) ~= \"table\" then return end\r\n\r\n  local alternatingColors = {\r\n    \"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\",\r\n    \"#70A8C4|#90C8E4|#4088A4|#D8F0FF\",\r\n  }\r\n  local colorIndex = 1\r\n\r\n  local buttonChildren = {}\r\n  for _, entry in ipairs(buttons) do\r\n    local fn = entry.fn or entry.function_name\r\n    local label = entry.label or entry.text\r\n    if fn and label then\r\n      if not tostring(fn):match(\"^Global/\") then\r\n        fn = \"Global/\" .. tostring(fn)\r\n      end\r\n\r\n      table.insert(buttonChildren, {\r\n        tag = \"Button\",\r\n        attributes = {\r\n          colors = alternatingColors[colorIndex],\r\n          fontStyle = \"Bold\",\r\n          fontSize = \"50\",\r\n          onClick = fn,\r\n        },\r\n        value = tostring(label),\r\n      })\r\n\r\n      colorIndex = 3 - colorIndex\r\n    end\r\n  end\r\n\r\n  local xml = self.UI.getXmlTable()\r\n  local grid = findById(xml[1], \"quick_action_grid\")\r\n  if not grid then\r\n    print(\"[QuickActions] Could not find GridLayout id=quick_action_grid\")\r\n    return\r\n  end\r\n\r\n  grid.children = buttonChildren\r\n  self.UI.setXmlTable(xml)\r\nend",
      "LuaScriptState": "",
      "XmlUI": "<Panel\r\n  id=\"quick_action_token\"\r\n  position=\"-170 300 4\"\r\n  rotation=\"180 180 0\"\r\n  width=\"300\" height=\"200\"\r\n  scale=\"1.7 2 1\"\r\n>\r\n  <Panel position=\"0 -20 0\" width=\"250\" height=\"120\" rotation=\"0 0 0\">\r\n      <GridLayout id=\"quick_action_grid\" cellSize=\"300 80\" spacing=\"10 10\" childAlignment=\"MiddleCenter\">\r\n          <Button\r\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\r\n            fontStyle=\"Bold\"\r\n            fontSize=\"50\"\r\n            onClick=\"Global/beginNewTurnProcedure\"\r\n          >Begin Turn</Button>\r\n          <Button\r\n            colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\"\r\n            fontStyle=\"Bold\"\r\n            fontSize=\"50\"\r\n            onClick=\"Global/endTurnProcedure\"\r\n          >End Turn</Button>\r\n          <Button\r\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\r\n            fontStyle=\"Bold\"\r\n            fontSize=\"50\"\r\n            onClick=\"Global/glimpseQuickAction\"\r\n          >Peek 1</Button>\r\n          <Button\r\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\r\n            fontStyle=\"Bold\"\r\n            fontSize=\"50\"\r\n            onClick=\"Global/revealQuickAction\"\r\n          >Reveal 1</Button>\r\n          <Button\r\n            colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\"\r\n            fontStyle=\"Bold\"\r\n            fontSize=\"50\"\r\n            onClick=\"Global/clearPlaymat\"\r\n          >Clear Mat</Button>\r\n          <Button\r\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\r\n            fontStyle=\"Bold\"\r\n            fontSize=\"50\"\r\n            onClick=\"Global/resetToGameStart\"\r\n          >GG Go Next</Button>\r\n       </GridLayout>\r\n  </Panel>\r\n\r\n</Panel>"
    },
    {
      "GUID": "fa1d96",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": -15.0,
        "posY": 0.92,
        "posZ": 0.0,
        "rotX": 1.40718646e-08,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 7.0,
        "scaleY": 1.0,
        "scaleZ": 7.0
      },
      "Nickname": "1v1 Battlefield 1",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/10685699193933447321/DD03917368C2A08DBCC3257E20F4BB79B23D777A/",
        "ImageSecondaryURL": "https://steamusercontent-a.akamaihd.net/ugc/10685699193933447321/DD03917368C2A08DBCC3257E20F4BB79B23D777A/",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 0,
          "Thickness": 0.1,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\r\n    self.interactable = false\r\n    self.UI.setXml(\"\")\r\nend\r\n\r\nfunction imprintRemote(params)\r\n  imprint(params.obj, params.player_color)\r\nend\r\n\r\nfunction imprint(obj, player_color)\r\n  if obj then\r\n    updateBattlefieldUI(obj.getName(), obj.getDescription())\r\n  else\r\n    self.UI.setXml(\"\") -- clear UI\r\n  end\r\nend\r\n\r\nfunction updateBattlefieldUI(title, effect)\r\n    local PANEL_WIDTH      = 3000\r\n    local PANEL_HEIGHT     = 400\r\n    local PANEL_SCALE      = 0.1\r\n    local TITLE_FONT_SIZE  = 80\r\n    local EFFECT_FONT_SIZE = 60\r\n    local TEXT_COLOR       = \"#FFFFFF\"\r\n    local OUTLINE_COLOR    = \"rgba(0,0,0,1)\"\r\n\r\n    local function makePanel(pos, rot)\r\n        return {\r\n            tag = \"Panel\",\r\n            attributes = {\r\n                anchor   = \"LowerMiddle\",\r\n                position = pos,\r\n                rotation = rot,\r\n                width    = PANEL_WIDTH,\r\n                height   = PANEL_HEIGHT,\r\n                scale    = PANEL_SCALE,\r\n            },\r\n            children = {\r\n                {\r\n                    tag = \"VerticalLayout\",\r\n                    attributes = {\r\n                        childForceExpandHeight = false,\r\n                        childAlignment         = \"LowerCenter\",\r\n                    },\r\n                    children = {\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = title,\r\n                                fontSize = TITLE_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = effect,\r\n                                fontSize = EFFECT_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    end\r\n\r\n    self.UI.setXmlTable({\r\n        makePanel(\"0 67 -25\", \"0 0 180\"),\r\n        makePanel(\"0 -67 -25\", \"0 0 0\"),\r\n    })\r\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "541d5c",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": 15.0,
        "posY": 0.92,
        "posZ": 0.0,
        "rotX": -1.41342307e-08,
        "rotY": 180.0,
        "rotZ": 4.78954032e-09,
        "scaleX": 7.0,
        "scaleY": 1.0,
        "scaleZ": 7.0
      },
      "Nickname": "1v1 Battlefield 2",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/10685699193933447321/DD03917368C2A08DBCC3257E20F4BB79B23D777A/",
        "ImageSecondaryURL": "https://steamusercontent-a.akamaihd.net/ugc/10685699193933447321/DD03917368C2A08DBCC3257E20F4BB79B23D777A/",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 0,
          "Thickness": 0.1,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\r\n    self.interactable = false\r\n    self.UI.setXml(\"\")\r\nend\r\n\r\nfunction imprintRemote(params)\r\n  imprint(params.obj, params.player_color)\r\nend\r\n\r\nfunction imprint(obj, player_color)\r\n  if obj then\r\n    updateBattlefieldUI(obj.getName(), obj.getDescription())\r\n  else\r\n    self.UI.setXml(\"\") -- clear UI\r\n  end\r\nend\r\n\r\nfunction updateBattlefieldUI(title, effect)\r\n    local PANEL_WIDTH      = 3000\r\n    local PANEL_HEIGHT     = 400\r\n    local PANEL_SCALE      = 0.1\r\n    local TITLE_FONT_SIZE  = 80\r\n    local EFFECT_FONT_SIZE = 60\r\n    local TEXT_COLOR       = \"#FFFFFF\"\r\n    local OUTLINE_COLOR    = \"rgba(0,0,0,1)\"\r\n\r\n    local function makePanel(pos, rot)\r\n        return {\r\n            tag = \"Panel\",\r\n            attributes = {\r\n                anchor   = \"LowerMiddle\",\r\n                position = pos,\r\n                rotation = rot,\r\n                width    = PANEL_WIDTH,\r\n                height   = PANEL_HEIGHT,\r\n                scale    = PANEL_SCALE,\r\n            },\r\n            children = {\r\n                {\r\n                    tag = \"VerticalLayout\",\r\n                    attributes = {\r\n                        childForceExpandHeight = false,\r\n                        childAlignment         = \"LowerCenter\",\r\n                    },\r\n                    children = {\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = title,\r\n                                fontSize = TITLE_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = effect,\r\n                                fontSize = EFFECT_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    end\r\n\r\n    self.UI.setXmlTable({\r\n        makePanel(\"0 67 -25\", \"0 0 180\"),\r\n        makePanel(\"0 -67 -25\", \"0 0 0\"),\r\n    })\r\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "2fad01",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 0.0,
        "posY": 4.0,
        "posZ": 0.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 90.0,
        "scaleY": 8.0,
        "scaleZ": 29.8086643
      },
      "Nickname": "buffbuttonzone",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "{\"buffCounts\":{\"0342f3\":2,\"034dc6\":3,\"05c928\":1,\"0894ac\":3,\"08ece6\":2,\"0f6132\":2,\"1d8614\":5,\"22a50c\":3,\"2b68dd\":2,\"2f03fc\":1,\"2f97fb\":3,\"324678\":3,\"3311c7\":4,\"35bf6d\":3,\"3ca1f9\":4,\"3db1fc\":2,\"4c4543\":2,\"50fd41\":5,\"5266be\":2,\"55964b\":2,\"5f2855\":1,\"61dc85\":2,\"66a07c\":7,\"6fa68d\":7,\"717f52\":2,\"7b6551\":7,\"85cf48\":1,\"8d1b96\":6,\"8e9745\":3,\"8f7a31\":3,\"9d0043\":2,\"a0d3dd\":2,\"a221a5\":2,\"a3f213\":2,\"a415cc\":2,\"a772c9\":2,\"c9f71b\":5,\"e4e76e\":4,\"f02f4d\":2,\"fa286d\":2},\"cardAttachments\":{\"55964b\":[]},\"deckCounts\":{\"3afbbb\":3,\"eb2c0d\":38},\"deckOrientations\":{\"3afbbb\":true,\"eb2c0d\":true},\"dropdownStates\":[],\"lastAction\":{\"0342f3\":\"initial\",\"034dc6\":\"initial\",\"05c928\":\"initial\",\"0894ac\":\"initial\",\"08ece6\":\"initial\",\"0f6132\":\"initial\",\"1d8614\":\"initial\",\"22a50c\":\"initial\",\"2b68dd\":\"initial\",\"2f03fc\":\"initial\",\"2f97fb\":\"initial\",\"324678\":\"initial\",\"3311c7\":\"initial\",\"35bf6d\":\"initial\",\"3ca1f9\":\"initial\",\"3db1fc\":\"initial\",\"4c4543\":\"initial\",\"50fd41\":\"initial\",\"5266be\":\"initial\",\"55964b\":\"decrease\",\"5f2855\":\"initial\",\"61dc85\":\"initial\",\"66a07c\":\"initial\",\"6fa68d\":\"initial\",\"717f52\":\"initial\",\"7b6551\":\"initial\",\"85cf48\":\"initial\",\"8d1b96\":\"initial\",\"8e9745\":\"initial\",\"8f7a31\":\"initial\",\"9d0043\":\"initial\",\"a0d3dd\":\"initial\",\"a221a5\":\"initial\",\"a3f213\":\"initial\",\"a415cc\":\"initial\",\"a772c9\":\"initial\",\"c9f71b\":\"initial\",\"e4e76e\":\"initial\",\"f02f4d\":\"initial\",\"fa286d\":\"initial\"},\"originalMightValues\":{\"0342f3\":2,\"034dc6\":3,\"05c928\":1,\"0894ac\":3,\"08ece6\":2,\"0f6132\":2,\"1d8614\":5,\"22a50c\":3,\"2b68dd\":2,\"2f03fc\":1,\"2f97fb\":3,\"324678\":3,\"3311c7\":4,\"35bf6d\":3,\"3ca1f9\":4,\"3db1fc\":2,\"4c4543\":2,\"50fd41\":5,\"5266be\":2,\"55964b\":2,\"5f2855\":1,\"61dc85\":2,\"66a07c\":7,\"6fa68d\":7,\"717f52\":2,\"7b6551\":7,\"85cf48\":1,\"8d1b96\":6,\"8e9745\":3,\"8f7a31\":3,\"9d0043\":2,\"a0d3dd\":2,\"a221a5\":2,\"a3f213\":2,\"a415cc\":2,\"a772c9\":2,\"c9f71b\":5,\"e4e76e\":4,\"f02f4d\":2,\"fa286d\":2}}",
      "XmlUI": ""
    },
    {
      "GUID": "b30ddd",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -15.0,
        "posY": 4.0,
        "posZ": -4.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 20.0,
        "scaleY": 8.0,
        "scaleZ": 4.0
      },
      "Nickname": "Battlefield Trigger Red West",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "b30dde",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 15.0,
        "posY": 4.0,
        "posZ": -4.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 20.0,
        "scaleY": 8.0,
        "scaleZ": 4.0
      },
      "Nickname": "Battlefield Trigger Red East",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "71d4a9",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -15.0,
        "posY": 4.0,
        "posZ": 4.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 20.0,
        "scaleY": 8.0,
        "scaleZ": 4.0
      },
      "Nickname": "Battlefield Trigger Blue West",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "edc262",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 15.0,
        "posY": 4.0,
        "posZ": 4.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 20.0,
        "scaleY": 8.0,
        "scaleZ": 4.0
      },
      "Nickname": "Battlefield Trigger Blue East",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "421f2d",
      "Name": "Infinite_Bag",
      "Transform": {
        "posX": -2.0,
        "posY": 0.0,
        "posZ": -2.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 1.0,
        "scaleY": 1.0,
        "scaleZ": 1.0
      },
      "Nickname": "Quick Actions Menus",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MaterialIndex": -1,
      "MeshIndex": -1,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": "",
      "ContainedObjects": [
        {
          "GUID": "e6da45",
          "Name": "CardCustom",
          "Transform": {
            "posX": 25.4063721,
            "posY": 0.973605037,
            "posZ": 9.850348,
            "rotX": -1.11508086e-06,
            "rotY": -4.45215155e-05,
            "rotZ": -1.0683852e-07,
            "scaleX": 0.8,
            "scaleY": 1.0,
            "scaleZ": 0.9
          },
          "Nickname": "Quick Actions Panel",
          "Description": "",
          "GMNotes": "",
          "AltLookAngle": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
          },
          "ColorDiffuse": {
            "r": 0.713235259,
            "g": 0.713235259,
            "b": 0.713235259
          },
          "LayoutGroupSortIndex": 0,
          "Value": 0,
          "Locked": false,
          "Grid": true,
          "Snap": true,
          "IgnoreFoW": false,
          "MeasureMovement": false,
          "DragSelectable": true,
          "Autoraise": true,
          "Sticky": true,
          "Tooltip": true,
          "GridProjection": false,
          "HideWhenFaceDown": true,
          "Hands": true,
          "CardID": 401600,
          "SidewaysCard": false,
          "CustomDeck": {
            "4016": {
              "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/",
              "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/",
              "NumWidth": 1,
              "NumHeight": 1,
              "BackIsHidden": true,
              "UniqueBack": false,
              "Type": 0
            }
          },
          "LuaScript": "function getCorrectRotation()\r\n  local sideOfTable = self.getPosition().z > 0\r\n  return sideOfTable and {0,0,0} or {0,180,0}\r\nend\r\n\r\nfunction onDrop(color)\r\n    self.setRotationSmooth(getCorrectRotation(), false, true)\r\nend\r\n\r\nfunction onLoad()\r\n  -- ---------- Side drop-zone button ----------\r\n  self.createButton({\r\n      label          = \"♻\",\r\n      click_function = \"linkToDeckBottom\",\r\n      function_owner = Global,\r\n      position       = {3, -0.35, 0},\r\n      rotation       = {0, 0, 0},\r\n      width          = 1400,\r\n      height         = 1200,\r\n      font_size      = 600,\r\n      color          = {0.44, 0.66, 0.77, 1},\r\n      font_color     = {0, 0, 0, 1},\r\n      tooltip        = \"Drop cards here to recycle\",\r\n  })\r\n  Wait.frames(function() buildQuickActionUI() end, 10)\r\nend\r\n\r\nlocal function findById(node, wantId)\r\n  if type(node) ~= \"table\" then return nil end\r\n\r\n  local attrs = node.attributes\r\n  if attrs and attrs.id == wantId then\r\n    return node\r\n  end\r\n\r\n  local kids = node.children\r\n  if kids then\r\n    for _, child in ipairs(kids) do\r\n      local found = findById(child, wantId)\r\n      if found then return found end\r\n    end\r\n  end\r\n\r\n  return nil\r\nend\r\n\r\nfunction buildQuickActionUI()\r\n  local buttons = Global.getVar(\"QUICK_ACTION_BUTTONS\")\r\n  if type(buttons) ~= \"table\" then return end\r\n\r\n  local alternatingColors = {\r\n    \"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\",\r\n    \"#70A8C4|#90C8E4|#4088A4|#D8F0FF\",\r\n  }\r\n  local colorIndex = 1\r\n\r\n  local buttonChildren = {}\r\n  for _, entry in ipairs(buttons) do\r\n    local fn = entry.fn or entry.function_name\r\n    local label = entry.label or entry.text\r\n    if fn and label then\r\n      if not tostring(fn):match(\"^Global/\") then\r\n        fn = \"Global/\" .. tostring(fn)\r\n      end\r\n\r\n      table.insert(buttonChildren, {\r\n        tag = \"Button\",\r\n        attributes = {\r\n          colors = alternatingColors[colorIndex],\r\n          fontStyle = \"Bold\",\r\n          fontSize = \"50\",\r\n          onClick = fn,\r\n        },\r\n        value = tostring(label),\r\n      })\r\n\r\n      colorIndex = 3 - colorIndex\r\n    end\r\n  end\r\n\r\n  local xml = self.UI.getXmlTable()\r\n  local grid = findById(xml[1], \"quick_action_grid\")\r\n  if not grid then\r\n    print(\"[QuickActions] Could not find GridLayout id=quick_action_grid\")\r\n    return\r\n  end\r\n\r\n  grid.children = buttonChildren\r\n  self.UI.setXmlTable(xml)\r\nend",
          "LuaScriptState": "",
          "XmlUI": "<Panel\n  id=\"quick_action_token\"\n  position=\"-170 300 4\"\n  rotation=\"180 180 0\"\n  width=\"300\" height=\"200\"\n  scale=\"1.7 2 1\"\n>\n  <Panel position=\"0 -20 0\" width=\"250\" height=\"120\" rotation=\"0 0 0\">\n      <GridLayout id=\"quick_action_grid\" cellSize=\"300 80\" spacing=\"10 10\" childAlignment=\"MiddleCenter\">\n          <Button\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/beginNewTurnProcedure\"\n          >Begin Turn</Button>\n          <Button\n            colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/endTurnProcedure\"\n          >End Turn</Button>\n          <Button\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/glimpseQuickAction\"\n          >Peek 1</Button>\n          <Button\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/revealQuickAction\"\n          >Reveal 1</Button>\n          <Button\n            colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/clearPlaymat\"\n          >Clear Mat</Button>\n          <Button\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/resetToGameStart\"\n          >GG Go Next</Button>\n       </GridLayout>\n  </Panel>\n\n</Panel>"
        }
      ]
    },
    {
      "GUID": "cb8139",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": -226.0,
        "posY": 0.9600004,
        "posZ": 0.0,
        "rotX": 0.0,
        "rotY": 0.00152,
        "rotZ": 0.0,
        "scaleX": 8.5,
        "scaleY": 1.0,
        "scaleZ": 7.0
      },
      "Nickname": "4P Battlefield 1",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/12899307092402486464/7F26D641D9BEB326BE7FD9B3C41D3B5001206497/",
        "ImageSecondaryURL": "https://steamusercontent-a.akamaihd.net/ugc/12899307092402486464/7F26D641D9BEB326BE7FD9B3C41D3B5001206497/",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 0,
          "Thickness": 0.2,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\r\n    self.interactable = false\r\n    self.UI.setXml(\"\")\r\nend\r\n\r\nfunction imprintRemote(params)\r\n  imprint(params.obj, params.player_color)\r\nend\r\n\r\nfunction imprint(obj, player_color)\r\n  if obj then\r\n    updateBattlefieldUI(obj.getName(), obj.getDescription())\r\n  else\r\n    self.UI.setXml(\"\") -- clear UI\r\n  end\r\nend\r\n\r\nfunction updateBattlefieldUI(title, effect)\r\n    local PANEL_WIDTH      = 3000\r\n    local PANEL_HEIGHT     = 400\r\n    local PANEL_SCALE      = 0.1\r\n    local TITLE_FONT_SIZE  = 80\r\n    local EFFECT_FONT_SIZE = 60\r\n    local TEXT_COLOR       = \"#FFFFFF\"\r\n    local OUTLINE_COLOR    = \"rgba(0,0,0,1)\"\r\n\r\n    local function makePanel(pos, rot)\r\n        return {\r\n            tag = \"Panel\",\r\n            attributes = {\r\n                anchor   = \"LowerMiddle\",\r\n                position = pos,\r\n                rotation = rot,\r\n                width    = PANEL_WIDTH,\r\n                height   = PANEL_HEIGHT,\r\n                scale    = PANEL_SCALE,\r\n            },\r\n            children = {\r\n                {\r\n                    tag = \"VerticalLayout\",\r\n                    attributes = {\r\n                        childForceExpandHeight = false,\r\n                        childAlignment         = \"LowerCenter\",\r\n                    },\r\n                    children = {\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = title,\r\n                                fontSize = TITLE_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = effect,\r\n                                fontSize = EFFECT_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    end\r\n\r\n    self.UI.setXmlTable({\r\n        makePanel(\"0 67 -25\", \"0 0 180\"),\r\n        makePanel(\"0 -67 -25\", \"0 0 0\"),\r\n    })\r\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "7772d5",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": -196.0,
        "posY": 0.9600004,
        "posZ": 0.0,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 8.5,
        "scaleY": 1.0,
        "scaleZ": 7.0
      },
      "Nickname": "4P Battlefield 2",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/12899307092402486464/7F26D641D9BEB326BE7FD9B3C41D3B5001206497/",
        "ImageSecondaryURL": "https://steamusercontent-a.akamaihd.net/ugc/12899307092402486464/7F26D641D9BEB326BE7FD9B3C41D3B5001206497/",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 0,
          "Thickness": 0.2,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\r\n    self.interactable = false\r\n    self.UI.setXml(\"\")\r\nend\r\n\r\nfunction imprintRemote(params)\r\n  imprint(params.obj, params.player_color)\r\nend\r\n\r\nfunction imprint(obj, player_color)\r\n  if obj then\r\n    updateBattlefieldUI(obj.getName(), obj.getDescription())\r\n  else\r\n    self.UI.setXml(\"\") -- clear UI\r\n  end\r\nend\r\n\r\nfunction updateBattlefieldUI(title, effect)\r\n    local PANEL_WIDTH      = 3000\r\n    local PANEL_HEIGHT     = 400\r\n    local PANEL_SCALE      = 0.1\r\n    local TITLE_FONT_SIZE  = 80\r\n    local EFFECT_FONT_SIZE = 60\r\n    local TEXT_COLOR       = \"#FFFFFF\"\r\n    local OUTLINE_COLOR    = \"rgba(0,0,0,1)\"\r\n\r\n    local function makePanel(pos, rot)\r\n        return {\r\n            tag = \"Panel\",\r\n            attributes = {\r\n                anchor   = \"LowerMiddle\",\r\n                position = pos,\r\n                rotation = rot,\r\n                width    = PANEL_WIDTH,\r\n                height   = PANEL_HEIGHT,\r\n                scale    = PANEL_SCALE,\r\n            },\r\n            children = {\r\n                {\r\n                    tag = \"VerticalLayout\",\r\n                    attributes = {\r\n                        childForceExpandHeight = false,\r\n                        childAlignment         = \"LowerCenter\",\r\n                    },\r\n                    children = {\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = title,\r\n                                fontSize = TITLE_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = effect,\r\n                                fontSize = EFFECT_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    end\r\n\r\n    self.UI.setXmlTable({\r\n        makePanel(\"0 67 -25\", \"0 0 180\"),\r\n        makePanel(\"0 -67 -25\", \"0 0 0\"),\r\n    })\r\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "4266ed",
      "Name": "Custom_Tile",
      "Transform": {
        "posX": -166.0,
        "posY": 0.9600004,
        "posZ": -0.03834893,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 8.5,
        "scaleY": 1.0,
        "scaleZ": 7.0
      },
      "Nickname": "4P Battlefield3",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0,
        "b": 0.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/12899307092402486464/7F26D641D9BEB326BE7FD9B3C41D3B5001206497/",
        "ImageSecondaryURL": "https://steamusercontent-a.akamaihd.net/ugc/12899307092402486464/7F26D641D9BEB326BE7FD9B3C41D3B5001206497/",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomTile": {
          "Type": 0,
          "Thickness": 0.2,
          "Stackable": false,
          "Stretch": true
        }
      },
      "LuaScript": "function onLoad()\r\n    self.interactable = false\r\n    self.UI.setXml(\"\")\r\nend\r\n\r\nfunction imprintRemote(params)\r\n  imprint(params.obj, params.player_color)\r\nend\r\n\r\nfunction imprint(obj, player_color)\r\n  if obj then\r\n    updateBattlefieldUI(obj.getName(), obj.getDescription())\r\n  else\r\n    self.UI.setXml(\"\") -- clear UI\r\n  end\r\nend\r\n\r\nfunction updateBattlefieldUI(title, effect)\r\n    local PANEL_WIDTH      = 3000\r\n    local PANEL_HEIGHT     = 400\r\n    local PANEL_SCALE      = 0.1\r\n    local TITLE_FONT_SIZE  = 80\r\n    local EFFECT_FONT_SIZE = 60\r\n    local TEXT_COLOR       = \"#FFFFFF\"\r\n    local OUTLINE_COLOR    = \"rgba(0,0,0,1)\"\r\n\r\n    local function makePanel(pos, rot)\r\n        return {\r\n            tag = \"Panel\",\r\n            attributes = {\r\n                anchor   = \"LowerMiddle\",\r\n                position = pos,\r\n                rotation = rot,\r\n                width    = PANEL_WIDTH,\r\n                height   = PANEL_HEIGHT,\r\n                scale    = PANEL_SCALE,\r\n            },\r\n            children = {\r\n                {\r\n                    tag = \"VerticalLayout\",\r\n                    attributes = {\r\n                        childForceExpandHeight = false,\r\n                        childAlignment         = \"LowerCenter\",\r\n                    },\r\n                    children = {\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = title,\r\n                                fontSize = TITLE_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                        {\r\n                            tag = \"Text\",\r\n                            attributes = {\r\n                                text      = effect,\r\n                                fontSize = EFFECT_FONT_SIZE,\r\n                                color     = TEXT_COLOR,\r\n                                alignment = \"LowerCenter\",\r\n                                wrap      = true,\r\n                                outline   = OUTLINE_COLOR,\r\n                            }\r\n                        },\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    end\r\n\r\n    self.UI.setXmlTable({\r\n        makePanel(\"0 67 -25\", \"0 0 180\"),\r\n        makePanel(\"0 -67 -25\", \"0 0 0\"),\r\n    })\r\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "ee40bb",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -159.0,
        "posY": 2.0,
        "posZ": -3.775053,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFAGreenEast",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee40bc",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -189.0,
        "posY": 2.0,
        "posZ": -3.775053,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFAGreenCenter",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee40bd",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -219.0,
        "posY": 2.0,
        "posZ": -3.775053,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFAGreenWest",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee40cb",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -159.0,
        "posY": 2.0,
        "posZ": 3.775053,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFAPurpleEast",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee40cc",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -189.0,
        "posY": 2.0,
        "posZ": 3.775053,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFAPurpleCenter",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee40cd",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -219.0,
        "posY": 2.0,
        "posZ": 3.775053,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFAPurpleWest",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee409b",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -173.0,
        "posY": 2.0,
        "posZ": -3.775053,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFARedEast",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee409c",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -203.0,
        "posY": 2.0,
        "posZ": -3.775053,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFARedCenter",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee409d",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -233.0,
        "posY": 2.0,
        "posZ": -3.775053,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFARedWest",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee40db",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -173.0,
        "posY": 2.0,
        "posZ": 3.775053,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFABlueEast",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee40dc",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -203.0,
        "posY": 2.0,
        "posZ": 3.775053,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFABlueCenter",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "ee40dd",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": -233.0,
        "posY": 2.0,
        "posZ": 3.775053,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 13.0,
        "scaleY": 3.0,
        "scaleZ": 6.0
      },
      "Nickname": "BattlefieldWakeupZoneFFABlueWest",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "650908",
      "Name": "CardCustom",
      "Transform": {
        "posX": -179.425,
        "posY": 2.01000023,
        "posZ": 11.4,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 1.87838769,
        "scaleY": 1.0,
        "scaleZ": 1.87838769
      },
      "Nickname": "Choose One Marker",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 600200,
      "SidewaysCard": false,
      "CustomDeck": {
        "6002": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/9932239945311389582/AA8E5F1B86D321D65CD627431632EBEC7780B0E3/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/9932239945311389582/AA8E5F1B86D321D65CD627431632EBEC7780B0E3/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "cdd84e",
      "Name": "CardCustom",
      "Transform": {
        "posX": -220.575,
        "posY": 2.009996,
        "posZ": -11.3999987,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 1.87838769,
        "scaleY": 1.0,
        "scaleZ": 1.87838769
      },
      "Nickname": "Choose One Marker",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 600200,
      "SidewaysCard": false,
      "CustomDeck": {
        "6002": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/9932239945311389582/AA8E5F1B86D321D65CD627431632EBEC7780B0E3/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/9932239945311389582/AA8E5F1B86D321D65CD627431632EBEC7780B0E3/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "2bb427",
      "Name": "CardCustom",
      "Transform": {
        "posX": -196.72168,
        "posY": 2.01000071,
        "posZ": -11.3999987,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 1.87838769,
        "scaleY": 1.0,
        "scaleZ": 1.87838769
      },
      "Nickname": "Choose One Marker",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 600200,
      "SidewaysCard": false,
      "CustomDeck": {
        "6002": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/9932239945311389582/AA8E5F1B86D321D65CD627431632EBEC7780B0E3/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/9932239945311389582/AA8E5F1B86D321D65CD627431632EBEC7780B0E3/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "7902f4",
      "Name": "CardCustom",
      "Transform": {
        "posX": -155.571686,
        "posY": 2.00999975,
        "posZ": 11.4,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 1.87838769,
        "scaleY": 1.0,
        "scaleZ": 1.87838769
      },
      "Nickname": "Choose One Marker",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 600200,
      "SidewaysCard": false,
      "CustomDeck": {
        "6002": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/9932239945311389582/AA8E5F1B86D321D65CD627431632EBEC7780B0E3/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/9932239945311389582/AA8E5F1B86D321D65CD627431632EBEC7780B0E3/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    },
    {
      "GUID": "96b1d6",
      "Name": "Custom_Token",
      "Transform": {
        "posX": 0.0,
        "posY": 1.1,
        "posZ": -6.0,
        "rotX": 8.537728e-07,
        "rotY": 180.0,
        "rotZ": -1.81426742e-06,
        "scaleX": 0.75,
        "scaleY": 1.0,
        "scaleZ": 0.75
      },
      "Nickname": "Red Points",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.8344949,
        "g": 0.0305303223,
        "b": 0.0305303223
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/13972340856252448540/DDCC83524ED154C1F937AC5319E4903077E4A335/",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomToken": {
          "Thickness": 0.1,
          "MergeDistancePixels": 15.0,
          "StandUp": false,
          "Stackable": false
        }
      },
      "LuaScript": "MIN_VALUE = 0\r\nMAX_VALUE = 21\r\n\r\nlocal val = 0\r\nlocal color = \"\"\r\n\r\n-- ---------- LOAD / SAVE ----------\r\n\r\nfunction onLoad(saved_data)\r\n    color = self.getName():match(\"^%S+\") or \"\"\r\n\r\n    if saved_data ~= \"\" then\r\n        local ok, data = pcall(JSON.decode, saved_data)\r\n        if ok and data and data[1] then\r\n            val = data[1]\r\n        end\r\n    end\r\n\r\n    rebuildUI()\r\n    createButtons()\r\nend\r\n\r\nfunction updateSave()\r\n    self.script_state = JSON.encode({ val })\r\nend\r\n\r\n-- ---------- UI ----------\r\n\r\nfunction rebuildUI()\r\n    local fontColor = getFontColor(val)\r\n\r\n    local xml = [[\r\n    <Panel width=\"800\" height=\"800\" position=\"0 50 -60\" rotation=\"180 180 0\">\r\n        <Text\r\n            id=\"score\"\r\n            text=\"]] .. val .. [[\"\r\n            fontSize=\"420\"\r\n            fontStyle=\"Bold\"\r\n            alignment=\"MiddleCenter\"\r\n            color=\"]] .. fontColor .. [[\"\r\n        />\r\n    </Panel>\r\n    ]]\r\n\r\n    self.UI.setXml(xml)\r\nend\r\n\r\nfunction getFontColor(v)\r\n    if v == 5 then return \"#FFFF00\" end\r\n    if v == 6 then return \"#FFCC00\" end\r\n    if v == 7 then return \"#FF8800\" end\r\n    if v == 8 then return \"#00FF00\" end\r\n    return \"#FFFFFF\"\r\nend\r\n\r\n-- ---------- BUTTONS ----------\r\n\r\nfunction createButtons()\r\n    self.clearButtons()\r\n\r\n    -- Single invisible button that handles both clicks\r\n    self.createButton({\r\n        click_function = \"onClick\",\r\n        function_owner = self,\r\n        position = {0, 0.4, 0},\r\n        width = 1400,\r\n        height = 2200,\r\n        color = {0,0,0,0},\r\n        tooltip = self.getName()\r\n    })\r\nend\r\n\r\nfunction onClick(_, player_color, alt_click)\r\n    local delta = alt_click and -1 or 1\r\n    setValue(val + delta, player_color)\r\nend\r\n\r\n-- ---------- LOGIC ----------\r\n\r\nfunction setValue(newVal, player_color)\r\n    newVal = math.max(MIN_VALUE, math.min(MAX_VALUE, newVal))\r\n    if newVal == val then return end\r\n\r\n    if val<newVal then broadcastToAll(color..\" Player scores! (\"..newVal..\" points)\", {1, 1, 0}) end\r\n    if val>newVal then broadcastToAll(color..\" Player loses a point! (\"..newVal..\" points)\", {1, 1, 0}) end\r\n\r\n    val = newVal\r\n    rebuildUI()\r\n    createButtons()    \r\n    updateSave()\r\n\r\n    Global.call(\"onAdjustScoreRemote\", {\r\n        player_color = player_color,\r\n        new_score = val\r\n    })\r\nend\r\n\r\n-- ---------- UTIL ----------\r\n\r\nfunction reset_val()\r\n    val = 0\r\n    rebuildUI()\r\n    createButtons()\r\n    updateSave()\r\nend\r\n\r\nself.max_typed_number = 99\r\nfunction onNumberTyped(_, int)\r\n    setValue(int)\r\nend",
      "LuaScriptState": "[0]"
    },
    {
      "GUID": "96b1d7",
      "Name": "Custom_Token",
      "Transform": {
        "posX": 0.0,
        "posY": 1.1,
        "posZ": 6.0,
        "rotX": 3.52181223e-06,
        "rotY": -4.29020729e-05,
        "rotZ": 5.336066e-07,
        "scaleX": 0.75,
        "scaleY": 1.0,
        "scaleZ": 0.75
      },
      "Nickname": "Blue Points",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.0305303223,
        "b": 0.8344949
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/13972340856252448540/DDCC83524ED154C1F937AC5319E4903077E4A335/",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomToken": {
          "Thickness": 0.1,
          "MergeDistancePixels": 15.0,
          "StandUp": false,
          "Stackable": false
        }
      },
      "LuaScript": "MIN_VALUE = 0\r\nMAX_VALUE = 21\r\n\r\nlocal val = 0\r\nlocal color = \"\"\r\n\r\n-- ---------- LOAD / SAVE ----------\r\n\r\nfunction onLoad(saved_data)\r\n    color = self.getName():match(\"^%S+\") or \"\"\r\n\r\n    if saved_data ~= \"\" then\r\n        local ok, data = pcall(JSON.decode, saved_data)\r\n        if ok and data and data[1] then\r\n            val = data[1]\r\n        end\r\n    end\r\n\r\n    rebuildUI()\r\n    createButtons()\r\nend\r\n\r\nfunction updateSave()\r\n    self.script_state = JSON.encode({ val })\r\nend\r\n\r\n-- ---------- UI ----------\r\n\r\nfunction rebuildUI()\r\n    local fontColor = getFontColor(val)\r\n\r\n    local xml = [[\r\n    <Panel width=\"800\" height=\"800\" position=\"0 50 -60\" rotation=\"180 180 0\">\r\n        <Text\r\n            id=\"score\"\r\n            text=\"]] .. val .. [[\"\r\n            fontSize=\"420\"\r\n            fontStyle=\"Bold\"\r\n            alignment=\"MiddleCenter\"\r\n            color=\"]] .. fontColor .. [[\"\r\n        />\r\n    </Panel>\r\n    ]]\r\n\r\n    self.UI.setXml(xml)\r\nend\r\n\r\nfunction getFontColor(v)\r\n    if v == 5 then return \"#FFFF00\" end\r\n    if v == 6 then return \"#FFCC00\" end\r\n    if v == 7 then return \"#FF8800\" end\r\n    if v == 8 then return \"#00FF00\" end\r\n    return \"#FFFFFF\"\r\nend\r\n\r\n-- ---------- BUTTONS ----------\r\n\r\nfunction createButtons()\r\n    self.clearButtons()\r\n\r\n    -- Single invisible button that handles both clicks\r\n    self.createButton({\r\n        click_function = \"onClick\",\r\n        function_owner = self,\r\n        position = {0, 0.4, 0},\r\n        width = 1400,\r\n        height = 2200,\r\n        color = {0,0,0,0},\r\n        tooltip = self.getName()\r\n    })\r\nend\r\n\r\nfunction onClick(_, player_color, alt_click)\r\n    local delta = alt_click and -1 or 1\r\n    setValue(val + delta, player_color)\r\nend\r\n\r\n-- ---------- LOGIC ----------\r\n\r\nfunction setValue(newVal, player_color)\r\n    newVal = math.max(MIN_VALUE, math.min(MAX_VALUE, newVal))\r\n    if newVal == val then return end\r\n\r\n    if val<newVal then broadcastToAll(color..\" Player scores! (\"..newVal..\" points)\", {1, 1, 0}) end\r\n    if val>newVal then broadcastToAll(color..\" Player loses a point! (\"..newVal..\" points)\", {1, 1, 0}) end\r\n\r\n    val = newVal\r\n    rebuildUI()\r\n    createButtons()\r\n    updateSave()\r\n\r\n    Global.call(\"onAdjustScoreRemote\", {\r\n        player_color = player_color,\r\n        new_score = val\r\n    })\r\nend\r\n\r\n-- ---------- UTIL ----------\r\n\r\nfunction reset_val()\r\n    val = 0\r\n    rebuildUI()\r\n    createButtons()\r\n    updateSave()\r\nend\r\n\r\nself.max_typed_number = 99\r\nfunction onNumberTyped(_, int)\r\n    setValue(int)\r\nend",
      "LuaScriptState": "[0]"
    },
    {
      "GUID": "96b1d8",
      "Name": "Custom_Token",
      "Transform": {
        "posX": 211.0,
        "posY": 1.1,
        "posZ": -6.0,
        "rotX": 0.0,
        "rotY": 180.0,
        "rotZ": 0.0,
        "scaleX": 0.75,
        "scaleY": 1.0,
        "scaleZ": 0.75
      },
      "Nickname": "Green Points",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.0,
        "g": 0.8344949,
        "b": 0.0305303223
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/13972340856252448540/DDCC83524ED154C1F937AC5319E4903077E4A335/",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomToken": {
          "Thickness": 0.1,
          "MergeDistancePixels": 15.0,
          "StandUp": false,
          "Stackable": false
        }
      },
      "LuaScript": "MIN_VALUE = 0\r\nMAX_VALUE = 21\r\n\r\nlocal val = 0\r\nlocal color = \"\"\r\n\r\n-- ---------- LOAD / SAVE ----------\r\n\r\nfunction onLoad(saved_data)\r\n    color = self.getName():match(\"^%S+\") or \"\"\r\n\r\n    if saved_data ~= \"\" then\r\n        local ok, data = pcall(JSON.decode, saved_data)\r\n        if ok and data and data[1] then\r\n            val = data[1]\r\n        end\r\n    end\r\n\r\n    rebuildUI()\r\n    createButtons()\r\nend\r\n\r\nfunction updateSave()\r\n    self.script_state = JSON.encode({ val })\r\nend\r\n\r\n-- ---------- UI ----------\r\n\r\nfunction rebuildUI()\r\n    local fontColor = getFontColor(val)\r\n\r\n    local xml = [[\r\n    <Panel width=\"800\" height=\"800\" position=\"0 50 -60\" rotation=\"180 180 0\">\r\n        <Text\r\n            id=\"score\"\r\n            text=\"]] .. val .. [[\"\r\n            fontSize=\"420\"\r\n            fontStyle=\"Bold\"\r\n            alignment=\"MiddleCenter\"\r\n            color=\"]] .. fontColor .. [[\"\r\n        />\r\n    </Panel>\r\n    ]]\r\n\r\n    self.UI.setXml(xml)\r\nend\r\n\r\nfunction getFontColor(v)\r\n    if v == 5 then return \"#FFFF00\" end\r\n    if v == 6 then return \"#FFCC00\" end\r\n    if v == 7 then return \"#FF8800\" end\r\n    if v == 8 then return \"#00FF00\" end\r\n    return \"#FFFFFF\"\r\nend\r\n\r\n-- ---------- BUTTONS ----------\r\n\r\nfunction createButtons()\r\n    self.clearButtons()\r\n\r\n    -- Single invisible button that handles both clicks\r\n    self.createButton({\r\n        click_function = \"onClick\",\r\n        function_owner = self,\r\n        position = {0, 0.4, 0},\r\n        width = 1400,\r\n        height = 2200,\r\n        color = {0,0,0,0},\r\n        tooltip = self.getName()\r\n    })\r\nend\r\n\r\nfunction onClick(_, player_color, alt_click)\r\n    local delta = alt_click and -1 or 1\r\n    setValue(val + delta, player_color)\r\nend\r\n\r\n-- ---------- LOGIC ----------\r\n\r\nfunction setValue(newVal, player_color)\r\n    newVal = math.max(MIN_VALUE, math.min(MAX_VALUE, newVal))\r\n    if newVal == val then return end\r\n\r\n    if val<newVal then broadcastToAll(color..\" Player scores! (\"..newVal..\" points)\", {1, 1, 0}) end\r\n    if val>newVal then broadcastToAll(color..\" Player loses a point! (\"..newVal..\" points)\", {1, 1, 0}) end\r\n\r\n    val = newVal\r\n    rebuildUI()\r\n    createButtons()\r\n    updateSave()\r\n\r\n    Global.call(\"onAdjustScoreRemote\", {\r\n        player_color = player_color,\r\n        new_score = val\r\n    })\r\nend\r\n\r\n-- ---------- UTIL ----------\r\n\r\nfunction reset_val()\r\n    val = 0\r\n    rebuildUI()\r\n    createButtons()\r\n    updateSave()\r\nend\r\n\r\nself.max_typed_number = 99\r\nfunction onNumberTyped(_, int)\r\n    setValue(int)\r\nend",
      "LuaScriptState": "[0]"
    },
    {
      "GUID": "96b1d9",
      "Name": "Custom_Token",
      "Transform": {
        "posX": 211.0,
        "posY": 1.1,
        "posZ": 6.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 0.75,
        "scaleY": 1.0,
        "scaleZ": 0.75
      },
      "Nickname": "Purple Points",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.8344949,
        "g": 0.0305303223,
        "b": 0.8344949
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": false,
      "Autoraise": false,
      "Sticky": false,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "CustomImage": {
        "ImageURL": "https://steamusercontent-a.akamaihd.net/ugc/13972340856252448540/DDCC83524ED154C1F937AC5319E4903077E4A335/",
        "ImageSecondaryURL": "",
        "ImageScalar": 1.0,
        "WidthScale": 0.0,
        "CustomToken": {
          "Thickness": 0.1,
          "MergeDistancePixels": 15.0,
          "StandUp": false,
          "Stackable": false
        }
      },
      "LuaScript": "MIN_VALUE = 0\r\nMAX_VALUE = 21\r\n\r\nlocal val = 0\r\nlocal color = \"\"\r\n\r\n-- ---------- LOAD / SAVE ----------\r\n\r\nfunction onLoad(saved_data)\r\n    color = self.getName():match(\"^%S+\") or \"\"\r\n\r\n    if saved_data ~= \"\" then\r\n        local ok, data = pcall(JSON.decode, saved_data)\r\n        if ok and data and data[1] then\r\n            val = data[1]\r\n        end\r\n    end\r\n\r\n    rebuildUI()\r\n    createButtons()\r\nend\r\n\r\nfunction updateSave()\r\n    self.script_state = JSON.encode({ val })\r\nend\r\n\r\n-- ---------- UI ----------\r\n\r\nfunction rebuildUI()\r\n    local fontColor = getFontColor(val)\r\n\r\n    local xml = [[\r\n    <Panel width=\"800\" height=\"800\" position=\"0 50 -60\" rotation=\"180 180 0\">\r\n        <Text\r\n            id=\"score\"\r\n            text=\"]] .. val .. [[\"\r\n            fontSize=\"420\"\r\n            fontStyle=\"Bold\"\r\n            alignment=\"MiddleCenter\"\r\n            color=\"]] .. fontColor .. [[\"\r\n        />\r\n    </Panel>\r\n    ]]\r\n\r\n    self.UI.setXml(xml)\r\nend\r\n\r\nfunction getFontColor(v)\r\n    if v == 5 then return \"#FFFF00\" end\r\n    if v == 6 then return \"#FFCC00\" end\r\n    if v == 7 then return \"#FF8800\" end\r\n    if v == 8 then return \"#00FF00\" end\r\n    return \"#FFFFFF\"\r\nend\r\n\r\n-- ---------- BUTTONS ----------\r\n\r\nfunction createButtons()\r\n    self.clearButtons()\r\n\r\n    -- Single invisible button that handles both clicks\r\n    self.createButton({\r\n        click_function = \"onClick\",\r\n        function_owner = self,\r\n        position = {0, 0.4, 0},\r\n        width = 1400,\r\n        height = 2200,\r\n        color = {0,0,0,0},\r\n        tooltip = self.getName()\r\n    })\r\nend\r\n\r\nfunction onClick(_, player_color, alt_click)\r\n    local delta = alt_click and -1 or 1\r\n    setValue(val + delta, player_color)\r\nend\r\n\r\n-- ---------- LOGIC ----------\r\n\r\nfunction setValue(newVal, player_color)\r\n    newVal = math.max(MIN_VALUE, math.min(MAX_VALUE, newVal))\r\n    if newVal == val then return end\r\n\r\n    if val<newVal then broadcastToAll(color..\" Player scores! (\"..newVal..\" points)\", {1, 1, 0}) end\r\n    if val>newVal then broadcastToAll(color..\" Player loses a point! (\"..newVal..\" points)\", {1, 1, 0}) end\r\n\r\n    val = newVal\r\n    rebuildUI()\r\n    createButtons()\r\n    updateSave()\r\n\r\n    Global.call(\"onAdjustScoreRemote\", {\r\n        player_color = player_color,\r\n        new_score = val\r\n    })\r\nend\r\n\r\n-- ---------- UTIL ----------\r\n\r\nfunction reset_val()\r\n    val = 0\r\n    rebuildUI()\r\n    createButtons()\r\n    updateSave()\r\nend\r\n\r\nself.max_typed_number = 99\r\nfunction onNumberTyped(_, int)\r\n    setValue(int)\r\nend",
      "LuaScriptState": "[0]"
    },
    {
      "GUID": "7deec9",
      "Name": "PiecePack_Moons",
      "Transform": {
        "posX": -46.75,
        "posY": -5.0,
        "posZ": 0.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 1.3499999,
        "scaleY": 1.3499999,
        "scaleZ": 1.3499999
      },
      "Nickname": "Riftbound Card Menu",
      "Description": "Menu for managing might, equipment, and spawning tokens",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "\nprop_id = \"cyberpunk-card-menu\"\nversion = \"1.0.0\"\n\nlocal encoder\ndo\n\tlocal mt = {\n\t\t__index = function(self, index)\n\t\t\treturn function(args) return rawget(self, \"object\").call(\"API\" .. index, args) end\n\t\tend\n\t}\n\n\tencoder = function()\n\t\tlocal object = Global.getVar(\"Encoder\")\n\t\treturn object ~= nil and setmetatable({ object = object }, mt) or nil\n\tend\nend\n\nlocal function register_module()\n\tlocal enc = encoder()\n\tif enc == nil then return end\n\n\tif tonumber(enc.object.getVar(\"version\"):match(\"%d+%.%d+\")) < 4.4 then\n\t\tbroadcastToAll(\"encoder version must be >=4.4\", { 1, 0, 0, 1 })\n\t\terror(\"bad encoder version\")\n\tend\n\n\tenc.registerProperty {\n\t\tpropID = prop_id,\n\t\tname = \"Card Menu\",\n\t\tvalues = { \"cyberpunk_might\", \"cyberpunk_cards_equipped\", \"cyberpunk_equipped_spawns\"  },\n\t\ttags = \"basic,counter\",\n\t\tvisible = false,\n\t\tvisible_in_hand = 0,\n\n\t\tfuncOwner = self,\n\t\tactivateFunc = \"\",\n\t}\n\n\tenc.registerValue {\n\t\tvalueID = \"cyberpunk_might\",\n\t\tvalidType = \"nil\",\n\t\tdesc = \"\",\n\t\tdefault = {},\n\t}\n\n\tenc.registerValue {\n\t\tvalueID = \"cyberpunk_cards_equipped\",\n\t\tvalidType = \"nil\",\n\t\tdesc = \"\",\n\t\tdefault = {},\n\t}\n\n\tenc.registerValue {\n\t    valueID = \"cyberpunk_equipped_spawns\",\n\t    validType = \"nil\",\n\t    desc = \"Cached GMNotes.spawn of equipped cards\",\n\t    default = {}\n\t}\n\nend\n\nbuffZoneGuid = \"2fad01\"\nfunction isObjectInBuffZone(obj)\n\t\tlocal isInBuffZone = false\n\t\tlocal isInChampionZone = false\n    if not obj then return false end\n    for _, z in ipairs(obj.getZones()) do\n        if z.guid == buffZoneGuid then\n            isInBuffZone = true\n        end\n\t\t\t\tif z.getName() == \"MaterialDeckZone\" then\n\t\t\t\t\tisInChampionZone = true\n\t\t\t\tend\n    end\n    return isInBuffZone and not isInChampionZone\nend\n\nfunction init_card(card)\n\tif card.tag ~= \"Card\" or card.getName()==\"Quick Actions Panel\" then return end\n\tif card.getVar('noencode') ~= nil and card.getVar('noencode') == true then return end\n\n\tlocal gm_notes = parseGMNotes(card.getGMNotes())\n\tif not gm_notes[\"type\"] or gm_notes[\"type\"]==\"rune\" then return end\n\n\tlocal enc = encoder()\n\tif enc == nil then return end\n\n\tif not enc.objectExists { obj = card } then enc.encodeObject { obj = card } end\n\n\tif not enc.propertyExists { propID = prop_id } then return end\n\n\tif not enc.objIsPropEnabled { obj = card, propID = prop_id } then\n\t\tenc.objEnableProp { obj = card, propID = prop_id }\n\t\tenc.rebuildButtons { obj = card }\n\tend\nend\n\nequip_rows = 3\n\nlocal function equipped_offset(i)\n\tlocal col = math.floor(i / equip_rows)\n\tlocal row = i % equip_rows\n\treturn Vector(-1.85 - 1.35 * col, 0.07 + row * (-0.05 / equip_rows), -0.58 + row * (1.7 / equip_rows))\nend\n\nlocal function attachment_guid(attached)\n\tif attached and type(attached.getGUID) == \"function\" then\n\t\treturn attached.getGUID()\n\telseif type(attached) == \"table\" then\n\t\treturn attached.guid\n\tend\n\treturn nil\nend\n\nlocal function normalize_equipped_cards(host, data)\n\tdata.cyberpunk_cards_equipped = data.cyberpunk_cards_equipped or {}\n\tlocal raw = data.cyberpunk_cards_equipped\n\n\tif type(raw.slot_count) == \"number\" and type(raw.slots) == \"table\" then\n\t\treturn raw\n\tend\n\n\tlocal migrated = { slot_count = 0, slots = {} }\n\tif type(raw) == \"table\" and #raw > 0 and type(raw[1]) == \"number\" then\n\t\tlocal atts = host.getAttachments() or {}\n\t\tfor i, idx in ipairs(raw) do\n\t\t\tlocal guid = attachment_guid(atts[idx])\n\t\t\tmigrated.slot_count = i\n\t\t\tmigrated.slots[i] = (type(guid) == \"string\" and guid ~= \"\") and guid or false\n\t\tend\n\telseif type(raw) == \"table\" then\n\t\tfor i, guid in ipairs(raw) do\n\t\t\tmigrated.slot_count = i\n\t\t\tmigrated.slots[i] = (type(guid) == \"string\" and guid ~= \"\") and guid or false\n\t\tend\n\tend\n\n\tdata.cyberpunk_cards_equipped = migrated\n\treturn migrated\nend\n\nlocal function slot_guid(slot_data, slot)\n\tif not slot_data or type(slot_data.slots) ~= \"table\" then return nil end\n\tlocal v = slot_data.slots[slot]\n\treturn (type(v) == \"string\" and v ~= \"\") and v or nil\nend\n\nlocal function first_empty_slot(slot_data)\n\tlocal limit = math.max(slot_data.slot_count or 0, 0)\n\tfor i = 1, limit do\n\t\tif not slot_guid(slot_data, i) then\n\t\t\treturn i\n\t\tend\n\tend\n\treturn limit + 1\nend\n\nlocal function count_occupied_slots(slot_data)\n\tlocal n = 0\n\tlocal limit = math.max(slot_data.slot_count or 0, 0)\n\tfor i = 1, limit do\n\t\tif slot_guid(slot_data, i) then n = n + 1 end\n\tend\n\treturn n\nend\n\nlocal function guid_to_attachment_index(host)\n\tlocal map = {}\n\tfor i, attached in ipairs(host.getAttachments() or {}) do\n\t\tlocal guid = attachment_guid(attached)\n\t\tif type(guid) == \"string\" and guid ~= \"\" then\n\t\t\tmap[guid] = i\n\t\tend\n\tend\n\treturn map\nend\n\nlocal MAX_EQUIP_SLOTS = 18\n\nlocal function add_host_slot_unequip_buttons(host, slot_data)\n\tlocal max_slots = math.min(slot_data.slot_count or 0, MAX_EQUIP_SLOTS)\n\tfor i = 1, max_slots do\n\t\tif slot_guid(slot_data, i) then\n\t\t\tlocal slot_pos = equipped_offset(i - 1)\n\t\thost.createButton({\n\t\t\tlabel = \"X\",\n\t\t\tposition = {-(slot_pos.x + 0.55), 0.30, slot_pos.z - 0.20},\n\t\t\tscale = {0.40, 0.40, 0.40},\n\t\t\twidth = 320,\n\t\t\theight = 320,\n\t\t\tcolor = {0.15, 0.15, 0.15, 1},\n\t\t\tfont_color = {1, 1, 1, 1},\n\t\t\tfont_size = 240,\n\t\t\ttooltip = \"Unequip\",\n\t\t\tclick_function = \"unequip_equipped_slot_\" .. tostring(i),\n\t\t\tfunction_owner = self,\n\t\t})\n\t\tend\n\tend\nend\n\nfunction equip_to_overlapped_card(obj, player_color, alt_click)\n    if not obj or obj.tag ~= \"Card\" then return end\n\n\t\tlocal card_scale = obj.getScale()[1]\n\t\tlocal equipped_card_scale = card_scale/1.618\n\n    local enc = encoder()\n    if enc == nil then return end\n\n    -- Find overlapping cards beneath this equipment\n    local hits = Physics.cast({\n        origin       = obj.getPosition() + Vector(0, 0.2, 0),\n        direction    = {0, -1, 0},\n        max_distance = 1.5,\n        type         = 3, -- box\n        size         = {2.5*card_scale, 0.2, 3*card_scale}, -- roughly card footprint\n        debug        = false,\n    })\n\n    local candidates = {}\n\n    for _, hit in ipairs(hits) do\n        local hitObj = hit.hit_object\n\t\t\t\tif hitObj and hitObj ~= obj and hitObj.tag == \"Card\" and not hitObj.is_face_down then\n\t\t\t\t\tlocal parsednotes = parseGMNotes(hitObj.getGMNotes())\n\t        if parsednotes.might then\n\t            table.insert(candidates, hitObj)\n\t        end\n\t\t\t\tend\n    end\n\n    if #candidates == 0 then\n        broadcastToColor(\"No valid card to equip to.\", player_color, {1,0.4,0.4})\n        return\n    end\n\n    -- Choose top-left-most card\n    table.sort(candidates, function(a, b)\n        local pa = a.getPosition()\n        local pb = b.getPosition()\n\n        if math.abs(pa.x - pb.x) > 0.01 then\n            return pa.x < pb.x\n        end\n        return pa.z > pb.z\n    end)\n\n    local target = candidates[1]\n\n    -- Ensure encoder data exists\n    if not enc.objectExists { obj = target } then\n        enc.encodeObject { obj = target }\n    end\n\n    if not enc.objIsPropEnabled { obj = target, propID = prop_id } then\n        enc.objEnableProp { obj = target, propID = prop_id }\n    end\n\n    local data = enc.objGetPropData { obj = target, propID = prop_id }\n    local slot_data = normalize_equipped_cards(target, data)\n\t\tdata.cyberpunk_might = data.cyberpunk_might or {}\n\t\tdata.cyberpunk_equipped_spawns = data.cyberpunk_equipped_spawns or {}\n\n\t\t-- snapshot GMNotes of the gear\n\t\tif obj.getGMNotes() ~= \"\" then\n\t\t\t\tlocal parsednotes = parseGMNotes(obj.getGMNotes())\n\t\t\t\tif parsednotes.spawn then\n\t\t\t\t\ttable.insert(data.cyberpunk_equipped_spawns, parsednotes.spawn)\n\t\t\t\tend\n\t\tend\n\n    -- Position + attach\n    local slot = first_empty_slot(slot_data)\n    if slot > MAX_EQUIP_SLOTS then\n        broadcastToColor(\"No equip slots available.\", player_color, {1,0.4,0.4})\n        return\n    end\n    local offsetIndex = slot - 1\n    local angles = target.getRotation()\n\n    obj.setPosition(target.positionToWorld(equipped_offset(offsetIndex)))\n    obj.setRotation(angles, false, false)\n    obj.setScale({equipped_card_scale,equipped_card_scale,equipped_card_scale})\n    obj.locked = true\n\n    target.addAttachment(obj)\n\n    slot_data.slot_count = math.max(slot_data.slot_count or 0, slot)\n    slot_data.slots[slot] = obj.getGUID()\n\n    broadcastToColor(\n        \"Equipped to \" .. (target.getName() or \"card\"),\n        player_color,\n        {0.6, 0.9, 1}\n    )\n\n\t\tGlobal.call(\"onEquipGearRemote\", { unit_object = target, gear_object = obj, player_color = player_color })\n\n\t\tlocal targetparsednotes={}\n\t\tif obj.getGMNotes() ~= \"\" then\n\t\t\ttargetparsednotes = Global.call(\"parseGMNotes\", target.getGMNotes())\n\t\t\tif targetparsednotes.might then\n\t\t\t\tdata.cyberpunk_might.original_might = targetparsednotes.might\n\t\t\tend\n\t\tend\n\n\t\tlocal gearparsednotes={}\n\t\tif obj.getGMNotes() ~= \"\" then\n\t\t\tgearparsednotes = Global.call(\"parseGMNotes\", obj.getGMNotes())\n\t\t\tif gearparsednotes.might_delta then\n\t\t\t\tdata.cyberpunk_might.gear_might_delta = gearparsednotes.might_delta + (data.cyberpunk_might.gear_might_delta or 0)\n\t\t\tend\n\t\tend\n\n\t\tenc.objSetPropData { obj = target, propID = prop_id, data = data }\n\t\tenc.rebuildButtons { obj = target }\nend\n\nfunction imprint_to_overlapped_battlefield(obj, player_color, alt_click)\n    if not obj then return end\n    local hits = Physics.cast({\n        origin       = obj.getPosition()+vector(0,3,0),\n        direction    = {0, -1, 0},\n        max_distance = 5,\n        type         = 1, -- ray\n    })\n\n    local candidates = {}\n\n    for _, hit in ipairs(hits) do\n        local hitObj = hit.hit_object\n\t\t\t\tlocal hitObjName = hitObj.getName()\n        if hitObj\n            and hitObj ~= obj\n            and hitObj.tag == \"Tile\"\n\t\t\t\t\t\tand hitObjName\n\t\t\t\t\t\tand hitObjName:match(\"Battlefield\")\n        then\n            table.insert(candidates, hitObj)\n        end\n    end\n\n    if #candidates == 0 then\n        broadcastToColor(\"No battlefield to imprint on.\", player_color, {1,0.4,0.4})\n        return\n    end\n\n    -- Choose topmost (highest Y)\n    table.sort(candidates, function(a, b)\n        return a.getPosition().y > b.getPosition().y\n    end)\n\n    local battlefield = candidates[1]\n\n    -- Call imprint safely\n    local ok, err = pcall(function()\n        battlefield.call(\"imprintRemote\", { obj = obj, player_color = player_color })\n    end)\n\n    if not ok then\n        broadcastToColor(\"Battlefield cannot be imprinted.\", player_color, {1,0.4,0.4})\n        print(\"[IMPRINT ERROR]\", err)\n        return\n    end\n\n\t\tobj.setPositionSmooth(battlefield.getPosition()+vector(0,0.4,0), false, true)\n\t\tobj.setRotationSmooth(battlefield.getRotation()+vector(0,90,0), false, true)\n\t\tobj.alt_view_angle = {0, 180, -90}\n    broadcastToColor(\n        \"Imprinted onto battlefield.\",\n        player_color,\n        {0.6, 1, 0.6}\n    )\nend\n\nICON_URL = \"https://steamusercontent-a.akamaihd.net/ugc/9257794450975868483/676E45F977E7D9200D25263512D57E2C97BA9176/\"\nfunction updateCardUI(obj)\n\t\tlocal enc = encoder()\n    local menu_properties = enc.objGetPropData { obj = obj, propID = prop_id }\n\n\t\tif menu_properties.cyberpunk_might and menu_properties.cyberpunk_might.original_might then\n\n\t\t\tlocal originalMight = menu_properties.cyberpunk_might.original_might\n\t\t\tlocal mightTempDiff = menu_properties.cyberpunk_might.temp_might_delta or 0\n\t\t\tlocal mightGearDiff = menu_properties.cyberpunk_might.gear_might_delta or 0\n\n\t\t\tlocal totalMight = originalMight + mightTempDiff + mightGearDiff\n\n\t  \t-- Determine text color based on count relative to original might\n\t    local textColor = \"white\" -- Default color when equal to original\n\t\t\tif mightTempDiff > 0 then\n\t        textColor = \"rgba(0,200,0,1)\" -- Green color when above original\n\t    elseif mightTempDiff < 0 then\n\t        textColor = \"rgba(200,0,0,1)\" -- Red color when below original\n\t\t\telseif mightGearDiff > 0 then\n\t\t       textColor = \"rgba(0,200,200,1)\" -- Blue color when Equipped\n\t\t\tend\n\n\t    -- Calculate proper aspect ratio based on the original image dimensions (1659x873)\n\t    local imageRatio = 873 / 1659 -- height/width ratio\n\t    local imageWidth = 160\n\t    local imageHeight = imageWidth * imageRatio\n\n\t    -- Show counter with icon and outlined text - always visible for unit cards\n\t\t\tlocal xmlUI = [[\n\t\t\t<Defaults>\n\t\t\t    <Text color=\"]] .. textColor .. [[\" fontSize=\"70\" fontStyle=\"Bold\" alignment=\"MiddleCenter\" outline=\"rgba(0,0,0,1)\" outlineSize=\"3 3\" />\n\t\t\t</Defaults>\n\n\t\t\t<!-- Current Might (always visible) -->\n\t\t\t<Panel position=\"-60 -130 -100\" width=\"200\" height=\"100\" scale=\"0.6 0.6 0.6\" rotation=\"180 180 0\">\n\t\t\t    <Image image=\"]] .. ICON_URL .. [[\" color=\"white\" width=\"]] .. imageWidth .. [[\" height=\"]] .. imageHeight .. [[\" preserveAspect=\"true\" />\n\t\t\t    <Text position=\"37 0 2\" fontSize=\"80\" outline=\"true\" outlineSize=\"2 2\">]] .. totalMight .. [[</Text>\n\t\t\t</Panel>\n\n\t\t\t<!-- Original Might (only shown if mightTempDiff ~= 0) -->\n\t\t\t]]\n\n\t\t\tif mightTempDiff ~= 0 or mightGearDiff ~= 0 then\n\t\t\t    xmlUI = xmlUI .. [[\n\t\t\t    <Panel id=\"originalMightPanel\" position=\"-77 -85 -100\" width=\"200\" height=\"100\" scale=\"0.4 0.4 0.4\" rotation=\"180 180 0\">\n\t\t\t        <Image image=\"]] .. ICON_URL .. [[\" color=\"white\" width=\"]] .. imageWidth .. [[\" height=\"]] .. imageHeight .. [[\" preserveAspect=\"true\" />\n\t\t\t        <Text position=\"37 0 2\" fontSize=\"80\" outline=\"true\" outlineSize=\"2 2\" color=\"#888888\">]] .. originalMight .. [[</Text> <!-- Greyed out to indicate \"old\" value -->\n\t\t\t    </Panel>\n\t\t\t    ]]\n\t\t\tend\n\n\t\t\txmlUI = xmlUI .. [[\n\t\t\t]]\n\n\t\t\tobj.UI.setXml(xmlUI)\n\t\tend\nend\n\nfunction adjust_might(obj, player_color, alt_click, temp_delta_delta)\n\tlocal enc = encoder()\n\tif enc == nil then return end\n\tlocal menu_properties = enc.objGetPropData { obj = obj, propID = prop_id }\n\tlocal might_data = menu_properties.cyberpunk_might or {}\n\tlocal original_might = might_data.original_might or 0\n\tlocal temp_might_delta = might_data.temp_might_delta or 0\n\tlocal gear_might_delta = might_data.gear_might_delta or 0\n\tmight_data.temp_might_delta = temp_might_delta+temp_delta_delta\n\tenc.objSetPropData { obj = obj, propID = prop_id, data = { cyberpunk_might = might_data } }\n\tGlobal.call(\"onAdjustMightRemote\", {\n\t\t\tobj = obj,\n\t\t\ttotal_might = original_might+temp_might_delta+gear_might_delta\n\t})\n\tupdateCardUI(obj)\nend\n\nfunction increase_might(obj, player_color, alt_click)\n\tadjust_might(obj, player_color, alt_click, 1)\nend\n\nfunction decrease_might(obj, player_color, alt_click)\n\tadjust_might(obj, player_color, alt_click, -1)\nend\n\nfunction reset_might(obj, player_color, alt_click)\n\tlocal enc = encoder()\n\tif enc == nil then return end\n\tlocal menu_properties = enc.objGetPropData { obj = obj, propID = prop_id }\n\tlocal might_data = menu_properties.cyberpunk_might or {}\n\tlocal original_might = might_data.original_might or 0\n\tlocal temp_might_delta = might_data.temp_might_delta or 0\n\tlocal gear_might_delta = might_data.gear_might_delta or 0\n\tmight_data.temp_might_delta = 0\n\tenc.objSetPropData { obj = obj, propID = prop_id, data = { cyberpunk_might = might_data } }\n\tGlobal.call(\"onAdjustMightRemote\", {\n\t\t\tobj = obj,\n\t\t\ttotal_might = original_might+temp_might_delta+gear_might_delta\n\t})\n\tupdateCardUI(obj)\nend\n\n\n-- Parse gmNotes JSON\nfunction parseGMNotes(gmNotes)\n    local success, data = pcall(JSON.decode, gmNotes)\n    return success and data or {}\nend\n\nlocal function getSpawnNotes(obj)\n    -- 1) Unit itself\n    if obj.getGMNotes() ~= \"\" then\n\t\t\t\tlocal parsednotes = parseGMNotes(obj.getGMNotes())\n\t\t\t\tif parsednotes.spawn then\n\t\t\t\t\treturn parsednotes.spawn\n\t\t\t\tend\n    end\n\n    -- 2) Cached equipped gear notes\n    local enc = encoder()\n    if not enc then return nil end\n\n    local props = enc.objGetPropData { obj = obj, propID = prop_id }\n    local equippedSpawns = props and props.cyberpunk_equipped_spawns or {}\n\n    for _, spawn in ipairs(equippedSpawns) do\n        if spawn ~= \"\" then\n           return spawn\n        end\n    end\n\n    return nil\nend\n\nfunction refreshButtons(obj)\n\tif obj.tag ~= \"Card\" or obj.getName() == \"flourish\" then return end\n\tlocal enc = encoder()\n\tif enc == nil then return end\n\n\tlocal flip = enc.getFlip { obj = obj } or 1\n\tif flip == -1 then return end\n\n  if not isObjectInBuffZone(obj) then return end\n\n\tlocal parsednotes={}\n\tif obj.getGMNotes() ~= \"\" then\n\t\tparsednotes = Global.call(\"parseGMNotes\", obj.getGMNotes())\n\tend\n\n\tlocal menu_properties = enc.objGetPropData { obj = obj, propID = prop_id }\n\tlocal slot_data = normalize_equipped_cards(obj, menu_properties)\n\tif count_occupied_slots(slot_data) > 0 then\n\t\tobj.createButton {\n\t\t\tlabel = \"X\",\n\t\t\tposition = {1.65, 0.3, -1.4},\n\t\t\tscale = {0.45, 0.45, 0.45},\n\t\t\twidth = 550,\n\t\t\theight = 550,\n\t\t\tcolor = {0.15, 0.15, 0.15, 1},\n\t\t\tfont_color = {1, 1, 1, 1},\n\t\t\tfont_size = 420,\n\n\t\t\ttooltip = \"unequip all\",\n\n\t\t\tclick_function = 'unequip_all',\n\t\t\tfunction_owner = self,\n\t\t}\n\n\t\tadd_host_slot_unequip_buttons(obj, slot_data)\n\tend\n\n\tif parsednotes.might then\n\t\tlocal might_data = menu_properties.cyberpunk_might or {}\n\t\tmight_data[\"original_might\"] = parsednotes.might\n\t\tenc.objSetPropData { obj = obj, propID = prop_id, data = { cyberpunk_might = might_data } }\n\n\t\tif (might_data.temp_might_delta ~=0 or might_data.gear_might_delta~=0) then\n\t\t\tobj.createButton({\n\t\t\t\t\tfunction_owner = self,\n\t\t\t\t\tlabel = \"+\",\n\t\t\t\t\tposition = {0.9, 0.5, -0.8},\n\t\t\t\t\tscale = {1, 1, 0.8},\n\t\t\t\t\twidth = 280,\n\t\t\t\t\theight = 280,\n\t\t\t\t\tcolor = {0.1, 0.6, 0.1, 0},\n\t\t\t\t\tfont_size = 400,\n\t\t\t\t\tfont_color = {1, 1, 1, 1},\n\t\t\t\t\ttooltip = \"Reset Might\",\n\t\t\t\t\tclick_function = \"reset_might\"\n\t\t\t})\n\t\tend\n\n\t\tobj.createButton({\n\t\t\t\tfunction_owner = self,\n\t\t\t\tlabel = \"+\",\n\t\t\t\tposition = {0.9, 0.5, -0.4},\n\t\t\t\tscale = {1, 1, 0.8},\n\t\t\t\twidth = 280,\n\t\t\t\theight = 280,\n\t\t\t\tcolor = {0.1, 0.6, 0.1, 1},\n\t\t\t\tfont_size = 400,\n\t\t\t\tfont_color = {1, 1, 1, 1},\n\t\t\t\ttooltip = \"Increase might\",\n\t\t\t\tclick_function = \"increase_might\"\n\t\t})\n\n\t\tobj.createButton({\n\t\t\t\tfunction_owner = self,\n\t\t\t\tlabel = \"-\",\n\t\t\t\tposition = {0.9, 0.5, 0.05},\n\t\t\t\tscale = {1, 1, 0.8},\n\t\t\t\twidth = 280,\n\t\t\t\theight = 280,\n\t\t\t\tcolor = {0.7, 0.1, 0.1, 1},\n\t\t\t\tfont_size = 400,\n\t\t\t\tfont_color = {1, 1, 1, 1},\n\t\t\t\ttooltip = \"Decrease might\",\n\t\t\t\tclick_function = \"decrease_might\"\n\t\t})\n\tend\n\tlocal spawnNotes = getSpawnNotes(obj)\n\tif spawnNotes then\n\t    obj.createButton({\n\t        function_owner = self,\n\t        label = \"✦\",\n\t        position = {0.0, 0.3, 1.5},\n\t        scale = {0.5, 0.5, 0.5},\n\t        width = 550,\n\t        height = 550,\n\t        color = {0, 0, 0, 1},\n\t        font_color = {250, 215, 0, 1},\n\t        font_size = 500,\n\t        tooltip = \"Spawn token\",\n\t        click_function = \"spawn_token_from_unit\"\n\t    })\n\tend\n\n\tif parsednotes.might_delta then\n\t\tobj.createButton({\n\t\t\tfunction_owner = self,\n\t\t\t\tlabel = \"EQ\",  -- Spawn symbol\n\t\t\t\tposition = {0.8, 0.3, -0.5},\n\t\t\t\tscale = {0.5, 0.5, 0.5},\n\t\t\t\twidth = 600,\n\t\t\t\theight = 600,\n\t\t\t\tcolor = {0, 0, 0, 1},\n\t\t\t\tfont_color = {0, 215, 250, 1},\n\t\t\t\tfont_size = 500,\n\t\t\t\ttooltip = \"Equip\",\n\t\t\t\tclick_function = \"equip_to_overlapped_card\"\n\t\t})\n\tend\n\n\tif parsednotes.type == \"battlefield\" then\n\t\tobj.createButton({\n\t\t\t\tfunction_owner = self,\n\t\t\t\tlabel = \"❖\",  -- Spawn symbol\n\t\t\t\tposition = {0, 0.8, -1.2},\n\t\t\t\tscale = {0.5, 0.5, 0.5},\n\t\t\t\twidth = 600,\n\t\t\t\theight = 600,\n\t\t\t\tcolor = {0, 0, 0, 1},\n\t\t\t\tfont_color = {0, 215, 250, 1},\n\t\t\t\tfont_size = 500,\n\t\t\t\ttooltip = \"Imprint\",\n\t\t\t\tclick_function = \"imprint_to_overlapped_battlefield\"\n\t\t})\n\tend\n\n\tupdateCardUI(obj)\nend\n\nfunction createButtons(params)\nrefreshButtons(params.obj)\n\nend\n\nlocal function unequip_single_equipped_slot(host, slot, player_color)\n\tlocal enc = encoder()\n\tif enc == nil or not host or host.tag ~= \"Card\" then return end\n\n\tlocal menu_properties = enc.objGetPropData { obj = host, propID = prop_id }\n\tlocal slot_data = normalize_equipped_cards(host, menu_properties)\n\tif slot < 1 or slot > (slot_data.slot_count or 0) then return end\n\n\tlocal gear_guid = slot_guid(slot_data, slot)\n\tif not gear_guid then return end\n\tlocal att_index = guid_to_attachment_index(host)[gear_guid]\n\tif not att_index then\n\t\tslot_data.slots[slot] = false\n\t\tenc.objSetPropData {\n\t\t\tobj = host,\n\t\t\tpropID = prop_id,\n\t\t\tdata = {\n\t\t\t\tcyberpunk_might = menu_properties.cyberpunk_might or {},\n\t\t\t\tcyberpunk_cards_equipped = slot_data,\n\t\t\t\tcyberpunk_equipped_spawns = menu_properties.cyberpunk_equipped_spawns or {},\n\t\t\t}\n\t\t}\n\t\tenc.rebuildButtons { obj = host }\n\t\treturn\n\tend\n\n\tlocal released = host.removeAttachment(att_index - 1)\n\tif not released then return end\n\tslot_data.slots[slot] = false\n\n\tlocal parsednotes = parseGMNotes(released.getGMNotes())\n\tif parsednotes.spawn and menu_properties.cyberpunk_equipped_spawns then\n\t\tfor j = #menu_properties.cyberpunk_equipped_spawns, 1, -1 do\n\t\t\tif menu_properties.cyberpunk_equipped_spawns[j] == parsednotes.spawn then\n\t\t\t\ttable.remove(menu_properties.cyberpunk_equipped_spawns, j)\n\t\t\t\tbreak\n\t\t\tend\n\t\tend\n\tend\n\tif parsednotes.might_delta and menu_properties.cyberpunk_might then\n\t\tmenu_properties.cyberpunk_might.gear_might_delta =\n\t\t\t(menu_properties.cyberpunk_might.gear_might_delta or 0) - parsednotes.might_delta\n\tend\n\n\tlocal i = slot\n\tlocal unequip_offset = Vector(-1.6 + i * -0.55, 0.1 + i * 0.6, -1 + i * 0.45)\n\treleased.setPositionSmooth(host.positionToWorld(unequip_offset), false, true)\n\treleased.setScale(host.getScale())\n\treleased.setRotation(host.getRotation())\n\treleased.setVelocity({0,0,0})\n\treleased.setAngularVelocity({0,0,0})\n\treleased.locked = false\n\n\tenc.objSetPropData {\n\t\tobj = host,\n\t\tpropID = prop_id,\n\t\tdata = {\n\t\t\tcyberpunk_might = menu_properties.cyberpunk_might or {},\n\t\t\tcyberpunk_cards_equipped = slot_data,\n\t\t\tcyberpunk_equipped_spawns = menu_properties.cyberpunk_equipped_spawns or {},\n\t\t}\n\t}\n\tenc.rebuildButtons { obj = host }\nend\n\nfor i = 1, MAX_EQUIP_SLOTS do\n\t_G[\"unequip_equipped_slot_\" .. tostring(i)] = function(host, player_color, alt_click)\n\t\tunequip_single_equipped_slot(host, i, player_color)\n\tend\nend\n\nfunction unequip_all(obj, player_color)\n\tlocal enc = encoder()\n\tif enc == nil then return end\n\n\tlocal menu_properties = enc.objGetPropData { obj = obj, propID = prop_id }\n\tlocal slot_data = normalize_equipped_cards(obj, menu_properties)\n\tif count_occupied_slots(slot_data) == 0 then return end\n\n\tfor i = (slot_data.slot_count or 0), 1, -1 do\n\t\t\tlocal guid = slot_guid(slot_data, i)\n\t\t\tif guid then\n\t\t\t\tlocal idx = guid_to_attachment_index(obj)[guid]\n\t\t\t\tlocal new = idx and obj.removeAttachment(idx - 1) or nil\n\t\t\t\tif new then\n\t\t\tlocal unequip_offset = Vector(-1.6+ i*-0.55, 0.1 + i*0.6, -1 + i* 0.45)\n\t\t\tnew.setPositionSmooth(obj.positionToWorld(unequip_offset), false, true)\n\t    new.setScale(obj.getScale())\n\t\t\tnew.setRotation( obj.getRotation() )\n\t\t\tnew.setVelocity({0,0,0})\n\t\t\tnew.setAngularVelocity({0,0,0})\n\t\t\tnew.locked = false\n\t\t\t\tend\n\t\t\tend\n\tend\n\n\tlocal might_data = menu_properties.cyberpunk_might or {}\n\tmight_data[\"gear_might_delta\"] = 0\n\tenc.objSetPropData {\n\t\tobj = obj,\n\t\tpropID = prop_id,\n\t\tdata = {\n\t\t\tcyberpunk_might = might_data,\n\t\t\tcyberpunk_cards_equipped = { slot_count = 0, slots = {} },\n\t\t\tcyberpunk_equipped_spawns = {}\n\t\t}\n\t}\n\tenc.rebuildButtons { obj = obj }\nend\n\nfunction spawn_token_from_unit(obj, player_color, alt_click)\n    if not obj or obj.tag ~= \"Card\" then return end\n\n    local spawn_name = getSpawnNotes(obj)\n    if not spawn_name then return end\n\n    local new_token = spawn_token(obj, spawn_name, player_color, alt_click)\nend\n\nfunction spawn_token(obj, spawn_name, player_color, alt_click)\n\t\tif not obj or obj.tag ~= \"Card\" then return end\n    if not spawn_name or spawn_name == \"\" then return end\n\n    local i = 0\n    for name in string.gmatch(spawn_name, \"([^;]+)\") do\n        name = name:match(\"^%s*(.-)%s*$\")\n        if name ~= \"\" then\n            local new = Global.call(\"spawnFromNameFragmentRemote\", {\n                nameFragment = name,\n                player_color = player_color\n            })\n\n\t\t\t\t\t\tif new then\n                -- HARD STOP: prevent instant deck merge\n                new.locked = true\n                new.setVelocity({0,0,0})\n                new.setAngularVelocity({0,0,0})\n\n                -- spawn in local space, slightly elevated\n                local localOffset = Vector(\n                    -2 - 1 * i,\n                    1.2,            -- IMPORTANT: high enough to avoid deck snap\n                    0.3 * i\n                )\n\n                new.setPositionSmooth(obj.positionToWorld(localOffset), false, true)\n                new.setRotation(obj.getRotation(), false, true)\n\n\n                -- finalize next frame\n                Wait.frames(function()\n                    if not new or new.tag ~= \"Card\" then return end\n                    new.locked = false\n                    init_card(new)\n                end, 2)\n\n                i = i + 1\n            end\n        end\n    end\nend\n\nlocal function isHandZone(zone)\n\t\treturn zone.tag==\"Hand\"\nend\n\n\nlocal function cleanupCardLeavingPlay(card)\n    if not card or card.tag ~= \"Card\" or card.getName() == \"flourish\" then return end\n\n\n    local enc = encoder()\n    if not enc then return end\n    if not enc.objectExists { obj = card } then return end\n    if not enc.objIsPropEnabled { obj = card, propID = prop_id } then return end\n\n    local data = enc.objGetPropData { obj = card, propID = prop_id } or {}\n\n    if data.cyberpunk_might then\n        data.cyberpunk_might.temp_might_delta = 0\n        data.cyberpunk_might.gear_might_delta = 0\n    end\n\n    enc.objSetPropData {\n        obj = card,\n        propID = prop_id,\n        data = data\n    }\n\n\t\tunequip_all(card, nil)\n\n    card.UI.setXml(\"\") -- clear UI overlay\n    enc.rebuildButtons { obj = card }\nend\n\nlocal destroyedGuids = {}\n\nfunction onObjectDestroy(obj)\n  if obj then\n    destroyedGuids[obj.guid] = true\n  end\nend\n\nfunction onObjectLeaveZone(zone, obj)\n  if not obj or obj.tag ~= \"Card\" or obj.getName()==\"Quick Actions Panel\" then return end\n\n  if zone.guid ~= buffZoneGuid then return end\n\n  local guid = obj.guid\n\n  Wait.frames(function()\n    if not destroyedGuids[guid] then\n      cleanupCardLeavingPlay(obj)\n    end\n\t\tdestroyedGuids[guid] = nil\n  end, 1)\n\n\nend\n\nfunction onObjectEnterZone(zone, obj)\n    if not obj or obj.tag ~= \"Card\" then return end\n    if not isHandZone(zone) then return end\n\n  \tcleanupCardLeavingPlay(obj)\nend\n\n\nfunction onload()\n\tself.addContextMenuItem(\"Register Module\", register_module)\n\tGlobal.setVar('Cyberpunk_CardMenu', self)\n\tWait.condition(register_module, function() return Global.getVar(\"Encoder\") ~= nil end, 30)\nend\n\nfunction onObjectDropped(ply, obj)\n\tinit_card(obj)\n\tlocal enc = encoder()\n\tif not enc or not obj or obj.tag ~= \"Card\" then return end\n\tif not enc.objectExists { obj = obj } then return end\n\tif not enc.objIsPropEnabled { obj = obj, propID = prop_id } then return end\n\n\t-- Rebuild immediately and for a short burst while the card is still in motion,\n\t-- so equip/load buttons appear during the fall instead of after settling.\n\tenc.rebuildButtons { obj = obj }\n\tfor f = 1, 20 do\n\t\tWait.frames(function()\n\t\t\tif obj and enc.objectExists { obj = obj } and enc.objIsPropEnabled { obj = obj, propID = prop_id } then\n\t\t\t\tenc.rebuildButtons { obj = obj }\n\t\t\tend\n\t\tend, f)\n\tend\nend\n\nfunction onObjectRotate(rotated_object, spin, flip, player_color, old_spin, old_flip)\n\tinit_card(rotated_object)\nend\n",
      "LuaScriptState": ""
    },
    {
      "GUID": "7dffc9",
      "Name": "PiecePack_Moons",
      "Transform": {
        "posX": -46.75,
        "posY": -5.0,
        "posZ": 0.0,
        "rotX": 90.0,
        "rotY": 270.0,
        "rotZ": 0.0,
        "scaleX": 1.3499999,
        "scaleY": 1.3499999,
        "scaleZ": 1.3499999
      },
      "Nickname": "Riftbound Deck Codes",
      "Description": "Encode and Decode riftbound decks in LUA",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "MeshIndex": 1,
      "LuaScript": "-- Cyberpunk Deck Code library (Format 1, Version 3) for Tabletop Simulator\r\n-- Mirrors: https://github.com/Piltover-Archive/CyberpunkDeckCodes\r\n\r\nlocal bit = bit32 or bit\r\nif not bit then\r\n    error(\"bit32 library not found; TTS Lua requires bit32 for deckcode decoding\")\r\nend\r\nlocal bit32 = bit\r\n\r\nlocal M = {}\r\n\r\n---------------------------------------------------------------------\r\n-- BASE32 (RFC 4648)\r\n---------------------------------------------------------------------\r\nlocal BASE32_ALPHABET = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\"\r\nlocal BASE32_INV = {}\r\nfor i = 1, #BASE32_ALPHABET do\r\n    BASE32_INV[string.byte(BASE32_ALPHABET, i)] = i - 1\r\nend\r\n\r\n-- Streaming Base32 decode (RFC 4648)\r\nlocal function base32Decode(str)\r\n    local out = {}\r\n    local buffer = 0\r\n    local bitsLeft = 0\r\n\r\n    str = str:gsub(\"%s+\", \"\")\r\n    str = str:gsub(\"=+$\", \"\")\r\n\r\n    for i = 1, #str do\r\n        local v = BASE32_INV[string.byte(str, i)]\r\n        if v == nil then\r\n            return nil\r\n        end\r\n\r\n        buffer = bit.bor(bit.lshift(buffer, 5), v)\r\n        bitsLeft = bitsLeft + 5\r\n\r\n        while bitsLeft >= 8 do\r\n            bitsLeft = bitsLeft - 8\r\n            local byte = bit.band(bit.rshift(buffer, bitsLeft), 0xFF)\r\n            out[#out + 1] = byte\r\n        end\r\n    end\r\n\r\n    return out\r\nend\r\n\r\nlocal function base32Encode(bytes)\r\n    local out = {}\r\n    local buffer = 0\r\n    local bitsLeft = 0\r\n\r\n    for i = 1, #bytes do\r\n        buffer = bit.bor(bit.lshift(buffer, 8), bytes[i])\r\n        bitsLeft = bitsLeft + 8\r\n\r\n        while bitsLeft >= 5 do\r\n            bitsLeft = bitsLeft - 5\r\n            local index = bit.band(bit.rshift(buffer, bitsLeft), 0x1F)\r\n            out[#out + 1] = string.sub(BASE32_ALPHABET, index + 1, index + 1)\r\n        end\r\n    end\r\n\r\n    if bitsLeft > 0 then\r\n        buffer = bit.lshift(buffer, 5 - bitsLeft)\r\n        local index = bit.band(buffer, 0x1F)\r\n        out[#out + 1] = string.sub(BASE32_ALPHABET, index + 1, index + 1)\r\n    end\r\n\r\n    return table.concat(out)\r\nend\r\n\r\n---------------------------------------------------------------------\r\n-- VARINT (DECODE/ENCODE)\r\n---------------------------------------------------------------------\r\nlocal function readVarint(bytes, pos)\r\n    local result = 0\r\n    local shift = 0\r\n    local startPos = pos.pos\r\n\r\n    while true do\r\n        if pos.pos > #bytes then\r\n            error(\"Unexpected EOF while reading varint at pos \" .. startPos)\r\n        end\r\n\r\n        local b = bytes[pos.pos]\r\n        pos.pos = pos.pos + 1\r\n\r\n        result = result + bit32.lshift(bit32.band(b, 0x7F), shift)\r\n\r\n        if bit32.band(b, 0x80) == 0 then\r\n            return result, startPos, pos.pos - 1\r\n        end\r\n\r\n        shift = shift + 7\r\n        if shift > 35 then\r\n            error(\"Varint too large / corrupted at pos \" .. startPos)\r\n        end\r\n    end\r\nend\r\n\r\nlocal function writeVarint(value)\r\n    if value == 0 then\r\n        return { 0 }\r\n    end\r\n\r\n    local out = {}\r\n    while value ~= 0 do\r\n        local byteVal = bit.band(value, 0x7F)\r\n        value = bit.rshift(value, 7)\r\n\r\n        if value ~= 0 then\r\n            byteVal = bit.bor(byteVal, 0x80)\r\n        end\r\n\r\n        out[#out + 1] = byteVal\r\n    end\r\n\r\n    return out\r\nend\r\n\r\nlocal function appendBytes(dst, src)\r\n    for i = 1, #src do\r\n        dst[#dst + 1] = src[i]\r\n    end\r\nend\r\n\r\n---------------------------------------------------------------------\r\n-- SET + VARIANT MAPPINGS (must be filled using your data)\r\n---------------------------------------------------------------------\r\nlocal SET_MAP = rawget(_G, \"SET_MAP\") or {\r\n    OGN = 0,\r\n    OGS = 1,\r\n    ARC = 2,\r\n    SFD = 3,\r\n}\r\n_G.SET_MAP = SET_MAP\r\n\r\nlocal VARIANT_MAP = rawget(_G, \"VARIANT_MAP\") or {\r\n    [\"\"] = 0,\r\n    a = 1,\r\n    s = 2,\r\n    [\"*\"] = 2,\r\n    b = 3,\r\n}\r\n_G.VARIANT_MAP = VARIANT_MAP\r\n\r\n-- Reverse lookup maps\r\nlocal SET_MAP_REV = {}\r\nfor k, v in pairs(SET_MAP) do\r\n    SET_MAP_REV[v] = k\r\nend\r\n\r\nlocal VARIANT_MAP_REV = {}\r\nfor k, v in pairs(VARIANT_MAP) do\r\n    VARIANT_MAP_REV[v] = k\r\nend\r\n\r\n---------------------------------------------------------------------\r\n-- CARD CODE HELPERS\r\n---------------------------------------------------------------------\r\nlocal function parseCardCode(cardCode)\r\n    local set, rest = cardCode:match(\"^([^%-]+)%-(.+)$\")\r\n    if not set or not rest then\r\n        error(\"Invalid card code format: \" .. tostring(cardCode))\r\n    end\r\n\r\n    local number, variant = rest:match(\"^(%d+)([a-z%*]?)$\")\r\n    if not number then\r\n        error(\"Invalid card code format: \" .. tostring(cardCode))\r\n    end\r\n\r\n    return set, number, variant or \"\"\r\nend\r\n\r\nlocal function groupBySetAndVariant(cards)\r\n    local groups = {}\r\n    local list = {}\r\n\r\n    for _, card in ipairs(cards) do\r\n        local set, number, variant = parseCardCode(card.cardCode)\r\n\r\n        local setValue = SET_MAP[set]\r\n        if setValue == nil then\r\n            error(\"Unknown set: \" .. tostring(set))\r\n        end\r\n\r\n        local variantValue = VARIANT_MAP[variant]\r\n        if variantValue == nil then\r\n            error(\"Unknown variant: \" .. tostring(variant))\r\n        end\r\n\r\n        local key = tostring(setValue) .. \":\" .. tostring(variantValue)\r\n        local group = groups[key]\r\n        if not group then\r\n            group = {\r\n                set = setValue,\r\n                variant = variantValue,\r\n                cardNumbers = {},\r\n            }\r\n            groups[key] = group\r\n            list[#list + 1] = group\r\n        end\r\n\r\n        group.cardNumbers[#group.cardNumbers + 1] = number\r\n    end\r\n\r\n    table.sort(list, function(a, b)\r\n        if a.set ~= b.set then\r\n            return a.set < b.set\r\n        end\r\n        return a.variant < b.variant\r\n    end)\r\n\r\n    for _, group in ipairs(list) do\r\n        table.sort(group.cardNumbers, function(a, b)\r\n            return tonumber(a) < tonumber(b)\r\n        end)\r\n    end\r\n\r\n    return list\r\nend\r\n\r\n---------------------------------------------------------------------\r\n-- DECODE A SECTION (main deck or sideboard)\r\n---------------------------------------------------------------------\r\nlocal function decodeDeckSection(bytes, pos, maxCount, signedSuffix)\r\n    local results = {}\r\n    signedSuffix = signedSuffix or \"s\"\r\n\r\n    for count = maxCount, 1, -1 do\r\n        local numGroups, err = readVarint(bytes, pos)\r\n        if not numGroups then\r\n            error(err)\r\n        end\r\n\r\n        for _ = 1, numGroups do\r\n            local numCards, err = readVarint(bytes, pos)\r\n            if not numCards then\r\n                error(err)\r\n            end\r\n\r\n            -- set and variant are RAW BYTES (not varints)\r\n            if pos.pos + 1 > #bytes then\r\n                error(\"Unexpected EOF reading set/variant\")\r\n            end\r\n\r\n            local setValue = bytes[pos.pos]\r\n            pos.pos = pos.pos + 1\r\n\r\n            local varValue = bytes[pos.pos]\r\n            pos.pos = pos.pos + 1\r\n\r\n            local setCode = SET_MAP_REV[setValue]\r\n            local variantCode = nil\r\n\r\n            if not setCode then\r\n                error(\"Unknown set code: \" .. tostring(setValue))\r\n            end\r\n\r\n            if varValue == 2 then\r\n                variantCode = signedSuffix\r\n            else\r\n                variantCode = VARIANT_MAP_REV[varValue]\r\n            end\r\n\r\n            for i = 1, numCards do\r\n                local cardNumber, err = readVarint(bytes, pos)\r\n                if not cardNumber then\r\n                    error(err)\r\n                end\r\n\r\n                table.insert(results, {\r\n                    cardCode = string.format(\r\n                        \"%s-%03d%s\",\r\n                        setCode,\r\n                        cardNumber,\r\n                        variantCode or \"\"\r\n                    ),\r\n                    count = count\r\n                })\r\n            end\r\n        end\r\n    end\r\n\r\n    return results\r\nend\r\n\r\nlocal function decodeChosenChampion(bytes, pos, signedSuffix)\r\n    signedSuffix = signedSuffix or \"s\"\r\n\r\n    -- Read presence flag (exactly 1 byte)\r\n    if pos.pos > #bytes then\r\n        return nil\r\n    end\r\n\r\n    local hasChampion = bytes[pos.pos]\r\n    pos.pos = pos.pos + 1\r\n\r\n    if hasChampion ~= 0x01 then\r\n        -- 0x00 -> no chosen champion\r\n        return nil\r\n    end\r\n\r\n    -- Next: set (1 byte), variant (1 byte)\r\n    if pos.pos + 1 > #bytes then\r\n        error(\"Unexpected EOF reading chosen champion set/variant\")\r\n    end\r\n\r\n    local setValue = bytes[pos.pos]\r\n    local varValue = bytes[pos.pos + 1]\r\n    pos.pos = pos.pos + 2\r\n\r\n    local setCode = SET_MAP_REV[setValue]\r\n    if not setCode then\r\n        error(\"Unknown set code in chosen champion: \" .. tostring(setValue))\r\n    end\r\n\r\n    local variantCode = nil\r\n    if varValue == 2 then\r\n        variantCode = signedSuffix\r\n    else\r\n        variantCode = VARIANT_MAP_REV[varValue]\r\n    end\r\n\r\n    -- Finally: card number (varint)\r\n    local cardNumber, err = readVarint(bytes, pos)\r\n    if not cardNumber then\r\n        error(err)\r\n    end\r\n\r\n    return string.format(\r\n        \"%s-%03d%s\",\r\n        setCode,\r\n        cardNumber,\r\n        variantCode or \"\"\r\n    )\r\nend\r\n\r\n---------------------------------------------------------------------\r\n-- ENCODE A SECTION (main deck or sideboard)\r\n---------------------------------------------------------------------\r\nlocal function encodeDeckSection(deck, maxCount)\r\n    local bytes = {}\r\n\r\n    for count = maxCount, 1, -1 do\r\n        local matching = {}\r\n        for _, card in ipairs(deck) do\r\n            if card.count == count then\r\n                matching[#matching + 1] = card\r\n            end\r\n        end\r\n\r\n        local groups = groupBySetAndVariant(matching)\r\n        appendBytes(bytes, writeVarint(#groups))\r\n\r\n        for _, group in ipairs(groups) do\r\n            appendBytes(bytes, writeVarint(#group.cardNumbers))\r\n            bytes[#bytes + 1] = group.set\r\n            bytes[#bytes + 1] = group.variant\r\n\r\n            for _, cardNumber in ipairs(group.cardNumbers) do\r\n                appendBytes(bytes, writeVarint(tonumber(cardNumber)))\r\n            end\r\n        end\r\n    end\r\n\r\n    return bytes\r\nend\r\n\r\n---------------------------------------------------------------------\r\n-- PUBLIC API\r\n---------------------------------------------------------------------\r\nfunction M.decode(code, options)\r\n    local rawBytes = base32Decode(code)\r\n    if not rawBytes then\r\n        return nil\r\n    end\r\n\r\n    local pos = { pos = 1 }\r\n    local signedSuffix = (options and options.signedSuffix) or \"s\"\r\n\r\n    -- Header\r\n    local FV = rawBytes[pos.pos]\r\n    pos.pos = pos.pos + 1\r\n\r\n    local format = bit32.band(bit32.rshift(FV, 4), 0x0F)\r\n    local version = bit32.band(FV, 0x0F)\r\n\r\n    if format ~= 1 then\r\n        error(\"Unsupported format: \" .. format)\r\n    end\r\n\r\n    -- Main deck\r\n    local main = decodeDeckSection(rawBytes, pos, 12, signedSuffix)\r\n\r\n    -- Sideboard\r\n    local side = {}\r\n    if version >= 2 then\r\n        side = decodeDeckSection(rawBytes, pos, 3, signedSuffix)\r\n    end\r\n\r\n    -- Chosen champion (version 3+)\r\n    local chosenChampion = nil\r\n    if version >= 3 then\r\n        chosenChampion = decodeChosenChampion(rawBytes, pos, signedSuffix)\r\n    end\r\n\r\n    return {\r\n        mainDeck = main,\r\n        sideDeck = side,\r\n        chosenChampion = chosenChampion,\r\n        format = format,\r\n        version = version,\r\n    }\r\nend\r\n\r\nfunction M.encode(mainDeck, sideDeck, chosenChampion)\r\n    local bytes = {}\r\n\r\n    -- Always emit format 1, version 3 for parity with TS\r\n    bytes[#bytes + 1] = bit.bor(bit.lshift(1, 4), 3)\r\n\r\n    appendBytes(bytes, encodeDeckSection(mainDeck or {}, 12))\r\n    appendBytes(bytes, encodeDeckSection(sideDeck or {}, 3))\r\n\r\n    if chosenChampion then\r\n        local set, number, variant = parseCardCode(chosenChampion)\r\n        local setValue = SET_MAP[set]\r\n        if setValue == nil then\r\n            error(\"Unknown set in chosen champion: \" .. tostring(set))\r\n        end\r\n\r\n        local variantValue = VARIANT_MAP[variant]\r\n        if variantValue == nil then\r\n            error(\"Unknown variant in chosen champion: \" .. tostring(variant))\r\n        end\r\n\r\n        bytes[#bytes + 1] = 0x01\r\n        bytes[#bytes + 1] = setValue\r\n        bytes[#bytes + 1] = variantValue\r\n        appendBytes(bytes, writeVarint(tonumber(number)))\r\n    else\r\n        bytes[#bytes + 1] = 0x00\r\n    end\r\n\r\n    return base32Encode(bytes)\r\nend\r\n\r\nfunction decode_json(params)\r\n  local code = params.code\r\n  local decoded = M.decode(code)\r\n  return JSON.encode(decoded)\r\nend\r\n\r\nfunction onLoad(saved_data)\r\n  Global.setVar('Cyberpunk_DeckCodes', self)\r\nend",
      "LuaScriptState": ""
    },
    {
      "GUID": "e6da45",
      "Name": "CardCustom",
      "Transform": {
        "posX": 25.40638,
        "posY": 0.9736049,
        "posZ": 9.850348,
        "rotX": -4.00712779e-08,
        "rotY": -3.0487221e-05,
        "rotZ": -1.50735275e-07,
        "scaleX": 0.8,
        "scaleY": 1.0,
        "scaleZ": 0.9
      },
      "Nickname": "Quick Actions Panel",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 0.713235259,
        "g": 0.713235259,
        "b": 0.713235259
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": false,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": true,
      "Hands": true,
      "CardID": 401600,
      "SidewaysCard": false,
      "CustomDeck": {
        "4016": {
          "FaceURL": "https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/",
          "BackURL": "https://steamusercontent-a.akamaihd.net/ugc/12405230528622771829/BA405BAD53CDE55389B7F38E81D6653A904E66C0/",
          "NumWidth": 1,
          "NumHeight": 1,
          "BackIsHidden": true,
          "UniqueBack": false,
          "Type": 0
        }
      },
      "LuaScript": "function getCorrectRotation()\r\n  local sideOfTable = self.getPosition().z > 0\r\n  return sideOfTable and {0,0,0} or {0,180,0}\r\nend\r\n\r\nfunction onDrop(color)\r\n    self.setRotationSmooth(getCorrectRotation(), false, true)\r\nend\r\n\r\nfunction onLoad()\r\n  -- ---------- Side drop-zone button ----------\r\n  self.createButton({\r\n      label          = \"♻\",\r\n      click_function = \"linkToDeckBottom\",\r\n      function_owner = Global,\r\n      position       = {3, -0.35, 0},\r\n      rotation       = {0, 0, 0},\r\n      width          = 1400,\r\n      height         = 1200,\r\n      font_size      = 600,\r\n      color          = {0.44, 0.66, 0.77, 1},\r\n      font_color     = {0, 0, 0, 1},\r\n      tooltip        = \"Drop cards here to recycle\",\r\n  })\r\n  Wait.frames(function() buildQuickActionUI() end, 10)\r\nend\r\n\r\nlocal function findById(node, wantId)\r\n  if type(node) ~= \"table\" then return nil end\r\n\r\n  local attrs = node.attributes\r\n  if attrs and attrs.id == wantId then\r\n    return node\r\n  end\r\n\r\n  local kids = node.children\r\n  if kids then\r\n    for _, child in ipairs(kids) do\r\n      local found = findById(child, wantId)\r\n      if found then return found end\r\n    end\r\n  end\r\n\r\n  return nil\r\nend\r\n\r\nfunction buildQuickActionUI()\r\n  local buttons = Global.getVar(\"QUICK_ACTION_BUTTONS\")\r\n  if type(buttons) ~= \"table\" then return end\r\n\r\n  local alternatingColors = {\r\n    \"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\",\r\n    \"#70A8C4|#90C8E4|#4088A4|#D8F0FF\",\r\n  }\r\n  local colorIndex = 1\r\n\r\n  local buttonChildren = {}\r\n  for _, entry in ipairs(buttons) do\r\n    local fn = entry.fn or entry.function_name\r\n    local label = entry.label or entry.text\r\n    if fn and label then\r\n      if not tostring(fn):match(\"^Global/\") then\r\n        fn = \"Global/\" .. tostring(fn)\r\n      end\r\n\r\n      table.insert(buttonChildren, {\r\n        tag = \"Button\",\r\n        attributes = {\r\n          colors = alternatingColors[colorIndex],\r\n          fontStyle = \"Bold\",\r\n          fontSize = \"50\",\r\n          onClick = fn,\r\n        },\r\n        value = tostring(label),\r\n      })\r\n\r\n      colorIndex = 3 - colorIndex\r\n    end\r\n  end\r\n\r\n  local xml = self.UI.getXmlTable()\r\n  local grid = findById(xml[1], \"quick_action_grid\")\r\n  if not grid then\r\n    print(\"[QuickActions] Could not find GridLayout id=quick_action_grid\")\r\n    return\r\n  end\r\n\r\n  grid.children = buttonChildren\r\n  self.UI.setXmlTable(xml)\r\nend",
      "LuaScriptState": "",
      "XmlUI": "<Panel\n  id=\"quick_action_token\"\n  position=\"-170 300 4\"\n  rotation=\"180 180 0\"\n  width=\"300\" height=\"200\"\n  scale=\"1.7 2 1\"\n>\n  <Panel position=\"0 -20 0\" width=\"250\" height=\"120\" rotation=\"0 0 0\">\n      <GridLayout id=\"quick_action_grid\" cellSize=\"300 80\" spacing=\"10 10\" childAlignment=\"MiddleCenter\">\n          <Button\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/beginNewTurnProcedure\"\n          >Begin Turn</Button>\n          <Button\n            colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/endTurnProcedure\"\n          >End Turn</Button>\n          <Button\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/glimpseQuickAction\"\n          >Peek 1</Button>\n          <Button\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/revealQuickAction\"\n          >Reveal 1</Button>\n          <Button\n            colors=\"#70A8C4|#90C8E4|#4088A4|#D8F0FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/clearPlaymat\"\n          >Clear Mat</Button>\n          <Button\n            colors=\"#88B8E8|#A8D8FF|#5088C8|#E8F8FF\"\n            fontStyle=\"Bold\"\n            fontSize=\"50\"\n            onClick=\"Global/resetToGameStart\"\n          >GG Go Next</Button>\n       </GridLayout>\n  </Panel>\n\n</Panel>"
    },
    {
      "GUID": "fad044",
      "Name": "ScriptingTrigger",
      "Transform": {
        "posX": 0.0,
        "posY": 10.0,
        "posZ": 0.0,
        "rotX": 0.0,
        "rotY": 0.0,
        "rotZ": 0.0,
        "scaleX": 24.0,
        "scaleY": 4.0,
        "scaleZ": 5.0
      },
      "Nickname": "",
      "Description": "",
      "GMNotes": "",
      "AltLookAngle": {
        "x": 0.0,
        "y": 0.0,
        "z": 0.0
      },
      "ColorDiffuse": {
        "r": 1.0,
        "g": 1.0,
        "b": 1.0,
        "a": 0.509803951
      },
      "LayoutGroupSortIndex": 0,
      "Value": 0,
      "Locked": true,
      "Grid": true,
      "Snap": true,
      "IgnoreFoW": false,
      "MeasureMovement": false,
      "DragSelectable": true,
      "Autoraise": true,
      "Sticky": true,
      "Tooltip": true,
      "GridProjection": false,
      "HideWhenFaceDown": false,
      "Hands": false,
      "LuaScript": "",
      "LuaScriptState": "",
      "XmlUI": ""
    }
  ],
  "VectorLines": []
}
